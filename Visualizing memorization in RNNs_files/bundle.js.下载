(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
var AwaitValue=require("./AwaitValue");function AsyncGenerator(e){var t,n;function r(t,n){try{var u=e[t](n),a=u.value,i=a instanceof AwaitValue;Promise.resolve(i?a.wrapped:a).then(function(e){i?r("next",e):o(u.done?"return":"normal",e)},function(e){r("throw",e)})}catch(e){o("throw",e)}}function o(e,o){switch(e){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,o){return new Promise(function(u,a){var i={key:e,arg:o,resolve:u,reject:a,next:null};n?n=n.next=i:(t=n=i,r(e,o))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(AsyncGenerator.prototype[Symbol.asyncIterator]=function(){return this}),AsyncGenerator.prototype.next=function(e){return this._invoke("next",e)},AsyncGenerator.prototype.throw=function(e){return this._invoke("throw",e)},AsyncGenerator.prototype.return=function(e){return this._invoke("return",e)},module.exports=AsyncGenerator;

},{"./AwaitValue":2}],2:[function(require,module,exports){
function _AwaitValue(a){this.wrapped=a}module.exports=_AwaitValue;

},{}],3:[function(require,module,exports){
function _arrayWithHoles(r){if(Array.isArray(r))return r}module.exports=_arrayWithHoles;

},{}],4:[function(require,module,exports){
function _arrayWithoutHoles(r){if(Array.isArray(r)){for(var t=0,a=new Array(r.length);t<r.length;t++)a[t]=r[t];return a}}module.exports=_arrayWithoutHoles;

},{}],5:[function(require,module,exports){
function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}module.exports=_assertThisInitialized;

},{}],6:[function(require,module,exports){
function _asyncIterator(r){var t;if("function"==typeof Symbol){if(Symbol.asyncIterator&&null!=(t=r[Symbol.asyncIterator]))return t.call(r);if(Symbol.iterator&&null!=(t=r[Symbol.iterator]))return t.call(r)}throw new TypeError("Object is not async iterable")}module.exports=_asyncIterator;

},{}],7:[function(require,module,exports){
function asyncGeneratorStep(n,e,r,t,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void r(n)}i.done?e(u):Promise.resolve(u).then(t,o)}function _asyncToGenerator(n){return function(){var e=this,r=arguments;return new Promise(function(t,o){var a=n.apply(e,r);function c(n){asyncGeneratorStep(a,t,o,c,i,"next",n)}function i(n){asyncGeneratorStep(a,t,o,c,i,"throw",n)}c(void 0)})}}module.exports=_asyncToGenerator;

},{}],8:[function(require,module,exports){
var AwaitValue=require("./AwaitValue");function _awaitAsyncGenerator(a){return new AwaitValue(a)}module.exports=_awaitAsyncGenerator;

},{"./AwaitValue":2}],9:[function(require,module,exports){
function _classCallCheck(a,l){if(!(a instanceof l))throw new TypeError("Cannot call a class as a function")}module.exports=_classCallCheck;

},{}],10:[function(require,module,exports){
function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}module.exports=_createClass;

},{}],11:[function(require,module,exports){
function _getPrototypeOf(t){return module.exports=_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}module.exports=_getPrototypeOf;

},{}],12:[function(require,module,exports){
var setPrototypeOf=require("./setPrototypeOf");function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&setPrototypeOf(e,t)}module.exports=_inherits;

},{"./setPrototypeOf":19}],13:[function(require,module,exports){
function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}module.exports=_interopRequireDefault;

},{}],14:[function(require,module,exports){
function _iterableToArray(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}module.exports=_iterableToArray;

},{}],15:[function(require,module,exports){
function _iterableToArrayLimit(r,t){var e=[],i=!0,l=!1,a=void 0;try{for(var n,o=r[Symbol.iterator]();!(i=(n=o.next()).done)&&(e.push(n.value),!t||e.length!==t);i=!0);}catch(r){l=!0,a=r}finally{try{i||null==o.return||o.return()}finally{if(l)throw a}}return e}module.exports=_iterableToArrayLimit;

},{}],16:[function(require,module,exports){
function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}module.exports=_nonIterableRest;

},{}],17:[function(require,module,exports){
function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}module.exports=_nonIterableSpread;

},{}],18:[function(require,module,exports){
var _typeof=require("../helpers/typeof"),assertThisInitialized=require("./assertThisInitialized");function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?assertThisInitialized(e):t}module.exports=_possibleConstructorReturn;

},{"../helpers/typeof":22,"./assertThisInitialized":5}],19:[function(require,module,exports){
function _setPrototypeOf(t,o){return module.exports=_setPrototypeOf=Object.setPrototypeOf||function(t,o){return t.__proto__=o,t},_setPrototypeOf(t,o)}module.exports=_setPrototypeOf;

},{}],20:[function(require,module,exports){
var arrayWithHoles=require("./arrayWithHoles"),iterableToArrayLimit=require("./iterableToArrayLimit"),nonIterableRest=require("./nonIterableRest");function _slicedToArray(r,e){return arrayWithHoles(r)||iterableToArrayLimit(r,e)||nonIterableRest()}module.exports=_slicedToArray;

},{"./arrayWithHoles":3,"./iterableToArrayLimit":15,"./nonIterableRest":16}],21:[function(require,module,exports){
var arrayWithoutHoles=require("./arrayWithoutHoles"),iterableToArray=require("./iterableToArray"),nonIterableSpread=require("./nonIterableSpread");function _toConsumableArray(r){return arrayWithoutHoles(r)||iterableToArray(r)||nonIterableSpread()}module.exports=_toConsumableArray;

},{"./arrayWithoutHoles":4,"./iterableToArray":14,"./nonIterableSpread":17}],22:[function(require,module,exports){
function _typeof2(o){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}function _typeof(o){return"function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?module.exports=_typeof=function(o){return _typeof2(o)}:module.exports=_typeof=function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":_typeof2(o)},_typeof(o)}module.exports=_typeof;

},{}],23:[function(require,module,exports){
var AsyncGenerator=require("./AsyncGenerator");function _wrapAsyncGenerator(r){return function(){return new AsyncGenerator(r.apply(this,arguments))}}module.exports=_wrapAsyncGenerator;

},{"./AsyncGenerator":1}],24:[function(require,module,exports){
var g=function(){return this||"object"==typeof self&&self}()||Function("return this")(),hadRuntime=g.regeneratorRuntime&&Object.getOwnPropertyNames(g).indexOf("regeneratorRuntime")>=0,oldRuntime=hadRuntime&&g.regeneratorRuntime;if(g.regeneratorRuntime=void 0,module.exports=require("./runtime"),hadRuntime)g.regeneratorRuntime=oldRuntime;else try{delete g.regeneratorRuntime}catch(e){g.regeneratorRuntime=void 0}

},{"./runtime":25}],25:[function(require,module,exports){
!function(t){"use strict";var r,e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag",u="object"==typeof module,h=t.regeneratorRuntime;if(h)u&&(module.exports=h);else{(h=t.regeneratorRuntime=u?module.exports:{}).wrap=w;var f="suspendedStart",s="suspendedYield",l="executing",p="completed",y={},v={};v[i]=function(){return this};var d=Object.getPrototypeOf,g=d&&d(d(P([])));g&&g!==e&&n.call(g,i)&&(v=g);var m=b.prototype=x.prototype=Object.create(v);E.prototype=m.constructor=b,b.constructor=E,b[c]=E.displayName="GeneratorFunction",h.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===E||"GeneratorFunction"===(r.displayName||r.name))},h.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c in t||(t[c]="GeneratorFunction")),t.prototype=Object.create(m),t},h.awrap=function(t){return{__await:t}},_(j.prototype),j.prototype[a]=function(){return this},h.AsyncIterator=j,h.async=function(t,r,e,n){var o=new j(w(t,r,e,n));return h.isGeneratorFunction(r)?o:o.next().then(function(t){return t.done?t.value:o.next()})},_(m),m[c]="Generator",m[i]=function(){return this},m.toString=function(){return"[object Generator]"},h.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},h.values=P,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(G),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function o(n,o){return c.type="throw",c.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),h=n.call(a,"finallyLoc");if(u&&h){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,r){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),y},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),G(e),y}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;G(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),y}}}function w(t,r,e,n){var o=r&&r.prototype instanceof x?r:x,i=Object.create(o.prototype),a=new N(n||[]);return i._invoke=function(t,r,e){var n=f;return function(o,i){if(n===l)throw new Error("Generator is already running");if(n===p){if("throw"===o)throw i;return F()}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var c=O(a,e);if(c){if(c===y)continue;return c}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if(n===f)throw n=p,e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n=l;var u=L(t,r,e);if("normal"===u.type){if(n=e.done?p:s,u.arg===y)continue;return{value:u.arg,done:e.done}}"throw"===u.type&&(n=p,e.method="throw",e.arg=u.arg)}}}(t,e,a),i}function L(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}function x(){}function E(){}function b(){}function _(t){["next","throw","return"].forEach(function(r){t[r]=function(t){return this._invoke(r,t)}})}function j(t){var r;this._invoke=function(e,o){function i(){return new Promise(function(r,i){!function r(e,o,i,a){var c=L(t[e],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==typeof h&&n.call(h,"__await")?Promise.resolve(h.__await).then(function(t){r("next",t,i,a)},function(t){r("throw",t,i,a)}):Promise.resolve(h).then(function(t){u.value=t,i(u)},function(t){return r("throw",t,i,a)})}a(c.arg)}(e,o,r,i)})}return r=r?r.then(i,i):i()}}function O(t,e){var n=t.iterator[e.method];if(n===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=r,O(t,e),"throw"===e.method))return y;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var o=L(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,y;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,y):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,y)}function k(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function G(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function P(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function e(){for(;++o<t.length;)if(n.call(t,o))return e.value=t[o],e.done=!1,e;return e.value=r,e.done=!0,e};return a.next=a}}return{next:F}}function F(){return{value:r,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")());

},{}],26:[function(require,module,exports){
module.exports=require("regenerator-runtime");

},{"regenerator-runtime":24}],27:[function(require,module,exports){

},{}],28:[function(require,module,exports){
!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(n.d3=n.d3||{})}(this,function(n){"use strict";function r(n,r){return n<r?-1:n>r?1:n>=r?0:NaN}function t(n){var t;return 1===n.length&&(t=n,n=function(n,e){return r(t(n),e)}),{left:function(r,t,e,o){for(null==e&&(e=0),null==o&&(o=r.length);e<o;){var u=e+o>>>1;n(r[u],t)<0?e=u+1:o=u}return e},right:function(r,t,e,o){for(null==e&&(e=0),null==o&&(o=r.length);e<o;){var u=e+o>>>1;n(r[u],t)>0?o=u:e=u+1}return e}}}var e=t(r),o=e.right,u=e.left;function f(n,r){return[n,r]}function l(n){return null===n?NaN:+n}function i(n,r){var t,e,o=n.length,u=0,f=-1,i=0,a=0;if(null==r)for(;++f<o;)isNaN(t=l(n[f]))||(a+=(e=t-i)*(t-(i+=e/++u)));else for(;++f<o;)isNaN(t=l(r(n[f],f,n)))||(a+=(e=t-i)*(t-(i+=e/++u)));if(u>1)return a/(u-1)}function a(n,r){var t=i(n,r);return t?Math.sqrt(t):t}function h(n,r){var t,e,o,u=n.length,f=-1;if(null==r){for(;++f<u;)if(null!=(t=n[f])&&t>=t)for(e=o=t;++f<u;)null!=(t=n[f])&&(e>t&&(e=t),o<t&&(o=t))}else for(;++f<u;)if(null!=(t=r(n[f],f,n))&&t>=t)for(e=o=t;++f<u;)null!=(t=r(n[f],f,n))&&(e>t&&(e=t),o<t&&(o=t));return[e,o]}var c=Array.prototype,s=c.slice,g=c.map;function v(n){return function(){return n}}function M(n){return n}function p(n,r,t){n=+n,r=+r,t=(o=arguments.length)<2?(r=n,n=0,1):o<3?1:+t;for(var e=-1,o=0|Math.max(0,Math.ceil((r-n)/t)),u=new Array(o);++e<o;)u[e]=n+e*t;return u}var d=Math.sqrt(50),y=Math.sqrt(10),N=Math.sqrt(2);function m(n,r,t){var e=(r-n)/Math.max(0,t),o=Math.floor(Math.log(e)/Math.LN10),u=e/Math.pow(10,o);return o>=0?(u>=d?10:u>=y?5:u>=N?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(u>=d?10:u>=y?5:u>=N?2:1)}function w(n,r,t){var e=Math.abs(r-n)/Math.max(0,t),o=Math.pow(10,Math.floor(Math.log(e)/Math.LN10)),u=e/o;return u>=d?o*=10:u>=y?o*=5:u>=N&&(o*=2),r<n?-o:o}function A(n){return Math.ceil(Math.log(n.length)/Math.LN2)+1}function x(n,r,t){if(null==t&&(t=l),e=n.length){if((r=+r)<=0||e<2)return+t(n[0],0,n);if(r>=1)return+t(n[e-1],e-1,n);var e,o=(e-1)*r,u=Math.floor(o),f=+t(n[u],u,n);return f+(+t(n[u+1],u+1,n)-f)*(o-u)}}function b(n,r){var t,e,o=n.length,u=-1;if(null==r){for(;++u<o;)if(null!=(t=n[u])&&t>=t)for(e=t;++u<o;)null!=(t=n[u])&&e>t&&(e=t)}else for(;++u<o;)if(null!=(t=r(n[u],u,n))&&t>=t)for(e=t;++u<o;)null!=(t=r(n[u],u,n))&&e>t&&(e=t);return e}function q(n){if(!(o=n.length))return[];for(var r=-1,t=b(n,L),e=new Array(t);++r<t;)for(var o,u=-1,f=e[r]=new Array(o);++u<o;)f[u]=n[u][r];return e}function L(n){return n.length}n.bisect=o,n.bisectRight=o,n.bisectLeft=u,n.ascending=r,n.bisector=t,n.cross=function(n,r,t){var e,o,u,l,i=n.length,a=r.length,h=new Array(i*a);for(null==t&&(t=f),e=u=0;e<i;++e)for(l=n[e],o=0;o<a;++o,++u)h[u]=t(l,r[o]);return h},n.descending=function(n,r){return r<n?-1:r>n?1:r>=n?0:NaN},n.deviation=a,n.extent=h,n.histogram=function(){var n=M,r=h,t=A;function e(e){var u,f,l=e.length,i=new Array(l);for(u=0;u<l;++u)i[u]=n(e[u],u,e);var a=r(i),h=a[0],c=a[1],s=t(i,h,c);Array.isArray(s)||(s=w(h,c,s),s=p(Math.ceil(h/s)*s,c,s));for(var g=s.length;s[0]<=h;)s.shift(),--g;for(;s[g-1]>c;)s.pop(),--g;var v,M=new Array(g+1);for(u=0;u<=g;++u)(v=M[u]=[]).x0=u>0?s[u-1]:h,v.x1=u<g?s[u]:c;for(u=0;u<l;++u)h<=(f=i[u])&&f<=c&&M[o(s,f,0,g)].push(e[u]);return M}return e.value=function(r){return arguments.length?(n="function"==typeof r?r:v(r),e):n},e.domain=function(n){return arguments.length?(r="function"==typeof n?n:v([n[0],n[1]]),e):r},e.thresholds=function(n){return arguments.length?(t="function"==typeof n?n:Array.isArray(n)?v(s.call(n)):v(n),e):t},e},n.thresholdFreedmanDiaconis=function(n,t,e){return n=g.call(n,l).sort(r),Math.ceil((e-t)/(2*(x(n,.75)-x(n,.25))*Math.pow(n.length,-1/3)))},n.thresholdScott=function(n,r,t){return Math.ceil((t-r)/(3.5*a(n)*Math.pow(n.length,-1/3)))},n.thresholdSturges=A,n.max=function(n,r){var t,e,o=n.length,u=-1;if(null==r){for(;++u<o;)if(null!=(t=n[u])&&t>=t)for(e=t;++u<o;)null!=(t=n[u])&&t>e&&(e=t)}else for(;++u<o;)if(null!=(t=r(n[u],u,n))&&t>=t)for(e=t;++u<o;)null!=(t=r(n[u],u,n))&&t>e&&(e=t);return e},n.mean=function(n,r){var t,e=n.length,o=e,u=-1,f=0;if(null==r)for(;++u<e;)isNaN(t=l(n[u]))?--o:f+=t;else for(;++u<e;)isNaN(t=l(r(n[u],u,n)))?--o:f+=t;if(o)return f/o},n.median=function(n,t){var e,o=n.length,u=-1,f=[];if(null==t)for(;++u<o;)isNaN(e=l(n[u]))||f.push(e);else for(;++u<o;)isNaN(e=l(t(n[u],u,n)))||f.push(e);return x(f.sort(r),.5)},n.merge=function(n){for(var r,t,e,o=n.length,u=-1,f=0;++u<o;)f+=n[u].length;for(t=new Array(f);--o>=0;)for(r=(e=n[o]).length;--r>=0;)t[--f]=e[r];return t},n.min=b,n.pairs=function(n,r){null==r&&(r=f);for(var t=0,e=n.length-1,o=n[0],u=new Array(e<0?0:e);t<e;)u[t]=r(o,o=n[++t]);return u},n.permute=function(n,r){for(var t=r.length,e=new Array(t);t--;)e[t]=n[r[t]];return e},n.quantile=x,n.range=p,n.scan=function(n,t){if(e=n.length){var e,o,u=0,f=0,l=n[f];for(null==t&&(t=r);++u<e;)(t(o=n[u],l)<0||0!==t(l,l))&&(l=o,f=u);return 0===t(l,l)?f:void 0}},n.shuffle=function(n,r,t){for(var e,o,u=(null==t?n.length:t)-(r=null==r?0:+r);u;)o=Math.random()*u--|0,e=n[u+r],n[u+r]=n[o+r],n[o+r]=e;return n},n.sum=function(n,r){var t,e=n.length,o=-1,u=0;if(null==r)for(;++o<e;)(t=+n[o])&&(u+=t);else for(;++o<e;)(t=+r(n[o],o,n))&&(u+=t);return u},n.ticks=function(n,r,t){var e,o,u,f,l=-1;if(t=+t,(n=+n)==(r=+r)&&t>0)return[n];if((e=r<n)&&(o=n,n=r,r=o),0===(f=m(n,r,t))||!isFinite(f))return[];if(f>0)for(n=Math.ceil(n/f),r=Math.floor(r/f),u=new Array(o=Math.ceil(r-n+1));++l<o;)u[l]=(n+l)*f;else for(n=Math.floor(n*f),r=Math.ceil(r*f),u=new Array(o=Math.ceil(n-r+1));++l<o;)u[l]=(n-l)/f;return e&&u.reverse(),u},n.tickIncrement=m,n.tickStep=w,n.transpose=q,n.variance=i,n.zip=function(){return q(arguments)},Object.defineProperty(n,"__esModule",{value:!0})});

},{}],29:[function(require,module,exports){
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.d3=t.d3||{})}(this,function(t){"use strict";var n=Array.prototype.slice;function r(t){return t}var e=1,i=2,a=3,o=4,u=1e-6;function c(t){return"translate("+(t+.5)+",0)"}function l(t){return"translate(0,"+(t+.5)+")"}function s(){return!this.__axis}function f(t,f){var d=[],m=null,p=null,h=6,g=6,x=3,k=t===e||t===o?-1:1,y=t===o||t===i?"x":"y",v=t===e||t===a?c:l;function M(n){var c=null==m?f.ticks?f.ticks.apply(f,d):f.domain():m,l=null==p?f.tickFormat?f.tickFormat.apply(f,d):r:p,M=Math.max(h,0)+x,_=f.range(),b=+_[0]+.5,A=+_[_.length-1]+.5,F=(f.bandwidth?function(t){var n=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(n=Math.round(n)),function(r){return+t(r)+n}}:function(t){return function(n){return+t(n)}})(f.copy()),V=n.selection?n.selection():n,z=V.selectAll(".domain").data([null]),H=V.selectAll(".tick").data(c,f).order(),C=H.exit(),S=H.enter().append("g").attr("class","tick"),j=H.select("line"),w=H.select("text");z=z.merge(z.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),H=H.merge(S),j=j.merge(S.append("line").attr("stroke","currentColor").attr(y+"2",k*h)),w=w.merge(S.append("text").attr("fill","currentColor").attr(y,k*M).attr("dy",t===e?"0em":t===a?"0.71em":"0.32em")),n!==V&&(z=z.transition(n),H=H.transition(n),j=j.transition(n),w=w.transition(n),C=C.transition(n).attr("opacity",u).attr("transform",function(t){return isFinite(t=F(t))?v(t):this.getAttribute("transform")}),S.attr("opacity",u).attr("transform",function(t){var n=this.parentNode.__axis;return v(n&&isFinite(n=n(t))?n:F(t))})),C.remove(),z.attr("d",t===o||t==i?g?"M"+k*g+","+b+"H0.5V"+A+"H"+k*g:"M0.5,"+b+"V"+A:g?"M"+b+","+k*g+"V0.5H"+A+"V"+k*g:"M"+b+",0.5H"+A),H.attr("opacity",1).attr("transform",function(t){return v(F(t))}),j.attr(y+"2",k*h),w.attr(y,k*M).text(l),V.filter(s).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===i?"start":t===o?"end":"middle"),V.each(function(){this.__axis=F})}return M.scale=function(t){return arguments.length?(f=t,M):f},M.ticks=function(){return d=n.call(arguments),M},M.tickArguments=function(t){return arguments.length?(d=null==t?[]:n.call(t),M):d.slice()},M.tickValues=function(t){return arguments.length?(m=null==t?null:n.call(t),M):m&&m.slice()},M.tickFormat=function(t){return arguments.length?(p=t,M):p},M.tickSize=function(t){return arguments.length?(h=g=+t,M):h},M.tickSizeInner=function(t){return arguments.length?(h=+t,M):h},M.tickSizeOuter=function(t){return arguments.length?(g=+t,M):g},M.tickPadding=function(t){return arguments.length?(x=+t,M):x},M}t.axisTop=function(t){return f(e,t)},t.axisRight=function(t){return f(i,t)},t.axisBottom=function(t){return f(a,t)},t.axisLeft=function(t){return f(o,t)},Object.defineProperty(t,"__esModule",{value:!0})});

},{}],30:[function(require,module,exports){
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.d3=n.d3||{})}(this,function(n){"use strict";function t(){}function e(n,e){var r=new t;if(n instanceof t)n.each(function(n,t){r.set(t,n)});else if(Array.isArray(n)){var i,u=-1,o=n.length;if(null==e)for(;++u<o;)r.set(u,n[u]);else for(;++u<o;)r.set(e(i=n[u],u,n),i)}else if(n)for(var s in n)r.set(s,n[s]);return r}function r(){return{}}function i(n,t,e){n[t]=e}function u(){return e()}function o(n,t,e){n.set(t,e)}function s(){}t.prototype=e.prototype={constructor:t,has:function(n){return"$"+n in this},get:function(n){return this["$"+n]},set:function(n,t){return this["$"+n]=t,this},remove:function(n){var t="$"+n;return t in this&&delete this[t]},clear:function(){for(var n in this)"$"===n[0]&&delete this[n]},keys:function(){var n=[];for(var t in this)"$"===t[0]&&n.push(t.slice(1));return n},values:function(){var n=[];for(var t in this)"$"===t[0]&&n.push(this[t]);return n},entries:function(){var n=[];for(var t in this)"$"===t[0]&&n.push({key:t.slice(1),value:this[t]});return n},size:function(){var n=0;for(var t in this)"$"===t[0]&&++n;return n},empty:function(){for(var n in this)if("$"===n[0])return!1;return!0},each:function(n){for(var t in this)"$"===t[0]&&n(this[t],t.slice(1),this)}};var f=e.prototype;function c(n,t){var e=new s;if(n instanceof s)n.each(function(n){e.add(n)});else if(n){var r=-1,i=n.length;if(null==t)for(;++r<i;)e.add(n[r]);else for(;++r<i;)e.add(t(n[r],r,n))}return e}s.prototype=c.prototype={constructor:s,has:f.has,add:function(n){return this["$"+(n+="")]=n,this},remove:f.remove,clear:f.clear,values:f.keys,size:f.size,empty:f.empty,each:f.each},n.nest=function(){var n,t,s,f=[],c=[];function a(r,i,u,o){if(i>=f.length)return null!=n&&r.sort(n),null!=t?t(r):r;for(var s,c,h,l=-1,v=r.length,p=f[i++],y=e(),d=u();++l<v;)(h=y.get(s=p(c=r[l])+""))?h.push(c):y.set(s,[c]);return y.each(function(n,t){o(d,t,a(n,i,u,o))}),d}return s={object:function(n){return a(n,0,r,i)},map:function(n){return a(n,0,u,o)},entries:function(n){return function n(e,r){if(++r>f.length)return e;var i,u=c[r-1];return null!=t&&r>=f.length?i=e.entries():(i=[],e.each(function(t,e){i.push({key:e,values:n(t,r)})})),null!=u?i.sort(function(n,t){return u(n.key,t.key)}):i}(a(n,0,u,o),0)},key:function(n){return f.push(n),s},sortKeys:function(n){return c[f.length-1]=n,s},sortValues:function(t){return n=t,s},rollup:function(n){return t=n,s}}},n.set=c,n.map=e,n.keys=function(n){var t=[];for(var e in n)t.push(e);return t},n.values=function(n){var t=[];for(var e in n)t.push(n[e]);return t},n.entries=function(n){var t=[];for(var e in n)t.push({key:e,value:n[e]});return t},Object.defineProperty(n,"__esModule",{value:!0})});

},{}],31:[function(require,module,exports){
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.d3=t.d3||{})}(this,function(t){"use strict";function e(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function n(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function i(){}var r="\\s*([+-]?\\d+)\\s*",a="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",h="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",s=/^#([0-9a-f]{3})$/,o=/^#([0-9a-f]{6})$/,l=new RegExp("^rgb\\("+[r,r,r]+"\\)$"),u=new RegExp("^rgb\\("+[h,h,h]+"\\)$"),c=new RegExp("^rgba\\("+[r,r,r,a]+"\\)$"),g=new RegExp("^rgba\\("+[h,h,h,a]+"\\)$"),d=new RegExp("^hsl\\("+[a,h,h]+"\\)$"),p=new RegExp("^hsla\\("+[a,h,h,a]+"\\)$"),f={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function b(t){var e;return t=(t+"").trim().toLowerCase(),(e=s.exec(t))?new N((e=parseInt(e[1],16))>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):(e=o.exec(t))?y(parseInt(e[1],16)):(e=l.exec(t))?new N(e[1],e[2],e[3],1):(e=u.exec(t))?new N(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=c.exec(t))?w(e[1],e[2],e[3],e[4]):(e=g.exec(t))?w(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=d.exec(t))?v(e[1],e[2]/100,e[3]/100,1):(e=p.exec(t))?v(e[1],e[2]/100,e[3]/100,e[4]):f.hasOwnProperty(t)?y(f[t]):"transparent"===t?new N(NaN,NaN,NaN,0):null}function y(t){return new N(t>>16&255,t>>8&255,255&t,1)}function w(t,e,n,i){return i<=0&&(t=e=n=NaN),new N(t,e,n,i)}function m(t){return t instanceof i||(t=b(t)),t?new N((t=t.rgb()).r,t.g,t.b,t.opacity):new N}function k(t,e,n,i){return 1===arguments.length?m(t):new N(t,e,n,null==i?1:i)}function N(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function M(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function v(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new q(t,e,n,i)}function x(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof q)return new q(t.h,t.s,t.l,t.opacity);if(t instanceof i||(t=b(t)),!t)return new q;if(t instanceof q)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),h=Math.max(e,n,r),s=NaN,o=h-a,l=(h+a)/2;return o?(s=e===h?(n-r)/o+6*(n<r):n===h?(r-e)/o+2:(e-n)/o+4,o/=l<.5?h+a:2-h-a,s*=60):o=l>0&&l<1?0:s,new q(s,o,l,t.opacity)}(t):new q(t,e,n,null==r?1:r)}function q(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function E(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}e(i,b,{displayable:function(){return this.rgb().displayable()},hex:function(){return this.rgb().hex()},toString:function(){return this.rgb()+""}}),e(N,k,n(i,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new N(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new N(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},hex:function(){return"#"+M(this.r)+M(this.g)+M(this.b)},toString:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}})),e(q,x,n(i,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new q(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new q(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new N(E(t>=240?t-240:t+120,r,i),E(t,r,i),E(t<120?t+240:t-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var $=Math.PI/180,R=180/Math.PI,j=.96422,I=1,P=.82521,O=4/29,S=6/29,_=3*S*S,z=S*S*S;function C(t){if(t instanceof A)return new A(t.l,t.a,t.b,t.opacity);if(t instanceof K){if(isNaN(t.h))return new A(t.l,0,0,t.opacity);var e=t.h*$;return new A(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t instanceof N||(t=m(t));var n,i,r=G(t.r),a=G(t.g),h=G(t.b),s=B((.2225045*r+.7168786*a+.0606169*h)/I);return r===a&&a===h?n=i=s:(n=B((.4360747*r+.3850649*a+.1430804*h)/j),i=B((.0139322*r+.0971045*a+.7141733*h)/P)),new A(116*s-16,500*(n-s),200*(s-i),t.opacity)}function L(t,e,n,i){return 1===arguments.length?C(t):new A(t,e,n,null==i?1:i)}function A(t,e,n,i){this.l=+t,this.a=+e,this.b=+n,this.opacity=+i}function B(t){return t>z?Math.pow(t,1/3):t/_+O}function D(t){return t>S?t*t*t:_*(t-O)}function F(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function G(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function H(t){if(t instanceof K)return new K(t.h,t.c,t.l,t.opacity);if(t instanceof A||(t=C(t)),0===t.a&&0===t.b)return new K(NaN,0,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*R;return new K(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function J(t,e,n,i){return 1===arguments.length?H(t):new K(t,e,n,null==i?1:i)}function K(t,e,n,i){this.h=+t,this.c=+e,this.l=+n,this.opacity=+i}e(A,L,n(i,{brighter:function(t){return new A(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new A(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new N(F(3.1338561*(e=j*D(e))-1.6168667*(t=I*D(t))-.4906146*(n=P*D(n))),F(-.9787684*e+1.9161415*t+.033454*n),F(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),e(K,J,n(i,{brighter:function(t){return new K(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new K(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return C(this).rgb()}}));var Q=-.14861,T=1.78277,U=-.29227,V=-.90649,W=1.97294,X=W*V,Y=W*T,Z=T*U-V*Q;function tt(t,e,n,i){return 1===arguments.length?function(t){if(t instanceof et)return new et(t.h,t.s,t.l,t.opacity);t instanceof N||(t=m(t));var e=t.r/255,n=t.g/255,i=t.b/255,r=(Z*i+X*e-Y*n)/(Z+X-Y),a=i-r,h=(W*(n-r)-U*a)/V,s=Math.sqrt(h*h+a*a)/(W*r*(1-r)),o=s?Math.atan2(h,a)*R-120:NaN;return new et(o<0?o+360:o,s,r,t.opacity)}(t):new et(t,e,n,null==i?1:i)}function et(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}e(et,tt,n(i,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new et(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new et(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*$,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),r=Math.sin(t);return new N(255*(e+n*(Q*i+T*r)),255*(e+n*(U*i+V*r)),255*(e+n*(W*i)),this.opacity)}})),t.color=b,t.rgb=k,t.hsl=x,t.lab=L,t.hcl=J,t.lch=function(t,e,n,i){return 1===arguments.length?H(t):new K(n,e,t,null==i?1:i)},t.gray=function(t,e){return new A(t,0,0,null==e?1:e)},t.cubehelix=tt,Object.defineProperty(t,"__esModule",{value:!0})});

},{}],32:[function(require,module,exports){
!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(r.d3=r.d3||{})}(this,function(r){"use strict";var n={},t={},e=34,o=10,u=13;function a(r){return new Function("d","return {"+r.map(function(r,n){return JSON.stringify(r)+": d["+n+"]"}).join(",")+"}")}function c(r){var c=new RegExp('["'+r+"\n\r]"),i=r.charCodeAt(0);function f(r,a){var c,f=[],s=r.length,p=0,d=0,l=s<=0,m=!1;function v(){if(l)return t;if(m)return m=!1,n;var a,c,f=p;if(r.charCodeAt(f)===e){for(;p++<s&&r.charCodeAt(p)!==e||r.charCodeAt(++p)===e;);return(a=p)>=s?l=!0:(c=r.charCodeAt(p++))===o?m=!0:c===u&&(m=!0,r.charCodeAt(p)===o&&++p),r.slice(f+1,a-1).replace(/""/g,'"')}for(;p<s;){if((c=r.charCodeAt(a=p++))===o)m=!0;else if(c===u)m=!0,r.charCodeAt(p)===o&&++p;else if(c!==i)continue;return r.slice(f,a)}return l=!0,r.slice(f,s)}for(r.charCodeAt(s-1)===o&&--s,r.charCodeAt(s-1)===u&&--s;(c=v())!==t;){for(var h=[];c!==n&&c!==t;)h.push(c),c=v();a&&null==(h=a(h,d++))||f.push(h)}return f}function s(n){return n.map(p).join(r)}function p(r){return null==r?"":c.test(r+="")?'"'+r.replace(/"/g,'""')+'"':r}return{parse:function(r,n){var t,e,o=f(r,function(r,o){if(t)return t(r,o-1);e=r,t=n?function(r,n){var t=a(r);return function(e,o){return n(t(e),o,r)}}(r,n):a(r)});return o.columns=e||[],o},parseRows:f,format:function(n,t){return null==t&&(t=function(r){var n=Object.create(null),t=[];return r.forEach(function(r){for(var e in r)e in n||t.push(n[e]=e)}),t}(n)),[t.map(p).join(r)].concat(n.map(function(n){return t.map(function(r){return p(n[r])}).join(r)})).join("\n")},formatRows:function(r){return r.map(s).join("\n")}}}var i=c(","),f=i.parse,s=i.parseRows,p=i.format,d=i.formatRows,l=c("\t"),m=l.parse,v=l.parseRows,h=l.format,w=l.formatRows;r.dsvFormat=c,r.csvParse=f,r.csvParseRows=s,r.csvFormat=p,r.csvFormatRows=d,r.tsvParse=m,r.tsvParseRows=v,r.tsvFormat=h,r.tsvFormatRows=w,Object.defineProperty(r,"__esModule",{value:!0})});

},{}],33:[function(require,module,exports){
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-dsv")):"function"==typeof define&&define.amd?define(["exports","d3-dsv"],n):n(t.d3=t.d3||{},t.d3)}(this,function(t,n){"use strict";function e(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.blob()}function r(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.arrayBuffer()}function o(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function u(t,n){return fetch(t,n).then(o)}function f(t){return function(n,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=void 0),u(n,e).then(function(n){return t(n,r)})}}var i=f(n.csvParse),s=f(n.tsvParse);function c(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.json()}function a(t){return function(n,e){return u(n,e).then(function(n){return(new DOMParser).parseFromString(n,t)})}}var d=a("application/xml"),h=a("text/html"),v=a("image/svg+xml");t.blob=function(t,n){return fetch(t,n).then(e)},t.buffer=function(t,n){return fetch(t,n).then(r)},t.dsv=function(t,e,r,o){3===arguments.length&&"function"==typeof r&&(o=r,r=void 0);var f=n.dsvFormat(t);return u(e,r).then(function(t){return f.parse(t,o)})},t.csv=i,t.tsv=s,t.image=function(t,n){return new Promise(function(e,r){var o=new Image;for(var u in n)o[u]=n[u];o.onerror=r,o.onload=function(){e(o)},o.src=t})},t.json=function(t,n){return fetch(t,n).then(c)},t.text=u,t.xml=d,t.html=h,t.svg=v,Object.defineProperty(t,"__esModule",{value:!0})});

},{"d3-dsv":32}],34:[function(require,module,exports){
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.d3=t.d3||{})}(this,function(t){"use strict";function n(t,n){if((r=(t=n?t.toExponential(n-1):t.toExponential()).indexOf("e"))<0)return null;var r,e=t.slice(0,r);return[e.length>1?e[0]+e.slice(2):e,+t.slice(r+1)]}function r(t){return(t=n(Math.abs(t)))?t[1]:NaN}var e,i=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function o(t){return new a(t)}function a(t){if(!(n=i.exec(t)))throw new Error("invalid format: "+t);var n;this.fill=n[1]||" ",this.align=n[2]||">",this.sign=n[3]||"-",this.symbol=n[4]||"",this.zero=!!n[5],this.width=n[6]&&+n[6],this.comma=!!n[7],this.precision=n[8]&&+n[8].slice(1),this.trim=!!n[9],this.type=n[10]||""}function u(t,r){var e=n(t,r);if(!e)return t+"";var i=e[0],o=e[1];return o<0?"0."+new Array(-o).join("0")+i:i.length>o+1?i.slice(0,o+1)+"."+i.slice(o+1):i+new Array(o-i.length+2).join("0")}o.prototype=a.prototype,a.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var s={"%":function(t,n){return(100*t).toFixed(n)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,n){return t.toExponential(n)},f:function(t,n){return t.toFixed(n)},g:function(t,n){return t.toPrecision(n)},o:function(t){return Math.round(t).toString(8)},p:function(t,n){return u(100*t,n)},r:u,s:function(t,r){var i=n(t,r);if(!i)return t+"";var o=i[0],a=i[1],u=a-(e=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,s=o.length;return u===s?o:u>s?o+new Array(u-s+1).join("0"):u>0?o.slice(0,u)+"."+o.slice(u):"0."+new Array(1-u).join("0")+n(t,Math.max(0,r+u-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function c(t){return t}var f,h=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function l(t){var n,i,a=t.grouping&&t.thousands?(n=t.grouping,i=t.thousands,function(t,r){for(var e=t.length,o=[],a=0,u=n[0],s=0;e>0&&u>0&&(s+u+1>r&&(u=Math.max(1,r-s)),o.push(t.substring(e-=u,e+u)),!((s+=u+1)>r));)u=n[a=(a+1)%n.length];return o.reverse().join(i)}):c,u=t.currency,f=t.decimal,l=t.numerals?function(t){return function(n){return n.replace(/[0-9]/g,function(n){return t[+n]})}}(t.numerals):c,m=t.percent||"%";function p(t){var n=(t=o(t)).fill,r=t.align,i=t.sign,c=t.symbol,p=t.zero,g=t.width,d=t.comma,M=t.precision,x=t.trim,y=t.type;"n"===y?(d=!0,y="g"):s[y]||(null==M&&(M=12),x=!0,y="g"),(p||"0"===n&&"="===r)&&(p=!0,n="0",r="=");var b="$"===c?u[0]:"#"===c&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",v="$"===c?u[1]:/[%p]/.test(y)?m:"",w=s[y],j=/[defgprs%]/.test(y);function k(t){var o,u,s,c=b,m=v;if("c"===y)m=w(t)+m,t="";else{var k=(t=+t)<0;if(t=w(Math.abs(t),M),x&&(t=function(t){t:for(var n,r=t.length,e=1,i=-1;e<r;++e)switch(t[e]){case".":i=n=e;break;case"0":0===i&&(i=e),n=e;break;default:if(i>0){if(!+t[e])break t;i=0}}return i>0?t.slice(0,i)+t.slice(n+1):t}(t)),k&&0==+t&&(k=!1),c=(k?"("===i?i:"-":"-"===i||"("===i?"":i)+c,m=("s"===y?h[8+e/3]:"")+m+(k&&"("===i?")":""),j)for(o=-1,u=t.length;++o<u;)if(48>(s=t.charCodeAt(o))||s>57){m=(46===s?f+t.slice(o+1):t.slice(o))+m,t=t.slice(0,o);break}}d&&!p&&(t=a(t,1/0));var S=c.length+t.length+m.length,P=S<g?new Array(g-S+1).join(n):"";switch(d&&p&&(t=a(P+t,P.length?g-m.length:1/0),P=""),r){case"<":t=c+t+m+P;break;case"=":t=c+P+t+m;break;case"^":t=P.slice(0,S=P.length>>1)+c+t+m+P.slice(S);break;default:t=P+c+t+m}return l(t)}return M=null==M?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,M)):Math.max(0,Math.min(20,M)),k.toString=function(){return t+""},k}return{format:p,formatPrefix:function(t,n){var e=p(((t=o(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(r(n)/3))),a=Math.pow(10,-i),u=h[8+i/3];return function(t){return e(a*t)+u}}}}function m(n){return f=l(n),t.format=f.format,t.formatPrefix=f.formatPrefix,f}m({decimal:".",thousands:",",grouping:[3],currency:["$",""]}),t.formatDefaultLocale=m,t.formatLocale=l,t.formatSpecifier=o,t.precisionFixed=function(t){return Math.max(0,-r(Math.abs(t)))},t.precisionPrefix=function(t,n){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(r(n)/3)))-r(Math.abs(t)))},t.precisionRound=function(t,n){return t=Math.abs(t),n=Math.abs(n)-t,Math.max(0,r(n)-r(t))+1},Object.defineProperty(t,"__esModule",{value:!0})});

},{}],35:[function(require,module,exports){
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-color")):"function"==typeof define&&define.amd?define(["exports","d3-color"],n):n(t.d3=t.d3||{},t.d3)}(this,function(t,n){"use strict";function r(t,n,r,e,o){var a=t*t,u=a*t;return((1-3*t+3*a-u)*n+(4-6*a+3*u)*r+(1+3*t+3*a-3*u)*e+u*o)/6}function e(t){var n=t.length-1;return function(e){var o=e<=0?e=0:e>=1?(e=1,n-1):Math.floor(e*n),a=t[o],u=t[o+1],i=o>0?t[o-1]:2*a-u,l=o<n-1?t[o+2]:2*u-a;return r((e-o/n)*n,i,a,u,l)}}function o(t){var n=t.length;return function(e){var o=Math.floor(((e%=1)<0?++e:e)*n),a=t[(o+n-1)%n],u=t[o%n],i=t[(o+1)%n],l=t[(o+2)%n];return r((e-o/n)*n,a,u,i,l)}}function a(t){return function(){return t}}function u(t,n){return function(r){return t+r*n}}function i(t,n){var r=n-t;return r?u(t,r>180||r<-180?r-360*Math.round(r/360):r):a(isNaN(t)?n:t)}function l(t){return 1==(t=+t)?c:function(n,r){return r-n?function(t,n,r){return t=Math.pow(t,r),n=Math.pow(n,r)-t,r=1/r,function(e){return Math.pow(t+e*n,r)}}(n,r,t):a(isNaN(n)?r:n)}}function c(t,n){var r=n-t;return r?u(t,r):a(isNaN(t)?n:t)}var f=function t(r){var e=l(r);function o(t,r){var o=e((t=n.rgb(t)).r,(r=n.rgb(r)).r),a=e(t.g,r.g),u=e(t.b,r.b),i=c(t.opacity,r.opacity);return function(n){return t.r=o(n),t.g=a(n),t.b=u(n),t.opacity=i(n),t+""}}return o.gamma=t,o}(1);function s(t){return function(r){var e,o,a=r.length,u=new Array(a),i=new Array(a),l=new Array(a);for(e=0;e<a;++e)o=n.rgb(r[e]),u[e]=o.r||0,i[e]=o.g||0,l[e]=o.b||0;return u=t(u),i=t(i),l=t(l),o.opacity=1,function(t){return o.r=u(t),o.g=i(t),o.b=l(t),o+""}}}var p=s(e),h=s(o);function v(t,n){var r,e=n?n.length:0,o=t?Math.min(e,t.length):0,a=new Array(o),u=new Array(e);for(r=0;r<o;++r)a[r]=m(t[r],n[r]);for(;r<e;++r)u[r]=n[r];return function(t){for(r=0;r<o;++r)u[r]=a[r](t);return u}}function g(t,n){var r=new Date;return n-=t=+t,function(e){return r.setTime(t+n*e),r}}function d(t,n){return n-=t=+t,function(r){return t+n*r}}function y(t,n){var r,e={},o={};for(r in null!==t&&"object"==typeof t||(t={}),null!==n&&"object"==typeof n||(n={}),n)r in t?e[r]=m(t[r],n[r]):o[r]=n[r];return function(t){for(r in e)o[r]=e[r](t);return o}}var x=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,M=new RegExp(x.source,"g");function b(t,n){var r,e,o,a=x.lastIndex=M.lastIndex=0,u=-1,i=[],l=[];for(t+="",n+="";(r=x.exec(t))&&(e=M.exec(n));)(o=e.index)>a&&(o=n.slice(a,o),i[u]?i[u]+=o:i[++u]=o),(r=r[0])===(e=e[0])?i[u]?i[u]+=e:i[++u]=e:(i[++u]=null,l.push({i:u,x:d(r,e)})),a=M.lastIndex;return a<n.length&&(o=n.slice(a),i[u]?i[u]+=o:i[++u]=o),i.length<2?l[0]?function(t){return function(n){return t(n)+""}}(l[0].x):function(t){return function(){return t}}(n):(n=l.length,function(t){for(var r,e=0;e<n;++e)i[(r=l[e]).i]=r.x(t);return i.join("")})}function m(t,r){var e,o=typeof r;return null==r||"boolean"===o?a(r):("number"===o?d:"string"===o?(e=n.color(r))?(r=e,f):b:r instanceof n.color?f:r instanceof Date?g:Array.isArray(r)?v:"function"!=typeof r.valueOf&&"function"!=typeof r.toString||isNaN(r)?y:d)(t,r)}var w,X,A,N,C=180/Math.PI,Y={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function j(t,n,r,e,o,a){var u,i,l;return(u=Math.sqrt(t*t+n*n))&&(t/=u,n/=u),(l=t*r+n*e)&&(r-=t*l,e-=n*l),(i=Math.sqrt(r*r+e*e))&&(r/=i,e/=i,l/=i),t*e<n*r&&(t=-t,n=-n,l=-l,u=-u),{translateX:o,translateY:a,rotate:Math.atan2(n,t)*C,skewX:Math.atan(l)*C,scaleX:u,scaleY:i}}function q(t,n,r,e){function o(t){return t.length?t.pop()+" ":""}return function(a,u){var i=[],l=[];return a=t(a),u=t(u),function(t,e,o,a,u,i){if(t!==o||e!==a){var l=u.push("translate(",null,n,null,r);i.push({i:l-4,x:d(t,o)},{i:l-2,x:d(e,a)})}else(o||a)&&u.push("translate("+o+n+a+r)}(a.translateX,a.translateY,u.translateX,u.translateY,i,l),function(t,n,r,a){t!==n?(t-n>180?n+=360:n-t>180&&(t+=360),a.push({i:r.push(o(r)+"rotate(",null,e)-2,x:d(t,n)})):n&&r.push(o(r)+"rotate("+n+e)}(a.rotate,u.rotate,i,l),function(t,n,r,a){t!==n?a.push({i:r.push(o(r)+"skewX(",null,e)-2,x:d(t,n)}):n&&r.push(o(r)+"skewX("+n+e)}(a.skewX,u.skewX,i,l),function(t,n,r,e,a,u){if(t!==r||n!==e){var i=a.push(o(a)+"scale(",null,",",null,")");u.push({i:i-4,x:d(t,r)},{i:i-2,x:d(n,e)})}else 1===r&&1===e||a.push(o(a)+"scale("+r+","+e+")")}(a.scaleX,a.scaleY,u.scaleX,u.scaleY,i,l),a=u=null,function(t){for(var n,r=-1,e=l.length;++r<e;)i[(n=l[r]).i]=n.x(t);return i.join("")}}}var k=q(function(t){return"none"===t?Y:(w||(w=document.createElement("DIV"),X=document.documentElement,A=document.defaultView),w.style.transform=t,t=A.getComputedStyle(X.appendChild(w),null).getPropertyValue("transform"),X.removeChild(w),j(+(t=t.slice(7,-1).split(","))[0],+t[1],+t[2],+t[3],+t[4],+t[5]))},"px, ","px)","deg)"),R=q(function(t){return null==t?Y:(N||(N=document.createElementNS("http://www.w3.org/2000/svg","g")),N.setAttribute("transform",t),(t=N.transform.baseVal.consolidate())?j((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):Y)},", ",")",")"),S=Math.SQRT2,D=2,E=4,H=1e-12;function I(t){return((t=Math.exp(t))+1/t)/2}function B(t){return function(r,e){var o=t((r=n.hsl(r)).h,(e=n.hsl(e)).h),a=c(r.s,e.s),u=c(r.l,e.l),i=c(r.opacity,e.opacity);return function(t){return r.h=o(t),r.s=a(t),r.l=u(t),r.opacity=i(t),r+""}}}var L=B(i),T=B(c);function V(t){return function(r,e){var o=t((r=n.hcl(r)).h,(e=n.hcl(e)).h),a=c(r.c,e.c),u=c(r.l,e.l),i=c(r.opacity,e.opacity);return function(t){return r.h=o(t),r.c=a(t),r.l=u(t),r.opacity=i(t),r+""}}}var O=V(i),P=V(c);function _(t){return function r(e){function o(r,o){var a=t((r=n.cubehelix(r)).h,(o=n.cubehelix(o)).h),u=c(r.s,o.s),i=c(r.l,o.l),l=c(r.opacity,o.opacity);return function(t){return r.h=a(t),r.s=u(t),r.l=i(Math.pow(t,e)),r.opacity=l(t),r+""}}return e=+e,o.gamma=r,o}(1)}var z=_(i),Q=_(c);t.interpolate=m,t.interpolateArray=v,t.interpolateBasis=e,t.interpolateBasisClosed=o,t.interpolateDate=g,t.interpolateDiscrete=function(t){var n=t.length;return function(r){return t[Math.max(0,Math.min(n-1,Math.floor(r*n)))]}},t.interpolateHue=function(t,n){var r=i(+t,+n);return function(t){var n=r(t);return n-360*Math.floor(n/360)}},t.interpolateNumber=d,t.interpolateObject=y,t.interpolateRound=function(t,n){return n-=t=+t,function(r){return Math.round(t+n*r)}},t.interpolateString=b,t.interpolateTransformCss=k,t.interpolateTransformSvg=R,t.interpolateZoom=function(t,n){var r,e,o=t[0],a=t[1],u=t[2],i=n[0],l=n[1],c=n[2],f=i-o,s=l-a,p=f*f+s*s;if(p<H)e=Math.log(c/u)/S,r=function(t){return[o+t*f,a+t*s,u*Math.exp(S*t*e)]};else{var h=Math.sqrt(p),v=(c*c-u*u+E*p)/(2*u*D*h),g=(c*c-u*u-E*p)/(2*c*D*h),d=Math.log(Math.sqrt(v*v+1)-v),y=Math.log(Math.sqrt(g*g+1)-g);e=(y-d)/S,r=function(t){var n,r=t*e,i=I(d),l=u/(D*h)*(i*(n=S*r+d,((n=Math.exp(2*n))-1)/(n+1))-function(t){return((t=Math.exp(t))-1/t)/2}(d));return[o+l*f,a+l*s,u*i/I(S*r+d)]}}return r.duration=1e3*e,r},t.interpolateRgb=f,t.interpolateRgbBasis=p,t.interpolateRgbBasisClosed=h,t.interpolateHsl=L,t.interpolateHslLong=T,t.interpolateLab=function(t,r){var e=c((t=n.lab(t)).l,(r=n.lab(r)).l),o=c(t.a,r.a),a=c(t.b,r.b),u=c(t.opacity,r.opacity);return function(n){return t.l=e(n),t.a=o(n),t.b=a(n),t.opacity=u(n),t+""}},t.interpolateHcl=O,t.interpolateHclLong=P,t.interpolateCubehelix=z,t.interpolateCubehelixLong=Q,t.piecewise=function(t,n){for(var r=0,e=n.length-1,o=n[0],a=new Array(e<0?0:e);r<e;)a[r]=t(o,o=n[++r]);return function(t){var n=Math.max(0,Math.min(e-1,Math.floor(t*=e)));return a[n](t-n)}},t.quantize=function(t,n){for(var r=new Array(n),e=0;e<n;++e)r[e]=t(e/(n-1));return r},Object.defineProperty(t,"__esModule",{value:!0})});

},{"d3-color":31}],36:[function(require,module,exports){
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.d3=t.d3||{})}(this,function(t){"use strict";var i=Math.PI,s=2*i,h=s-1e-6;function _(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function e(){return new _}_.prototype=e.prototype={constructor:_,moveTo:function(t,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+i)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,i){this._+="L"+(this._x1=+t)+","+(this._y1=+i)},quadraticCurveTo:function(t,i,s,h){this._+="Q"+ +t+","+ +i+","+(this._x1=+s)+","+(this._y1=+h)},bezierCurveTo:function(t,i,s,h,_,e){this._+="C"+ +t+","+ +i+","+ +s+","+ +h+","+(this._x1=+_)+","+(this._y1=+e)},arcTo:function(t,s,h,_,e){t=+t,s=+s,h=+h,_=+_,e=+e;var n=this._x1,o=this._y1,r=h-t,a=_-s,u=n-t,c=o-s,f=u*u+c*c;if(e<0)throw new Error("negative radius: "+e);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=s);else if(f>1e-6)if(Math.abs(c*r-a*u)>1e-6&&e){var x=h-n,y=_-o,M=r*r+a*a,l=x*x+y*y,d=Math.sqrt(M),p=Math.sqrt(f),v=e*Math.tan((i-Math.acos((M+f-l)/(2*d*p)))/2),b=v/p,w=v/d;Math.abs(b-1)>1e-6&&(this._+="L"+(t+b*u)+","+(s+b*c)),this._+="A"+e+","+e+",0,0,"+ +(c*x>u*y)+","+(this._x1=t+w*r)+","+(this._y1=s+w*a)}else this._+="L"+(this._x1=t)+","+(this._y1=s);else;},arc:function(t,_,e,n,o,r){t=+t,_=+_;var a=(e=+e)*Math.cos(n),u=e*Math.sin(n),c=t+a,f=_+u,x=1^r,y=r?n-o:o-n;if(e<0)throw new Error("negative radius: "+e);null===this._x1?this._+="M"+c+","+f:(Math.abs(this._x1-c)>1e-6||Math.abs(this._y1-f)>1e-6)&&(this._+="L"+c+","+f),e&&(y<0&&(y=y%s+s),y>h?this._+="A"+e+","+e+",0,1,"+x+","+(t-a)+","+(_-u)+"A"+e+","+e+",0,1,"+x+","+(this._x1=c)+","+(this._y1=f):y>1e-6&&(this._+="A"+e+","+e+",0,"+ +(y>=i)+","+x+","+(this._x1=t+e*Math.cos(o))+","+(this._y1=_+e*Math.sin(o))))},rect:function(t,i,s,h){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+i)+"h"+ +s+"v"+ +h+"h"+-s+"Z"},toString:function(){return this._}},t.path=e,Object.defineProperty(t,"__esModule",{value:!0})});

},{}],37:[function(require,module,exports){
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-array"),require("d3-collection"),require("d3-interpolate"),require("d3-format"),require("d3-time"),require("d3-time-format"),require("d3-color")):"function"==typeof define&&define.amd?define(["exports","d3-array","d3-collection","d3-interpolate","d3-format","d3-time","d3-time-format","d3-color"],n):n(e.d3=e.d3||{},e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3)}(this,function(e,n,a,f,c,t,r,d){"use strict";var i=Array.prototype,u=i.map,b=i.slice,o={name:"implicit"};function l(e){var n=a.map(),f=[],c=o;function t(a){var t=a+"",r=n.get(t);if(!r){if(c!==o)return c;n.set(t,r=f.push(a))}return e[(r-1)%e.length]}return e=null==e?[]:b.call(e),t.domain=function(e){if(!arguments.length)return f.slice();f=[],n=a.map();for(var c,r,d=-1,i=e.length;++d<i;)n.has(r=(c=e[d])+"")||n.set(r,f.push(c));return t},t.range=function(n){return arguments.length?(e=b.call(n),t):e.slice()},t.unknown=function(e){return arguments.length?(c=e,t):c},t.copy=function(){return l().domain(f).range(e).unknown(c)},t}function h(){var e,a,f=l().unknown(void 0),c=f.domain,t=f.range,r=[0,1],d=!1,i=0,u=0,b=.5;function o(){var f=c().length,o=r[1]<r[0],l=r[o-0],h=r[1-o];e=(h-l)/Math.max(1,f-i+2*u),d&&(e=Math.floor(e)),l+=(h-l-e*(f-i))*b,a=e*(1-i),d&&(l=Math.round(l),a=Math.round(a));var s=n.range(f).map(function(n){return l+e*n});return t(o?s.reverse():s)}return delete f.unknown,f.domain=function(e){return arguments.length?(c(e),o()):c()},f.range=function(e){return arguments.length?(r=[+e[0],+e[1]],o()):r.slice()},f.rangeRound=function(e){return r=[+e[0],+e[1]],d=!0,o()},f.bandwidth=function(){return a},f.step=function(){return e},f.round=function(e){return arguments.length?(d=!!e,o()):d},f.padding=function(e){return arguments.length?(i=u=Math.max(0,Math.min(1,e)),o()):i},f.paddingInner=function(e){return arguments.length?(i=Math.max(0,Math.min(1,e)),o()):i},f.paddingOuter=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),o()):u},f.align=function(e){return arguments.length?(b=Math.max(0,Math.min(1,e)),o()):b},f.copy=function(){return h().domain(c()).range(r).round(d).paddingInner(i).paddingOuter(u).align(b)},o()}var s=function(e){return function(){return e}},m=function(e){return+e},g=[0,1];function p(e,n){return(n-=e=+e)?function(a){return(a-e)/n}:s(n)}function M(e,n,a,f){var c=e[0],t=e[1],r=n[0],d=n[1];return t<c?(c=a(t,c),r=f(d,r)):(c=a(c,t),r=f(r,d)),function(e){return r(c(e))}}function v(e,a,f,c){var t=Math.min(e.length,a.length)-1,r=new Array(t),d=new Array(t),i=-1;for(e[t]<e[0]&&(e=e.slice().reverse(),a=a.slice().reverse());++i<t;)r[i]=f(e[i],e[i+1]),d[i]=c(a[i],a[i+1]);return function(a){var f=n.bisect(e,a,1,t)-1;return d[f](r[f](a))}}function x(e,n){return n.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp())}function y(e,n){var a,c,t,r=g,d=g,i=f.interpolate,o=!1;function l(){return a=Math.min(r.length,d.length)>2?v:M,c=t=null,h}function h(n){return(c||(c=a(r,d,o?function(e){return function(n,a){var f=e(n=+n,a=+a);return function(e){return e<=n?0:e>=a?1:f(e)}}}(e):e,i)))(+n)}return h.invert=function(e){return(t||(t=a(d,r,p,o?function(e){return function(n,a){var f=e(n=+n,a=+a);return function(e){return e<=0?n:e>=1?a:f(e)}}}(n):n)))(+e)},h.domain=function(e){return arguments.length?(r=u.call(e,m),l()):r.slice()},h.range=function(e){return arguments.length?(d=b.call(e),l()):d.slice()},h.rangeRound=function(e){return d=b.call(e),i=f.interpolateRound,l()},h.clamp=function(e){return arguments.length?(o=!!e,l()):o},h.interpolate=function(e){return arguments.length?(i=e,l()):i},l()}var k=function(e,a,f){var t,r=e[0],d=e[e.length-1],i=n.tickStep(r,d,null==a?10:a);switch((f=c.formatSpecifier(null==f?",f":f)).type){case"s":var u=Math.max(Math.abs(r),Math.abs(d));return null!=f.precision||isNaN(t=c.precisionPrefix(i,u))||(f.precision=t),c.formatPrefix(f,u);case"":case"e":case"g":case"p":case"r":null!=f.precision||isNaN(t=c.precisionRound(i,Math.max(Math.abs(r),Math.abs(d))))||(f.precision=t-("e"===f.type));break;case"f":case"%":null!=f.precision||isNaN(t=c.precisionFixed(i))||(f.precision=t-2*("%"===f.type))}return c.format(f)};function w(e){var a=e.domain;return e.ticks=function(e){var f=a();return n.ticks(f[0],f[f.length-1],null==e?10:e)},e.tickFormat=function(e,n){return k(a(),e,n)},e.nice=function(f){null==f&&(f=10);var c,t=a(),r=0,d=t.length-1,i=t[r],u=t[d];return u<i&&(c=i,i=u,u=c,c=r,r=d,d=c),(c=n.tickIncrement(i,u,f))>0?(i=Math.floor(i/c)*c,u=Math.ceil(u/c)*c,c=n.tickIncrement(i,u,f)):c<0&&(i=Math.ceil(i*c)/c,u=Math.floor(u*c)/c,c=n.tickIncrement(i,u,f)),c>0?(t[r]=Math.floor(i/c)*c,t[d]=Math.ceil(u/c)*c,a(t)):c<0&&(t[r]=Math.ceil(i*c)/c,t[d]=Math.floor(u*c)/c,a(t)),e},e}var N=function(e,n){var a,f=0,c=(e=e.slice()).length-1,t=e[f],r=e[c];return r<t&&(a=f,f=c,c=a,a=t,t=r,r=a),e[f]=n.floor(t),e[c]=n.ceil(r),e};function I(e,n){return(n=Math.log(n/e))?function(a){return Math.log(a/e)/n}:s(n)}function q(e,n){return e<0?function(a){return-Math.pow(-n,a)*Math.pow(-e,1-a)}:function(a){return Math.pow(n,a)*Math.pow(e,1-a)}}function C(e){return isFinite(e)?+("1e"+e):e<0?0:e}function D(e){return 10===e?C:e===Math.E?Math.exp:function(n){return Math.pow(e,n)}}function O(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(n){return Math.log(n)/e})}function S(e){return function(n){return-e(-n)}}function F(e,n){return e<0?-Math.pow(-e,n):Math.pow(e,n)}function L(){var e=1,n=y(function(n,a){return(a=F(a,e)-(n=F(n,e)))?function(f){return(F(f,e)-n)/a}:s(a)},function(n,a){return a=F(a,e)-(n=F(n,e)),function(f){return F(n+a*f,1/e)}}),a=n.domain;return n.exponent=function(n){return arguments.length?(e=+n,a(a())):e},n.copy=function(){return x(n,L().exponent(e))},w(n)}var P=1e3,A=60*P,E=60*A,R=24*E,T=7*R,U=30*R,W=365*R;function Y(e){return new Date(e)}function j(e){return e instanceof Date?+e:+new Date(+e)}function B(e,a,c,t,r,d,i,b,o){var l=y(p,f.interpolateNumber),h=l.invert,s=l.domain,m=o(".%L"),g=o(":%S"),M=o("%I:%M"),v=o("%I %p"),k=o("%a %d"),w=o("%b %d"),I=o("%B"),q=o("%Y"),C=[[i,1,P],[i,5,5*P],[i,15,15*P],[i,30,30*P],[d,1,A],[d,5,5*A],[d,15,15*A],[d,30,30*A],[r,1,E],[r,3,3*E],[r,6,6*E],[r,12,12*E],[t,1,R],[t,2,2*R],[c,1,T],[a,1,U],[a,3,3*U],[e,1,W]];function D(n){return(i(n)<n?m:d(n)<n?g:r(n)<n?M:t(n)<n?v:a(n)<n?c(n)<n?k:w:e(n)<n?I:q)(n)}function O(a,f,c,t){if(null==a&&(a=10),"number"==typeof a){var r=Math.abs(c-f)/a,d=n.bisector(function(e){return e[2]}).right(C,r);d===C.length?(t=n.tickStep(f/W,c/W,a),a=e):d?(t=(d=C[r/C[d-1][2]<C[d][2]/r?d-1:d])[1],a=d[0]):(t=Math.max(n.tickStep(f,c,a),1),a=b)}return null==t?a:a.every(t)}return l.invert=function(e){return new Date(h(e))},l.domain=function(e){return arguments.length?s(u.call(e,j)):s().map(Y)},l.ticks=function(e,n){var a,f=s(),c=f[0],t=f[f.length-1],r=t<c;return r&&(a=c,c=t,t=a),a=(a=O(e,c,t,n))?a.range(c,t+1):[],r?a.reverse():a},l.tickFormat=function(e,n){return null==n?D:o(n)},l.nice=function(e,n){var a=s();return(e=O(e,a[0],a[a.length-1],n))?s(N(a,e)):l},l.copy=function(){return x(l,B(e,a,c,t,r,d,i,b,o))},l}var H=function(e){return e.match(/.{6}/g).map(function(e){return"#"+e})},Q=H("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),_=H("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),z=H("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),V=H("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"),G=f.interpolateCubehelixLong(d.cubehelix(300,.5,0),d.cubehelix(-240,.5,1)),J=f.interpolateCubehelixLong(d.cubehelix(-100,.75,.35),d.cubehelix(80,1.5,.8)),K=f.interpolateCubehelixLong(d.cubehelix(260,.75,.35),d.cubehelix(80,1.5,.8)),X=d.cubehelix();function Z(e){var n=e.length;return function(a){return e[Math.max(0,Math.min(n-1,Math.floor(a*n)))]}}var $=Z(H("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),ee=Z(H("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),ne=Z(H("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),ae=Z(H("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));e.scaleBand=h,e.scalePoint=function(){return function e(n){var a=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return e(a())},n}(h().paddingInner(1))},e.scaleIdentity=function e(){var n=[0,1];function a(e){return+e}return a.invert=a,a.domain=a.range=function(e){return arguments.length?(n=u.call(e,m),a):n.slice()},a.copy=function(){return e().domain(n)},w(a)},e.scaleLinear=function e(){var n=y(p,f.interpolateNumber);return n.copy=function(){return x(n,e())},w(n)},e.scaleLog=function e(){var a=y(I,q).domain([1,10]),f=a.domain,t=10,r=O(10),d=D(10);function i(){return r=O(t),d=D(t),f()[0]<0&&(r=S(r),d=S(d)),a}return a.base=function(e){return arguments.length?(t=+e,i()):t},a.domain=function(e){return arguments.length?(f(e),i()):f()},a.ticks=function(e){var a,c=f(),i=c[0],u=c[c.length-1];(a=u<i)&&(h=i,i=u,u=h);var b,o,l,h=r(i),s=r(u),m=null==e?10:+e,g=[];if(!(t%1)&&s-h<m){if(h=Math.round(h)-1,s=Math.round(s)+1,i>0){for(;h<s;++h)for(o=1,b=d(h);o<t;++o)if(!((l=b*o)<i)){if(l>u)break;g.push(l)}}else for(;h<s;++h)for(o=t-1,b=d(h);o>=1;--o)if(!((l=b*o)<i)){if(l>u)break;g.push(l)}}else g=n.ticks(h,s,Math.min(s-h,m)).map(d);return a?g.reverse():g},a.tickFormat=function(e,n){if(null==n&&(n=10===t?".0e":","),"function"!=typeof n&&(n=c.format(n)),e===1/0)return n;null==e&&(e=10);var f=Math.max(1,t*e/a.ticks().length);return function(e){var a=e/d(Math.round(r(e)));return a*t<t-.5&&(a*=t),a<=f?n(e):""}},a.nice=function(){return f(N(f(),{floor:function(e){return d(Math.floor(r(e)))},ceil:function(e){return d(Math.ceil(r(e)))}}))},a.copy=function(){return x(a,e().base(t))},a},e.scaleOrdinal=l,e.scaleImplicit=o,e.scalePow=L,e.scaleSqrt=function(){return L().exponent(.5)},e.scaleQuantile=function e(){var a=[],f=[],c=[];function t(){var e=0,t=Math.max(1,f.length);for(c=new Array(t-1);++e<t;)c[e-1]=n.quantile(a,e/t);return r}function r(e){if(!isNaN(e=+e))return f[n.bisect(c,e)]}return r.invertExtent=function(e){var n=f.indexOf(e);return n<0?[NaN,NaN]:[n>0?c[n-1]:a[0],n<c.length?c[n]:a[a.length-1]]},r.domain=function(e){if(!arguments.length)return a.slice();a=[];for(var f,c=0,r=e.length;c<r;++c)null==(f=e[c])||isNaN(f=+f)||a.push(f);return a.sort(n.ascending),t()},r.range=function(e){return arguments.length?(f=b.call(e),t()):f.slice()},r.quantiles=function(){return c.slice()},r.copy=function(){return e().domain(a).range(f)},r},e.scaleQuantize=function e(){var a=0,f=1,c=1,t=[.5],r=[0,1];function d(e){if(e<=e)return r[n.bisect(t,e,0,c)]}function i(){var e=-1;for(t=new Array(c);++e<c;)t[e]=((e+1)*f-(e-c)*a)/(c+1);return d}return d.domain=function(e){return arguments.length?(a=+e[0],f=+e[1],i()):[a,f]},d.range=function(e){return arguments.length?(c=(r=b.call(e)).length-1,i()):r.slice()},d.invertExtent=function(e){var n=r.indexOf(e);return n<0?[NaN,NaN]:n<1?[a,t[0]]:n>=c?[t[c-1],f]:[t[n-1],t[n]]},d.copy=function(){return e().domain([a,f]).range(r)},w(d)},e.scaleThreshold=function e(){var a=[.5],f=[0,1],c=1;function t(e){if(e<=e)return f[n.bisect(a,e,0,c)]}return t.domain=function(e){return arguments.length?(a=b.call(e),c=Math.min(a.length,f.length-1),t):a.slice()},t.range=function(e){return arguments.length?(f=b.call(e),c=Math.min(a.length,f.length-1),t):f.slice()},t.invertExtent=function(e){var n=f.indexOf(e);return[a[n-1],a[n]]},t.copy=function(){return e().domain(a).range(f)},t},e.scaleTime=function(){return B(t.timeYear,t.timeMonth,t.timeWeek,t.timeDay,t.timeHour,t.timeMinute,t.timeSecond,t.timeMillisecond,r.timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)])},e.scaleUtc=function(){return B(t.utcYear,t.utcMonth,t.utcWeek,t.utcDay,t.utcHour,t.utcMinute,t.utcSecond,t.utcMillisecond,r.utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)])},e.schemeCategory10=Q,e.schemeCategory20b=_,e.schemeCategory20c=z,e.schemeCategory20=V,e.interpolateCubehelixDefault=G,e.interpolateRainbow=function(e){(e<0||e>1)&&(e-=Math.floor(e));var n=Math.abs(e-.5);return X.h=360*e-100,X.s=1.5-1.5*n,X.l=.8-.9*n,X+""},e.interpolateWarm=J,e.interpolateCool=K,e.interpolateViridis=$,e.interpolateMagma=ee,e.interpolateInferno=ne,e.interpolatePlasma=ae,e.scaleSequential=function e(n){var a=0,f=1,c=!1;function t(e){var t=(e-a)/(f-a);return n(c?Math.max(0,Math.min(1,t)):t)}return t.domain=function(e){return arguments.length?(a=+e[0],f=+e[1],t):[a,f]},t.clamp=function(e){return arguments.length?(c=!!e,t):c},t.interpolator=function(e){return arguments.length?(n=e,t):n},t.copy=function(){return e(n).domain([a,f]).clamp(c)},w(t)},Object.defineProperty(e,"__esModule",{value:!0})});

},{"d3-array":28,"d3-collection":30,"d3-color":31,"d3-format":34,"d3-interpolate":35,"d3-time":41,"d3-time-format":40}],38:[function(require,module,exports){
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.d3=t.d3||{})}(this,function(t){"use strict";var n="http://www.w3.org/1999/xhtml",e={svg:"http://www.w3.org/2000/svg",xhtml:n,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function r(t){var n=t+="",r=n.indexOf(":");return r>=0&&"xmlns"!==(n=t.slice(0,r))&&(t=t.slice(r+1)),e.hasOwnProperty(n)?{space:e[n],local:t}:t}function i(t){var e=r(t);return(e.local?function(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}:function(t){return function(){var e=this.ownerDocument,r=this.namespaceURI;return r===n&&e.documentElement.namespaceURI===n?e.createElement(t):e.createElementNS(r,t)}})(e)}function o(){}function u(t){return null==t?o:function(){return this.querySelector(t)}}function c(){return[]}function s(t){return null==t?c:function(){return this.querySelectorAll(t)}}function a(t){return function(){return this.matches(t)}}function l(t){return new Array(t.length)}function f(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}f.prototype={constructor:f,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var h="$";function p(t,n,e,r,i,o){for(var u,c=0,s=n.length,a=o.length;c<a;++c)(u=n[c])?(u.__data__=o[c],r[c]=u):e[c]=new f(t,o[c]);for(;c<s;++c)(u=n[c])&&(i[c]=u)}function _(t,n,e,r,i,o,u){var c,s,a,l={},p=n.length,_=o.length,v=new Array(p);for(c=0;c<p;++c)(s=n[c])&&(v[c]=a=h+u.call(s,s.__data__,c,n),a in l?i[c]=s:l[a]=s);for(c=0;c<_;++c)(s=l[a=h+u.call(t,o[c],c,o)])?(r[c]=s,s.__data__=o[c],l[a]=null):e[c]=new f(t,o[c]);for(c=0;c<p;++c)(s=n[c])&&l[v[c]]===s&&(i[c]=s)}function v(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function d(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function y(t,n){return t.style.getPropertyValue(n)||d(t).getComputedStyle(t,null).getPropertyValue(n)}function m(t){return t.trim().split(/^|\s+/)}function g(t){return t.classList||new w(t)}function w(t){this._node=t,this._names=m(t.getAttribute("class")||"")}function A(t,n){for(var e=g(t),r=-1,i=n.length;++r<i;)e.add(n[r])}function x(t,n){for(var e=g(t),r=-1,i=n.length;++r<i;)e.remove(n[r])}function S(){this.textContent=""}function b(){this.innerHTML=""}function E(){this.nextSibling&&this.parentNode.appendChild(this)}function N(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function P(){return null}function C(){var t=this.parentNode;t&&t.removeChild(this)}function L(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function T(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}w.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var B={};(t.event=null,"undefined"!=typeof document)&&("onmouseenter"in document.documentElement||(B={mouseenter:"mouseover",mouseleave:"mouseout"}));function q(t,n,e){return t=D(t,n,e),function(n){var e=n.relatedTarget;e&&(e===this||8&e.compareDocumentPosition(this))||t.call(this,n)}}function D(n,e,r){return function(i){var o=t.event;t.event=i;try{n.call(this,this.__data__,e,r)}finally{t.event=o}}}function M(t){return function(){var n=this.__on;if(n){for(var e,r=0,i=-1,o=n.length;r<o;++r)e=n[r],t.type&&e.type!==t.type||e.name!==t.name?n[++i]=e:this.removeEventListener(e.type,e.listener,e.capture);++i?n.length=i:delete this.__on}}}function O(t,n,e){var r=B.hasOwnProperty(t.type)?q:D;return function(i,o,u){var c,s=this.__on,a=r(n,o,u);if(s)for(var l=0,f=s.length;l<f;++l)if((c=s[l]).type===t.type&&c.name===t.name)return this.removeEventListener(c.type,c.listener,c.capture),this.addEventListener(c.type,c.listener=a,c.capture=e),void(c.value=n);this.addEventListener(t.type,a,e),c={type:t.type,name:t.name,value:n,listener:a,capture:e},s?s.push(c):this.__on=[c]}}function V(t,n,e){var r=d(t),i=r.CustomEvent;"function"==typeof i?i=new i(n,e):(i=r.document.createEvent("Event"),e?(i.initEvent(n,e.bubbles,e.cancelable),i.detail=e.detail):i.initEvent(n,!1,!1)),t.dispatchEvent(i)}var j=[null];function R(t,n){this._groups=t,this._parents=n}function H(){return new R([[document.documentElement]],j)}function I(t){return"string"==typeof t?new R([[document.querySelector(t)]],[document.documentElement]):new R([[t]],j)}R.prototype=H.prototype={constructor:R,select:function(t){"function"!=typeof t&&(t=u(t));for(var n=this._groups,e=n.length,r=new Array(e),i=0;i<e;++i)for(var o,c,s=n[i],a=s.length,l=r[i]=new Array(a),f=0;f<a;++f)(o=s[f])&&(c=t.call(o,o.__data__,f,s))&&("__data__"in o&&(c.__data__=o.__data__),l[f]=c);return new R(r,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=s(t));for(var n=this._groups,e=n.length,r=[],i=[],o=0;o<e;++o)for(var u,c=n[o],a=c.length,l=0;l<a;++l)(u=c[l])&&(r.push(t.call(u,u.__data__,l,c)),i.push(u));return new R(r,i)},filter:function(t){"function"!=typeof t&&(t=a(t));for(var n=this._groups,e=n.length,r=new Array(e),i=0;i<e;++i)for(var o,u=n[i],c=u.length,s=r[i]=[],l=0;l<c;++l)(o=u[l])&&t.call(o,o.__data__,l,u)&&s.push(o);return new R(r,this._parents)},data:function(t,n){if(!t)return d=new Array(this.size()),l=-1,this.each(function(t){d[++l]=t}),d;var e,r=n?_:p,i=this._parents,o=this._groups;"function"!=typeof t&&(e=t,t=function(){return e});for(var u=o.length,c=new Array(u),s=new Array(u),a=new Array(u),l=0;l<u;++l){var f=i[l],h=o[l],v=h.length,d=t.call(f,f&&f.__data__,l,i),y=d.length,m=s[l]=new Array(y),g=c[l]=new Array(y);r(f,h,m,g,a[l]=new Array(v),d,n);for(var w,A,x=0,S=0;x<y;++x)if(w=m[x]){for(x>=S&&(S=x+1);!(A=g[S])&&++S<y;);w._next=A||null}}return(c=new R(c,i))._enter=s,c._exit=a,c},enter:function(){return new R(this._enter||this._groups.map(l),this._parents)},exit:function(){return new R(this._exit||this._groups.map(l),this._parents)},join:function(t,n,e){var r=this.enter(),i=this,o=this.exit();return r="function"==typeof t?t(r):r.append(t+""),null!=n&&(i=n(i)),null==e?o.remove():e(o),r&&i?r.merge(i).order():i},merge:function(t){for(var n=this._groups,e=t._groups,r=n.length,i=e.length,o=Math.min(r,i),u=new Array(r),c=0;c<o;++c)for(var s,a=n[c],l=e[c],f=a.length,h=u[c]=new Array(f),p=0;p<f;++p)(s=a[p]||l[p])&&(h[p]=s);for(;c<r;++c)u[c]=n[c];return new R(u,this._parents)},order:function(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var r,i=t[n],o=i.length-1,u=i[o];--o>=0;)(r=i[o])&&(u&&4^r.compareDocumentPosition(u)&&u.parentNode.insertBefore(r,u),u=r);return this},sort:function(t){function n(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}t||(t=v);for(var e=this._groups,r=e.length,i=new Array(r),o=0;o<r;++o){for(var u,c=e[o],s=c.length,a=i[o]=new Array(s),l=0;l<s;++l)(u=c[l])&&(a[l]=u);a.sort(n)}return new R(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),n=-1;return this.each(function(){t[++n]=this}),t},node:function(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r=t[n],i=0,o=r.length;i<o;++i){var u=r[i];if(u)return u}return null},size:function(){var t=0;return this.each(function(){++t}),t},empty:function(){return!this.node()},each:function(t){for(var n=this._groups,e=0,r=n.length;e<r;++e)for(var i,o=n[e],u=0,c=o.length;u<c;++u)(i=o[u])&&t.call(i,i.__data__,u,o);return this},attr:function(t,n){var e=r(t);if(arguments.length<2){var i=this.node();return e.local?i.getAttributeNS(e.space,e.local):i.getAttribute(e)}return this.each((null==n?e.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}}:"function"==typeof n?e.local?function(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}:function(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttribute(t):this.setAttribute(t,e)}}:e.local?function(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}:function(t,n){return function(){this.setAttribute(t,n)}})(e,n))},style:function(t,n,e){return arguments.length>1?this.each((null==n?function(t){return function(){this.style.removeProperty(t)}}:"function"==typeof n?function(t,n,e){return function(){var r=n.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,e)}}:function(t,n,e){return function(){this.style.setProperty(t,n,e)}})(t,n,null==e?"":e)):y(this.node(),t)},property:function(t,n){return arguments.length>1?this.each((null==n?function(t){return function(){delete this[t]}}:"function"==typeof n?function(t,n){return function(){var e=n.apply(this,arguments);null==e?delete this[t]:this[t]=e}}:function(t,n){return function(){this[t]=n}})(t,n)):this.node()[t]},classed:function(t,n){var e=m(t+"");if(arguments.length<2){for(var r=g(this.node()),i=-1,o=e.length;++i<o;)if(!r.contains(e[i]))return!1;return!0}return this.each(("function"==typeof n?function(t,n){return function(){(n.apply(this,arguments)?A:x)(this,t)}}:n?function(t){return function(){A(this,t)}}:function(t){return function(){x(this,t)}})(e,n))},text:function(t){return arguments.length?this.each(null==t?S:("function"==typeof t?function(t){return function(){var n=t.apply(this,arguments);this.textContent=null==n?"":n}}:function(t){return function(){this.textContent=t}})(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?b:("function"==typeof t?function(t){return function(){var n=t.apply(this,arguments);this.innerHTML=null==n?"":n}}:function(t){return function(){this.innerHTML=t}})(t)):this.node().innerHTML},raise:function(){return this.each(E)},lower:function(){return this.each(N)},append:function(t){var n="function"==typeof t?t:i(t);return this.select(function(){return this.appendChild(n.apply(this,arguments))})},insert:function(t,n){var e="function"==typeof t?t:i(t),r=null==n?P:"function"==typeof n?n:u(n);return this.select(function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(C)},clone:function(t){return this.select(t?T:L)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,n,e){var r,i,o=function(t){return t.trim().split(/^|\s+/).map(function(t){var n="",e=t.indexOf(".");return e>=0&&(n=t.slice(e+1),t=t.slice(0,e)),{type:t,name:n}})}(t+""),u=o.length;if(!(arguments.length<2)){for(c=n?O:M,null==e&&(e=!1),r=0;r<u;++r)this.each(c(o[r],n,e));return this}var c=this.node().__on;if(c)for(var s,a=0,l=c.length;a<l;++a)for(r=0,s=c[a];r<u;++r)if((i=o[r]).type===s.type&&i.name===s.name)return s.value},dispatch:function(t,n){return this.each(("function"==typeof n?function(t,n){return function(){return V(this,t,n.apply(this,arguments))}}:function(t,n){return function(){return V(this,t,n)}})(t,n))}};var U=0;function z(){return new G}function G(){this._="@"+(++U).toString(36)}function X(){for(var n,e=t.event;n=e.sourceEvent;)e=n;return e}function k(t,n){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var r=e.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}var i=t.getBoundingClientRect();return[n.clientX-i.left-t.clientLeft,n.clientY-i.top-t.clientTop]}G.prototype=z.prototype={constructor:G,get:function(t){for(var n=this._;!(n in t);)if(!(t=t.parentNode))return;return t[n]},set:function(t,n){return t[this._]=n},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}},t.create=function(t){return I(i(t).call(document.documentElement))},t.creator=i,t.local=z,t.matcher=a,t.mouse=function(t){var n=X();return n.changedTouches&&(n=n.changedTouches[0]),k(t,n)},t.namespace=r,t.namespaces=e,t.clientPoint=k,t.select=I,t.selectAll=function(t){return"string"==typeof t?new R([document.querySelectorAll(t)],[document.documentElement]):new R([null==t?[]:t],j)},t.selection=H,t.selector=u,t.selectorAll=s,t.style=y,t.touch=function(t,n,e){arguments.length<3&&(e=n,n=X().changedTouches);for(var r,i=0,o=n?n.length:0;i<o;++i)if((r=n[i]).identifier===e)return k(t,r);return null},t.touches=function(t,n){null==n&&(n=X().touches);for(var e=0,r=n?n.length:0,i=new Array(r);e<r;++e)i[e]=k(t,n[e]);return i},t.window=d,t.customEvent=function(n,e,r,i){var o=t.event;n.sourceEvent=t.event,t.event=n;try{return e.apply(r,i)}finally{t.event=o}},Object.defineProperty(t,"__esModule",{value:!0})});

},{}],39:[function(require,module,exports){
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-path")):"function"==typeof define&&define.amd?define(["exports","d3-path"],n):n(t.d3=t.d3||{},t.d3)}(this,function(t,n){"use strict";function i(t){return function(){return t}}var e=Math.abs,s=Math.atan2,h=Math.cos,o=Math.max,_=Math.min,r=Math.sin,a=Math.sqrt,c=1e-12,l=Math.PI,u=l/2,f=2*l;function x(t){return t>=1?u:t<=-1?-u:Math.asin(t)}function y(t){return t.innerRadius}function p(t){return t.outerRadius}function v(t){return t.startAngle}function d(t){return t.endAngle}function T(t){return t&&t.padAngle}function g(t,n,i,e,s,h,_){var r=t-i,c=n-e,l=(_?h:-h)/a(r*r+c*c),u=l*c,f=-l*r,x=t+u,y=n+f,p=i+u,v=e+f,d=(x+p)/2,T=(y+v)/2,g=p-x,b=v-y,w=g*g+b*b,k=s-h,m=x*v-p*y,N=(b<0?-1:1)*a(o(0,k*k*w-m*m)),M=(m*b-g*N)/w,S=(-m*g-b*N)/w,E=(m*b+g*N)/w,A=(-m*g+b*N)/w,P=M-d,C=S-T,O=E-d,R=A-T;return P*P+C*C>O*O+R*R&&(M=E,S=A),{cx:M,cy:S,x01:-u,y01:-f,x11:M*(s/k-1),y11:S*(s/k-1)}}function b(t){this._context=t}function w(t){return new b(t)}function k(t){return t[0]}function m(t){return t[1]}function N(){var t=k,e=m,s=i(!0),h=null,o=w,_=null;function r(i){var r,a,c,l=i.length,u=!1;for(null==h&&(_=o(c=n.path())),r=0;r<=l;++r)!(r<l&&s(a=i[r],r,i))===u&&((u=!u)?_.lineStart():_.lineEnd()),u&&_.point(+t(a,r,i),+e(a,r,i));if(c)return _=null,c+""||null}return r.x=function(n){return arguments.length?(t="function"==typeof n?n:i(+n),r):t},r.y=function(t){return arguments.length?(e="function"==typeof t?t:i(+t),r):e},r.defined=function(t){return arguments.length?(s="function"==typeof t?t:i(!!t),r):s},r.curve=function(t){return arguments.length?(o=t,null!=h&&(_=o(h)),r):o},r.context=function(t){return arguments.length?(null==t?h=_=null:_=o(h=t),r):h},r}function M(){var t=k,e=null,s=i(0),h=m,o=i(!0),_=null,r=w,a=null;function c(i){var c,l,u,f,x,y=i.length,p=!1,v=new Array(y),d=new Array(y);for(null==_&&(a=r(x=n.path())),c=0;c<=y;++c){if(!(c<y&&o(f=i[c],c,i))===p)if(p=!p)l=c,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),u=c-1;u>=l;--u)a.point(v[u],d[u]);a.lineEnd(),a.areaEnd()}p&&(v[c]=+t(f,c,i),d[c]=+s(f,c,i),a.point(e?+e(f,c,i):v[c],h?+h(f,c,i):d[c]))}if(x)return a=null,x+""||null}function l(){return N().defined(o).curve(r).context(_)}return c.x=function(n){return arguments.length?(t="function"==typeof n?n:i(+n),e=null,c):t},c.x0=function(n){return arguments.length?(t="function"==typeof n?n:i(+n),c):t},c.x1=function(t){return arguments.length?(e=null==t?null:"function"==typeof t?t:i(+t),c):e},c.y=function(t){return arguments.length?(s="function"==typeof t?t:i(+t),h=null,c):s},c.y0=function(t){return arguments.length?(s="function"==typeof t?t:i(+t),c):s},c.y1=function(t){return arguments.length?(h=null==t?null:"function"==typeof t?t:i(+t),c):h},c.lineX0=c.lineY0=function(){return l().x(t).y(s)},c.lineY1=function(){return l().x(t).y(h)},c.lineX1=function(){return l().x(e).y(s)},c.defined=function(t){return arguments.length?(o="function"==typeof t?t:i(!!t),c):o},c.curve=function(t){return arguments.length?(r=t,null!=_&&(a=r(_)),c):r},c.context=function(t){return arguments.length?(null==t?_=a=null:a=r(_=t),c):_},c}function S(t,n){return n<t?-1:n>t?1:n>=t?0:NaN}function E(t){return t}b.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:this._context.lineTo(t,n)}}};var A=C(w);function P(t){this._curve=t}function C(t){function n(n){return new P(t(n))}return n._curve=t,n}function O(t){var n=t.curve;return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t.curve=function(t){return arguments.length?n(C(t)):n()._curve},t}function R(){return O(N().curve(A))}function q(){var t=M().curve(A),n=t.curve,i=t.lineX0,e=t.lineX1,s=t.lineY0,h=t.lineY1;return t.angle=t.x,delete t.x,t.startAngle=t.x0,delete t.x0,t.endAngle=t.x1,delete t.x1,t.radius=t.y,delete t.y,t.innerRadius=t.y0,delete t.y0,t.outerRadius=t.y1,delete t.y1,t.lineStartAngle=function(){return O(i())},delete t.lineX0,t.lineEndAngle=function(){return O(e())},delete t.lineX1,t.lineInnerRadius=function(){return O(s())},delete t.lineY0,t.lineOuterRadius=function(){return O(h())},delete t.lineY1,t.curve=function(t){return arguments.length?n(C(t)):n()._curve},t}function z(t,n){return[(n=+n)*Math.cos(t-=Math.PI/2),n*Math.sin(t)]}P.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,n){this._curve.point(n*Math.sin(t),n*-Math.cos(t))}};var X=Array.prototype.slice;function Y(t){return t.source}function B(t){return t.target}function I(t){var e=Y,s=B,h=k,o=m,_=null;function r(){var i,r=X.call(arguments),a=e.apply(this,r),c=s.apply(this,r);if(_||(_=i=n.path()),t(_,+h.apply(this,(r[0]=a,r)),+o.apply(this,r),+h.apply(this,(r[0]=c,r)),+o.apply(this,r)),i)return _=null,i+""||null}return r.source=function(t){return arguments.length?(e=t,r):e},r.target=function(t){return arguments.length?(s=t,r):s},r.x=function(t){return arguments.length?(h="function"==typeof t?t:i(+t),r):h},r.y=function(t){return arguments.length?(o="function"==typeof t?t:i(+t),r):o},r.context=function(t){return arguments.length?(_=null==t?null:t,r):_},r}function j(t,n,i,e,s){t.moveTo(n,i),t.bezierCurveTo(n=(n+e)/2,i,n,s,e,s)}function D(t,n,i,e,s){t.moveTo(n,i),t.bezierCurveTo(n,i=(i+s)/2,e,i,e,s)}function L(t,n,i,e,s){var h=z(n,i),o=z(n,i=(i+s)/2),_=z(e,i),r=z(e,s);t.moveTo(h[0],h[1]),t.bezierCurveTo(o[0],o[1],_[0],_[1],r[0],r[1])}var V={draw:function(t,n){var i=Math.sqrt(n/l);t.moveTo(i,0),t.arc(0,0,i,0,f)}},W={draw:function(t,n){var i=Math.sqrt(n/5)/2;t.moveTo(-3*i,-i),t.lineTo(-i,-i),t.lineTo(-i,-3*i),t.lineTo(i,-3*i),t.lineTo(i,-i),t.lineTo(3*i,-i),t.lineTo(3*i,i),t.lineTo(i,i),t.lineTo(i,3*i),t.lineTo(-i,3*i),t.lineTo(-i,i),t.lineTo(-3*i,i),t.closePath()}},H=Math.sqrt(1/3),F=2*H,G={draw:function(t,n){var i=Math.sqrt(n/F),e=i*H;t.moveTo(0,-i),t.lineTo(e,0),t.lineTo(0,i),t.lineTo(-e,0),t.closePath()}},J=Math.sin(l/10)/Math.sin(7*l/10),K=Math.sin(f/10)*J,Q=-Math.cos(f/10)*J,U={draw:function(t,n){var i=Math.sqrt(.8908130915292852*n),e=K*i,s=Q*i;t.moveTo(0,-i),t.lineTo(e,s);for(var h=1;h<5;++h){var o=f*h/5,_=Math.cos(o),r=Math.sin(o);t.lineTo(r*i,-_*i),t.lineTo(_*e-r*s,r*e+_*s)}t.closePath()}},Z={draw:function(t,n){var i=Math.sqrt(n),e=-i/2;t.rect(e,e,i,i)}},$=Math.sqrt(3),tt={draw:function(t,n){var i=-Math.sqrt(n/(3*$));t.moveTo(0,2*i),t.lineTo(-$*i,-i),t.lineTo($*i,-i),t.closePath()}},nt=-.5,it=Math.sqrt(3)/2,et=1/Math.sqrt(12),st=3*(et/2+1),ht={draw:function(t,n){var i=Math.sqrt(n/st),e=i/2,s=i*et,h=e,o=i*et+i,_=-h,r=o;t.moveTo(e,s),t.lineTo(h,o),t.lineTo(_,r),t.lineTo(nt*e-it*s,it*e+nt*s),t.lineTo(nt*h-it*o,it*h+nt*o),t.lineTo(nt*_-it*r,it*_+nt*r),t.lineTo(nt*e+it*s,nt*s-it*e),t.lineTo(nt*h+it*o,nt*o-it*h),t.lineTo(nt*_+it*r,nt*r-it*_),t.closePath()}},ot=[V,W,G,Z,U,tt,ht];function _t(){}function rt(t,n,i){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+n)/6,(t._y0+4*t._y1+i)/6)}function at(t){this._context=t}function ct(t){this._context=t}function lt(t){this._context=t}function ut(t,n){this._basis=new at(t),this._beta=n}at.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:rt(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:rt(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}},ct.prototype={areaStart:_t,areaEnd:_t,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._x2=t,this._y2=n;break;case 1:this._point=2,this._x3=t,this._y3=n;break;case 2:this._point=3,this._x4=t,this._y4=n,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+n)/6);break;default:rt(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}},lt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var i=(this._x0+4*this._x1+t)/6,e=(this._y0+4*this._y1+n)/6;this._line?this._context.lineTo(i,e):this._context.moveTo(i,e);break;case 3:this._point=4;default:rt(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}},ut.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,n=this._y,i=t.length-1;if(i>0)for(var e,s=t[0],h=n[0],o=t[i]-s,_=n[i]-h,r=-1;++r<=i;)e=r/i,this._basis.point(this._beta*t[r]+(1-this._beta)*(s+e*o),this._beta*n[r]+(1-this._beta)*(h+e*_));this._x=this._y=null,this._basis.lineEnd()},point:function(t,n){this._x.push(+t),this._y.push(+n)}};var ft=function t(n){function i(t){return 1===n?new at(t):new ut(t,n)}return i.beta=function(n){return t(+n)},i}(.85);function xt(t,n,i){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-n),t._y2+t._k*(t._y1-i),t._x2,t._y2)}function yt(t,n){this._context=t,this._k=(1-n)/6}yt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:xt(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2,this._x1=t,this._y1=n;break;case 2:this._point=3;default:xt(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var pt=function t(n){function i(t){return new yt(t,n)}return i.tension=function(n){return t(+n)},i}(0);function vt(t,n){this._context=t,this._k=(1-n)/6}vt.prototype={areaStart:_t,areaEnd:_t,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._x3=t,this._y3=n;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=n);break;case 2:this._point=3,this._x5=t,this._y5=n;break;default:xt(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var dt=function t(n){function i(t){return new vt(t,n)}return i.tension=function(n){return t(+n)},i}(0);function Tt(t,n){this._context=t,this._k=(1-n)/6}Tt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:xt(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var gt=function t(n){function i(t){return new Tt(t,n)}return i.tension=function(n){return t(+n)},i}(0);function bt(t,n,i){var e=t._x1,s=t._y1,h=t._x2,o=t._y2;if(t._l01_a>c){var _=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,r=3*t._l01_a*(t._l01_a+t._l12_a);e=(e*_-t._x0*t._l12_2a+t._x2*t._l01_2a)/r,s=(s*_-t._y0*t._l12_2a+t._y2*t._l01_2a)/r}if(t._l23_a>c){var a=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,l=3*t._l23_a*(t._l23_a+t._l12_a);h=(h*a+t._x1*t._l23_2a-n*t._l12_2a)/l,o=(o*a+t._y1*t._l23_2a-i*t._l12_2a)/l}t._context.bezierCurveTo(e,s,h,o,t._x2,t._y2)}function wt(t,n){this._context=t,this._alpha=n}wt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){if(t=+t,n=+n,this._point){var i=this._x2-t,e=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(i*i+e*e,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3;default:bt(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var kt=function t(n){function i(t){return n?new wt(t,n):new yt(t,0)}return i.alpha=function(n){return t(+n)},i}(.5);function mt(t,n){this._context=t,this._alpha=n}mt.prototype={areaStart:_t,areaEnd:_t,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,n){if(t=+t,n=+n,this._point){var i=this._x2-t,e=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(i*i+e*e,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=n;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=n);break;case 2:this._point=3,this._x5=t,this._y5=n;break;default:bt(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var Nt=function t(n){function i(t){return n?new mt(t,n):new vt(t,0)}return i.alpha=function(n){return t(+n)},i}(.5);function Mt(t,n){this._context=t,this._alpha=n}Mt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){if(t=+t,n=+n,this._point){var i=this._x2-t,e=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(i*i+e*e,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:bt(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var St=function t(n){function i(t){return n?new Mt(t,n):new Tt(t,0)}return i.alpha=function(n){return t(+n)},i}(.5);function Et(t){this._context=t}function At(t){return t<0?-1:1}function Pt(t,n,i){var e=t._x1-t._x0,s=n-t._x1,h=(t._y1-t._y0)/(e||s<0&&-0),o=(i-t._y1)/(s||e<0&&-0),_=(h*s+o*e)/(e+s);return(At(h)+At(o))*Math.min(Math.abs(h),Math.abs(o),.5*Math.abs(_))||0}function Ct(t,n){var i=t._x1-t._x0;return i?(3*(t._y1-t._y0)/i-n)/2:n}function Ot(t,n,i){var e=t._x0,s=t._y0,h=t._x1,o=t._y1,_=(h-e)/3;t._context.bezierCurveTo(e+_,s+_*n,h-_,o-_*i,h,o)}function Rt(t){this._context=t}function qt(t){this._context=new zt(t)}function zt(t){this._context=t}function Xt(t){this._context=t}function Yt(t){var n,i,e=t.length-1,s=new Array(e),h=new Array(e),o=new Array(e);for(s[0]=0,h[0]=2,o[0]=t[0]+2*t[1],n=1;n<e-1;++n)s[n]=1,h[n]=4,o[n]=4*t[n]+2*t[n+1];for(s[e-1]=2,h[e-1]=7,o[e-1]=8*t[e-1]+t[e],n=1;n<e;++n)i=s[n]/h[n-1],h[n]-=i,o[n]-=i*o[n-1];for(s[e-1]=o[e-1]/h[e-1],n=e-2;n>=0;--n)s[n]=(o[n]-s[n+1])/h[n];for(h[e-1]=(t[e]+s[e-1])/2,n=0;n<e-1;++n)h[n]=2*t[n+1]-s[n+1];return[s,h]}function Bt(t,n){this._context=t,this._t=n}function It(t,n){if((s=t.length)>1)for(var i,e,s,h=1,o=t[n[0]],_=o.length;h<s;++h)for(e=o,o=t[n[h]],i=0;i<_;++i)o[i][1]+=o[i][0]=isNaN(e[i][1])?e[i][0]:e[i][1]}function jt(t){for(var n=t.length,i=new Array(n);--n>=0;)i[n]=n;return i}function Dt(t,n){return t[n]}function Lt(t){var n=t.map(Vt);return jt(t).sort(function(t,i){return n[t]-n[i]})}function Vt(t){for(var n,i=-1,e=0,s=t.length,h=-1/0;++i<s;)(n=+t[i][1])>h&&(h=n,e=i);return e}function Wt(t){var n=t.map(Ht);return jt(t).sort(function(t,i){return n[t]-n[i]})}function Ht(t){for(var n,i=0,e=-1,s=t.length;++e<s;)(n=+t[e][1])&&(i+=n);return i}Et.prototype={areaStart:_t,areaEnd:_t,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,n){t=+t,n=+n,this._point?this._context.lineTo(t,n):(this._point=1,this._context.moveTo(t,n))}},Rt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Ot(this,this._t0,Ct(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){var i=NaN;if(n=+n,(t=+t)!==this._x1||n!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3,Ot(this,Ct(this,i=Pt(this,t,n)),i);break;default:Ot(this,this._t0,i=Pt(this,t,n))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n,this._t0=i}}},(qt.prototype=Object.create(Rt.prototype)).point=function(t,n){Rt.prototype.point.call(this,n,t)},zt.prototype={moveTo:function(t,n){this._context.moveTo(n,t)},closePath:function(){this._context.closePath()},lineTo:function(t,n){this._context.lineTo(n,t)},bezierCurveTo:function(t,n,i,e,s,h){this._context.bezierCurveTo(n,t,e,i,h,s)}},Xt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,n=this._y,i=t.length;if(i)if(this._line?this._context.lineTo(t[0],n[0]):this._context.moveTo(t[0],n[0]),2===i)this._context.lineTo(t[1],n[1]);else for(var e=Yt(t),s=Yt(n),h=0,o=1;o<i;++h,++o)this._context.bezierCurveTo(e[0][h],s[0][h],e[1][h],s[1][h],t[o],n[o]);(this._line||0!==this._line&&1===i)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,n){this._x.push(+t),this._y.push(+n)}},Bt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,n),this._context.lineTo(t,n);else{var i=this._x*(1-this._t)+t*this._t;this._context.lineTo(i,this._y),this._context.lineTo(i,n)}}this._x=t,this._y=n}},t.arc=function(){var t=y,o=p,b=i(0),w=null,k=v,m=d,N=T,M=null;function S(){var i,y,p,v=+t.apply(this,arguments),d=+o.apply(this,arguments),T=k.apply(this,arguments)-u,S=m.apply(this,arguments)-u,E=e(S-T),A=S>T;if(M||(M=i=n.path()),d<v&&(y=d,d=v,v=y),d>c)if(E>f-c)M.moveTo(d*h(T),d*r(T)),M.arc(0,0,d,T,S,!A),v>c&&(M.moveTo(v*h(S),v*r(S)),M.arc(0,0,v,S,T,A));else{var P,C,O=T,R=S,q=T,z=S,X=E,Y=E,B=N.apply(this,arguments)/2,I=B>c&&(w?+w.apply(this,arguments):a(v*v+d*d)),j=_(e(d-v)/2,+b.apply(this,arguments)),D=j,L=j;if(I>c){var V=x(I/v*r(B)),W=x(I/d*r(B));(X-=2*V)>c?(q+=V*=A?1:-1,z-=V):(X=0,q=z=(T+S)/2),(Y-=2*W)>c?(O+=W*=A?1:-1,R-=W):(Y=0,O=R=(T+S)/2)}var H=d*h(O),F=d*r(O),G=v*h(z),J=v*r(z);if(j>c){var K,Q=d*h(R),U=d*r(R),Z=v*h(q),$=v*r(q);if(E<l&&(K=function(t,n,i,e,s,h,o,_){var r=i-t,a=e-n,l=o-s,u=_-h,f=u*r-l*a;if(!(f*f<c))return[t+(f=(l*(n-h)-u*(t-s))/f)*r,n+f*a]}(H,F,Z,$,Q,U,G,J))){var tt=H-K[0],nt=F-K[1],it=Q-K[0],et=U-K[1],st=1/r(((p=(tt*it+nt*et)/(a(tt*tt+nt*nt)*a(it*it+et*et)))>1?0:p<-1?l:Math.acos(p))/2),ht=a(K[0]*K[0]+K[1]*K[1]);D=_(j,(v-ht)/(st-1)),L=_(j,(d-ht)/(st+1))}}Y>c?L>c?(P=g(Z,$,H,F,d,L,A),C=g(Q,U,G,J,d,L,A),M.moveTo(P.cx+P.x01,P.cy+P.y01),L<j?M.arc(P.cx,P.cy,L,s(P.y01,P.x01),s(C.y01,C.x01),!A):(M.arc(P.cx,P.cy,L,s(P.y01,P.x01),s(P.y11,P.x11),!A),M.arc(0,0,d,s(P.cy+P.y11,P.cx+P.x11),s(C.cy+C.y11,C.cx+C.x11),!A),M.arc(C.cx,C.cy,L,s(C.y11,C.x11),s(C.y01,C.x01),!A))):(M.moveTo(H,F),M.arc(0,0,d,O,R,!A)):M.moveTo(H,F),v>c&&X>c?D>c?(P=g(G,J,Q,U,v,-D,A),C=g(H,F,Z,$,v,-D,A),M.lineTo(P.cx+P.x01,P.cy+P.y01),D<j?M.arc(P.cx,P.cy,D,s(P.y01,P.x01),s(C.y01,C.x01),!A):(M.arc(P.cx,P.cy,D,s(P.y01,P.x01),s(P.y11,P.x11),!A),M.arc(0,0,v,s(P.cy+P.y11,P.cx+P.x11),s(C.cy+C.y11,C.cx+C.x11),A),M.arc(C.cx,C.cy,D,s(C.y11,C.x11),s(C.y01,C.x01),!A))):M.arc(0,0,v,z,q,A):M.lineTo(G,J)}else M.moveTo(0,0);if(M.closePath(),i)return M=null,i+""||null}return S.centroid=function(){var n=(+t.apply(this,arguments)+ +o.apply(this,arguments))/2,i=(+k.apply(this,arguments)+ +m.apply(this,arguments))/2-l/2;return[h(i)*n,r(i)*n]},S.innerRadius=function(n){return arguments.length?(t="function"==typeof n?n:i(+n),S):t},S.outerRadius=function(t){return arguments.length?(o="function"==typeof t?t:i(+t),S):o},S.cornerRadius=function(t){return arguments.length?(b="function"==typeof t?t:i(+t),S):b},S.padRadius=function(t){return arguments.length?(w=null==t?null:"function"==typeof t?t:i(+t),S):w},S.startAngle=function(t){return arguments.length?(k="function"==typeof t?t:i(+t),S):k},S.endAngle=function(t){return arguments.length?(m="function"==typeof t?t:i(+t),S):m},S.padAngle=function(t){return arguments.length?(N="function"==typeof t?t:i(+t),S):N},S.context=function(t){return arguments.length?(M=null==t?null:t,S):M},S},t.area=M,t.line=N,t.pie=function(){var t=E,n=S,e=null,s=i(0),h=i(f),o=i(0);function _(i){var _,r,a,c,l,u=i.length,x=0,y=new Array(u),p=new Array(u),v=+s.apply(this,arguments),d=Math.min(f,Math.max(-f,h.apply(this,arguments)-v)),T=Math.min(Math.abs(d)/u,o.apply(this,arguments)),g=T*(d<0?-1:1);for(_=0;_<u;++_)(l=p[y[_]=_]=+t(i[_],_,i))>0&&(x+=l);for(null!=n?y.sort(function(t,i){return n(p[t],p[i])}):null!=e&&y.sort(function(t,n){return e(i[t],i[n])}),_=0,a=x?(d-u*g)/x:0;_<u;++_,v=c)r=y[_],c=v+((l=p[r])>0?l*a:0)+g,p[r]={data:i[r],index:_,value:l,startAngle:v,endAngle:c,padAngle:T};return p}return _.value=function(n){return arguments.length?(t="function"==typeof n?n:i(+n),_):t},_.sortValues=function(t){return arguments.length?(n=t,e=null,_):n},_.sort=function(t){return arguments.length?(e=t,n=null,_):e},_.startAngle=function(t){return arguments.length?(s="function"==typeof t?t:i(+t),_):s},_.endAngle=function(t){return arguments.length?(h="function"==typeof t?t:i(+t),_):h},_.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:i(+t),_):o},_},t.areaRadial=q,t.radialArea=q,t.lineRadial=R,t.radialLine=R,t.pointRadial=z,t.linkHorizontal=function(){return I(j)},t.linkVertical=function(){return I(D)},t.linkRadial=function(){var t=I(L);return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t},t.symbol=function(){var t=i(V),e=i(64),s=null;function h(){var i;if(s||(s=i=n.path()),t.apply(this,arguments).draw(s,+e.apply(this,arguments)),i)return s=null,i+""||null}return h.type=function(n){return arguments.length?(t="function"==typeof n?n:i(n),h):t},h.size=function(t){return arguments.length?(e="function"==typeof t?t:i(+t),h):e},h.context=function(t){return arguments.length?(s=null==t?null:t,h):s},h},t.symbols=ot,t.symbolCircle=V,t.symbolCross=W,t.symbolDiamond=G,t.symbolSquare=Z,t.symbolStar=U,t.symbolTriangle=tt,t.symbolWye=ht,t.curveBasisClosed=function(t){return new ct(t)},t.curveBasisOpen=function(t){return new lt(t)},t.curveBasis=function(t){return new at(t)},t.curveBundle=ft,t.curveCardinalClosed=dt,t.curveCardinalOpen=gt,t.curveCardinal=pt,t.curveCatmullRomClosed=Nt,t.curveCatmullRomOpen=St,t.curveCatmullRom=kt,t.curveLinearClosed=function(t){return new Et(t)},t.curveLinear=w,t.curveMonotoneX=function(t){return new Rt(t)},t.curveMonotoneY=function(t){return new qt(t)},t.curveNatural=function(t){return new Xt(t)},t.curveStep=function(t){return new Bt(t,.5)},t.curveStepAfter=function(t){return new Bt(t,1)},t.curveStepBefore=function(t){return new Bt(t,0)},t.stack=function(){var t=i([]),n=jt,e=It,s=Dt;function h(i){var h,o,_=t.apply(this,arguments),r=i.length,a=_.length,c=new Array(a);for(h=0;h<a;++h){for(var l,u=_[h],f=c[h]=new Array(r),x=0;x<r;++x)f[x]=l=[0,+s(i[x],u,x,i)],l.data=i[x];f.key=u}for(h=0,o=n(c);h<a;++h)c[o[h]].index=h;return e(c,o),c}return h.keys=function(n){return arguments.length?(t="function"==typeof n?n:i(X.call(n)),h):t},h.value=function(t){return arguments.length?(s="function"==typeof t?t:i(+t),h):s},h.order=function(t){return arguments.length?(n=null==t?jt:"function"==typeof t?t:i(X.call(t)),h):n},h.offset=function(t){return arguments.length?(e=null==t?It:t,h):e},h},t.stackOffsetExpand=function(t,n){if((e=t.length)>0){for(var i,e,s,h=0,o=t[0].length;h<o;++h){for(s=i=0;i<e;++i)s+=t[i][h][1]||0;if(s)for(i=0;i<e;++i)t[i][h][1]/=s}It(t,n)}},t.stackOffsetDiverging=function(t,n){if((_=t.length)>1)for(var i,e,s,h,o,_,r=0,a=t[n[0]].length;r<a;++r)for(h=o=0,i=0;i<_;++i)(s=(e=t[n[i]][r])[1]-e[0])>=0?(e[0]=h,e[1]=h+=s):s<0?(e[1]=o,e[0]=o+=s):e[0]=h},t.stackOffsetNone=It,t.stackOffsetSilhouette=function(t,n){if((i=t.length)>0){for(var i,e=0,s=t[n[0]],h=s.length;e<h;++e){for(var o=0,_=0;o<i;++o)_+=t[o][e][1]||0;s[e][1]+=s[e][0]=-_/2}It(t,n)}},t.stackOffsetWiggle=function(t,n){if((s=t.length)>0&&(e=(i=t[n[0]]).length)>0){for(var i,e,s,h=0,o=1;o<e;++o){for(var _=0,r=0,a=0;_<s;++_){for(var c=t[n[_]],l=c[o][1]||0,u=(l-(c[o-1][1]||0))/2,f=0;f<_;++f){var x=t[n[f]];u+=(x[o][1]||0)-(x[o-1][1]||0)}r+=l,a+=u*l}i[o-1][1]+=i[o-1][0]=h,r&&(h-=a/r)}i[o-1][1]+=i[o-1][0]=h,It(t,n)}},t.stackOrderAppearance=Lt,t.stackOrderAscending=Wt,t.stackOrderDescending=function(t){return Wt(t).reverse()},t.stackOrderInsideOut=function(t){var n,i,e=t.length,s=t.map(Ht),h=Lt(t),o=0,_=0,r=[],a=[];for(n=0;n<e;++n)i=h[n],o<_?(o+=s[i],r.push(i)):(_+=s[i],a.push(i));return a.reverse().concat(r)},t.stackOrderNone=jt,t.stackOrderReverse=function(t){return jt(t).reverse()},Object.defineProperty(t,"__esModule",{value:!0})});

},{"d3-path":36}],40:[function(require,module,exports){
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-time")):"function"==typeof define&&define.amd?define(["exports","d3-time"],t):t(e.d3=e.d3||{},e.d3)}(this,function(e,t){"use strict";function n(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function r(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function u(e){return{y:e,m:0,d:1,H:0,M:0,S:0,L:0}}function c(e){var c=e.dateTime,i=e.date,a=e.time,f=e.periods,l=e.days,s=e.shortDays,g=e.months,ve=e.shortMonths,Me=y(f),Te=d(f),De=y(l),Ce=d(l),xe=y(s),Ue=d(s),pe=y(g),we=d(g),Se=y(ve),Ye=d(ve),Fe={a:function(e){return s[e.getDay()]},A:function(e){return l[e.getDay()]},b:function(e){return ve[e.getMonth()]},B:function(e){return g[e.getMonth()]},c:null,d:W,e:W,f:I,H:V,I:j,j:P,L:Q,m:J,M:O,p:function(e){return f[+(e.getHours()>=12)]},Q:he,s:me,S:X,u:N,U:B,V:_,w:$,W:q,x:null,X:null,y:z,Y:E,Z:R,"%":de},He={a:function(e){return s[e.getUTCDay()]},A:function(e){return l[e.getUTCDay()]},b:function(e){return ve[e.getUTCMonth()]},B:function(e){return g[e.getUTCMonth()]},c:null,d:k,e:k,f:ne,H:G,I:K,j:ee,L:te,m:re,M:ue,p:function(e){return f[+(e.getUTCHours()>=12)]},Q:he,s:me,S:ce,u:ie,U:oe,V:ae,w:fe,W:le,x:null,X:null,y:se,Y:ge,Z:ye,"%":de},Le={a:function(e,t,n){var r=xe.exec(t.slice(n));return r?(e.w=Ue[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=De.exec(t.slice(n));return r?(e.w=Ce[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=Se.exec(t.slice(n));return r?(e.m=Ye[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=pe.exec(t.slice(n));return r?(e.m=we[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,t,n){return be(e,c,t,n)},d:p,e:p,f:L,H:S,I:S,j:w,L:H,m:U,M:Y,p:function(e,t,n){var r=Me.exec(t.slice(n));return r?(e.p=Te[r[0].toLowerCase()],n+r[0].length):-1},Q:Z,s:b,S:F,u:m,U:v,V:M,w:h,W:T,x:function(e,t,n){return be(e,i,t,n)},X:function(e,t,n){return be(e,a,t,n)},y:C,Y:D,Z:x,"%":A};function Ae(e,t){return function(n){var r,u,c,i=[],a=-1,f=0,l=e.length;for(n instanceof Date||(n=new Date(+n));++a<l;)37===e.charCodeAt(a)&&(i.push(e.slice(f,a)),null!=(u=o[r=e.charAt(++a)])?r=e.charAt(++a):u="e"===r?" ":"0",(c=t[r])&&(r=c(n,u)),i.push(r),f=a+1);return i.push(e.slice(f,a)),i.join("")}}function Ze(e,n){return function(c){var i,o,a=u(1900);if(be(a,e,c+="",0)!=c.length)return null;if("Q"in a)return new Date(a.Q);if("p"in a&&(a.H=a.H%12+12*a.p),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(o=(i=r(u(a.y))).getUTCDay(),i=o>4||0===o?t.utcMonday.ceil(i):t.utcMonday(i),i=t.utcDay.offset(i,7*(a.V-1)),a.y=i.getUTCFullYear(),a.m=i.getUTCMonth(),a.d=i.getUTCDate()+(a.w+6)%7):(o=(i=n(u(a.y))).getDay(),i=o>4||0===o?t.timeMonday.ceil(i):t.timeMonday(i),i=t.timeDay.offset(i,7*(a.V-1)),a.y=i.getFullYear(),a.m=i.getMonth(),a.d=i.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),o="Z"in a?r(u(a.y)).getUTCDay():n(u(a.y)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(o+5)%7:a.w+7*a.U-(o+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,r(a)):n(a)}}function be(e,t,n,r){for(var u,c,i=0,a=t.length,f=n.length;i<a;){if(r>=f)return-1;if(37===(u=t.charCodeAt(i++))){if(u=t.charAt(i++),!(c=Le[u in o?t.charAt(i++):u])||(r=c(e,n,r))<0)return-1}else if(u!=n.charCodeAt(r++))return-1}return r}return Fe.x=Ae(i,Fe),Fe.X=Ae(a,Fe),Fe.c=Ae(c,Fe),He.x=Ae(i,He),He.X=Ae(a,He),He.c=Ae(c,He),{format:function(e){var t=Ae(e+="",Fe);return t.toString=function(){return e},t},parse:function(e){var t=Ze(e+="",n);return t.toString=function(){return e},t},utcFormat:function(e){var t=Ae(e+="",He);return t.toString=function(){return e},t},utcParse:function(e){var t=Ze(e,r);return t.toString=function(){return e},t}}}var i,o={"-":"",_:" ",0:"0"},a=/^\s*\d+/,f=/^%/,l=/[\\^$*+?|[\]().{}]/g;function s(e,t,n){var r=e<0?"-":"",u=(r?-e:e)+"",c=u.length;return r+(c<n?new Array(n-c+1).join(t)+u:u)}function g(e){return e.replace(l,"\\$&")}function y(e){return new RegExp("^(?:"+e.map(g).join("|")+")","i")}function d(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function h(e,t,n){var r=a.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function m(e,t,n){var r=a.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function v(e,t,n){var r=a.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function M(e,t,n){var r=a.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function T(e,t,n){var r=a.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function D(e,t,n){var r=a.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function C(e,t,n){var r=a.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function x(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function U(e,t,n){var r=a.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function p(e,t,n){var r=a.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function w(e,t,n){var r=a.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function S(e,t,n){var r=a.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Y(e,t,n){var r=a.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function F(e,t,n){var r=a.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function H(e,t,n){var r=a.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function L(e,t,n){var r=a.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function A(e,t,n){var r=f.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Z(e,t,n){var r=a.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function b(e,t,n){var r=a.exec(t.slice(n));return r?(e.Q=1e3*+r[0],n+r[0].length):-1}function W(e,t){return s(e.getDate(),t,2)}function V(e,t){return s(e.getHours(),t,2)}function j(e,t){return s(e.getHours()%12||12,t,2)}function P(e,n){return s(1+t.timeDay.count(t.timeYear(e),e),n,3)}function Q(e,t){return s(e.getMilliseconds(),t,3)}function I(e,t){return Q(e,t)+"000"}function J(e,t){return s(e.getMonth()+1,t,2)}function O(e,t){return s(e.getMinutes(),t,2)}function X(e,t){return s(e.getSeconds(),t,2)}function N(e){var t=e.getDay();return 0===t?7:t}function B(e,n){return s(t.timeSunday.count(t.timeYear(e),e),n,2)}function _(e,n){var r=e.getDay();return e=r>=4||0===r?t.timeThursday(e):t.timeThursday.ceil(e),s(t.timeThursday.count(t.timeYear(e),e)+(4===t.timeYear(e).getDay()),n,2)}function $(e){return e.getDay()}function q(e,n){return s(t.timeMonday.count(t.timeYear(e),e),n,2)}function z(e,t){return s(e.getFullYear()%100,t,2)}function E(e,t){return s(e.getFullYear()%1e4,t,4)}function R(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+s(t/60|0,"0",2)+s(t%60,"0",2)}function k(e,t){return s(e.getUTCDate(),t,2)}function G(e,t){return s(e.getUTCHours(),t,2)}function K(e,t){return s(e.getUTCHours()%12||12,t,2)}function ee(e,n){return s(1+t.utcDay.count(t.utcYear(e),e),n,3)}function te(e,t){return s(e.getUTCMilliseconds(),t,3)}function ne(e,t){return te(e,t)+"000"}function re(e,t){return s(e.getUTCMonth()+1,t,2)}function ue(e,t){return s(e.getUTCMinutes(),t,2)}function ce(e,t){return s(e.getUTCSeconds(),t,2)}function ie(e){var t=e.getUTCDay();return 0===t?7:t}function oe(e,n){return s(t.utcSunday.count(t.utcYear(e),e),n,2)}function ae(e,n){var r=e.getUTCDay();return e=r>=4||0===r?t.utcThursday(e):t.utcThursday.ceil(e),s(t.utcThursday.count(t.utcYear(e),e)+(4===t.utcYear(e).getUTCDay()),n,2)}function fe(e){return e.getUTCDay()}function le(e,n){return s(t.utcMonday.count(t.utcYear(e),e),n,2)}function se(e,t){return s(e.getUTCFullYear()%100,t,2)}function ge(e,t){return s(e.getUTCFullYear()%1e4,t,4)}function ye(){return"+0000"}function de(){return"%"}function he(e){return+e}function me(e){return Math.floor(+e/1e3)}function ve(t){return i=c(t),e.timeFormat=i.format,e.timeParse=i.parse,e.utcFormat=i.utcFormat,e.utcParse=i.utcParse,i}ve({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var Me=Date.prototype.toISOString?function(e){return e.toISOString()}:e.utcFormat("%Y-%m-%dT%H:%M:%S.%LZ");var Te=+new Date("2000-01-01T00:00:00.000Z")?function(e){var t=new Date(e);return isNaN(t)?null:t}:e.utcParse("%Y-%m-%dT%H:%M:%S.%LZ");e.timeFormatDefaultLocale=ve,e.timeFormatLocale=c,e.isoFormat=Me,e.isoParse=Te,Object.defineProperty(e,"__esModule",{value:!0})});

},{"d3-time":41}],41:[function(require,module,exports){
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.d3=e.d3||{})}(this,function(e){"use strict";var t=new Date,n=new Date;function u(e,r,i,o){function s(t){return e(t=new Date(+t)),t}return s.floor=s,s.ceil=function(t){return e(t=new Date(t-1)),r(t,1),e(t),t},s.round=function(e){var t=s(e),n=s.ceil(e);return e-t<n-e?t:n},s.offset=function(e,t){return r(e=new Date(+e),null==t?1:Math.floor(t)),e},s.range=function(t,n,u){var i,o=[];if(t=s.ceil(t),u=null==u?1:Math.floor(u),!(t<n&&u>0))return o;do{o.push(i=new Date(+t)),r(t,u),e(t)}while(i<t&&t<n);return o},s.filter=function(t){return u(function(n){if(n>=n)for(;e(n),!t(n);)n.setTime(n-1)},function(e,n){if(e>=e)if(n<0)for(;++n<=0;)for(;r(e,-1),!t(e););else for(;--n>=0;)for(;r(e,1),!t(e););})},i&&(s.count=function(u,r){return t.setTime(+u),n.setTime(+r),e(t),e(n),Math.floor(i(t,n))},s.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?s.filter(o?function(t){return o(t)%e==0}:function(t){return s.count(0,t)%e==0}):s:null}),s}var r=u(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});r.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?u(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):r:null};var i=r.range,o=6e4,s=6048e5,a=u(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),c=a.range,f=u(function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds())},function(e,t){e.setTime(+e+t*o)},function(e,t){return(t-e)/o},function(e){return e.getMinutes()}),l=f.range,g=u(function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds()-e.getMinutes()*o)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),T=g.range,d=u(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*o)/864e5},function(e){return e.getDate()-1}),m=d.range;function M(e){return u(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*o)/s})}var y=M(0),C=M(1),U=M(2),h=M(3),F=M(4),D=M(5),Y=M(6),H=y.range,S=C.range,v=U.range,p=h.range,W=F.range,w=D.range,O=Y.range,k=u(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),z=k.range,x=u(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});x.every=function(e){return isFinite(e=Math.floor(e))&&e>0?u(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)}):null};var b=x.range,j=u(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*o)},function(e,t){return(t-e)/o},function(e){return e.getUTCMinutes()}),_=j.range,I=u(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()}),P=I.range,q=u(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),A=q.range;function B(e){return u(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/s})}var E=B(0),G=B(1),J=B(2),K=B(3),L=B(4),N=B(5),Q=B(6),R=E.range,V=G.range,X=J.range,Z=K.range,$=L.range,ee=N.range,te=Q.range,ne=u(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),ue=ne.range,re=u(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});re.every=function(e){return isFinite(e=Math.floor(e))&&e>0?u(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)}):null};var ie=re.range;e.timeInterval=u,e.timeMillisecond=r,e.timeMilliseconds=i,e.utcMillisecond=r,e.utcMilliseconds=i,e.timeSecond=a,e.timeSeconds=c,e.utcSecond=a,e.utcSeconds=c,e.timeMinute=f,e.timeMinutes=l,e.timeHour=g,e.timeHours=T,e.timeDay=d,e.timeDays=m,e.timeWeek=y,e.timeWeeks=H,e.timeSunday=y,e.timeSundays=H,e.timeMonday=C,e.timeMondays=S,e.timeTuesday=U,e.timeTuesdays=v,e.timeWednesday=h,e.timeWednesdays=p,e.timeThursday=F,e.timeThursdays=W,e.timeFriday=D,e.timeFridays=w,e.timeSaturday=Y,e.timeSaturdays=O,e.timeMonth=k,e.timeMonths=z,e.timeYear=x,e.timeYears=b,e.utcMinute=j,e.utcMinutes=_,e.utcHour=I,e.utcHours=P,e.utcDay=q,e.utcDays=A,e.utcWeek=E,e.utcWeeks=R,e.utcSunday=E,e.utcSundays=R,e.utcMonday=G,e.utcMondays=V,e.utcTuesday=J,e.utcTuesdays=X,e.utcWednesday=K,e.utcWednesdays=Z,e.utcThursday=L,e.utcThursdays=$,e.utcFriday=N,e.utcFridays=ee,e.utcSaturday=Q,e.utcSaturdays=te,e.utcMonth=ne,e.utcMonths=ue,e.utcYear=re,e.utcYears=ie,Object.defineProperty(e,"__esModule",{value:!0})});

},{}],42:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,r,t,n){var o,c=arguments.length,i=c<3?r:null===n?n=Object.getOwnPropertyDescriptor(r,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,t,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(c<3?o(i):c>3?o(r,t,i):o(r,t))||i);return c>3&&i&&Object.defineProperty(r,t,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("./doc"),BrowserUtil=function(){function e(){}return e.nextFrame=function(){return new Promise(function(e){return requestAnimationFrame(function(){return e()})})},__decorate([doc_1.doc({heading:"Performance",subheading:"Timing"})],e,"nextFrame",null),e}();exports.BrowserUtil=BrowserUtil;

},{"./doc":64}],43:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(a,o){function i(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(i,s)}c((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("../../tensor"),util=require("../../util"),BatchDataset=function(){function t(t,e,n){void 0===n&&(n=!0),this.base=t,this.batchSize=e,this.smallLastBatch=n}return t.prototype.getStream=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.base.getStream()];case 1:return[2,t.sent().batch(this.batchSize,this.smallLastBatch).map(makeDatasetBatch)]}})})},t}();function makeDatasetBatch(t){var e={},n=t[0],r=Object.keys(n);r.forEach(function(t){e[t]=[]});for(var a=function(t){r.forEach(function(n){var r=t[n];e[n].push(r)})},o=0,i=t;o<i.length;o++){a(i[o])}for(var s={},c=0,u=r;c<u.length;c++){var h=u[c];if(e[h].length!==t.length)throw new Error("Batching failed to get a '"+h+"' value for each element.");"string"==typeof e[h][0]?s[h]=e[h]:s[h]=batchConcat(e[h])}return s}function batchConcat(t){for(var e=shapeAndValues(t[0])[0],n=[t.length].concat(e),r=new Float32Array(n.reduce(function(t,e){return t*e})),a=0,o=0,i=t;o<i.length;o++){var s=shapeAndValues(i[o]),c=s[0],u=s[1];if(!util.arraysEqual(c,e))throw new Error("Elements must have the same shape to be batched");r.set(u,a),a+=u.length}return tensor_1.Tensor.make(n,{values:r})}function shapeAndValues(t){return t instanceof tensor_1.Tensor?[t.shape,t.dataSync()]:Array.isArray(t)?[[t.length],t]:[[],[t]]}exports.BatchDataset=BatchDataset;

},{"../../tensor":178,"../../util":183}],44:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(a,o){function i(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?a(t.value):new r(function(e){e(t.value)}).then(i,s)}u((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var seedrandom=require("seedrandom"),batch_dataset_1=require("./batch_dataset"),statistics_1=require("./statistics"),data_stream_1=require("./streams/data_stream"),data_stream_2=require("./streams/data_stream"),data_stream_3=require("./streams/data_stream"),Dataset=function(){function t(){}return t.prototype.computeStatistics=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,statistics_1.computeDatasetStatistics(this,t,e)]})})},t.prototype.filter=function(t){var e=this,r=this;return datasetFromStreamFn(function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,r.getStream()];case 1:return[2,e.sent().filter(t)]}})})})},t.prototype.map=function(t){var e=this,r=this;return datasetFromStreamFn(function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,r.getStream()];case 1:return[2,e.sent().map(t)]}})})})},t.prototype.batch=function(t,e){return void 0===e&&(e=!0),new batch_dataset_1.BatchDataset(this,t,e)},t.prototype.concatenate=function(t){var e=this,r=this;return datasetFromStreamFn(function(){return __awaiter(e,void 0,void 0,function(){var e,n;return __generator(this,function(a){switch(a.label){case 0:return[4,r.getStream()];case 1:return n=(e=a.sent()).concatenate,[4,t.getStream()];case 2:return[2,n.apply(e,[a.sent()])]}})})})},t.prototype.repeat=function(t){var e=this,r=this;return datasetFromStreamFn(function(){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return e=data_stream_2.streamFromFunction(function(){return r.getStream()}),[4,data_stream_1.streamFromConcatenated(e.take(t))];case 1:return[2,n.sent()]}})})})},t.prototype.take=function(t){var e=this,r=this;return datasetFromStreamFn(function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,r.getStream()];case 1:return[2,e.sent().take(t)]}})})})},t.prototype.skip=function(t){var e=this,r=this;return datasetFromStreamFn(function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,r.getStream()];case 1:return[2,e.sent().skip(t)]}})})})},t.prototype.shuffle=function(t,e,r){var n=this;void 0===r&&(r=!0);var a=this,o=seedrandom(e);return datasetFromStreamFn(function(){return __awaiter(n,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return e=o.int32(),r&&(e+=o.int32()),[4,a.getStream()];case 1:return[2,n.sent().shuffle(t,e.toString())]}})})})},t.prototype.prefetch=function(t){var e=this,r=this;return datasetFromStreamFn(function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,r.getStream()];case 1:return[2,e.sent().prefetch(t)]}})})})},t}();function datasetFromStreamFn(t){return new(function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.getStream=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,t()]})})},r}(Dataset))}function datasetFromElements(t){var e=this;return datasetFromStreamFn(function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve(data_stream_3.streamFromItems(t))]})})})}function datasetFromConcatenated(t){var e=this;return datasetFromStreamFn(function(){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return t.getStream()}))];case 1:return e=r.sent(),[2,data_stream_1.streamFromConcatenated(data_stream_3.streamFromItems(e))]}})})})}exports.Dataset=Dataset,exports.datasetFromStreamFn=datasetFromStreamFn,exports.datasetFromElements=datasetFromElements,exports.datasetFromConcatenated=datasetFromConcatenated;

},{"./batch_dataset":43,"./statistics":50,"./streams/data_stream":52,"seedrandom":186}],45:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function i(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,i)}u((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var n,r,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=r[2&s[0]?"return":s[0]?"throw":"next"])&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[0,a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}};Object.defineProperty(exports,"__esModule",{value:!0});var CsvHeaderConfig,dataset_1=require("../dataset"),text_line_dataset_1=require("./text_line_dataset");!function(e){e[e.READ_FIRST_LINE=0]="READ_FIRST_LINE",e[e.NUMBERED=1]="NUMBERED"}(CsvHeaderConfig=exports.CsvHeaderConfig||(exports.CsvHeaderConfig={}));var CSVDataset=function(e){function t(n){var r=e.call(this)||this;return r.input=n,r.hasHeaderLine=!1,r.base=new text_line_dataset_1.TextLineDataset(n,t.textColumnName),r}return __extends(t,e),Object.defineProperty(t.prototype,"csvColumnNames",{get:function(){return this._csvColumnNames},enumerable:!0,configurable:!0}),t.prototype.setCsvColumnNames=function(e){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(a){switch(a.label){case 0:return null!=e&&e!==CsvHeaderConfig.NUMBERED?[3,3]:[4,this.base.getStream()];case 1:return[4,a.sent().next()];case 2:return n=a.sent(),r=n[t.textColumnName],this._csvColumnNames=Array.from(r.split(",").keys()).map(function(e){return e.toString()}),[3,7];case 3:return e!==CsvHeaderConfig.READ_FIRST_LINE?[3,6]:[4,this.base.getStream()];case 4:return[4,a.sent().next()];case 5:return n=a.sent(),r=n[t.textColumnName],this._csvColumnNames=r.split(","),this.hasHeaderLine=!0,[3,7];case 6:this._csvColumnNames=e,a.label=7;case 7:return[2]}})})},t.create=function(e,n){return void 0===n&&(n=CsvHeaderConfig.NUMBERED),__awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){switch(a.label){case 0:return[4,(r=new t(e)).setCsvColumnNames(n)];case 1:return a.sent(),[2,r]}})})},t.prototype.getStream=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return[4,this.base.getStream()];case 1:return e=n.sent(),this.hasHeaderLine&&(e=e.skip(1)),[2,e.map(function(e){return t.makeDatasetElement(e)})]}})})},t.prototype.makeDatasetElement=function(e){for(var n=e[t.textColumnName].split(","),r={},a=0;a<this._csvColumnNames.length;a++){var s=n[a];if(""===s)r[this._csvColumnNames[a]]=void 0;else{var o=Number(s);isNaN(o)?r[this._csvColumnNames[a]]=s:r[this._csvColumnNames[a]]=o}}return r},t.textColumnName="line",t}(dataset_1.Dataset);exports.CSVDataset=CSVDataset;

},{"../dataset":44,"./text_line_dataset":46}],46:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,a){function i(t){try{c(r.next(t))}catch(t){a(t)}}function u(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(i,u)}c((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=r[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var dataset_1=require("../dataset"),TextLineDataset=function(t){function e(e,n){void 0===n&&(n="line");var r=t.call(this)||this;return r.input=e,r.columnName=n,r}return __extends(e,t),e.prototype.getStream=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n=this;return __generator(this,function(r){return t=this.input.getStream(),e=t.decodeUTF8(),[2,e.split("\n").map(function(t){return(e={})[n.columnName]=t,e;var e})]})})},e}(dataset_1.Dataset);exports.TextLineDataset=TextLineDataset;

},{"../dataset":44}],47:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DataSource=function(){return function(){}}();exports.DataSource=DataSource;

},{}],48:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var datasource_1=require("../datasource"),filereader_stream_1=require("../streams/filereader_stream"),FileDataSource=function(e){function t(t,r){void 0===r&&(r={});var o=e.call(this)||this;return o.input=t,o.options=r,o}return __extends(t,e),t.prototype.getStream=function(){return new filereader_stream_1.FileReaderStream(this.input,this.options)},t}(datasource_1.DataSource);exports.FileDataSource=FileDataSource;

},{"../datasource":47,"../streams/filereader_stream":53}],49:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var datasource_1=require("../datasource"),url_stream_1=require("../streams/url_stream"),URLDataSource=function(t){function r(r,e){void 0===e&&(e={});var o=t.call(this)||this;return o.url=r,o.options=e,o}return __extends(r,t),r.prototype.getStream=function(){return new url_stream_1.URLStream(this.url,this.options)},r}(datasource_1.DataSource);exports.URLDataSource=URLDataSource;

},{"../datasource":47,"../streams/url_stream":55}],50:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(a,o){function i(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(i,s)}u((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("../../tensor");function scaleTo01(t,e){var n=e-t,r=tensor_1.Scalar.new(t),a=tensor_1.Scalar.new(n);return function(e){if("string"==typeof e)throw new Error("Can't scale a string.");return e instanceof tensor_1.Tensor?e.sub(r).div(a):e instanceof Array?e.map(function(e){return(e-t)/n}):(e-t)/n}}function computeDatasetStatistics(t,e,n){return __awaiter(this,void 0,void 0,function(){var r,a;return __generator(this,function(o){switch(o.label){case 0:return[4,t.getStream()];case 1:return r=o.sent(),null!=n&&(r=r.shuffle(n)),null!=e&&(r=r.take(e)),a={},[4,r.forEach(function(t){for(var e in t){var n=t[e];if("string"==typeof n);else{var r=void 0,o=void 0;if(n instanceof tensor_1.Tensor)r=n.min().dataSync()[0],o=n.max().dataSync()[0];else if(n instanceof Array)r=n.reduce(function(t,e){return Math.min(t,e)}),o=n.reduce(function(t,e){return Math.max(t,e)});else{if(isNaN(n)||!isFinite(n))throw new Error("Cannot compute statistics: "+e+" = "+n);r=n,o=n}var i=a[e];null==i&&(i={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},a[e]=i),i.min=Math.min(i.min,r),i.max=Math.max(i.max,o)}}return{}})];case 2:return o.sent(),[2,a]}})})}exports.scaleTo01=scaleTo01,exports.computeDatasetStatistics=computeDatasetStatistics;

},{"../../tensor":178}],51:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,a){function o(t){try{s(n.next(t))}catch(t){a(t)}}function u(t){try{s(n.throw(t))}catch(t){a(t)}}function s(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(o,u)}s((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=n[2&a[0]?"return":a[0]?"throw":"next"])&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[0,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var utf8=require("utf8"),data_stream_1=require("./data_stream"),string_stream_1=require("./string_stream"),ByteStream=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.decodeUTF8=function(){return new Utf8Stream(this)},e}(data_stream_1.DataStream);exports.ByteStream=ByteStream;var Utf8Stream=function(t){function e(e){var r=t.call(this)||this;return r.impl=new Utf8StreamImpl(e),r}return __extends(e,t),e.prototype.next=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.impl.next()]})})},e}(string_stream_1.StringStream),Utf8StreamImpl=function(t){function e(e){var r=t.call(this)||this;return r.upstream=e,r.partial=new Uint8Array([]),r.partialBytesValid=0,r}return __extends(e,t),e.prototype.pump=function(){return __awaiter(this,void 0,void 0,function(){var t,e,r,n,i,a,o;return __generator(this,function(u){switch(u.label){case 0:return[4,this.upstream.next()];case 1:if(null==(t=u.sent())){if(0===this.partial.length)return[2,!1];t=new Uint8Array([])}for(e=this.partial.length-this.partialBytesValid,n=r=e,i=0;r<t.length;)n=r,i=utfWidth(t[r]),r=n+i;return r===t.length&&(n=r),a=utf8.decode(String.fromCharCode.apply(null,t.slice(e,n))),e>0?(this.partial.set(t.slice(0,e),this.partialBytesValid),o=utf8.decode(String.fromCharCode.apply(null,this.partial)),this.outputQueue.push(o+a)):this.outputQueue.push(a),n===t.length?(this.partial=new Uint8Array([]),this.partialBytesValid=0):(this.partial=new Uint8Array(new ArrayBuffer(i)),this.partial.set(t.slice(n),0),this.partialBytesValid=t.length-n),[2,!0]}})})},e}(data_stream_1.QueueStream);function utfWidth(t){return t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1}

},{"./data_stream":52,"./string_stream":54,"utf8":194}],52:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,a){function u(t){try{s(n.next(t))}catch(t){a(t)}}function o(t){try{s(n.throw(t))}catch(t){a(t)}}function s(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(u,o)}s((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var r,n,i,a,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(i=n[2&a[0]?"return":a[0]?"throw":"next"])&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[0,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,n=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(i=(i=u.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){u.label=a[1];break}if(6===a[0]&&u.label<i[1]){u.label=i[1],i=a;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(a);break}i[2]&&u.ops.pop(),u.trys.pop();continue}a=e.call(t,u)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(exports,"__esModule",{value:!0});var seedrandom=require("seedrandom"),growing_ring_buffer_1=require("../util/growing_ring_buffer"),ring_buffer_1=require("../util/ring_buffer");function streamFromItems(t){return new ArrayStream(t)}function streamFromIncrementing(t){var e=t;return streamFromFunction(function(){return e++})}function streamFromFunction(t){return new FunctionCallStream(t)}function streamFromConcatenated(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,ChainedStream.create(t)]})})}function streamFromConcatenatedFunction(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,streamFromConcatenated(streamFromFunction(t).take(e))]})})}exports.streamFromItems=streamFromItems,exports.streamFromIncrementing=streamFromIncrementing,exports.streamFromFunction=streamFromFunction,exports.streamFromConcatenated=streamFromConcatenated,exports.streamFromConcatenatedFunction=streamFromConcatenatedFunction;var DataStream=function(){function t(){}return t.prototype.collectRemaining=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(r){switch(r.label){case 0:return t=[],[4,this.next()];case 1:e=r.sent(),r.label=2;case 2:return null==e?[3,4]:(t.push(e),[4,this.next()]);case 3:return e=r.sent(),[3,2];case 4:return[2,t]}})})},t.prototype.resolveFully=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.next()];case 1:t=e.sent(),e.label=2;case 2:return null==t?[3,4]:[4,this.next()];case 3:return t=e.sent(),[3,2];case 4:return[2]}})})},t.prototype.filter=function(t){return new FilterStream(this,t)},t.prototype.map=function(t){return new MapStream(this,t)},t.prototype.forEach=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.map(t).resolveFully()]})})},t.prototype.batch=function(t,e){return void 0===e&&(e=!0),new BatchStream(this,t,e)},t.prototype.concatenate=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,ChainedStream.create(new ArrayStream([this,t]))]})})},t.prototype.take=function(t){return t<0||null==t?this:new TakeStream(this,t)},t.prototype.skip=function(t){return t<0||null==t?this:new SkipStream(this,t)},t.prototype.prefetch=function(t){return new PrefetchStream(this,t)},t.prototype.shuffle=function(t,e){return new ShuffleStream(this,t,e)},t}();exports.DataStream=DataStream;var ArrayStream=function(t){function e(e){var r=t.call(this)||this;return r.items=e,r.trav=0,r}return __extends(e,t),e.prototype.next=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return this.trav>=this.items.length?[2,void 0]:(t=this.items[this.trav],this.trav++,[2,t])})})},e}(DataStream),FunctionCallStream=function(t){function e(e){var r=t.call(this)||this;return r.nextFn=e,r}return __extends(e,t),e.prototype.next=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.nextFn()]})})},e}(DataStream),SkipStream=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.maxCount=r,n.count=0,n}return __extends(e,t),e.prototype.next=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return null==t.sent()?[2,void 0]:[3,0];case 2:return[2,this.upstream.next()]}})})},e}(DataStream),TakeStream=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.maxCount=r,n.count=0,n}return __extends(e,t),e.prototype.next=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.count++>=this.maxCount?[2,void 0]:[2,this.upstream.next()]})})},e}(DataStream),QueueStream=function(t){function e(){var e=t.call(this)||this;return e.outputQueue=new growing_ring_buffer_1.GrowingRingBuffer,e}return __extends(e,t),e.prototype.next=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return 0!==this.outputQueue.length()?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,void 0];case 2:return[2,this.outputQueue.shift()]}})})},e}(DataStream);exports.QueueStream=QueueStream;var BatchStream=function(t){function e(e,r,n){void 0===n&&(n=!0);var i=t.call(this)||this;return i.upstream=e,i.batchSize=r,i.enableSmallLastBatch=n,i.currentBatch=[],i}return __extends(e,t),e.prototype.pump=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.upstream.next()];case 1:return null==(t=e.sent())?this.enableSmallLastBatch&&this.currentBatch.length>0?(this.outputQueue.push(this.currentBatch),this.currentBatch=[],[2,!0]):[2,!1]:(this.currentBatch.push(t),this.currentBatch.length===this.batchSize&&(this.outputQueue.push(this.currentBatch),this.currentBatch=[]),[2,!0])}})})},e}(QueueStream),FilterStream=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.predicate=r,n}return __extends(e,t),e.prototype.pump=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(r){switch(r.label){case 0:return[4,this.upstream.next()];case 1:return null==(t=r.sent())?[2,!1]:(e=this.predicate(t))instanceof Promise?[4,e]:[3,3];case 2:e=r.sent(),r.label=3;case 3:return e&&this.outputQueue.push(t),[2,!0]}})})},e}(QueueStream),MapStream=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.transform=r,n}return __extends(e,t),e.prototype.pump=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(r){switch(r.label){case 0:return[4,this.upstream.next()];case 1:return null==(t=r.sent())?[2,!1]:(e=this.transform(t))instanceof Promise?[4,e]:[3,3];case 2:e=r.sent(),r.label=3;case 3:return this.outputQueue.push(e),[2,!0]}})})},e}(QueueStream),ChainState=function(){return function(t,e,r){this.item=t,this.currentStream=e,this.moreStreams=r}}();function nextChainState(t){return __awaiter(this,void 0,void 0,function(){var e,r,n;return __generator(this,function(i){switch(i.label){case 0:return[4,t];case 1:return e=i.sent(),null==(r=e.currentStream)?[2,new ChainState(void 0,void 0,e.moreStreams)]:[4,r.next()];case 2:return null!=(n=i.sent())?[3,4]:[4,e.moreStreams.next()];case 3:return r=i.sent(),[2,nextChainState(Promise.resolve(new ChainState(void 0,r,e.moreStreams)))];case 4:return[2,new ChainState(n,r,e.moreStreams)]}})})}var ChainedStream=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.create=function(t){return __awaiter(this,void 0,void 0,function(){var r,n;return __generator(this,function(i){switch(i.label){case 0:return r=new e,[4,t.next()];case 1:return n=i.sent(),r.currentPromise=Promise.resolve(new ChainState(void 0,n,t)),[2,r]}})})},e.prototype.next=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.currentPromise=nextChainState(this.currentPromise),[4,this.currentPromise];case 1:return[2,t.sent().item]}})})},e}(DataStream);exports.ChainedStream=ChainedStream;var PrefetchStream=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.bufferSize=r,n.total=0,n.buffer=new ring_buffer_1.RingBuffer(r),n}return __extends(e,t),e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();if(null==t)return;this.buffer.push(t)}},e.prototype.next=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.refill(),this.buffer.isEmpty()?[2,void 0]:[4,this.buffer.shift()];case 1:return t=e.sent(),this.refill(),[2,t]}})})},e}(DataStream);exports.PrefetchStream=PrefetchStream;var ShuffleStream=function(t){function e(e,r,n){var i=t.call(this,e,r)||this;return i.upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=seedrandom(n),i}return __extends(e,t),e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.next=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(r){switch(r.label){case 0:this.upstreamExhausted||this.refill(),r.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:return null!=(e=r.sent())?(this.refill(),[2,e]):(this.upstreamExhausted=!0,[3,1]);case 3:return[2,void 0]}})})},e}(PrefetchStream);exports.ShuffleStream=ShuffleStream;

},{"../util/growing_ring_buffer":56,"../util/ring_buffer":57,"seedrandom":186}],53:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{f(n.next(e))}catch(e){i(e)}}function u(e){try{f(n.throw(e))}catch(e){i(e)}}function f(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}f((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var byte_stream_1=require("./byte_stream"),FileReaderStream=function(e){function t(t,r){void 0===r&&(r={});var n=e.call(this)||this;return n.file=t,n.options=r,n.offset=r.offset||0,n.chunkSize=r.chunkSize||1048576,n}return __extends(t,e),t.prototype.next=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return this.offset>=this.file.size?[2,void 0]:[2,new Promise(function(t,r){var n=new FileReader;n.onload=function(e){var o=n.result;if(o instanceof ArrayBuffer&&(o=new Uint8Array(o)),!(o instanceof Uint8Array))return r(new TypeError("FileReader returned unknown type."));t(o)},n.onabort=function(e){return r(new Error("Aborted"))},n.onerror=function(e){return r(new Error(e.error))};var o=e.offset+e.chunkSize,i=e.file.slice(e.offset,o);n.readAsArrayBuffer(i),e.offset=o})]})})},t}(byte_stream_1.ByteStream);exports.FileReaderStream=FileReaderStream;

},{"./byte_stream":51}],54:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,u)}s((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var data_stream_1=require("./data_stream"),StringStream=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.split=function(t){return new SplitStream(this,t)},e}(data_stream_1.DataStream);exports.StringStream=StringStream;var SplitStream=function(t){function e(e,r){var n=t.call(this)||this;return n.impl=new SplitStreamImpl(e,r),n}return __extends(e,t),e.prototype.next=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.impl.next()]})})},e}(StringStream),SplitStreamImpl=function(t){function e(e,r){var n=t.call(this)||this;return n.upstream=e,n.separator=r,n.carryover="",n}return __extends(e,t),e.prototype.pump=function(){return __awaiter(this,void 0,void 0,function(){var t,e,r,n,o;return __generator(this,function(i){switch(i.label){case 0:return[4,this.upstream.next()];case 1:if(null==(t=i.sent()))return""===this.carryover?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((e=t.split(this.separator))[0]=this.carryover+e[0],r=0,n=e.slice(0,-1);r<n.length;r++)o=n[r],this.outputQueue.push(o);return this.carryover=e[e.length-1],[2,!0]}})})},e}(data_stream_1.QueueStream);

},{"./data_stream":52}],55:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,u)}s((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var byte_stream_1=require("./byte_stream"),data_stream_1=require("./data_stream"),filereader_stream_1=require("./filereader_stream"),URLStream=function(t){function e(e,r){void 0===r&&(r={});var n=t.call(this)||this;return n.impl=new URLStreamImpl(e,r),n}return __extends(e,t),e.prototype.next=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.impl.next()]})})},e}(byte_stream_1.ByteStream);exports.URLStream=URLStream;var URLStreamImpl=function(t){function e(e,r){void 0===r&&(r={});var n=t.call(this)||this;return n.url=e,n.options=r,n.blobPromise=fetch(e,r).then(function(t){if(t.ok)return t.blob();throw new Error(t.statusText)}),n}return __extends(e,t),e.prototype.pump=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(r){switch(r.label){case 0:return null!=this.fileReaderStream?[3,2]:[4,this.blobPromise];case 1:t=r.sent(),this.fileReaderStream=new filereader_stream_1.FileReaderStream(t,this.options),r.label=2;case 2:return[4,this.fileReaderStream.next()];case 3:return null==(e=r.sent())?[2,!1]:(this.outputQueue.push(e),[2,!0])}})})},e}(data_stream_1.QueueStream);

},{"./byte_stream":51,"./data_stream":52,"./filereader_stream":53}],56:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var ring_buffer_1=require("./ring_buffer"),GrowingRingBuffer=function(t){function e(){return t.call(this,e.INITIAL_CAPACITY)||this}return __extends(e,t),e.prototype.isFull=function(){return!1},e.prototype.push=function(e){t.prototype.isFull.call(this)&&this.expand(),t.prototype.push.call(this,e)},e.prototype.unshift=function(e){t.prototype.isFull.call(this)&&this.expand(),t.prototype.unshift.call(this,e)},e.prototype.expand=function(){for(var t=2*this.capacity,e=new Array(t),i=this.length(),r=0;r<i;r++)e[r]=this.get(this.wrap(this.begin+r));this.data=e,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=i},e.INITIAL_CAPACITY=32,e}(ring_buffer_1.RingBuffer);exports.GrowingRingBuffer=GrowingRingBuffer;

},{"./ring_buffer":57}],57:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var RingBuffer=function(){function t(t){if(this.capacity=t,this.begin=0,this.end=0,t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return t.prototype.wrap=function(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity},t.prototype.get=function(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]},t.prototype.set=function(t,i){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=i},t.prototype.length=function(){var t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t},t.prototype.isFull=function(){return this.length()===this.capacity},t.prototype.isEmpty=function(){return 0===this.length()},t.prototype.push=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)},t.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var t=this.get(this.end);return this.set(this.end,void 0),t},t.prototype.unshift=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)},t.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t},t.prototype.shuffleExcise=function(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var i=this.wrap(this.begin+t),e=this.get(i);return this.set(i,this.pop()),e},t}();exports.RingBuffer=RingBuffer;

},{}],58:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var dataset_1=require("./data/dataset");exports.Dataset=dataset_1.Dataset;var csv_dataset_1=require("./data/datasets/csv_dataset");exports.CSVDataset=csv_dataset_1.CSVDataset;var text_line_dataset_1=require("./data/datasets/text_line_dataset");exports.TextLineDataset=text_line_dataset_1.TextLineDataset;var file_data_source_1=require("./data/sources/file_data_source");exports.FileDataSource=file_data_source_1.FileDataSource;var url_data_source_1=require("./data/sources/url_data_source");exports.URLDataSource=url_data_source_1.URLDataSource;

},{"./data/dataset":44,"./data/datasets/csv_dataset":45,"./data/datasets/text_line_dataset":46,"./data/sources/file_data_source":48,"./data/sources/url_data_source":49}],59:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("../tensor"),MANIFEST_FILE="manifest.json",CheckpointLoader=function(){function e(e){this.urlPath=e,"/"!==this.urlPath.charAt(this.urlPath.length-1)&&(this.urlPath+="/")}return e.prototype.loadManifest=function(){var e=this;return new Promise(function(n,t){var r=new XMLHttpRequest;r.open("GET",e.urlPath+MANIFEST_FILE),r.onload=function(){e.checkpointManifest=JSON.parse(r.responseText),n()},r.onerror=function(n){throw new Error(MANIFEST_FILE+" not found at "+e.urlPath+". "+n)},r.send()})},e.prototype.getCheckpointManifest=function(){var e=this;return null==this.checkpointManifest?new Promise(function(n,t){e.loadManifest().then(function(){n(e.checkpointManifest)})}):new Promise(function(n,t){n(e.checkpointManifest)})},e.prototype.getAllVariables=function(){var e=this;return null!=this.variables?new Promise(function(n,t){n(e.variables)}):new Promise(function(n,t){e.getCheckpointManifest().then(function(t){for(var r=Object.keys(e.checkpointManifest),o=[],i=0;i<r.length;i++)o.push(e.getVariable(r[i]));Promise.all(o).then(function(t){e.variables={};for(var o=0;o<t.length;o++)e.variables[r[o]]=t[o];n(e.variables)})})})},e.prototype.getVariable=function(e){var n=this;if(!(e in this.checkpointManifest))throw new Error("Cannot load non-existant variable "+e);var t=function(t,r){var o=new XMLHttpRequest;o.responseType="arraybuffer";var i=n.checkpointManifest[e].filename;o.open("GET",n.urlPath+i),o.onload=function(){if(404===o.status)throw new Error("Not found variable "+e);var r=new Float32Array(o.response),i=tensor_1.Tensor.make(n.checkpointManifest[e].shape,{values:r});t(i)},o.onerror=function(n){throw new Error("Could not fetch variable "+e+": "+n)},o.send()};return null==this.checkpointManifest?new Promise(function(e,r){n.loadManifest().then(function(){new Promise(t).then(e)})}):new Promise(t)},e}();exports.CheckpointLoader=CheckpointLoader;

},{"../tensor":178}],60:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("../tensor"),util=require("../util"),STATS_SAMPLE_PERCENTAGE=.1,InMemoryDataset=function(){function t(t){this.dataShapes=t,this.normalizationInfo={}}return t.prototype.getDataShape=function(t){return this.dataShapes[t]},t.prototype.getData=function(){return this.dataset},t.prototype.getStats=function(){var t=this;if(null==this.dataset)throw new Error("Data is null.");return this.dataset.map(function(a){return t.getStatsForData(a)})},t.prototype.getStatsForData=function(t){var a=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=t.map(function(t,a){return a});util.shuffle(o),o=o.slice(o.length*STATS_SAMPLE_PERCENTAGE);for(var i=0;i<o.length;i++)for(var r=t[o[i]].dataSync(),e=0;e<r.length;e++)a=Math.min(a,r[e]),n=Math.max(n,r[e]);return{inputMin:a,inputMax:n,exampleCount:t.length,shape:t[0].shape}},t.prototype.normalizeExamplesToRange=function(t,a,n,o,i){var r=n instanceof Float32Array&&a instanceof Float32Array,e=o instanceof Float32Array&&i instanceof Float32Array,s=util.sizeFromShape(t[0].shape),l=[];return t.forEach(function(t){for(var u=t.dataSync(),h=new Float32Array(s),m=0;m<s;m++){var f=r?a[m]:a,p=(r?n[m]:n)-f,d=e?o[m]:o,I=(e?i[m]:i)-d;h[m]=0===p?d:d+I*(u[m]-f)/p}l.push(tensor_1.Tensor.make(t.shape,{values:h},"float32"))}),l},t.prototype.computeBounds=function(t){var a=this;if(null==this.dataset)throw new Error("Data is null.");var n=util.sizeFromShape(this.dataset[t][0].shape);this.normalizationInfo[t]={isNormalized:!1,minValues:new Float32Array(n),maxValues:new Float32Array(n)};for(var o=0;o<n;o++)this.normalizationInfo[t].minValues[o]=Number.POSITIVE_INFINITY,this.normalizationInfo[t].maxValues[o]=Number.NEGATIVE_INFINITY;this.dataset[t].forEach(function(o){for(var i=o.dataSync(),r=0;r<n;r++)a.normalizationInfo[t].minValues[r]=Math.min(a.normalizationInfo[t].minValues[r],i[r]),a.normalizationInfo[t].maxValues[r]=Math.max(a.normalizationInfo[t].maxValues[r],i[r])})},t.prototype.normalizeWithinBounds=function(t,a,n){if(null==this.dataset)throw new Error("Data is null.");if(t>=this.dataset.length)throw new Error("dataIndex out of bounds.");var o,i;null==this.normalizationInfo[t]&&this.computeBounds(t),this.normalizationInfo[t].isNormalized?(o=this.normalizationInfo[t].lowerBound,i=this.normalizationInfo[t].upperBound):(o=this.normalizationInfo[t].minValues,i=this.normalizationInfo[t].maxValues),this.dataset[t]=this.normalizeExamplesToRange(this.dataset[t],o,i,a,n),this.normalizationInfo[t].isNormalized=!0,this.normalizationInfo[t].lowerBound=a,this.normalizationInfo[t].upperBound=n},t.prototype.isNormalized=function(t){return null!=this.normalizationInfo&&this.normalizationInfo[t].isNormalized},t.prototype.removeNormalization=function(t){if(null==this.dataset)throw new Error("Training or test data is null.");this.isNormalized(t)&&(this.dataset[t]=this.normalizeExamplesToRange(this.dataset[t],this.normalizationInfo[t].lowerBound,this.normalizationInfo[t].upperBound,this.normalizationInfo[t].minValues,this.normalizationInfo[t].maxValues),this.normalizationInfo[t].isNormalized=!1)},t.prototype.unnormalizeExamples=function(t,a){return this.isNormalized(a)?this.normalizeExamplesToRange(t,this.normalizationInfo[a].lowerBound,this.normalizationInfo[a].upperBound,this.normalizationInfo[a].minValues,this.normalizationInfo[a].maxValues):t},t.prototype.dispose=function(){if(null!=this.dataset){for(var t=0;t<this.dataset.length;t++)for(var a=0;a<this.dataset[t].length;a++)this.dataset[t][a].dispose();this.dataset=[]}},t}();exports.InMemoryDataset=InMemoryDataset;

},{"../tensor":178,"../util":183}],61:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util"),InMemoryShuffledInputProviderBuilder=function(){function t(t){this.inputs=t,this.idx=0,this.inputCounter=0,this.epoch=0,this.shuffledIndices=util.createShuffledIndices(t[0].length),this.numInputs=t.length;for(var e=this.inputs[0].length,n=0;n<this.numInputs;n++)util.assert(this.inputs[n].length===e,"Number of examples must match across different inputs.");for(n=0;n<this.numInputs;n++)for(var r=this.inputs[n][0].shape,u=0;u<this.inputs[n].length;u++)util.assertShapesMatch(r,this.inputs[n][u].shape)}return t.prototype.getCurrentExampleIndex=function(){var t=this.idx;return this.inputCounter++,this.inputCounter>=this.numInputs&&(this.idx++,this.inputCounter=0,this.idx>=this.inputs[0].length&&(this.idx=0,this.epoch++)),t},t.prototype.getNextInput=function(t){var e=this.getCurrentExampleIndex();return this.inputs[t][this.shuffledIndices[e]]},t.prototype.getEpoch=function(){return this.epoch},t.prototype.getInputProviders=function(){for(var t=[],e=0;e<this.numInputs;e++)t.push(this.getInputProvider(e));return t},t}();exports.InMemoryShuffledInputProviderBuilder=InMemoryShuffledInputProviderBuilder;var InCPUMemoryShuffledInputProviderBuilder=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getInputProvider=function(t){var e=this;return{getNextCopy:function(){return e.getNextInput(t).clone()},disposeCopy:function(t){t.dispose()}}},e}(InMemoryShuffledInputProviderBuilder);exports.InCPUMemoryShuffledInputProviderBuilder=InCPUMemoryShuffledInputProviderBuilder;var InGPUMemoryShuffledInputProviderBuilder=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getInputProvider=function(t){var e=this;return{getNextCopy:function(){return e.getNextInput(t).clone()},disposeCopy:function(t){t.dispose()}}},e}(InMemoryShuffledInputProviderBuilder);exports.InGPUMemoryShuffledInputProviderBuilder=InGPUMemoryShuffledInputProviderBuilder;

},{"../util":183}],62:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("../tensor"),util=require("../util"),dataset_1=require("./dataset"),PARSING_IMAGE_CANVAS_HEIGHT_PX=1e3;function getXhrDatasetConfig(e){return new Promise(function(t,r){var a=new XMLHttpRequest;a.open("GET",e),a.onload=function(){t(JSON.parse(a.responseText))},a.onerror=function(e){r(e)},a.send()})}exports.getXhrDatasetConfig=getXhrDatasetConfig;var XhrDataset=function(e){function t(t){var r=e.call(this,t.data.map(function(e){return e.shape}))||this;return r.xhrDatasetConfig=t,r}return __extends(t,e),t.prototype.getTensor=function(e){var t="png"===e.dataType?parseTypedArrayFromPng(e,e.shape):parseTypedArrayFromBinary(e),r=util.sizeFromShape(e.shape);return t.then(function(t){for(var a=[],n=0;n<t.length/r;n++){var o=t.subarray(n*r,(n+1)*r),s=tensor_1.Tensor.make(e.shape,{values:new Float32Array(o)},"float32");a.push(s)}return a})},t.prototype.fetchData=function(){var e=this;return new Promise(function(t,r){var a=e.xhrDatasetConfig.data.map(function(t){return e.getTensor(t)});Promise.all(a).then(function(r){e.dataset=r,t()})})},t}(dataset_1.InMemoryDataset);function parseTypedArrayFromBinary(e){return new Promise(function(t,r){var a=new XMLHttpRequest;a.open("GET",e.path),a.responseType="arraybuffer",a.onload=function(r){var n="float32"===e.dataType?new Float32Array(a.response):new Uint8Array(a.response);t(n)},a.onerror=function(e){return r(e)},a.send()})}function parseGrayscaleImageData(e,t,r){for(var a=r,n=0;n<e.length;n+=4)t[a++]=e[n]}function parseRGBImageData(e,t,r){for(var a=r,n=0;n<e.length;n+=4)t[a]=e[n],t[a+1]=e[n+1],t[a+2]=e[n+2],a+=3}function parseImage(e,t){var r=document.createElement("canvas"),a=r.getContext("2d"),n=e.height,o=util.sizeFromShape(t),s=new Uint8Array(n*o);if(e.width!==t[0]*t[1])throw new Error("Image width ("+e.width+") must be multiple of rows*columns ("+t[0]+"*"+t[1]+") of the tensor");r.width=e.width,r.height=PARSING_IMAGE_CANVAS_HEIGHT_PX;for(var i=r.width,u=r.height,h=i,p=u,f=t[2],c=0,g=Math.ceil(n/r.height),d=0;d<g;++d){var l=d*r.height;d===g-1&&n%r.height>0&&(r.height=n%r.height,p=u=r.height),a.drawImage(e,0,l,i,u,0,0,h,p);var y=a.getImageData(0,0,r.width,r.height).data;1===f?parseGrayscaleImageData(y,s,c):parseRGBImageData(y,s,c),c+=r.height*o}return s}function parseTypedArrayFromPng(e,t){return new Promise(function(r,a){var n=new Image;n.setAttribute("crossOrigin",""),n.onload=function(){var e=parseImage(n,t);n.src="",n=null,r(e)},n.src=e.path})}exports.XhrDataset=XhrDataset;

},{"../tensor":178,"../util":183,"./dataset":60}],63:[function(require,module,exports){
"use strict";function isMobile(){var i=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(i.substr(0,4))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isMobile=isMobile;

},{}],64:[function(require,module,exports){
"use strict";function doc(e){return function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o]}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.doc=doc;

},{}],65:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment"),globals_1=require("./globals"),kernel_registry=require("./kernels/kernel_registry"),ops=require("./ops/ops"),profiler_1=require("./profiler"),tape_util=require("./tape_util"),tensor_1=require("./tensor"),util=require("./util"),Engine=function(){function e(e,t,r){this.backend=e,this.customBackend=t,this.safeMode=r,this.registeredVariables={},this.refCounter=new WeakMap,this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numDataBuffers=0,this.gradientScopeCount=0,this.customGradientDepth=0,this.activeScope={keep:[],track:[]},this.scopeStack=[this.activeScope],this.profiler=new profiler_1.Profiler(e)}return e.prototype.executeKernel=function(e,t,r){var n,i=this;if(n=environment_1.ENV.get("DEBUG")?this.profiler.profileKernel(e,function(){return kernel_registry.executeKernel(i.backend,e,t)}):kernel_registry.executeKernel(this.backend,e,t),null!=this.activeTape&&0===this.customGradientDepth){t=tape_util.stripUndefinedInputsFromInputConfig(t);var o={id:this.nextTapeNodeId++,type:"kernel",name:"kernel: "+e,kernel:e,inputAndArgs:t,output:n,gradient:r};this.activeTape.push(o)}return n},e.prototype.registerTensor=function(e){var t=this.refCounter.has(e.dataId)?this.refCounter.get(e.dataId):0;this.numTensors++,0===t&&(this.numDataBuffers++,this.numBytes+=util.sizeFromShape(e.shape)*util.bytesPerElement(e.dtype),this.backend.register(e.dataId,e.shape,e.dtype)),this.refCounter.set(e.dataId,t+1),e instanceof tensor_1.Variable||this.track(e)},e.prototype.registerVariable=function(e){if(null!=this.registeredVariables[e.name])throw new Error("Variable with name "+e.name+" was already registered");this.registeredVariables[e.name]=e},e.prototype.disposeTensor=function(e){if(this.refCounter.has(e.dataId)){this.numTensors--;var t=this.refCounter.get(e.dataId);t<=1?(this.refCounter.delete(e.dataId),this.backend.disposeData(e.dataId),this.numDataBuffers--,this.numBytes-=util.sizeFromShape(e.shape)*util.bytesPerElement(e.dtype)):this.refCounter.set(e.dataId,t-1)}},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.numTensors,e.numDataBuffers=this.numDataBuffers,e.numBytes=this.numBytes,e},e.prototype.shouldRecord=function(){return null!=this.activeTape&&0===this.customGradientDepth},e.prototype.addTapeNode=function(e,t,r){var n={};e.forEach(function(e,t){n[t]=e});var i={id:this.nextTapeNodeId++,type:"customGradient",name:name,inputAndArgs:{inputs:n},output:t,gradient:function(e){var t=r(e),n={};return t.forEach(function(e,t){n[t]=function(){return e}}),n}};this.activeTape.push(i)},e.prototype.keep=function(e){if(1===this.scopeStack.length&&environment_1.ENV.engine.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside dl.tidy(): dl.tidy(() => {...}) to avoid memory leaks.");return this.activeScope.keep.push(e),e},e.prototype.startScope=function(e){void 0===e&&(e=!1),e&&0===this.gradientScopeCount&&(this.activeTape=[]),e&&this.gradientScopeCount++;var t={keep:[],track:[]};this.scopeStack.push(t),this.activeScope=t},e.prototype.endScope=function(e,t){var r=this;void 0===t&&(t=!1),t&&(this.gradientScopeCount--,0===this.gradientScopeCount&&(this.activeTape=null));var n=this.activeScope.keep,i=tape_util.extractTensorsFromScopeResult(e);n=n.concat(i);for(var o=0;o<this.activeScope.track.length;o++){var s=this.activeScope.track[o];util.isTensorInList(s,n)||(null!=this.activeTape?i.push(s):s.dispose())}this.scopeStack.pop(),this.activeScope=0===this.scopeStack.length?{keep:[],track:[]}:this.scopeStack[this.scopeStack.length-1],i.forEach(function(e){util.isTensorInList(e,r.activeScope.keep)||r.track(e)})},e.prototype.dispose=function(){this.customBackend&&this.backend.dispose()},e.prototype.gradients=function(e,t,r,n){var i=this;return void 0===n&&(n=!1),globals_1.tidy("gradients",function(){var o=e();util.assert(o instanceof tensor_1.Tensor,"The result y returned by f() must be a tensor.");var s=tape_util.getFilteredNodesXToY(i.activeTape,t,o);if(!n&&0===s.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");var a={};return a[o.id]=null==r?ops.onesLike(o):r,tape_util.backpropagateGradients(a,s),{value:o,grads:t.map(function(e){return a[e.id]})}},!0)},e.prototype.customGrad=function(e){var t=this;return util.assert(util.isFunction(e),"The f passed in customGrad(f) must be a function."),function(){for(var r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];util.assert(n.every(function(e){return e instanceof tensor_1.Tensor}),"The args passed in customGrad(f)(x1, x2,...) must all be tensors"),t.customGradientDepth++;var o=globals_1.tidy(e.name,function(){var t=e.apply(void 0,n),i=t.value,o=t.gradFunc;return util.assert(i instanceof tensor_1.Tensor,"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),util.assert(util.isFunction(o),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r=o,i},!0);if(t.customGradientDepth--,t.shouldRecord()){t.addTapeNode(n,o,function(e){var t=r(e),i=Array.isArray(t)?t:[t];return util.assert(i.length===n.length,"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),util.assert(i.every(function(e){return e instanceof tensor_1.Tensor}),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."),i})}return o}},e.prototype.write=function(e,t){this.backend.write(e,t)},e.prototype.readSync=function(e){return this.backend.readSync(e)},e.prototype.read=function(e){return this.backend.read(e)},e.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},e.prototype.time=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(n){switch(n.label){case 0:return t=performance.now(),[4,this.backend.time(e)];case 1:return(r=n.sent()).wallMs=performance.now()-t,[2,r]}})})},e.prototype.track=function(e){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside dl.tidy(): dl.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope.track.push(e),e},e}();exports.Engine=Engine;

},{"./environment":66,"./globals":67,"./kernels/kernel_registry":102,"./ops/ops":155,"./profiler":176,"./tape_util":177,"./tensor":178,"./util":183}],66:[function(require,module,exports){
(function (global){
"use strict";var __decorate=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var E=e.length-1;E>=0;E--)(i=e[E])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(exports,"__esModule",{value:!0});var Type,device_util=require("./device_util"),doc_1=require("./doc"),engine_1=require("./engine"),math_1=require("./math"),util=require("./util");function hasExtension(e,t){return null!=e.getExtension(t)}function getWebGLRenderingContext(e){if(0===e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=document.createElement("canvas");return 1===e?t.getContext("webgl")||t.getContext("experimental-webgl"):t.getContext("webgl2")}function loseContext(e){if(null!=e){var t=e.getExtension("WEBGL_lose_context");if(null==t)throw new Error("Extension WEBGL_lose_context not supported on this browser.");t.loseContext()}}function isWebGLVersionEnabled(e){var t=getWebGLRenderingContext(e);return null!=t&&(loseContext(t),!0)}function getWebGLDisjointQueryTimerVersion(e){if(0===e)return 0;var t,n=getWebGLRenderingContext(e);return t=hasExtension(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:hasExtension(n,"EXT_disjoint_timer_query")?1:0,null!=n&&loseContext(n),t}function isFloatTextureReadPixelsEnabled(e){if(0===e)return!1;var t=getWebGLRenderingContext(e);if(1===e){if(!hasExtension(t,"OES_texture_float"))return!1}else if(!hasExtension(t,"EXT_color_buffer_float"))return!1;var n=t.createFramebuffer(),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);var i=2===e?t.RGBA32F:t.RGBA;t.texImage2D(t.TEXTURE_2D,0,i,1,1,0,t.RGBA,t.FLOAT,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,new Float32Array(4));var a=t.getError()===t.NO_ERROR;return loseContext(t),o&&a}function isWebGLGetBufferSubDataAsyncExtensionEnabled(e){if(2!==e)return!1;var t=getWebGLRenderingContext(e),n=hasExtension(t,"WEBGL_get_buffer_sub_data_async");return loseContext(t),n}!function(e){e[e.NUMBER=0]="NUMBER",e[e.BOOLEAN=1]="BOOLEAN",e[e.STRING=2]="STRING"}(Type=exports.Type||(exports.Type={})),exports.URL_PROPERTIES=[{name:"DEBUG",type:Type.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:Type.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:Type.BOOLEAN},{name:"WEBGL_VERSION",type:Type.NUMBER},{name:"WEBGL_FLOAT_TEXTURE_ENABLED",type:Type.BOOLEAN},{name:"WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED",type:Type.BOOLEAN},{name:"BACKEND",type:Type.STRING}];var SUPPORTED_BACKENDS=["webgl","cpu"],Environment=function(){function e(e){this.features={},this.BACKEND_REGISTRY={},this.backends=this.BACKEND_REGISTRY,null!=e&&(this.features=e),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return e.setBackend=function(e,t){if(void 0===t&&(t=!1),!(e in exports.ENV.backends))throw new Error("Backend type '"+e+"' not found in registry");exports.ENV.globalMath=new math_1.NDArrayMath(e,t)},e.getBackend=function(){return exports.ENV.initEngine(),exports.ENV.currentBackendType},e.memory=function(){return exports.ENV.engine.memory()},e.prototype.get=function(e){return e in this.features?this.features[e]:(this.features[e]=this.evaluateFeature(e),this.features[e])},e.prototype.set=function(e,t){this.features[e]=t},e.prototype.getBestBackendType=function(){for(var e=0;e<SUPPORTED_BACKENDS.length;++e){var t=SUPPORTED_BACKENDS[e];if(t in this.backends)return t}throw new Error("No backend found in registry.")},e.prototype.evaluateFeature=function(e){if("DEBUG"===e)return!1;if("BACKEND"===e)return this.getBestBackendType();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===e){var t=this.get("WEBGL_VERSION");return 0===t?0:getWebGLDisjointQueryTimerVersion(t)}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===e)return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!device_util.isMobile();if("WEBGL_VERSION"===e)return isWebGLVersionEnabled(2)?2:isWebGLVersionEnabled(1)?1:0;if("WEBGL_FLOAT_TEXTURE_ENABLED"===e)return isFloatTextureReadPixelsEnabled(this.get("WEBGL_VERSION"));if("WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED"===e)return isWebGLGetBufferSubDataAsyncExtensionEnabled(this.get("WEBGL_VERSION"));throw new Error("Unknown feature "+e+".")},e.prototype.setFeatures=function(e){this.reset(),this.features=e,this.backends={}},e.prototype.reset=function(){if(this.features=getFeaturesFromURL(),null!=this.globalMath&&(this.globalMath.dispose(),this.globalMath=null,this.globalEngine=null),this.backends!==this.BACKEND_REGISTRY){for(var e in this.backends)this.backends[e].dispose();this.backends=this.BACKEND_REGISTRY}},e.prototype.setMath=function(e,t,n){if(void 0===n&&(n=!1),this.globalMath!==e){var r=!1;"string"==typeof t?(this.currentBackendType=t,t=exports.ENV.findBackend(t)):(r=!0,this.currentBackendType="custom"),this.globalEngine=new engine_1.Engine(t,r,n),this.globalMath=e}},e.prototype.findBackend=function(e){return this.backends[e]},e.prototype.addCustomBackend=function(e,t){if(e in this.backends)throw new Error(e+" backend was already registered");try{var n=t();return this.backends[e]=n,!0}catch(e){return!1}},e.prototype.registerBackend=function(e,t){if(e in this.BACKEND_REGISTRY)throw new Error(e+" backend was already registered as global");try{var n=t();return this.BACKEND_REGISTRY[e]=n,!0}catch(e){return!1}},Object.defineProperty(e.prototype,"math",{get:function(){return null==this.globalEngine&&this.initEngine(),this.globalMath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"engine",{get:function(){return null==this.globalEngine&&this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),e.prototype.initEngine=function(){this.globalMath=new math_1.NDArrayMath(exports.ENV.get("BACKEND"),!1)},__decorate([doc_1.doc({heading:"Environment"})],e,"setBackend",null),__decorate([doc_1.doc({heading:"Environment"})],e,"getBackend",null),__decorate([doc_1.doc({heading:"Performance",subheading:"Memory"})],e,"memory",null),e}();exports.Environment=Environment;var DEEPLEARNJS_FLAGS_PREFIX="dljsflags";function getFeaturesFromURL(){var e={};if("undefined"==typeof window)return e;var t=util.getQueryParams(window.location.search);if(DEEPLEARNJS_FLAGS_PREFIX in t){var n={};t[DEEPLEARNJS_FLAGS_PREFIX].split(",").forEach(function(e){var t=e.split(":"),r=t[0],i=t[1];n[r]=i}),exports.URL_PROPERTIES.forEach(function(t){t.name in n&&(console.log("Setting feature override from URL "+t.name+": "+n[t.name]),t.type===Type.NUMBER?e[t.name]=+n[t.name]:t.type===Type.BOOLEAN?e[t.name]="true"===n[t.name]:t.type===Type.STRING?e[t.name]=n[t.name]:console.warn("Unknown URL param: "+t.name+"."))})}return e}function getGlobalNamespace(){var e;if("undefined"!=typeof window)e=window;else{if("undefined"==typeof global)throw new Error("Could not find a global object");e=global}return e}function getOrMakeEnvironment(){var e=getGlobalNamespace();return e.ENV=e.ENV||new Environment(getFeaturesFromURL()),e.ENV}exports.ENV=getOrMakeEnvironment();

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./device_util":63,"./doc":64,"./engine":65,"./math":137,"./util":183}],67:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var gradients_1=require("./gradients"),tracking_1=require("./tracking");exports.tidy=tracking_1.Tracking.tidy,exports.keep=tracking_1.Tracking.keep,exports.time=tracking_1.Tracking.time,exports.grad=gradients_1.Gradients.grad,exports.valueAndGrad=gradients_1.Gradients.valueAndGrad,exports.grads=gradients_1.Gradients.grads,exports.valueAndGrads=gradients_1.Gradients.valueAndGrads,exports.variableGrads=gradients_1.Gradients.variableGrads,exports.customGrad=gradients_1.Gradients.customGrad;

},{"./gradients":68,"./tracking":180}],68:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,n,r,a){var t,s=arguments.length,i=s<3?n:null===a?a=Object.getOwnPropertyDescriptor(n,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,n,r,a);else for(var u=e.length-1;u>=0;u--)(t=e[u])&&(i=(s<3?t(i):s>3?t(n,r,i):t(n,r))||i);return s>3&&i&&Object.defineProperty(n,r,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("./doc"),environment_1=require("./environment"),globals_1=require("./globals"),tensor_1=require("./tensor"),util=require("./util"),Gradients=function(){function e(){}return e.gradScope=function(e,n){return globals_1.tidy(e,n,!0)},e.grad=function(e){return util.assert(util.isFunction(e),"The f passed in grad(f) must be a function"),function(n,r){util.assert(n instanceof tensor_1.Tensor,"The x passed in grad(f)(x) must be a tensor"),util.assert(null==r||r instanceof tensor_1.Tensor,"The dy passed in grad(f)(x, dy) must be a tensor");var a=environment_1.ENV.engine.gradients(function(){return e(n)},[n],r),t=a.value,s=a.grads;return null!=r&&util.assertShapesMatch(t.shape,r.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),t.dispose(),checkGrads(s),s[0]}},e.grads=function(e){return util.assert(util.isFunction(e),"The f passed in grads(f) must be a function"),function(n,r){util.assert(Array.isArray(n)&&n.every(function(e){return e instanceof tensor_1.Tensor}),"The args passed in grads(f)(args) must be an array of tensors"),util.assert(null==r||r instanceof tensor_1.Tensor,"The dy passed in grads(f)(args, dy) must be a tensor");var a=environment_1.ENV.engine.gradients(function(){return e.apply(void 0,n)},n,r),t=a.value,s=a.grads;return null!=r&&util.assertShapesMatch(t.shape,r.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),t.dispose(),checkGrads(s),s}},e.valueAndGrad=function(e){return util.assert(util.isFunction(e),"The f passed in valueAndGrad(f) must be a function"),function(n,r){util.assert(n instanceof tensor_1.Tensor,"The x passed in valueAndGrad(f)(x) must be a tensor"),util.assert(null==r||r instanceof tensor_1.Tensor,"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");var a=environment_1.ENV.engine.gradients(function(){return e(n)},[n],r),t=a.grads,s=a.value;return checkGrads(t),{grad:t[0],value:s}}},e.valueAndGrads=function(e){return util.assert(util.isFunction(e),"The f passed in valueAndGrads(f) must be a function"),function(n,r){util.assert(Array.isArray(n)&&n.every(function(e){return e instanceof tensor_1.Tensor}),"The args passed in valueAndGrads(f)(args) must be array of tensors"),util.assert(null==r||r instanceof tensor_1.Tensor,"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");var a=environment_1.ENV.engine.gradients(function(){return e.apply(void 0,n)},n,r);return null!=r&&util.assertShapesMatch(a.value.shape,r.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),checkGrads(a.grads),a}},e.variableGrads=function(e,n){if(util.assert(util.isFunction(e),"The f passed in variableGrads(f) must be a function"),util.assert(null==n||Array.isArray(n)&&n.every(function(e){return e instanceof tensor_1.Variable}),"The varList passed in variableGrads(f, varList) must be an array of variables"),null==n)for(var r in n=[],environment_1.ENV.engine.registeredVariables)n.push(environment_1.ENV.engine.registeredVariables[r]);n=n.filter(function(e){return e.trainable});var a=environment_1.ENV.engine.gradients(e,n,null,!0),t=a.value,s=a.grads;util.assert(s.some(function(e){return null!=e}),"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),util.assert(0===t.rank,"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+t.rank+" tensor");var i={};return n.forEach(function(e,n){null!=s[n]&&(i[e.name]=s[n])}),{value:t,grads:i}},e.customGrad=function(e){return environment_1.ENV.engine.customGrad(e)},__decorate([doc_1.doc({heading:"Training",subheading:"Gradients"})],e,"grad",null),__decorate([doc_1.doc({heading:"Training",subheading:"Gradients"})],e,"grads",null),__decorate([doc_1.doc({heading:"Training",subheading:"Gradients"})],e,"valueAndGrad",null),__decorate([doc_1.doc({heading:"Training",subheading:"Gradients"})],e,"valueAndGrads",null),__decorate([doc_1.doc({heading:"Training",subheading:"Gradients"})],e,"variableGrads",null),__decorate([doc_1.doc({heading:"Training",subheading:"Gradients"})],e,"customGrad",null),e}();function checkGrads(e){if(e.filter(function(e){return null==e}).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}exports.Gradients=Gradients;

},{"./doc":64,"./environment":66,"./globals":67,"./tensor":178,"./util":183}],69:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../globals"),tensor_1=require("../tensor"),TanHFunc=function(){function t(){this.one=tensor_1.Scalar.new(1)}return t.prototype.output=function(t,n){return t.tanh(n)},t.prototype.der=function(t,n,o){var r=this;return globals_1.tidy(function(){var n=t.multiplyStrict(o,o);return t.subtract(r.one,n)})},t.prototype.dispose=function(){this.one.dispose()},t}();exports.TanHFunc=TanHFunc;var ReLUFunc=function(){function t(){}return t.prototype.output=function(t,n){return t.relu(n)},t.prototype.der=function(t,n,o){return t.step(n)},t.prototype.dispose=function(){},t}();exports.ReLUFunc=ReLUFunc;var LeakyReluFunc=function(){function t(t){this.alpha=t}return t.prototype.output=function(t,n){return t.leakyRelu(n,this.alpha)},t.prototype.der=function(t,n,o){return t.step(n,this.alpha)},t.prototype.dispose=function(){},t}();exports.LeakyReluFunc=LeakyReluFunc;var SigmoidFunc=function(){function t(){}return t.prototype.output=function(t,n){return t.sigmoid(n)},t.prototype.der=function(t,n,o){return globals_1.tidy(function(){var n=t.multiplyStrict(o,o);return t.subStrict(o,n)})},t.prototype.dispose=function(){},t}();exports.SigmoidFunc=SigmoidFunc;var SquareFunc=function(){function t(){this.two=tensor_1.Scalar.new(2)}return t.prototype.output=function(t,n){return t.multiplyStrict(n,n)},t.prototype.der=function(t,n,o){return t.multiply(this.two,n)},t.prototype.dispose=function(){this.two.dispose()},t}();exports.SquareFunc=SquareFunc;var EluFunc=function(){function t(){}return t.prototype.output=function(t,n){return t.elu(n)},t.prototype.der=function(t,n,o){throw new Error("Not implemented")},t.prototype.dispose=function(){},t}();exports.EluFunc=EluFunc;

},{"../globals":67,"../tensor":178}],70:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../globals"),ops=require("../ops/ops"),SquareCostFunc=function(){function e(){this.halfOne=globals_1.keep(ops.scalar(.5))}return e.prototype.cost=function(e,s){var t=e.subStrict(s),o=t.square(),r=this.halfOne.mul(o);return t.dispose(),o.dispose(),r},e.prototype.der=function(e,s){return e.subStrict(s)},e.prototype.dispose=function(){this.halfOne.dispose()},e}();exports.SquareCostFunc=SquareCostFunc;

},{"../globals":67,"../ops/ops":155}],71:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var concat_util=require("../ops/concat_util"),conv_util=require("../ops/conv_util"),tensor_1=require("../tensor"),util=require("../util"),initializers_1=require("./initializers"),GraphLayers=function(){function t(t){this.g=t}return t.prototype.dense=function(t,e,o,n,a,s,r){void 0===n&&(n=null),void 0===a&&(a=!0),void 0===s&&(s=new initializers_1.VarianceScalingInitializer),void 0===r&&(r=new initializers_1.ZerosInitializer);var i=this.g.variable(t+"-weights",s.initialize([e.shape[0],o],e.shape[0],o)),u=this.g.matmul(e,i);if(a){var h=this.g.variable(t+"-bias",r.initialize([o],e.shape[0],o));u=this.g.add(u,h)}return null!=n&&(u=n(u)),u},t}();exports.GraphLayers=GraphLayers;var Graph=function(){function t(){this.nodes=[],this.layers=new GraphLayers(this)}return t.prototype.variable=function(t,e){return this.addNodeAndReturnOutput(new VariableNode(this,t,e))},t.prototype.placeholder=function(t,e){return this.addNodeAndReturnOutput(new PlaceholderNode(this,t,e))},t.prototype.constant=function(t){var e;if("number"==typeof t)e=tensor_1.Scalar.new(t);else if(t instanceof tensor_1.Tensor)e=t;else{if(!(t instanceof Array))throw new Error("unimplemented constant type.");var o=util.flatten(t),n=new Float32Array(o);e=tensor_1.Tensor.make(util.inferShape(t),{values:n})}return this.addNodeAndReturnOutput(new ConstantNode(this,e))},t.prototype.reshape=function(t,e){return this.addNodeAndReturnOutput(new ReshapeNode(this,"Reshape",t,e))},t.prototype.fusedLinearCombination=function(t,e,o,n){return this.addNodeAndReturnOutput(new FusedLinearCombinationNode(this,t,e,o,n))},t.prototype.add=function(t,e){return this.addNodeAndReturnOutput(new AddNode(this,t,e))},t.prototype.subtract=function(t,e){return this.addNodeAndReturnOutput(new SubtractNode(this,t,e))},t.prototype.multiply=function(t,e){return this.addNodeAndReturnOutput(new MultiplyNode(this,t,e))},t.prototype.divide=function(t,e){return this.addNodeAndReturnOutput(new DivideNode(this,t,e))},t.prototype.reduceSum=function(t){return this.addNodeAndReturnOutput(new ReduceSumNode(this,t))},t.prototype.concat1d=function(t,e){return this.addNodeAndReturnOutput(new Concat1DNode(this,t,e))},t.prototype.concat2d=function(t,e,o){return this.addNodeAndReturnOutput(new Concat2DNode(this,t,e,o))},t.prototype.concat3d=function(t,e,o){return this.addNodeAndReturnOutput(new Concat3DNode(this,t,e,o))},t.prototype.concat4d=function(t,e,o){return this.addNodeAndReturnOutput(new Concat4DNode(this,t,e,o))},t.prototype.matmul=function(t,e){return this.addNodeAndReturnOutput(new MatMulNode(this,t,e))},t.prototype.conv2d=function(t,e,o,n,a,s,r){return void 0===s&&(s=1),this.addNodeAndReturnOutput(new Convolution2DNode(this,t,e,o,n,a,s,r))},t.prototype.maxPool=function(t,e,o,n){return void 0===o&&(o=1),this.addNodeAndReturnOutput(new MaxPoolNode(this,t,e,o,n))},t.prototype.exp=function(t){return this.addNodeAndReturnOutput(new ExpNode(this,t))},t.prototype.log=function(t){return this.addNodeAndReturnOutput(new LogNode(this,t))},t.prototype.relu=function(t){return this.addNodeAndReturnOutput(new ReLUNode(this,t))},t.prototype.leakyRelu=function(t,e){return this.addNodeAndReturnOutput(new LeakyReLUNode(this,t,e))},t.prototype.prelu=function(t,e){return this.addNodeAndReturnOutput(new PReLUNode(this,t,e))},t.prototype.elu=function(t){return this.addNodeAndReturnOutput(new EluNode(this,t))},t.prototype.tanh=function(t){return this.addNodeAndReturnOutput(new TanHNode(this,t))},t.prototype.sigmoid=function(t){return this.addNodeAndReturnOutput(new SigmoidNode(this,t))},t.prototype.square=function(t){return this.addNodeAndReturnOutput(new SquareNode(this,t))},t.prototype.softmax=function(t){return this.addNodeAndReturnOutput(new SoftmaxNode(this,t))},t.prototype.softmaxCrossEntropyCost=function(t,e){return this.addNodeAndReturnOutput(new SoftmaxCrossEntropyCostNode(this,t,e))},t.prototype.meanSquaredCost=function(t,e){return this.addNodeAndReturnOutput(new MeanSquaredCostNode(this,t,e))},t.prototype.argmax=function(t){return this.addNodeAndReturnOutput(new ArgMaxNode(this,t))},t.prototype.argmaxEquals=function(t,e){return this.addNodeAndReturnOutput(new ArgMaxEqualsNode(this,t,e))},t.prototype.addNodeAndReturnOutput=function(t){return this.nodes.push(t),t.validate(),t.output},t.prototype.getNodes=function(){return this.nodes},t}();exports.Graph=Graph;var SymbolicTensor=function(t){function e(o){var n=t.call(this,[],"float32")||this;return n.shape=o,n.id=e.nextID++,n}return __extends(e,t),e.nextID=0,e}(tensor_1.Tensor);exports.SymbolicTensor=SymbolicTensor;var Node=function(){function t(e,o,n,a){this.graph=e,this.name=o,this.inputs=n,this.output=a,this.id=t.nextID++,a.node=this}return t.nextID=0,t}();exports.Node=Node;var VariableNode=function(t){function e(e,o,n){var a=t.call(this,e,o,{},new SymbolicTensor(n.shape))||this;return a.data=n,a}return __extends(e,t),e.prototype.validate=function(){util.assert(null!=this.data,"Error adding variable op: Data for variable '"+this.name+"' is null or undefined")},e}(Node);exports.VariableNode=VariableNode;var PlaceholderNode=function(t){function e(e,o,n){return t.call(this,e,o,{},new SymbolicTensor(n))||this}return __extends(e,t),e.prototype.validate=function(){},e}(Node);exports.PlaceholderNode=PlaceholderNode;var ConstantNode=function(t){function e(e,o){var n=t.call(this,e,"Constant",{},new SymbolicTensor(o.shape))||this;return n.data=o,n}return __extends(e,t),e.prototype.validate=function(){util.assert(null!=this.data,"Error adding constant: data for placeholder '"+this.name+"' is null or undefined")},e}(Node);exports.ConstantNode=ConstantNode;var ReshapeNode=function(t){function e(e,o,n,a){var s=t.call(this,e,o,{x:n},new SymbolicTensor(a))||this;return s.name=o,s.x=n,s.shape=a,s}return __extends(e,t),e.prototype.validate=function(){var t=util.sizeFromShape(this.x.shape),e=util.sizeFromShape(this.shape);util.assert(t===e,"Error making reshape operation: input to reshape '"+this.name+"' of shape ("+this.x.shape+") does not match size of requested shape "+this.shape+".")},e.X="x",e}(Node);exports.ReshapeNode=ReshapeNode;var FusedLinearCombinationNode=function(t){function e(e,o,n,a,s){var r=t.call(this,e,"Linear Combination",{t1:o,t2:n,c1:a,c2:s},new SymbolicTensor(o.shape))||this;return r.t1=o,r.t2=n,r.c1=a,r.c2=s,r}return __extends(e,t),e.prototype.validate=function(){if(util.assertShapesMatch(this.t1.shape,this.t2.shape),!util.isScalarShape(this.c1.shape))throw new Error("Error adding fusedLinearCombination: c1 is not a scalar, got shape: "+this.c1.shape);if(!util.isScalarShape(this.c2.shape))throw new Error("Error adding fusedLinearCombination: c2 is not a scalar, got shape: "+this.c2.shape)},e.T1="t1",e.T2="t2",e.C1="c1",e.C2="c2",e}(Node);exports.FusedLinearCombinationNode=FusedLinearCombinationNode;var AddNode=function(t){function e(e,o,n){var a=t.call(this,e,"Add",{t1:o,t2:n},new SymbolicTensor(1===util.sizeFromShape(o.shape)?n.shape:o.shape.length<n.shape.length?n.shape:o.shape))||this;return a.t1=o,a.t2=n,a}return __extends(e,t),e.prototype.validate=function(){util.assert(1===util.sizeFromShape(this.t1.shape)||1===util.sizeFromShape(this.t2.shape)||util.arraysEqual(this.t1.shape,this.t2.shape)||2===this.t1.shape.length&&1===this.t2.shape.length&&this.t1.shape[1]===this.t2.shape[0]||1===this.t1.shape.length&&2===this.t2.shape.length&&this.t1.shape[0]===this.t2.shape[1],"Error adding add operation op: one of inputs must be scalar, shapes "+this.t1.shape+" and "+this.t2.shape+" must match,or one of them can be broadcasted (2D and 1D).")},e.T1="t1",e.T2="t2",e}(Node);exports.AddNode=AddNode;var SubtractNode=function(t){function e(e,o,n){var a=t.call(this,e,"Subtract",{t1:o,t2:n},new SymbolicTensor(1===util.sizeFromShape(o.shape)?n.shape:o.shape))||this;return a.t1=o,a.t2=n,a}return __extends(e,t),e.prototype.validate=function(){util.assert(1===util.sizeFromShape(this.t1.shape)||1===util.sizeFromShape(this.t2.shape)||util.arraysEqual(this.t1.shape,this.t2.shape),"Error adding subtract op: one of inputs must be scalar or the shapes "+this.t1.shape+" and "+this.t2.shape+" must match.")},e.T1="t1",e.T2="t2",e}(Node);exports.SubtractNode=SubtractNode;var MultiplyNode=function(t){function e(e,o,n){var a=t.call(this,e,"Multiply",{t1:o,t2:n},new SymbolicTensor(1===util.sizeFromShape(o.shape)?n.shape:o.shape))||this;return a.t1=o,a.t2=n,a}return __extends(e,t),e.prototype.validate=function(){util.assert(1===util.sizeFromShape(this.t1.shape)||1===util.sizeFromShape(this.t2.shape)||util.arraysEqual(this.t1.shape,this.t2.shape),"Error adding multiply op: one of inputs must be scalar or the shapes "+this.t1.shape+" and "+this.t2.shape+" must match.")},e.T1="t1",e.T2="t2",e}(Node);exports.MultiplyNode=MultiplyNode;var DivideNode=function(t){function e(e,o,n){var a=t.call(this,e,"Divide",{t1:o,t2:n},new SymbolicTensor(1===util.sizeFromShape(o.shape)?n.shape:o.shape))||this;return a.t1=o,a.t2=n,a}return __extends(e,t),e.prototype.validate=function(){util.assert(1===util.sizeFromShape(this.t1.shape)||1===util.sizeFromShape(this.t2.shape)||util.arraysEqual(this.t1.shape,this.t2.shape),"Error adding divide op: one of inputs must be scalar or the shapes "+this.t1.shape+" and "+this.t2.shape+" must match.")},e.T1="t1",e.T2="t2",e}(Node);exports.DivideNode=DivideNode;var ReduceSumNode=function(t){function e(e,o){return t.call(this,e,"ReduceSum",{x:o},new SymbolicTensor([]))||this}return __extends(e,t),e.prototype.validate=function(){},e.X="x",e}(Node);exports.ReduceSumNode=ReduceSumNode;var Concat1DNode=function(t){function e(e,o,n){return t.call(this,e,"Concat1D",{x1:o,x2:n},new SymbolicTensor(concat_util.computeOutShape1D(o.shape,n.shape)))||this}return __extends(e,t),e.prototype.validate=function(){},e.X1="x1",e.X2="x2",e}(Node);exports.Concat1DNode=Concat1DNode;var Concat2DNode=function(t){function e(e,o,n,a){var s=t.call(this,e,"Concat2D",{x1:o,x2:n},new SymbolicTensor(concat_util.computeOutShape(o.shape,n.shape,a)))||this;return s.x1=o,s.x2=n,s.axis=a,s}return __extends(e,t),e.prototype.validate=function(){concat_util.assertParams(this.x1.shape,this.x2.shape,this.axis)},e.X1="x1",e.X2="x2",e.AXIS="axis",e}(Node);exports.Concat2DNode=Concat2DNode;var Concat3DNode=function(t){function e(e,o,n,a){var s=t.call(this,e,"Concat3D",{x1:o,x2:n},new SymbolicTensor(concat_util.computeOutShape(o.shape,n.shape,a)))||this;return s.x1=o,s.x2=n,s.axis=a,s}return __extends(e,t),e.prototype.validate=function(){concat_util.assertParams(this.x1.shape,this.x2.shape,this.axis)},e.X1="x1",e.X2="x2",e.AXIS="axis",e}(Node);exports.Concat3DNode=Concat3DNode;var Concat4DNode=function(t){function e(e,o,n,a){var s=t.call(this,e,"Concat4D",{x1:o,x2:n},new SymbolicTensor(concat_util.computeOutShape(o.shape,n.shape,a)))||this;return s.x1=o,s.x2=n,s.axis=a,s}return __extends(e,t),e.prototype.validate=function(){concat_util.assertParams(this.x1.shape,this.x2.shape,this.axis)},e.X1="x1",e.X2="x2",e.AXIS="axis",e}(Node);function getMatMulOutputShape(t,e){return 1===t.length&&1===e.length?[1]:1===t.length&&2===e.length?[e[1]]:2===t.length&&1===e.length?[t[0]]:[t[0],e[1]]}exports.Concat4DNode=Concat4DNode;var MatMulNode=function(t){function e(e,o,n){var a=t.call(this,e,"MatMul",{x1:o,x2:n},new SymbolicTensor(getMatMulOutputShape(o.shape,n.shape)))||this;return a.x1=o,a.x2=n,a}return __extends(e,t),e.prototype.validate=function(){if(2===this.x1.shape.length&&2===this.x2.shape.length)util.assert(this.x1.shape[1]===this.x2.shape[0],"Error adding matmul op: inner shapes of matrices with shapes "+this.x1.shape+" and "+this.x2.shape+" must match.");else if(2===this.x1.shape.length&&1===this.x2.shape.length)util.assert(this.x1.shape[1]===this.x2.shape[0],"Error adding matmul op: second dimension of matrix with shape "+this.x1.shape.toString()+" must match size of vector with shape "+this.x2.shape+".");else{if(1!==this.x1.shape.length||2!==this.x2.shape.length)throw new Error("Error adding matmul op: inputs must be vectors or matrices.");util.assert(this.x1.shape[0]===this.x2.shape[0],"Error adding matmul op: size of vector with shape "+this.x1.shape+" must match first dimension of matrix with shape "+this.x2.shape+".")}},e.X1="x1",e.X2="x2",e}(Node);exports.MatMulNode=MatMulNode;var Convolution2DNode=function(t){function e(e,o,n,a,s,r,i,u){void 0===i&&(i=1);var h=t.call(this,e,"Convolution 2D",{x:o,w:n,b:a},new SymbolicTensor(conv_util.computeOutputShape3D(o.shape,s,r,i,u)))||this;return h.x=o,h.w=n,h.b=a,h.fieldSize=s,h.outputDepth=r,h.stride=i,h.zeroPad=u,h}return __extends(e,t),e.prototype.validate=function(){util.assert(3===this.x.shape.length,"Error adding conv2d op: input must be of rank 3, but got shape: "+this.x.shape+"."),util.assert(4===this.w.shape.length,"Error adding conv2d op: weights must be of rank 4, but got shape: "+this.w.shape+"."),util.assert(1===this.b.shape.length,"Error adding conv2d op: biases must be of rank 1, but got shape: "+this.b.shape+"."),util.assert(this.x.shape[2]===this.w.shape[2],"Error adding conv2d op: depth of input ("+this.x.shape[2]+") must match input depth for weights ("+this.w.shape[2]+").")},e.X="x",e.W="w",e.B="b",e}(Node);exports.Convolution2DNode=Convolution2DNode;var MaxPoolNode=function(t){function e(e,o,n,a,s){void 0===a&&(a=1);var r=t.call(this,e,"Max pool",{x:o},new SymbolicTensor(conv_util.computeOutputShape3D(o.shape,n,o.shape[2],a,s)))||this;return r.x=o,r.fieldSize=n,r.stride=a,r.zeroPad=s,r}return __extends(e,t),e.prototype.validate=function(){util.assert(3===this.x.shape.length,"Error adding maxPool op: input must be of rank 3, but got shape: "+this.x.shape+".")},e.X="x",e}(Node);exports.MaxPoolNode=MaxPoolNode;var ReLUNode=function(t){function e(e,o){return t.call(this,e,"ReLU",{x:o},new SymbolicTensor(o.shape))||this}return __extends(e,t),e.prototype.validate=function(){},e.X="x",e}(Node);exports.ReLUNode=ReLUNode;var LeakyReLUNode=function(t){function e(e,o,n){var a=t.call(this,e,"LeakyReLU",{x:o},new SymbolicTensor(o.shape))||this;return a.alpha=n,a}return __extends(e,t),e.prototype.validate=function(){},e.X="x",e}(Node);exports.LeakyReLUNode=LeakyReLUNode;var PReLUNode=function(t){function e(e,o,n){var a=t.call(this,e,"PReLU",{x:o,alpha:n},new SymbolicTensor(o.shape))||this;return a.x=o,a.alpha=n,a}return __extends(e,t),e.prototype.validate=function(){util.assert(util.arraysEqual(this.x.shape,this.alpha.shape),"Error adding pRelu op: the shapes x: "+this.x.shape+" and alpha: "+this.alpha.shape+" must match.")},e.X="x",e.ALPHA="alpha",e}(Node);exports.PReLUNode=PReLUNode;var EluNode=function(t){function e(e,o){return t.call(this,e,"Elu",{x:o},new SymbolicTensor(o.shape))||this}return __extends(e,t),e.prototype.validate=function(){},e.X="x",e}(Node);exports.EluNode=EluNode;var ExpNode=function(t){function e(e,o){return t.call(this,e,"Exp",{x:o},new SymbolicTensor(o.shape))||this}return __extends(e,t),e.prototype.validate=function(){},e.X="x",e}(Node);exports.ExpNode=ExpNode;var LogNode=function(t){function e(e,o){return t.call(this,e,"Log",{x:o},new SymbolicTensor(o.shape))||this}return __extends(e,t),e.prototype.validate=function(){},e.X="x",e}(Node);exports.LogNode=LogNode;var TanHNode=function(t){function e(e,o){return t.call(this,e,"TanH",{x:o},new SymbolicTensor(o.shape))||this}return __extends(e,t),e.prototype.validate=function(){},e.X="x",e}(Node);exports.TanHNode=TanHNode;var SigmoidNode=function(t){function e(e,o){return t.call(this,e,"Sigmoid",{x:o},new SymbolicTensor(o.shape))||this}return __extends(e,t),e.prototype.validate=function(){},e.X="x",e}(Node);exports.SigmoidNode=SigmoidNode;var SquareNode=function(t){function e(e,o){return t.call(this,e,"Square",{x:o},new SymbolicTensor(o.shape))||this}return __extends(e,t),e.prototype.validate=function(){},e.X="x",e}(Node);exports.SquareNode=SquareNode;var SoftmaxCrossEntropyCostNode=function(t){function e(e,o,n){var a=t.call(this,e,"SoftmaxCrossEntropyCost",{x:o,target:n},new SymbolicTensor([]))||this;return a.x=o,a.target=n,a}return __extends(e,t),e.prototype.validate=function(){util.assert(util.arraysEqual(this.x.shape,this.target.shape),"Error adding softmaxCrossEntropyCost op: x shape ("+this.x.shape+") must match target shape ("+this.target.shape+").")},e.X="x",e.TARGET="target",e}(Node);exports.SoftmaxCrossEntropyCostNode=SoftmaxCrossEntropyCostNode;var SoftmaxNode=function(t){function e(e,o){var n=t.call(this,e,"Softmax",{x:o},new SymbolicTensor(o.shape))||this;return n.x=o,n}return __extends(e,t),e.prototype.validate=function(){util.assert(1===this.x.shape.length,"The input to a softmax must be a 1-D tensor"),util.assert(this.x.shape[0]>=2,"The input to a softmax must have at least 2 values")},e.X="x",e}(Node);exports.SoftmaxNode=SoftmaxNode;var MeanSquaredCostNode=function(t){function e(e,o,n){var a=t.call(this,e,"Mean Squared Cost",{label:o,prediction:n},new SymbolicTensor([]))||this;return a.label=o,a.prediction=n,a}return __extends(e,t),e.prototype.validate=function(){util.assert(util.arraysEqual(this.label.shape,this.prediction.shape),"Error adding meanSquaredCost op: label shape ("+this.label.shape+") must match prediction shape ("+this.prediction.shape+").")},e.LABEL="label",e.PREDICTION="prediction",e}(Node);exports.MeanSquaredCostNode=MeanSquaredCostNode;var ArgMaxNode=function(t){function e(e,o){var n=t.call(this,e,"ArgMax",{x:o},new SymbolicTensor([1]))||this;return n.x=o,n}return __extends(e,t),e.prototype.validate=function(){util.assert(util.sizeFromShape(this.x.shape)>0,"Error adding argmax op: input tensor must have at least one entry.")},e.X="x",e}(Node);exports.ArgMaxNode=ArgMaxNode;var ArgMaxEqualsNode=function(t){function e(e,o,n){var a=t.call(this,e,"ArgMaxEquals",{x1:o,x2:n},new SymbolicTensor([1]))||this;return a.x1=o,a.x2=n,a}return __extends(e,t),e.prototype.validate=function(){util.assert(util.arraysEqual(this.x1.shape,this.x2.shape),"Error adding ArgMaxEquals op: x1 shape ("+this.x1.shape+") must match x2 shape ("+this.x2.shape+").")},e.X1="x1",e.X2="x2",e}(Node);exports.ArgMaxEqualsNode=ArgMaxEqualsNode;

},{"../ops/concat_util":145,"../ops/conv_util":147,"../tensor":178,"../util":183,"./initializers":74}],72:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MetricReduction,globals_1=require("../globals"),tensor_1=require("../tensor"),session_1=require("./session"),DEFAULT_EVAL_INTERVAL_MS=1500,DEFAULT_COST_INTERVAL_MS=500,DEFAULT_INFERENCE_EXAMPLE_INTERVAL_MS=3e3;!function(e){e[e.SUM=0]="SUM",e[e.MEAN=1]="MEAN"}(MetricReduction=exports.MetricReduction||(exports.MetricReduction={}));var GraphRunner=function(){function e(e,t,r){this.math=e,this.session=t,this.eventObserver=r,this.lastCostTimestamp=0,this.lastEvalTimestamp=0,this.resetStatistics(),this.zeroScalar=tensor_1.Scalar.new(0)}return e.prototype.resetStatistics=function(){this.totalBatchesTrained=0},e.prototype.train=function(e,t,r,n,i,s,a,o,c,l,h){void 0===c&&(c=MetricReduction.MEAN),void 0===l&&(l=DEFAULT_EVAL_INTERVAL_MS),void 0===h&&(h=DEFAULT_COST_INTERVAL_MS),this.costTensor=e,this.trainFeedEntries=t,this.metricTensor=s,this.metricFeedEntries=a,null!=o&&this.metricBatchSize!==o&&(null!=this.metricBatchSizeScalar&&this.metricBatchSizeScalar.dispose(),this.metricBatchSizeScalar=tensor_1.Scalar.new(o)),this.metricBatchSize=o,this.metricReduction=c,this.batchSize=r,this.optimizer=n,this.metricIntervalMs=l,this.costIntervalMs=h,this.currentTrainLoopNumBatches=i,this.batchesTrainedThisRun=0,this.isTraining=!0,this.trainStartTimestamp=performance.now(),this.trainNetwork()},e.prototype.stopTraining=function(){this.isTraining=!1},e.prototype.resumeTraining=function(){this.isTraining=!0,this.trainNetwork()},e.prototype.trainNetwork=function(){var e=this;if(this.batchesTrainedThisRun===this.currentTrainLoopNumBatches&&this.stopTraining(),this.isTraining){var t=performance.now(),r=null!=this.eventObserver.avgCostCallback&&t-this.lastCostTimestamp>this.costIntervalMs;r&&(this.lastCostTimestamp=t);var n=r?session_1.CostReduction.MEAN:session_1.CostReduction.NONE;globals_1.tidy(function(){var i=e.session.train(e.costTensor,e.trainFeedEntries,e.batchSize,e.optimizer,n);if(r){var s=performance.now()-t;if(e.eventObserver.avgCostCallback(i),null!=e.eventObserver.trainExamplesPerSecCallback){var a=1e3*e.batchSize/s;e.eventObserver.trainExamplesPerSecCallback(a)}}null!=e.eventObserver.metricCallback&&null!=e.metricFeedEntries&&t-e.lastEvalTimestamp>e.metricIntervalMs&&(e.lastEvalTimestamp=t,null!=e.lastComputedMetric&&e.lastComputedMetric.dispose(),e.lastComputedMetric=e.computeMetric(),e.eventObserver.metricCallback(e.lastComputedMetric)),null!=e.eventObserver.totalTimeCallback&&e.eventObserver.totalTimeCallback((t-e.trainStartTimestamp)/1e3),e.batchesTrainedThisRun++,e.totalBatchesTrained++,null!=e.eventObserver.batchesTrainedCallback&&e.eventObserver.batchesTrainedCallback(e.totalBatchesTrained)}),requestAnimationFrame(function(){return e.trainNetwork()})}else null!=this.eventObserver.doneTrainingCallback&&this.eventObserver.doneTrainingCallback()},e.prototype.infer=function(e,t,r,n,i){var s=this;if(void 0===r&&(r=DEFAULT_INFERENCE_EXAMPLE_INTERVAL_MS),void 0===n&&(n=5),null==this.eventObserver.inferenceExamplesCallback&&null==this.eventObserver.inferenceExamplesPerSecCallback)throw new Error("Cannot start inference loop, no inference example or examples/sec observer provided.");for(var a=0;a<t.length;a++){if(t[a].data instanceof tensor_1.Tensor)throw new Error("Cannot start inference on the model runner with feed entries of type NDArray. Please use InputProviders.")}this.inferenceExampleIntervalMs=r,this.inferenceTensor=e,this.inferenceFeedEntries=t,this.inferenceExampleCount=n,this.currentInferenceLoopNumPasses=i,this.isInferring||(this.inferencePassesThisRun=0,requestAnimationFrame(function(){return s.inferNetwork()})),this.isInferring=!0},e.prototype.inferNetwork=function(){var e=this;this.isInferring&&this.inferencePassesThisRun!==this.currentInferenceLoopNumPasses&&(globals_1.tidy(function(){for(var t=[],r=[],n=performance.now(),i=0;i<e.inferenceExampleCount;i++){for(var s=[],a=0;a<e.inferenceFeedEntries.length;a++){var o=e.inferenceFeedEntries[a],c=o.data.getNextCopy();s.push({tensor:o.tensor,data:c})}t.push(s),r.push(e.session.eval(e.inferenceTensor,s))}if(null!=e.eventObserver.inferenceExamplesPerSecCallback){r[r.length-1].dataSync();var l=performance.now()-n,h=1e3*e.inferenceExampleCount/l;e.eventObserver.inferenceExamplesPerSecCallback(h)}null!=e.eventObserver.inferenceExamplesCallback&&e.eventObserver.inferenceExamplesCallback(t,r),e.inferencePassesThisRun++}),this.lastInferTimeoutID=window.setTimeout(function(){return e.inferNetwork()},this.inferenceExampleIntervalMs))},e.prototype.stopInferring=function(){this.isInferring=!1,window.clearTimeout(this.lastInferTimeoutID)},e.prototype.isInferenceRunning=function(){return this.isInferring},e.prototype.computeMetric=function(){var e=this;if(null==this.metricFeedEntries)throw new Error("Cannot compute metric, no metric FeedEntries provided.");var t=this.zeroScalar;return globals_1.tidy(function(){for(var r=0;r<e.metricBatchSize;r++){var n=e.session.eval(e.metricTensor,e.metricFeedEntries);t=e.math.add(t,n.toFloat())}return e.metricReduction===MetricReduction.MEAN&&(t=e.math.divide(t,e.metricBatchSizeScalar)),t})},e.prototype.getTotalBatchesTrained=function(){return this.totalBatchesTrained},e.prototype.getLastComputedMetric=function(){return this.lastComputedMetric},e.prototype.setMath=function(e){this.math=e},e.prototype.setSession=function(e){this.session=e},e.prototype.setInferenceTensor=function(e){this.inferenceTensor=e},e.prototype.setInferenceExampleCount=function(e){this.inferenceExampleCount=e},e}();exports.GraphRunner=GraphRunner;

},{"../globals":67,"../tensor":178,"./session":96}],73:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var graph_1=require("./graph"),priority_queue=require("./priority_queue"),priority_queue_1=require("./priority_queue");function getUnorderedEvaluationSet(e,t){var r={},n={},u=[],o=e.slice();t.forEach(function(e){return r[e.id]=e});for(var i=function(){var e=o.pop();null==n[e.id]&&(null==r[e.id]&&Object.keys(e.inputs).map(function(t){return e.inputs[t]}).forEach(function(e){return o.push(e.node)}),u.push(e),n[e.id]=e)};0!==o.length;)i();return u}function getOrderedEvaluationSet(e){var t=[],r={},n={},u=new priority_queue_1.PriorityQueue(function(e,t){return priority_queue.defaultCompare(n[e.id],n[t.id])},function(e,t){return r[e.id]=t});for(e.forEach(function(e){return n[e.id]=0}),e.forEach(function(t){return Object.keys(t.inputs).map(function(e){return t.inputs[e]}).forEach(function(t){-1!==e.indexOf(t.node)&&n[t.node.id]++})}),e.forEach(function(e){return u.enqueue(e)});!u.empty();)t.unshift(u.dequeue()),Object.keys(t[0].inputs).map(function(e){return t[0].inputs[e]}).forEach(function(t){-1!==e.indexOf(t.node)&&(n[t.node.id]--,u.update(t.node,r[t.node.id]))});return t}function isInputNode(e){return 0===Object.keys(e.inputs).length}function shouldBackProp(e){return!(e.node instanceof graph_1.ConstantNode)}function isPassthroughNode(e,t){for(var r=Object.keys(e.inputs),n=0;n<r.length;n++){var u=e.inputs[r[n]];if(t.get(u,!0)===t.get(e.output,!0))return!0}return!1}exports.getUnorderedEvaluationSet=getUnorderedEvaluationSet,exports.getOrderedEvaluationSet=getOrderedEvaluationSet,exports.isInputNode=isInputNode,exports.shouldBackProp=shouldBackProp,exports.isPassthroughNode=isPassthroughNode;

},{"./graph":71,"./priority_queue":95}],74:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ops=require("../ops/ops"),VarianceScalingInitializer=function(){function i(i,n,t){void 0===i&&(i=1),void 0===n&&(n="fan_in"),void 0===t&&(t="normal"),this.scale=i,this.mode=n,this.distribution=t}return i.prototype.initialize=function(i,n,t){var r=0;if("fan_in"===this.mode)r=n;else if("fan_out"===this.mode)r=t;else{if("fan_avg"!==this.mode)throw new Error("Unexpected mode for variance scaling initializer: "+this.mode);r=(n+t)/2}if("normal"===this.distribution)return ops.truncatedNormal(i,0,Math.sqrt(this.scale/r));if("uniform"===this.distribution)return ops.randomUniform(i,0,Math.sqrt(3*this.scale/r));throw new Error("Unexpected distribution for variance scaling initializer: "+this.distribution)},i}();exports.VarianceScalingInitializer=VarianceScalingInitializer;var ZerosInitializer=function(){function i(){}return i.prototype.initialize=function(i,n,t){return ops.zeros(i)},i}();exports.ZerosInitializer=ZerosInitializer;var OnesInitializer=function(){function i(){}return i.prototype.initialize=function(i,n,t){return ops.ones(i)},i}();exports.OnesInitializer=OnesInitializer;var ConstantInitializer=function(){function i(i){void 0===i&&(i=0),this.value=i}return i.prototype.initialize=function(i,n,t){return ops.fill(i,this.value)},i}();exports.ConstantInitializer=ConstantInitializer;var TensorInitializer=function(){function i(i){this.tensor=i}return i.prototype.initialize=function(i,n,t){return this.tensor},i}();exports.TensorInitializer=TensorInitializer;var RandomNormalInitializer=function(){function i(i,n){void 0===i&&(i=0),void 0===n&&(n=.05),this.mean=i,this.stdev=n}return i.prototype.initialize=function(i,n,t){return ops.randomNormal(i,this.mean,this.stdev)},i}();exports.RandomNormalInitializer=RandomNormalInitializer;var RandomTruncatedNormalInitializer=function(){function i(i,n){void 0===i&&(i=0),void 0===n&&(n=.05),this.mean=i,this.stdev=n}return i.prototype.initialize=function(i,n,t){return ops.truncatedNormal(i,this.mean,this.stdev)},i}();exports.RandomTruncatedNormalInitializer=RandomTruncatedNormalInitializer;var RandomUniformInitializer=function(){function i(i,n){void 0===i&&(i=-.05),void 0===n&&(n=.05),this.minval=i,this.maxval=n}return i.prototype.initialize=function(i,n,t){return ops.randomUniform(i,this.minval,this.maxval)},i}();exports.RandomUniformInitializer=RandomUniformInitializer;

},{"../ops/ops":155}],75:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var graph_1=require("./graph"),graph_util=require("./graph_util"),add_1=require("./ops/add"),argmax_1=require("./ops/argmax"),argmaxequals_1=require("./ops/argmaxequals"),concat_1=require("./ops/concat"),convolution_1=require("./ops/convolution"),divide_1=require("./ops/divide"),element_wise_activation_1=require("./ops/element_wise_activation"),element_wise_cost_1=require("./ops/element_wise_cost"),exp_1=require("./ops/exp"),linear_combination_1=require("./ops/linear_combination"),log_1=require("./ops/log"),matmul_1=require("./ops/matmul"),max_pool_1=require("./ops/max_pool"),multiply_1=require("./ops/multiply"),reduce_sum_1=require("./ops/reduce_sum"),reshape_1=require("./ops/reshape"),softmax_1=require("./ops/softmax"),subtract_1=require("./ops/subtract");function emitFromGraphNodes(e){var t=[];return e.forEach(function(e){return Array.prototype.push.apply(t,emitOpFromNode(e))}),t}function emitOpFromNode(e){if(e instanceof graph_1.ReshapeNode)return[new reshape_1.Reshape(e.inputs[graph_1.ReshapeNode.X],e.output)];if(e instanceof graph_1.MatMulNode){var t=e.inputs[graph_1.MatMulNode.X1],o=e.inputs[graph_1.MatMulNode.X2];return[new matmul_1.MatMul(t,o,e.output)]}if(e instanceof graph_1.Convolution2DNode){var n=e.inputs[graph_1.Convolution2DNode.W],a=e.inputs[graph_1.Convolution2DNode.X],r=e.inputs[graph_1.Convolution2DNode.B];return[new convolution_1.Convolution2D(n,a,r,e.output,e.fieldSize,e.outputDepth,e.stride,e.zeroPad)]}if(e instanceof graph_1.MaxPoolNode){a=e.inputs[graph_1.MaxPoolNode.X];return[new max_pool_1.MaxPool(a,e.output,e.fieldSize,e.stride,e.zeroPad)]}if(e instanceof graph_1.ExpNode)return[new exp_1.Exp(e.inputs[graph_1.ExpNode.X],e.output)];if(e instanceof graph_1.LogNode)return[new log_1.Log(e.inputs[graph_1.LogNode.X],e.output)];if(e instanceof graph_1.ReLUNode)return[new element_wise_activation_1.ReLU(e.inputs[graph_1.ReLUNode.X],e.output)];if(e instanceof graph_1.LeakyReLUNode)return[new element_wise_activation_1.LeakyReLU(e.inputs[graph_1.LeakyReLUNode.X],e.output,e.alpha)];if(e instanceof graph_1.PReLUNode)return[new element_wise_activation_1.PReLU(e.inputs[graph_1.PReLUNode.X],e.inputs[graph_1.PReLUNode.ALPHA],e.output)];if(e instanceof graph_1.EluNode)return[new element_wise_activation_1.Elu(e.inputs[graph_1.EluNode.X],e.output)];if(e instanceof graph_1.TanHNode)return[new element_wise_activation_1.TanH(e.inputs[graph_1.TanHNode.X],e.output)];if(e instanceof graph_1.SigmoidNode)return[new element_wise_activation_1.Sigmoid(e.inputs[graph_1.SigmoidNode.X],e.output)];if(e instanceof graph_1.SoftmaxCrossEntropyCostNode){a=e.inputs[graph_1.SoftmaxCrossEntropyCostNode.X];var i=e.inputs[graph_1.SoftmaxCrossEntropyCostNode.TARGET];return[new softmax_1.SoftmaxCrossEntropyCost(a,i,e.output)]}if(e instanceof graph_1.SoftmaxNode)return[new softmax_1.Softmax(e.inputs[graph_1.SoftmaxNode.X],e.output)];if(e instanceof graph_1.MeanSquaredCostNode){var u=e.inputs[graph_1.MeanSquaredCostNode.LABEL],p=e.inputs[graph_1.MeanSquaredCostNode.PREDICTION];return[new element_wise_cost_1.MeanSquaredCost(u,p,e.output)]}if(e instanceof graph_1.ArgMaxEqualsNode)return[new argmaxequals_1.ArgMaxEquals(e.inputs[graph_1.ArgMaxEqualsNode.X1],e.inputs[graph_1.ArgMaxEqualsNode.X2],e.output)];if(e instanceof graph_1.ArgMaxNode)return[new argmax_1.ArgMax(e.x,e.output)];if(e instanceof graph_1.FusedLinearCombinationNode)return[new linear_combination_1.LinearCombination(e.inputs[graph_1.FusedLinearCombinationNode.T1],e.inputs[graph_1.FusedLinearCombinationNode.T2],e.inputs[graph_1.FusedLinearCombinationNode.C1],e.inputs[graph_1.FusedLinearCombinationNode.C2],e.output)];if(e instanceof graph_1.Concat1DNode)return[new concat_1.Concat1D(e.inputs[graph_1.Concat1DNode.X1],e.inputs[graph_1.Concat1DNode.X2],e.output)];if(e instanceof graph_1.Concat2DNode)return[new concat_1.Concat2D(e.inputs[graph_1.Concat2DNode.X1],e.inputs[graph_1.Concat2DNode.X2],e.axis,e.output)];if(e instanceof graph_1.Concat3DNode)return[new concat_1.Concat3D(e.inputs[graph_1.Concat3DNode.X1],e.inputs[graph_1.Concat3DNode.X2],e.axis,e.output)];if(e instanceof graph_1.Concat4DNode)return[new concat_1.Concat4D(e.inputs[graph_1.Concat4DNode.X1],e.inputs[graph_1.Concat4DNode.X2],e.axis,e.output)];if(e instanceof graph_1.SquareNode)return[new element_wise_activation_1.Square(e.inputs[graph_1.SquareNode.X],e.output)];if(e instanceof graph_1.AddNode)return[new add_1.Add(e.inputs[graph_1.AddNode.T1],e.inputs[graph_1.AddNode.T2],e.output)];if(e instanceof graph_1.SubtractNode)return[new subtract_1.Subtract(e.inputs[graph_1.SubtractNode.T1],e.inputs[graph_1.SubtractNode.T2],e.output)];if(e instanceof graph_1.MultiplyNode)return[new multiply_1.Multiply(e.inputs[graph_1.MultiplyNode.T1],e.inputs[graph_1.MultiplyNode.T2],e.output)];if(e instanceof graph_1.DivideNode)return[new divide_1.Divide(e.inputs[graph_1.DivideNode.T1],e.inputs[graph_1.DivideNode.T2],e.output)];if(e instanceof graph_1.ReduceSumNode)return[new reduce_sum_1.ReduceSum(e.inputs[graph_1.ReduceSumNode.X],e.output)];if(graph_util.isInputNode(e))return[];throw Error("Unsupported node type: "+e.constructor.name)}exports.emitFromGraphNodes=emitFromGraphNodes;

},{"./graph":71,"./graph_util":73,"./ops/add":76,"./ops/argmax":77,"./ops/argmaxequals":78,"./ops/concat":79,"./ops/convolution":80,"./ops/divide":81,"./ops/element_wise_activation":82,"./ops/element_wise_cost":83,"./ops/exp":84,"./ops/linear_combination":85,"./ops/log":86,"./ops/matmul":87,"./ops/max_pool":88,"./ops/multiply":89,"./ops/reduce_sum":91,"./ops/reshape":92,"./ops/softmax":93,"./ops/subtract":94}],76:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var r in s)s.hasOwnProperty(r)&&(e[r]=s[r])};return function(s,r){function a(){this.constructor=s}e(s,r),s.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),util=require("../../util"),graph_util=require("../graph_util"),op_1=require("./op"),Add=function(e){function s(s,r,a){var t=e.call(this)||this;return t.x1Tensor=s,t.x2Tensor=r,t.yTensor=a,util.assert(1===util.sizeFromShape(s.shape)||1===util.sizeFromShape(r.shape)||util.arraysEqual(s.shape,r.shape)||2===s.shape.length&&1===r.shape.length&&s.shape[1]===r.shape[0]||1===s.shape.length&&2===r.shape.length&&s.shape[0]===r.shape[1],"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape, or one of them can be broadcasted (2D and 1D)."),t}return __extends(s,e),s.prototype.feedForward=function(e,s){var r=this,a=s.get(this.x1Tensor),t=s.get(this.x2Tensor);globals_1.tidy(function(){var o;o=util.isScalarShape(a.shape)?e.scalarPlusArray(a,t):util.isScalarShape(t.shape)?e.scalarPlusArray(t,a):e.add(a,t),s.set(r.yTensor,globals_1.keep(o))})},s.prototype.backProp=function(e,s,r){var a=this,t=r.get(this.yTensor);globals_1.tidy(function(){if(graph_util.shouldBackProp(a.x1Tensor))if(1===a.x1Tensor.shape.length&&2===a.x2Tensor.shape.length&&a.x1Tensor.shape[0]===a.x2Tensor.shape[1]){var s=e.sum(t,0);r.add(a.x1Tensor,s)}else if(util.isScalarShape(a.x1Tensor.shape)){s=e.sum(t);r.add(a.x1Tensor,s)}else r.add(a.x1Tensor,e.clone(t));if(graph_util.shouldBackProp(a.x2Tensor))if(2===a.x1Tensor.shape.length&&1===a.x2Tensor.shape.length&&a.x1Tensor.shape[1]===a.x2Tensor.shape[0]){s=e.sum(t,0);r.add(a.x2Tensor,s)}else if(util.isScalarShape(a.x2Tensor.shape)){s=e.sum(t);r.add(a.x2Tensor,s)}else r.add(a.x2Tensor,e.clone(t))})},s.prototype.dispose=function(){null!=this.dySizeScalar&&this.dySizeScalar.dispose()},s}(op_1.Operation);exports.Add=Add;

},{"../../globals":67,"../../util":183,"../graph_util":73,"./op":90}],77:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),op_1=require("./op"),ArgMax=function(t){function r(r,e){var o=t.call(this)||this;return o.xTensor=r,o.yTensor=e,o}return __extends(r,t),r.prototype.feedForward=function(t,r){var e=this,o=r.get(this.xTensor);globals_1.tidy(function(){r.set(e.yTensor,globals_1.keep(t.argMax(o)))})},r.prototype.backProp=function(t,r,e){throw new Error("ArgMax backprop unimplemented")},r}(op_1.Operation);exports.ArgMax=ArgMax;

},{"../../globals":67,"./op":90}],78:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),op_1=require("./op"),ArgMaxEquals=function(t){function r(r,e,o){var n=t.call(this)||this;return n.x1Tensor=r,n.x2Tensor=e,n.yTensor=o,n}return __extends(r,t),r.prototype.feedForward=function(t,r){var e=this,o=r.get(this.x1Tensor),n=r.get(this.x2Tensor);globals_1.tidy(function(){r.set(e.yTensor,globals_1.keep(t.argMaxEquals(o,n)))})},r.prototype.backProp=function(t,r,e){throw new Error("ArgMaxEquals backprop unimplemented")},r}(op_1.Operation);exports.ArgMaxEquals=ArgMaxEquals;

},{"../../globals":67,"./op":90}],79:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])};return function(o,e){function n(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),concat_util=require("../../ops/concat_util"),util=require("../../util"),op_1=require("./op"),Concat1D=function(t){function o(o,e,n){var r=t.call(this)||this;return r.x1Tensor=o,r.x2Tensor=e,r.yTensor=n,r}return __extends(o,t),o.prototype.feedForward=function(t,o){var e=this,n=o.get(this.x1Tensor),r=o.get(this.x2Tensor);globals_1.tidy(function(){var s=t.concat1D(n,r);o.set(e.yTensor,globals_1.keep(s))})},o.prototype.backProp=function(t,o,e){var n=this;globals_1.tidy(function(){concatBackProp(t,n.x1Tensor,n.x2Tensor,n.yTensor,0,e,o)})},o}(op_1.Operation);exports.Concat1D=Concat1D;var Concat2D=function(t){function o(o,e,n,r){var s=t.call(this)||this;return s.x1Tensor=o,s.x2Tensor=e,s.axis=n,s.yTensor=r,concat_util.assertParams(o.shape,e.shape,n),s}return __extends(o,t),o.prototype.feedForward=function(t,o){var e=this,n=o.get(this.x1Tensor),r=o.get(this.x2Tensor);globals_1.tidy(function(){var s=t.concat2D(n,r,e.axis);o.set(e.yTensor,globals_1.keep(s))})},o.prototype.backProp=function(t,o,e){var n=this;globals_1.tidy(function(){concatBackProp(t,n.x1Tensor,n.x2Tensor,n.yTensor,n.axis,e,o)})},o}(op_1.Operation);exports.Concat2D=Concat2D;var Concat3D=function(t){function o(o,e,n,r){var s=t.call(this)||this;return s.x1Tensor=o,s.x2Tensor=e,s.axis=n,s.yTensor=r,concat_util.assertParams(o.shape,e.shape,n),s}return __extends(o,t),o.prototype.feedForward=function(t,o){var e=this,n=o.get(this.x1Tensor),r=o.get(this.x2Tensor);globals_1.tidy(function(){var s=t.concat3D(n,r,e.axis);o.set(e.yTensor,globals_1.keep(s))})},o.prototype.backProp=function(t,o,e){var n=this;globals_1.tidy(function(){concatBackProp(t,n.x1Tensor,n.x2Tensor,n.yTensor,n.axis,e,o)})},o}(op_1.Operation);exports.Concat3D=Concat3D;var Concat4D=function(t){function o(o,e,n,r){var s=t.call(this)||this;return s.x1Tensor=o,s.x2Tensor=e,s.axis=n,s.yTensor=r,concat_util.assertParams(o.shape,e.shape,n),s}return __extends(o,t),o.prototype.feedForward=function(t,o){var e=this,n=o.get(this.x1Tensor),r=o.get(this.x2Tensor);globals_1.tidy(function(){var s=t.concat4D(n,r,e.axis);o.set(e.yTensor,globals_1.keep(s))})},o.prototype.backProp=function(t,o,e){var n=this;globals_1.tidy(function(){concatBackProp(t,n.x1Tensor,n.x2Tensor,n.yTensor,n.axis,e,o)})},o}(op_1.Operation);function concatBackProp(t,o,e,n,r,s,a){var i=s.get(n),c=a.get(o),p=a.get(e),u=c.as2D(-1,util.sizeFromShape(c.shape.slice(r))),l=p.as2D(-1,util.sizeFromShape(p.shape.slice(r))),_=concat_util.computeGradientSliceShapes(u.shape,l.shape),h=_.aBegin,x=_.aSize,f=_.bBegin,T=_.bSize,y=i.as2D(-1,u.shape[1]+l.shape[1]),d=t.slice2D(y,h,x).reshapeAs(c),g=t.slice2D(y,f,T).reshapeAs(p);s.add(o,d),s.add(e,g)}exports.Concat4D=Concat4D;

},{"../../globals":67,"../../ops/concat_util":145,"../../util":183,"./op":90}],80:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),conv_util=require("../../ops/conv_util"),util=require("../../util"),op_1=require("./op"),Convolution2D=function(e){function t(t,o,r,s,i,n,a,u){void 0===a&&(a=1);var p=e.call(this)||this;return p.wTensor=t,p.xTensor=o,p.bTensor=r,p.yTensor=s,p.fieldSize=i,p.outputDepth=n,p.stride=a,p.assertWeightsShape(t.shape),p.zeroPad=null!=u?u:conv_util.computeDefaultPad(p.xTensor.shape,p.fieldSize,p.stride),util.assert(util.isInt(p.zeroPad),"The zero padding ("+p.zeroPad+") must be an integer. Change the stride and/or zero pad parameters"),p}return __extends(t,e),t.prototype.feedForward=function(e,t){var o=this,r=t.get(this.wTensor),s=t.get(this.bTensor),i=t.get(this.xTensor);globals_1.tidy(function(){t.set(o.yTensor,globals_1.keep(e.conv2d(i,r,s,o.stride,o.zeroPad)))})},t.prototype.backProp=function(e,t,o){var r=this,s=t.get(this.wTensor),i=t.get(this.xTensor),n=o.get(this.yTensor);globals_1.tidy(function(){var t=e.conv2dDerFilter(i,n,s.shape,r.stride,r.zeroPad),a=e.sum(n,[0,1]),u=e.conv2dDerInput(i.shape,n,s,r.stride,r.zeroPad);o.add(r.wTensor,t),o.add(r.bTensor,a),o.add(r.xTensor,u)})},t.prototype.assertWeightsShape=function(e){util.assert(e[0]===this.fieldSize&&e[1]===this.fieldSize&&e[2]===this.xTensor.shape[2]&&e[3]===this.outputDepth,"weights must be of shape ["+this.fieldSize+","+this.fieldSize+","+this.xTensor.shape[2]+","+this.outputDepth+"] but they are ofshape ["+e+"]")},t}(op_1.Operation);exports.Convolution2D=Convolution2D;

},{"../../globals":67,"../../ops/conv_util":147,"../../util":183,"./op":90}],81:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function a(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),util=require("../../util"),graph_util=require("../graph_util"),op_1=require("./op"),Divide=function(e){function r(r,t,a){var i=e.call(this)||this;return i.x1Tensor=r,i.x2Tensor=t,i.yTensor=a,util.assert(1===util.sizeFromShape(r.shape)||1===util.sizeFromShape(t.shape)||util.arraysEqual(r.shape,t.shape),"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape"),i}return __extends(r,e),r.prototype.feedForward=function(e,r){var t=this,a=r.get(this.x1Tensor),i=r.get(this.x2Tensor);globals_1.tidy(function(){var s;s=util.isScalarShape(a.shape)?e.scalarDividedByArray(a,i):util.isScalarShape(i.shape)?e.arrayDividedByScalar(a,i):e.divide(a,i),r.set(t.yTensor,globals_1.keep(s))})},r.prototype.backProp=function(e,r,t){var a=this,i=r.get(this.x1Tensor),s=r.get(this.x2Tensor),o=t.get(this.yTensor),n=util.isScalarShape(i.shape),l=util.isScalarShape(s.shape);globals_1.tidy(function(){if(graph_util.shouldBackProp(a.x1Tensor))if(n){var r=e.divide(o,s);t.add(a.x1Tensor,e.sum(r)),r.dispose()}else l?t.add(a.x1Tensor,e.arrayDividedByScalar(o,s)):t.add(a.x1Tensor,e.divide(o,s));if(graph_util.shouldBackProp(a.x2Tensor)){var u=e.elementWiseMul(s,s),d=void 0;d=l?e.arrayDividedByScalar(i,u):n?e.scalarDividedByArray(i,u):e.divide(i,u);var p=e.neg(d),h=e.elementWiseMul(o,p);l?t.add(a.x2Tensor,e.sum(h)):t.add(a.x2Tensor,h)}})},r}(op_1.Operation);exports.Divide=Divide;

},{"../../globals":67,"../../util":183,"../graph_util":73,"./op":90}],82:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),activation_functions_1=require("../activation_functions"),op_1=require("./op"),ElementWiseActivation=function(t){function e(e,n,i){var o=t.call(this)||this;return o.xTensor=e,o.yTensor=n,o.func=i,o}return __extends(e,t),e.prototype.feedForward=function(t,e){var n=this,i=e.get(this.xTensor);globals_1.tidy(function(){e.set(n.yTensor,globals_1.keep(n.func.output(t,i)))})},e.prototype.backProp=function(t,e,n){var i=this,o=e.get(this.xTensor),r=e.get(this.yTensor),s=n.get(this.yTensor);globals_1.tidy(function(){var e=i.func.der(t,o,r);n.add(i.xTensor,t.elementWiseMul(s,e)),e.dispose()})},e.prototype.dispose=function(){this.func.dispose()},e}(op_1.Operation);exports.ElementWiseActivation=ElementWiseActivation;var ReLU=function(t){function e(e,n){return t.call(this,e,n,new activation_functions_1.ReLUFunc)||this}return __extends(e,t),e}(ElementWiseActivation);exports.ReLU=ReLU;var LeakyReLU=function(t){function e(e,n,i){return t.call(this,e,n,new activation_functions_1.LeakyReluFunc(i))||this}return __extends(e,t),e}(ElementWiseActivation);exports.LeakyReLU=LeakyReLU;var TanH=function(t){function e(e,n){return t.call(this,e,n,new activation_functions_1.TanHFunc)||this}return __extends(e,t),e}(ElementWiseActivation);exports.TanH=TanH;var Sigmoid=function(t){function e(e,n){return t.call(this,e,n,new activation_functions_1.SigmoidFunc)||this}return __extends(e,t),e}(ElementWiseActivation);exports.Sigmoid=Sigmoid;var Square=function(t){function e(e,n){return t.call(this,e,n,new activation_functions_1.SquareFunc)||this}return __extends(e,t),e}(ElementWiseActivation);exports.Square=Square;var Elu=function(t){function e(e,n){return t.call(this,e,n,new activation_functions_1.EluFunc)||this}return __extends(e,t),e}(ElementWiseActivation);exports.Elu=Elu;var PReLU=function(t){function e(e,n,i){var o=t.call(this)||this;return o.xTensor=e,o.alphaTensor=n,o.yTensor=i,o}return __extends(e,t),e.prototype.feedForward=function(t,e){var n=this,i=e.get(this.xTensor),o=e.get(this.alphaTensor);globals_1.tidy(function(){e.set(n.yTensor,globals_1.keep(t.prelu(i,o)))})},e.prototype.backProp=function(t,e,n){throw new Error("Not implemented")},e}(op_1.Operation);exports.PReLU=PReLU;

},{"../../globals":67,"../activation_functions":69,"./op":90}],83:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),globals_1=require("../../globals"),tensor_1=require("../../tensor"),util=require("../../util"),cost_functions_1=require("../cost_functions"),graph_util=require("../graph_util"),op_1=require("./op"),ElementWiseCost=function(e){function t(t,r,o,n){var s=e.call(this)||this;return s.x1Tensor=t,s.x2Tensor=r,s.yTensor=o,s.func=n,s.oneOverNScalar=environment_1.ENV.math.keep(tensor_1.Scalar.new(1/util.sizeFromShape(t.shape))),s}return __extends(t,e),t.prototype.feedForward=function(e,t){var r=this,o=t.get(this.x1Tensor),n=t.get(this.x2Tensor);globals_1.tidy(function(){var s=r.func.cost(o,n),i=e.sum(s),u=e.scalarTimesArray(r.oneOverNScalar,i);t.set(r.yTensor,globals_1.keep(u))})},t.prototype.backProp=function(e,t,r){var o=this,n=t.get(this.x1Tensor),s=t.get(this.x2Tensor);globals_1.tidy(function(){graph_util.shouldBackProp(o.x1Tensor)&&r.add(o.x1Tensor,o.func.der(n,s)),graph_util.shouldBackProp(o.x2Tensor)&&r.add(o.x2Tensor,o.func.der(s,n))})},t.prototype.dispose=function(){this.func.dispose(),this.oneOverNScalar.dispose()},t}(op_1.Operation);exports.ElementWiseCost=ElementWiseCost;var MeanSquaredCost=function(e){function t(t,r,o){return e.call(this,t,r,o,new cost_functions_1.SquareCostFunc)||this}return __extends(t,e),t}(ElementWiseCost);exports.MeanSquaredCost=MeanSquaredCost;

},{"../../environment":66,"../../globals":67,"../../tensor":178,"../../util":183,"../cost_functions":70,"../graph_util":73,"./op":90}],84:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),graph_util=require("../graph_util"),op_1=require("./op"),Exp=function(t){function e(e,o){var r=t.call(this)||this;return r.xTensor=e,r.yTensor=o,r}return __extends(e,t),e.prototype.feedForward=function(t,e){var o=this,r=e.get(this.xTensor);globals_1.tidy(function(){e.set(o.yTensor,globals_1.keep(t.exp(r)))})},e.prototype.backProp=function(t,e,o){var r=this,n=e.get(this.yTensor),s=o.get(this.yTensor);globals_1.tidy(function(){graph_util.shouldBackProp(r.xTensor)&&o.add(r.xTensor,t.elementWiseMul(n,s))})},e}(op_1.Operation);exports.Exp=Exp;

},{"../../globals":67,"../graph_util":73,"./op":90}],85:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])};return function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),graph_util=require("../graph_util"),op_1=require("./op"),LinearCombination=function(r){function e(e,t,o,s,n){var i=r.call(this)||this;return i.x1Tensor=e,i.x2Tensor=t,i.c1Tensor=o,i.c2Tensor=s,i.outTensor=n,i}return __extends(e,r),e.prototype.feedForward=function(r,e){var t=this,o=e.get(this.x1Tensor),s=e.get(this.x2Tensor),n=e.get(this.c1Tensor).asScalar(),i=e.get(this.c2Tensor).asScalar();globals_1.tidy(function(){e.set(t.outTensor,globals_1.keep(r.scaledArrayAdd(n,o,i,s)))})},e.prototype.backProp=function(r,e,t){var o=this,s=e.get(this.x1Tensor),n=e.get(this.x2Tensor),i=e.get(this.c1Tensor),a=e.get(this.c2Tensor),c=t.get(this.outTensor);globals_1.tidy(function(){if(graph_util.shouldBackProp(o.x1Tensor)&&t.add(o.x1Tensor,r.scalarTimesArray(i,c)),graph_util.shouldBackProp(o.x2Tensor)&&t.add(o.x2Tensor,r.scalarTimesArray(a,c)),graph_util.shouldBackProp(o.c1Tensor)){var e=r.elementWiseMul(s,c);t.add(o.c1Tensor,r.sum(e))}if(graph_util.shouldBackProp(o.c2Tensor)){var u=r.elementWiseMul(n,c);t.add(o.c2Tensor,r.sum(u))}})},e}(op_1.Operation);exports.LinearCombination=LinearCombination;

},{"../../globals":67,"../graph_util":73,"./op":90}],86:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])};return function(o,e){function r(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),graph_util=require("../graph_util"),op_1=require("./op"),Log=function(t){function o(o,e){var r=t.call(this)||this;return r.xTensor=o,r.yTensor=e,r}return __extends(o,t),o.prototype.feedForward=function(t,o){var e=this,r=o.get(this.xTensor);globals_1.tidy(function(){o.set(e.yTensor,globals_1.keep(t.log(r)))})},o.prototype.backProp=function(t,o,e){var r=this,n=o.get(this.xTensor),s=e.get(this.yTensor);globals_1.tidy(function(){graph_util.shouldBackProp(r.xTensor)&&e.add(r.xTensor,t.divide(s,n))})},o}(op_1.Operation);exports.Log=Log;

},{"../../globals":67,"../graph_util":73,"./op":90}],87:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),graph_util=require("../graph_util"),op_1=require("./op"),MatMul=function(e){function t(t,r,s){var o=e.call(this)||this;return o.x1Tensor=t,o.x2Tensor=r,o.yTensor=s,o}return __extends(t,e),t.prototype.feedForward=function(e,t){var r=this,s=t.get(this.x1Tensor),o=t.get(this.x2Tensor);globals_1.tidy(function(){2===s.shape.length&&2===o.shape.length?t.set(r.yTensor,globals_1.keep(e.matMul(s,o))):2===s.shape.length&&1===o.shape.length?t.set(r.yTensor,globals_1.keep(e.matrixTimesVector(s,o))):1===s.shape.length&&2===o.shape.length&&t.set(r.yTensor,globals_1.keep(e.vectorTimesMatrix(s,o)))})},t.prototype.backProp=function(e,t,r){var s=this,o=t.get(this.x1Tensor),n=t.get(this.x2Tensor),a=r.get(this.yTensor);1===o.shape.length&&(o=o.reshape([1,o.size]),a=a.reshape([1,a.size])),1===n.shape.length&&(n=n.reshape([n.size,1]),a=a.reshape([a.size,1])),globals_1.tidy(function(){if(graph_util.shouldBackProp(s.x1Tensor)){var t=e.matMul(a,n,!1,!0);r.add(s.x1Tensor,1===s.x1Tensor.shape.length?t.as1D():t)}if(graph_util.shouldBackProp(s.x2Tensor)){var i=e.matMul(o,a,!0,!1);r.add(s.x2Tensor,1===s.x2Tensor.shape.length?i.as1D():i)}})},t}(op_1.Operation);exports.MatMul=MatMul;

},{"../../globals":67,"../graph_util":73,"./op":90}],88:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),conv_util=require("../../ops/conv_util"),util=require("../../util"),op_1=require("./op"),MaxPool=function(e){function t(t,o,r,i,n){void 0===i&&(i=1);var s=e.call(this)||this;return s.xTensor=t,s.yTensor=o,s.fieldSize=r,s.stride=i,s.pad=null!=n?n:conv_util.computeDefaultPad(t.shape,s.fieldSize,s.stride),util.assert(util.isInt(s.pad),"The zero padding ("+s.pad+") must be an integer. Change the stride and/or zero pad parameters"),s}return __extends(t,e),t.prototype.feedForward=function(e,t){var o=this,r=t.get(this.xTensor);globals_1.tidy(function(){t.set(o.yTensor,globals_1.keep(e.maxPool(r,o.fieldSize,o.stride,o.pad)))})},t.prototype.backProp=function(e,t,o){var r=this,i=t.get(this.xTensor),n=o.get(this.yTensor);globals_1.tidy(function(){o.add(r.xTensor,e.maxPoolBackprop(n,i,r.fieldSize,r.stride,r.pad))})},t}(op_1.Operation);exports.MaxPool=MaxPool;

},{"../../globals":67,"../../ops/conv_util":147,"../../util":183,"./op":90}],89:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function s(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),util=require("../../util"),graph_util=require("../graph_util"),op_1=require("./op"),Multiply=function(e){function r(r,t,s){var a=e.call(this)||this;return a.x1Tensor=r,a.x2Tensor=t,a.yTensor=s,util.assert(1===util.sizeFromShape(r.shape)||1===util.sizeFromShape(t.shape)||util.arraysEqual(r.shape,t.shape),"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape"),a}return __extends(r,e),r.prototype.feedForward=function(e,r){var t=this,s=r.get(this.x1Tensor),a=r.get(this.x2Tensor);globals_1.tidy(function(){var o;o=util.isScalarShape(s.shape)?e.scalarTimesArray(s,a):util.isScalarShape(a.shape)?e.scalarTimesArray(a,s):e.elementWiseMul(s,a),r.set(t.yTensor,globals_1.keep(o))})},r.prototype.backProp=function(e,r,t){var s=this,a=r.get(this.x1Tensor),o=r.get(this.x2Tensor),i=t.get(this.yTensor);globals_1.tidy(function(){if(graph_util.shouldBackProp(s.x1Tensor))if(util.isScalarShape(s.x1Tensor.shape)){var r=e.elementWiseMul(i,o);t.add(s.x1Tensor,e.sum(r))}else util.isScalarShape(o.shape)?t.add(s.x1Tensor,e.scalarTimesArray(o,i)):t.add(s.x1Tensor,e.elementWiseMul(o,i));if(graph_util.shouldBackProp(s.x2Tensor))if(util.isScalarShape(s.x2Tensor.shape)){r=e.elementWiseMul(i,a);t.add(s.x2Tensor,e.sum(r))}else util.isScalarShape(a.shape)?t.add(s.x2Tensor,e.scalarTimesArray(a,i)):t.add(s.x2Tensor,e.elementWiseMul(a,i))})},r}(op_1.Operation);exports.Multiply=Multiply;

},{"../../globals":67,"../../util":183,"../graph_util":73,"./op":90}],90:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Operation=function(){function e(){}return e.prototype.disposeTransientArrays=function(e,t){},e.prototype.dispose=function(){},e}();exports.Operation=Operation;

},{}],91:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),globals_1=require("../../globals"),tensor_1=require("../../tensor"),util=require("../../util"),graph_util=require("../graph_util"),op_1=require("./op"),ReduceSum=function(e){function t(t,o){var r=e.call(this)||this;return r.x=t,r.outTensor=o,util.assertShapesMatch(o.shape,[]),r.ones=environment_1.ENV.math.keep(tensor_1.Tensor.ones(t.shape)),r}return __extends(t,e),t.prototype.feedForward=function(e,t){var o=this,r=t.get(this.x);globals_1.tidy(function(){t.set(o.outTensor,globals_1.keep(e.sum(r)))})},t.prototype.backProp=function(e,t,o){var r=this;graph_util.shouldBackProp(this.x)&&globals_1.tidy(function(){var t=o.get(r.outTensor);o.add(r.x,e.scalarTimesArray(t,r.ones))})},t.prototype.dispose=function(){this.ones.dispose()},t}(op_1.Operation);exports.ReduceSum=ReduceSum;

},{"../../environment":66,"../../globals":67,"../../tensor":178,"../../util":183,"../graph_util":73,"./op":90}],92:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),util=require("../../util"),op_1=require("./op"),Reshape=function(e){function t(t,o){var r=e.call(this)||this;r.xTensor=t,r.yTensor=o;var s=util.sizeFromShape(t.shape),n=util.sizeFromShape(o.shape);return util.assert(s===n,"The input size ("+s+") and output size ("+n+") must match"),r}return __extends(t,e),t.prototype.feedForward=function(e,t){var o=this,r=t.get(this.xTensor),s=e.clone(r);globals_1.tidy(function(){t.set(o.yTensor,globals_1.keep(s.reshape(o.yTensor.shape)))})},t.prototype.backProp=function(e,t,o){var r=this,s=o.get(this.yTensor),n=e.clone(s);globals_1.tidy(function(){o.add(r.xTensor,n.reshape(r.xTensor.shape))})},t}(op_1.Operation);exports.Reshape=Reshape;

},{"../../globals":67,"../../util":183,"./op":90}],93:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])};return function(o,e){function r(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),globals_1=require("../../globals"),tensor_1=require("../../tensor"),util=require("../../util"),graph_1=require("../graph"),graph_util=require("../graph_util"),op_1=require("./op"),Softmax=function(t){function o(o,e){var r=t.call(this)||this;return r.logitsTensor=o,r.output=e,r}return __extends(o,t),o.prototype.feedForward=function(t,o){var e=this,r=o.get(this.logitsTensor);return globals_1.tidy(function(){o.set(e.output,globals_1.keep(t.softmax(r)))})},o.prototype.backProp=function(t,o,e){var r=this,s=o.get(this.output),n=e.get(this.output);globals_1.tidy(function(){if(graph_util.shouldBackProp(r.logitsTensor)){var o=t.elementWiseMul(t.subtract(n,t.sum(t.elementWiseMul(n,s))),s);e.add(r.logitsTensor,o)}})},o}(op_1.Operation);exports.Softmax=Softmax;var SoftmaxCrossEntropyCost=function(t){function o(o,e,r){var s=t.call(this)||this;return s.logitsTensor=o,s.labelTensor=e,s.yTensor=r,s.softmaxTensor=new graph_1.SymbolicTensor(o.shape),s.epsilon=environment_1.ENV.math.keep(tensor_1.Scalar.new(1e-5)),s}return __extends(o,t),o.prototype.feedForward=function(t,o){var e=this,r=o.get(this.logitsTensor),s=o.get(this.labelTensor);globals_1.tidy(function(){var n=t.softmax(r);o.set(e.softmaxTensor,globals_1.keep(n)),o.set(e.yTensor,globals_1.keep(crossEntropyCost(t,n,s,e.epsilon)))})},o.prototype.backProp=function(t,o,e){var r=this,s=o.get(this.softmaxTensor),n=o.get(this.labelTensor);globals_1.tidy(function(){e.add(r.logitsTensor,t.subtract(s,n))})},o.prototype.disposeTransientArrays=function(t,o){t.disposeArray(this.softmaxTensor)},o.prototype.dispose=function(){this.epsilon.dispose()},o}(op_1.Operation);function crossEntropyCost(t,o,e,r){return util.assert(o.size===e.size,"The output and target must be the same size"),globals_1.tidy(function(){var s=t.scalarPlusArray(r,o),n=t.log(s),i=t.elementWiseMul(e,n),a=t.neg(i);return t.sum(a)})}exports.SoftmaxCrossEntropyCost=SoftmaxCrossEntropyCost,exports.crossEntropyCost=crossEntropyCost;

},{"../../environment":66,"../../globals":67,"../../tensor":178,"../../util":183,"../graph":71,"../graph_util":73,"./op":90}],94:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function a(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../../globals"),util=require("../../util"),graph_util=require("../graph_util"),op_1=require("./op"),Subtract=function(t){function e(e,r,a){var s=t.call(this)||this;return s.t1=e,s.t2=r,s.outTensor=a,util.assert(1===util.sizeFromShape(e.shape)||1===util.sizeFromShape(r.shape)||util.arraysEqual(e.shape,r.shape),"One of t1 or t2 must be a scalar, or t1 and t2 must have the same shape"),s}return __extends(e,t),e.prototype.feedForward=function(t,e){var r=this,a=e.get(this.t1),s=e.get(this.t2);globals_1.tidy(function(){var o;o=util.isScalarShape(a.shape)?t.scalarMinusArray(a,s):util.isScalarShape(s.shape)?t.arrayMinusScalar(a,s):t.subtract(a,s),e.set(r.outTensor,globals_1.keep(o))})},e.prototype.backProp=function(t,e,r){var a=this,s=r.get(this.outTensor);globals_1.tidy(function(){if(graph_util.shouldBackProp(a.t1))if(util.isScalarShape(a.t1.shape)){var e=t.sum(s);r.add(a.t1,e)}else r.add(a.t1,t.clone(s));if(graph_util.shouldBackProp(a.t2))if(util.isScalarShape(a.t2.shape)){e=t.sum(s);var o=t.neg(e);r.add(a.t2,o)}else r.add(a.t2,t.neg(s))})},e.prototype.dispose=function(){null!=this.dySizeScalar&&this.dySizeScalar.dispose()},e}(op_1.Operation);exports.Subtract=Subtract;

},{"../../globals":67,"../../util":183,"../graph_util":73,"./op":90}],95:[function(require,module,exports){
"use strict";function defaultCompare(t,e){return t===e?0:t<e?-1:1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultCompare=defaultCompare;var PriorityQueue=function(){function t(t,e){this.comparator=t,this.indexObserver=e,this.heap=[]}return t.prototype.enqueue=function(t){this.heap.push(t),this.onIndexChanged(t,this.heap.length-1),this.siftUp(this.heap.length-1)},t.prototype.dequeue=function(){if(this.empty())throw new Error("dequeue called on empty priority queue.");var t=this.heap[0];return this.swap(0,this.heap.length-1),this.heap.pop(),this.siftDown(0),t},t.prototype.update=function(t,e){var i=e===this.heap.length-1;i||this.swap(e,this.heap.length-1),this.heap.pop(),i||(-1!==this.siftUpIndex(e)?this.siftUp(e):-1!==this.siftDownIndex(e)&&this.siftDown(e)),this.enqueue(t)},t.prototype.empty=function(){return 0===this.heap.length},t.prototype.onIndexChanged=function(t,e){this.indexObserver&&this.indexObserver(t,e)},t.prototype.getParentIndex=function(t){return 0===t?-1:Math.floor((t-1)/2)},t.prototype.getLeftChildIndex=function(t){var e=2*t+1;return e<this.heap.length?e:-1},t.prototype.getRightChildIndex=function(t){var e=2*t+2;return e<this.heap.length?e:-1},t.prototype.siftUpIndex=function(t){var e=this.getParentIndex(t);return-1===e?-1:this.compare(e,t)>0?e:-1},t.prototype.siftUp=function(t){for(var e=this.siftUpIndex(t);-1!==e;)this.swap(t,e),t=e,e=this.siftUpIndex(t)},t.prototype.siftDownIndex=function(t){if(t>=this.heap.length)return-1;var e=t,i=this.getLeftChildIndex(t);-1!==i&&this.compare(i,e)<0&&(e=i);var n=this.getRightChildIndex(t);return-1!==n&&this.compare(n,e)<0&&(e=n),e===t?-1:e},t.prototype.siftDown=function(t){for(var e=this.siftDownIndex(t);-1!==e;)this.swap(t,e),t=e,e=this.siftDownIndex(t)},t.prototype.compare=function(t,e){return this.comparator(this.heap[t],this.heap[e])},t.prototype.swap=function(t,e){var i=this.heap[t];this.heap[t]=this.heap[e],this.heap[e]=i,this.onIndexChanged(this.heap[t],t),this.onIndexChanged(this.heap[e],e)},t}();exports.PriorityQueue=PriorityQueue;

},{}],96:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var CostReduction,globals_1=require("../globals"),tensor_1=require("../tensor"),util=require("../util"),operation_emitter=require("./operation_emitter"),session_util=require("./session_util"),tensor_array_map_1=require("./tensor_array_map"),FeedDictionary=function(){return function(t){var e=this;this.dict={},t&&t.forEach(function(t){return e.dict[t.tensor.id]=t})}}();exports.FeedDictionary=FeedDictionary,function(t){t[t.NONE=0]="NONE",t[t.SUM=1]="SUM",t[t.MEAN=2]="MEAN"}(CostReduction=exports.CostReduction||(exports.CostReduction={}));var Session=function(){function t(t,e){this.math=e,this.activationArrayMap=new tensor_array_map_1.TensorArrayMap,this.runtimeCache={},this.oneScalar=tensor_1.Scalar.new(1),this.gradientArrayMap=new tensor_array_map_1.SummedTensorArrayMap(this.math)}return t.prototype.dispose=function(){var t=this;this.activationArrayMap.dispose(),Object.keys(this.runtimeCache).forEach(function(e){var r=t.runtimeCache[e];r.operations&&r.operations.forEach(function(t){return t.dispose()})}),this.runtimeCache={},null!=this.batchSizeScalar&&this.batchSizeScalar.dispose(),this.oneScalar.dispose()},t.prototype.evalAll=function(t,e){var r=this;return globals_1.tidy(function(){var i=new FeedDictionary(e),a=r.getOrCreateRuntime(t,i),o=r.activationArrayMap;session_util.disposeAndInitializeOperationOutputs(a.nodes,o),session_util.disposeTransientOperationArrays(a.operations,r.activationArrayMap,r.gradientArrayMap),session_util.addPersistentArraysToTensorArrayMap(a.nodes,o),session_util.loadInputsFromFeedDictionaryToTensorArrayMap(i,o,r.math),a.operations.forEach(function(t){return t.feedForward(r.math,o)});var n=t.map(function(t){return o.get(t)});return t.forEach(function(t){return o.delete(t)}),session_util.releaseFeedDictionaryInputsFromTensorArrayMap(i,o,r.math),n})},t.prototype.eval=function(t,e){return this.evalAll([t],e)[0]},t.prototype.train=function(t,e,r,i,a){var o=this;void 0===a&&(a=CostReduction.NONE),util.assert(util.isScalarShape(t.shape),"Cost tensor for training must be a scalar value."),this.prevBatchSize!==r&&(this.prevBatchSize=r,null!=this.batchSizeScalar&&this.batchSizeScalar.dispose(),this.batchSizeScalar=this.math.keep(tensor_1.Scalar.new(r)));var n=new FeedDictionary(e);session_util.throwIfFeedDictionaryContainsNDArrays(n);var s=this.getOrCreateRuntime([t],n),u=s.operations,c=s.operations.slice().reverse(),p=this.activationArrayMap,h=this.gradientArrayMap;return h.nullify(t),h.add(t,this.oneScalar),session_util.addPersistentArraysToTensorArrayMap(s.nodes,p),i.beforeBatch(this.math,r,s,p,h),globals_1.tidy(function(){for(var e=tensor_1.Scalar.new(0),d=0;d<r;++d)session_util.disposeAndInitializeOperationOutputs(s.nodes,p),session_util.disposeAndInitializeOperationInputGradients(s.nodes,h),session_util.disposeTransientOperationArrays(s.operations,p,h),session_util.loadInputsFromFeedDictionaryToTensorArrayMap(n,p,o.math),u.forEach(function(t){return t.feedForward(o.math,p)}),c.forEach(function(t){return t.backProp(o.math,p,h)}),i.afterExample(o.math,s,p,h),session_util.releaseFeedDictionaryInputsFromTensorArrayMap(n,p,o.math),e=o.updateCostForExample(e,p.get(t),a);return i.afterBatch(o.math,r,s,p,h),o.updateCostForBatch(e,a)})},t.prototype.updateCostForExample=function(t,e,r){return r===CostReduction.MEAN||r===CostReduction.SUM?this.math.add(t,e):t},t.prototype.updateCostForBatch=function(t,e){return e===CostReduction.MEAN?this.math.divide(t,this.batchSizeScalar):t},t.prototype.getOrCreateRuntime=function(t,e){var r=this.makeRuntimeCacheKey(t,e),i=this.runtimeCache[r];if(void 0===i){var a=session_util.getOrderedEvaluationSetFromEvalTensor(t,e);session_util.removeFeedDictionaryNodesFromEvaluationSet(e,a),session_util.throwErrorIfEvaluationSetContainsPlaceholderNodes(a),i={nodes:a,operations:operation_emitter.emitFromGraphNodes(a)},this.runtimeCache[r]=i}return i},t.prototype.makeRuntimeCacheKey=function(t,e){return t.map(function(t){return t.id}).sort().join("_")+"__"+Object.keys(e.dict).sort().join("_")},t}();exports.Session=Session;

},{"../globals":67,"../tensor":178,"../util":183,"./operation_emitter":75,"./session_util":97,"./tensor_array_map":98}],97:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("../tensor"),util=require("../util"),graph_1=require("./graph"),graph_util=require("./graph_util");function getTerminatingNodesFromFeedDictionary(e){return Object.keys(e.dict).map(function(r){return e.dict[+r].tensor.node})}function getOrderedEvaluationSetFromEvalTensor(e,r){var t=getTerminatingNodesFromFeedDictionary(r),o=e.map(function(e){return e.node}),n=graph_util.getUnorderedEvaluationSet(o,t);return graph_util.getOrderedEvaluationSet(n)}function addPersistentArraysToTensorArrayMap(e,r){e.forEach(function(e){(e instanceof graph_1.VariableNode||e instanceof graph_1.ConstantNode)&&r.set(e.output,e.data)})}function getVariableNodesFromEvaluationSet(e){var r=[];return e.forEach(function(e){e instanceof graph_1.VariableNode&&r.push(e)}),r}function throwIfFeedDictionaryContainsNDArrays(e){Object.keys(e.dict).forEach(function(r){if(e.dict[+r].data instanceof tensor_1.Tensor)throw new Error("training requires FeedDictionary entries to be InputProvidersand not NDArrays.")})}function loadInputsFromFeedDictionaryToTensorArrayMap(e,r,t){Object.keys(e.dict).forEach(function(t){var o,n=e.dict[+t];n.data instanceof tensor_1.Tensor?o=n.data:o=n.data.getNextCopy();util.assert(util.arraysEqual(n.tensor.shape,o.shape),"Error loading FeedEntry: feeding NDArray of shape "+o.shape+" does not match Tensor (id: "+n.tensor.id+") shape: "+n.tensor.shape+"."),r.set(n.tensor,o)})}function releaseFeedDictionaryInputsFromTensorArrayMap(e,r,t){Object.keys(e.dict).forEach(function(t){var o=e.dict[+t];if(!(o.data instanceof tensor_1.Tensor)){var n=o.data,a=r.get(o.tensor);n.disposeCopy(a)}r.delete(o.tensor)})}function removeFeedDictionaryNodesFromEvaluationSet(e,r){for(var t=0;t<r.length;){var o=r[t];null!=e.dict[o.output.id]?r.splice(t,1):++t}}function disposeAndInitializeOperationOutputs(e,r){e.forEach(function(e){graph_util.isInputNode(e)||(graph_util.isPassthroughNode(e,r)||r.disposeArray(e.output),r.set(e.output,null))})}function disposeAndInitializeOperationInputGradients(e,r){e.forEach(function(e){Object.keys(e.inputs).forEach(function(t){var o=e.inputs[t];r.get(o,!0)!==r.get(e.output,!0)&&r.disposeArray(o),r.nullify(o)})})}function disposeTransientOperationArrays(e,r,t){e.forEach(function(e){return e.disposeTransientArrays(r,t)})}function throwErrorIfEvaluationSetContainsPlaceholderNodes(e){e.forEach(function(e){if(e instanceof graph_1.PlaceholderNode){var r="["+e.output.shape.join(", ")+"]";throw new Error('Placeholder node "'+e.name+'" '+r+" not present in feed dictionary.")}})}exports.getTerminatingNodesFromFeedDictionary=getTerminatingNodesFromFeedDictionary,exports.getOrderedEvaluationSetFromEvalTensor=getOrderedEvaluationSetFromEvalTensor,exports.addPersistentArraysToTensorArrayMap=addPersistentArraysToTensorArrayMap,exports.getVariableNodesFromEvaluationSet=getVariableNodesFromEvaluationSet,exports.throwIfFeedDictionaryContainsNDArrays=throwIfFeedDictionaryContainsNDArrays,exports.loadInputsFromFeedDictionaryToTensorArrayMap=loadInputsFromFeedDictionaryToTensorArrayMap,exports.releaseFeedDictionaryInputsFromTensorArrayMap=releaseFeedDictionaryInputsFromTensorArrayMap,exports.removeFeedDictionaryNodesFromEvaluationSet=removeFeedDictionaryNodesFromEvaluationSet,exports.disposeAndInitializeOperationOutputs=disposeAndInitializeOperationOutputs,exports.disposeAndInitializeOperationInputGradients=disposeAndInitializeOperationInputGradients,exports.disposeTransientOperationArrays=disposeTransientOperationArrays,exports.throwErrorIfEvaluationSetContainsPlaceholderNodes=throwErrorIfEvaluationSetContainsPlaceholderNodes;

},{"../tensor":178,"../util":183,"./graph":71,"./graph_util":73}],98:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])};return function(r,i){function e(){this.constructor=r}t(r,i),r.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}}();Object.defineProperty(exports,"__esModule",{value:!0});var TensorArrayMapBase=function(){function t(){this.dict={}}return t.prototype.get=function(t,r){if(void 0===r&&(r=!1),!r&&void 0===this.dict[t.id])throw new Error("tensor "+t.id+" not in array map.");var i=this.dict[t.id];if(!r&&null===i)throw new Error("tensor "+t.id+" has null array.");return i},t.prototype.delete=function(t){delete this.dict[t.id]},t.prototype.nullify=function(t){this.dict[t.id]=null},t.prototype.disposeArray=function(t){if(void 0!==this.dict[t.id]){var r=this.dict[t.id];null!==r&&(r.dispose(),this.dict[t.id]=null)}},t.prototype.size=function(){return Object.keys(this.dict).length},t.prototype.dispose=function(){var t=this;Object.keys(this.dict).forEach(function(r){var i=t.dict[+r];i&&i.dispose()}),this.dict={}},t.prototype.hasNullArray=function(t){if(void 0===this.dict[t.id])throw new Error("tensor "+t.id+" not in array map.");return null===this.dict[t.id]},t}();exports.TensorArrayMapBase=TensorArrayMapBase;var TensorArrayMap=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.set=function(t,r){this.dict[t.id]=r},r}(TensorArrayMapBase);exports.TensorArrayMap=TensorArrayMap;var SummedTensorArrayMap=function(t){function r(r){var i=t.call(this)||this;return i.math=r,i}return __extends(r,t),r.prototype.add=function(t,r){if(null==this.dict[t.id])this.dict[t.id]=this.math.keep(r);else{var i=this.get(t),e=this.math.keep(this.math.addStrict(i,r));this.dict[t.id]=e,i.dispose()}},r}(TensorArrayMapBase);exports.SummedTensorArrayMap=SummedTensorArrayMap;

},{}],99:[function(require,module,exports){
"use strict";function __export(r){for(var e in r)exports.hasOwnProperty(e)||(exports[e]=r[e])}Object.defineProperty(exports,"__esModule",{value:!0});var browser_util_1=require("./browser_util"),contrib=require("./contrib");exports.contrib=contrib;var xhr_dataset=require("./data/xhr-dataset");exports.xhr_dataset=xhr_dataset;var environment=require("./environment");exports.environment=environment;var environment_1=require("./environment"),gpgpu_util=require("./kernels/webgl/gpgpu_util");exports.gpgpu_util=gpgpu_util;var webgl_util=require("./kernels/webgl/webgl_util");exports.webgl_util=webgl_util;var conv_util=require("./ops/conv_util");exports.conv_util=conv_util;var test_util=require("./test_util");exports.test_util=test_util;var util=require("./util");exports.util=util;var version_1=require("./version");exports.version=version_1.version;var checkpoint_loader_1=require("./data/checkpoint_loader");exports.CheckpointLoader=checkpoint_loader_1.CheckpointLoader;var dataset_1=require("./data/dataset");exports.InMemoryDataset=dataset_1.InMemoryDataset;var input_provider_1=require("./data/input_provider");exports.InCPUMemoryShuffledInputProviderBuilder=input_provider_1.InCPUMemoryShuffledInputProviderBuilder,exports.InGPUMemoryShuffledInputProviderBuilder=input_provider_1.InGPUMemoryShuffledInputProviderBuilder;var xhr_dataset_1=require("./data/xhr-dataset");exports.XhrDataset=xhr_dataset_1.XhrDataset;var environment_2=require("./environment");exports.ENV=environment_2.ENV,exports.Environment=environment_2.Environment;var graph_1=require("./graph/graph");exports.Graph=graph_1.Graph,exports.SymbolicTensor=graph_1.SymbolicTensor;var graph_runner_1=require("./graph/graph_runner");exports.GraphRunner=graph_runner_1.GraphRunner,exports.MetricReduction=graph_runner_1.MetricReduction;var initializers_1=require("./graph/initializers");exports.ConstantInitializer=initializers_1.ConstantInitializer,exports.OnesInitializer=initializers_1.OnesInitializer,exports.RandomNormalInitializer=initializers_1.RandomNormalInitializer,exports.RandomTruncatedNormalInitializer=initializers_1.RandomTruncatedNormalInitializer,exports.RandomUniformInitializer=initializers_1.RandomUniformInitializer,exports.TensorInitializer=initializers_1.TensorInitializer,exports.VarianceScalingInitializer=initializers_1.VarianceScalingInitializer,exports.ZerosInitializer=initializers_1.ZerosInitializer;var session_1=require("./graph/session");exports.CostReduction=session_1.CostReduction,exports.Session=session_1.Session;var backend_cpu_1=require("./kernels/backend_cpu");exports.MathBackendCPU=backend_cpu_1.MathBackendCPU,exports.NDArrayMathCPU=backend_cpu_1.NDArrayMathCPU;var backend_webgl_1=require("./kernels/backend_webgl");exports.MathBackendWebGL=backend_webgl_1.MathBackendWebGL,exports.NDArrayMathGPU=backend_webgl_1.NDArrayMathGPU;var matmul_1=require("./kernels/types/matmul");exports.MatrixOrientation=matmul_1.MatrixOrientation;var gpgpu_context_1=require("./kernels/webgl/gpgpu_context");exports.GPGPUContext=gpgpu_context_1.GPGPUContext;var math_1=require("./math");exports.NDArrayMath=math_1.NDArrayMath;var adadelta_optimizer_1=require("./optimizers/adadelta_optimizer");exports.AdadeltaOptimizer=adadelta_optimizer_1.AdadeltaOptimizer;var adagrad_optimizer_1=require("./optimizers/adagrad_optimizer");exports.AdagradOptimizer=adagrad_optimizer_1.AdagradOptimizer;var adam_optimizer_1=require("./optimizers/adam_optimizer");exports.AdamOptimizer=adam_optimizer_1.AdamOptimizer;var adamax_optimizer_1=require("./optimizers/adamax_optimizer");exports.AdamaxOptimizer=adamax_optimizer_1.AdamaxOptimizer;var momentum_optimizer_1=require("./optimizers/momentum_optimizer");exports.MomentumOptimizer=momentum_optimizer_1.MomentumOptimizer;var optimizer_1=require("./optimizers/optimizer");exports.Optimizer=optimizer_1.Optimizer;var rmsprop_optimizer_1=require("./optimizers/rmsprop_optimizer");exports.RMSPropOptimizer=rmsprop_optimizer_1.RMSPropOptimizer;var sgd_optimizer_1=require("./optimizers/sgd_optimizer");exports.SGDOptimizer=sgd_optimizer_1.SGDOptimizer;var tensor_1=require("./tensor");exports.Array1D=tensor_1.Array1D,exports.Array2D=tensor_1.Array2D,exports.Array3D=tensor_1.Array3D,exports.Array4D=tensor_1.Array4D,exports.NDArray=tensor_1.NDArray,exports.Scalar=tensor_1.Scalar,exports.Tensor=tensor_1.Tensor,exports.Tensor1D=tensor_1.Tensor1D,exports.Tensor2D=tensor_1.Tensor2D,exports.Tensor3D=tensor_1.Tensor3D,exports.Tensor4D=tensor_1.Tensor4D,exports.variable=tensor_1.variable,exports.Variable=tensor_1.Variable;var types_1=require("./types");exports.Rank=types_1.Rank,__export(require("./ops/ops")),__export(require("./train")),__export(require("./globals")),exports.setBackend=environment_1.Environment.setBackend,exports.getBackend=environment_1.Environment.getBackend,exports.memory=environment_1.Environment.memory,exports.nextFrame=browser_util_1.BrowserUtil.nextFrame;

},{"./browser_util":42,"./contrib":58,"./data/checkpoint_loader":59,"./data/dataset":60,"./data/input_provider":61,"./data/xhr-dataset":62,"./environment":66,"./globals":67,"./graph/graph":71,"./graph/graph_runner":72,"./graph/initializers":74,"./graph/session":96,"./kernels/backend_cpu":100,"./kernels/backend_webgl":101,"./kernels/types/matmul":103,"./kernels/webgl/gpgpu_context":115,"./kernels/webgl/gpgpu_util":117,"./kernels/webgl/webgl_util":136,"./math":137,"./ops/conv_util":147,"./ops/ops":155,"./optimizers/adadelta_optimizer":167,"./optimizers/adagrad_optimizer":168,"./optimizers/adam_optimizer":169,"./optimizers/adamax_optimizer":170,"./optimizers/momentum_optimizer":171,"./optimizers/optimizer":172,"./optimizers/rmsprop_optimizer":174,"./optimizers/sgd_optimizer":175,"./tensor":178,"./test_util":179,"./train":181,"./types":182,"./util":183,"./version":184}],100:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function a(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),__awaiter=this&&this.__awaiter||function(t,e,r,a){return new(r||(r=Promise))(function(o,n){function i(t){try{u(a.next(t))}catch(t){n(t)}}function s(t){try{u(a.throw(t))}catch(t){n(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(i,s)}u((a=a.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var r,a,o,n,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,a&&(o=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return i.label++,{value:n[1],done:!1};case 5:i.label++,a=n[1],n=[0];continue;case 7:n=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){i=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){i.label=n[1];break}if(6===n[0]&&i.label<o[1]){i.label=o[1],o=n;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(n);break}o[2]&&i.ops.pop(),i.trys.pop();continue}n=e.call(t,i)}catch(t){n=[6,t],a=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var seedrandom=require("seedrandom"),environment_1=require("../environment"),math_1=require("../math"),axis_util=require("../ops/axis_util"),broadcast_util=require("../ops/broadcast_util"),concat_util=require("../ops/concat_util"),ops=require("../ops/ops"),ops_1=require("../ops/ops"),selu_util=require("../ops/selu_util"),tensor_1=require("../tensor"),types=require("../types"),util=require("../util"),MathBackendCPU=function(){function t(){this.data=new WeakMap,"undefined"!=typeof document&&(this.canvas=document.createElement("canvas"))}return t.prototype.register=function(t,e,r){if(this.data.has(t))throw new Error("Data buffer is already registered");this.data.set(t,null)},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendCPU.write(): values can not be null");this.throwIfNoData(t),this.data.set(t,e)},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("MathBackendCPU.writePixels(): pixels can not be null");var r,a;if(t instanceof ImageData)r=t.data;else if(t instanceof HTMLCanvasElement)r=t.getContext("2d").getImageData(0,0,t.width,t.height).data;else{if(!(t instanceof HTMLImageElement||t instanceof HTMLVideoElement))throw new Error("pixels is of unknown type: "+t.constructor.name);if(null==this.canvas)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.canvas.width=t.width,this.canvas.height=t.height,this.canvas.getContext("2d").drawImage(t,0,0,t.width,t.height),r=this.canvas.getContext("2d").getImageData(0,0,t.width,t.height).data}if(4===e)a=new Int32Array(r);else{var o=t.width*t.height;a=new Int32Array(o*e);for(var n=0;n<o;n++)for(var i=0;i<e;++i)a[n*e+i]=r[4*n+i]}var s=[t.height,t.width,e];return ops_1.tensor3d(a,s,"int32")},t.prototype.read=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.readSync(t)]})})},t.prototype.readSync=function(t){return this.throwIfNoData(t),this.data.get(t)},t.prototype.disposeData=function(t){this.data.has(t)&&this.data.delete(t)},t.prototype.time=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){return e=performance.now(),t(),[2,{kernelMs:performance.now()-e}]})})},t.prototype.memory=function(){return{unreliable:!0}},t.prototype.throwIfNoData=function(t){if(!this.data.has(t))throw new Error("CPU backend: No data found for this tensor. Did you change your backend in the middle of the program? New backends can't use Tensors created with previous backends")},t.prototype.slice1D=function(t,e,r){var a=t.dataSync().slice(e,e+r);return ops.tensor1d(a,t.dtype)},t.prototype.slice2D=function(t,e,r){for(var a=ops.buffer(r,t.dtype),o=e[0],n=e[1],i=0;i<r[0];++i)for(var s=0;s<r[1];++s){var u=t.get(i+o,s+n);a.set(u,i,s)}return a.toTensor()},t.prototype.slice3D=function(t,e,r){for(var a=ops.buffer(r,t.dtype),o=e[0],n=e[1],i=e[2],s=0;s<r[0];++s)for(var u=0;u<r[1];++u)for(var p=0;p<r[2];++p){var h=t.get(s+o,u+n,p+i);a.set(h,s,u,p)}return a.toTensor()},t.prototype.slice4D=function(t,e,r){for(var a=ops.buffer(r,t.dtype),o=e[0],n=e[1],i=e[2],s=e[3],u=0;u<r[0];++u)for(var p=0;p<r[1];++p)for(var h=0;h<r[2];++h)for(var l=0;l<r[3];++l){var f=t.get(u+o,p+n,h+i,l+s);a.set(f,u,p,h,l)}return a.toTensor()},t.prototype.reverse4D=function(t,e){for(var r=ops.buffer(t.shape,t.dtype),a=function(r){return-1!==e.indexOf(r)&&1!==t.shape[r]},o=0;o<t.shape[0];++o)for(var n=0;n<t.shape[1];++n)for(var i=0;i<t.shape[2];++i)for(var s=0;s<t.shape[3];++s){var u=a(0)?t.shape[0]-o-1:o,p=a(1)?t.shape[1]-n-1:n,h=a(2)?t.shape[2]-i-1:i,l=a(3)?t.shape[3]-s-1:s,f=t.get(u,p,h,l);r.set(f,o,n,i,s)}return r.toTensor()},t.prototype.concat=function(t,e){var r=concat_util.computeOutShape(t.shape,e.shape,1),a=ops.buffer(r,t.dtype);if(1===t.shape[0]&&1===e.shape[0]){var o=t.dataSync(),n=e.dataSync(),i=a.values;return i.set(o,0),i.set(n,t.size),a.toTensor()}for(var s=0;s<r[0];++s){for(var u=0;u<t.shape[1];++u)a.set(t.get(s,u),s,u);for(u=0;u<e.shape[1];++u)a.set(e.get(s,u),s,u+t.shape[1])}return a.toTensor()},t.prototype.neg=function(t){return this.multiply(ops.scalar(-1),t)},t.prototype.add=function(t,e){return this.broadcastedBinaryOp(t,e,types.upcastType(t.dtype,e.dtype),function(t,e){return t+e})},t.prototype.subtract=function(t,e){return this.broadcastedBinaryOp(t,e,types.upcastType(t.dtype,e.dtype),function(t,e){return t-e})},t.prototype.pow=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.pow(t,e)})},t.prototype.matMul=function(t,e,r,a){for(var o=r?t.shape[0]:t.shape[1],n=r?t.shape[1]:t.shape[0],i=a?e.shape[0]:e.shape[1],s=function(t,e,r){return t.get(e,r)},u=function(t,e,r){return t.get(r,e)},p=r?u:s,h=a?u:s,l=new Float32Array(n*i),f=0,c=0;c<n;++c)for(var d=0;d<i;++d){for(var y=0,v=0;v<o;++v)y+=p(t,c,v)*h(e,v,d);l[f++]=y}return ops.tensor2d(l,[n,i])},t.prototype.multiply=function(t,e){return this.broadcastedBinaryOp(t,e,types.upcastType(t.dtype,e.dtype),function(t,e){return t*e})},t.prototype.divide=function(t,e){return this.broadcastedBinaryOp(t,e,"float32",function(t,e){return t/e})},t.prototype.sum=function(t,e){axis_util.assertAxesAreInnerMostDims("sum",e,t.rank);for(var r=axis_util.computeOutAndReduceShapes(t.shape,e),a=r[0],o=r[1],n=types.upcastType(t.dtype,"int32"),i=ops.zeros(a,n),s=util.sizeFromShape(o),u=i.dataSync(),p=t.dataSync(),h=0;h<u.length;++h){for(var l=h*s,f=0,c=0;c<s;++c)f+=p[l+c];u[h]=f}return i},t.prototype.argMin=function(t,e){axis_util.assertAxesAreInnerMostDims("argMin",e,t.rank);for(var r=axis_util.computeOutAndReduceShapes(t.shape,e),a=r[0],o=r[1],n=ops.zeros(a,"int32"),i=util.sizeFromShape(o),s=n.dataSync(),u=t.dataSync(),p=0;p<s.length;++p){for(var h=p*i,l=u[h],f=0,c=0;c<i;++c){var d=u[h+c];if(isNaN(d)){f=util.NAN_INT32;break}d<l&&(l=d,f=c)}s[p]=f}return n},t.prototype.argMax=function(t,e){axis_util.assertAxesAreInnerMostDims("argMax",e,t.rank);for(var r=axis_util.computeOutAndReduceShapes(t.shape,e),a=r[0],o=r[1],n=ops.zeros(a,"int32"),i=util.sizeFromShape(o),s=n.dataSync(),u=t.dataSync(),p=0;p<s.length;++p){for(var h=p*i,l=u[h],f=0,c=0;c<i;++c){var d=u[h+c];if(isNaN(d)){f=util.NAN_INT32;break}d>l&&(l=d,f=c)}s[p]=f}return n},t.prototype.equal=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return util.isValNaN(r,t.dtype)||util.isValNaN(a,e.dtype)?util.getNaN("bool"):r===a?1:0})},t.prototype.notEqual=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return util.isValNaN(r,t.dtype)||util.isValNaN(a,e.dtype)?util.getNaN("bool"):r!==a?1:0})},t.prototype.less=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return util.isValNaN(r,t.dtype)||util.isValNaN(a,e.dtype)?util.getNaN("bool"):r<a?1:0})},t.prototype.lessEqual=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return util.isValNaN(r,t.dtype)||util.isValNaN(a,e.dtype)?util.getNaN("bool"):r<=a?1:0})},t.prototype.greater=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return util.isValNaN(r,t.dtype)||util.isValNaN(a,e.dtype)?util.getNaN("bool"):r>a?1:0})},t.prototype.greaterEqual=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return util.isValNaN(r,t.dtype)||util.isValNaN(a,e.dtype)?util.getNaN("bool"):r>=a?1:0})},t.prototype.logicalNot=function(t){for(var e=t.dataSync(),r=new Int32Array(e.length),a=0;a<e.length;++a)util.isValNaN(e[a],t.dtype)?r[a]=util.getNaN("bool"):r[a]=e[a]?0:1;return tensor_1.Tensor.make(t.shape,{values:r},"bool")},t.prototype.logicalAnd=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return util.isValNaN(r,t.dtype)||util.isValNaN(a,e.dtype)?util.getNaN("bool"):r&&a})},t.prototype.logicalOr=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return util.isValNaN(r,t.dtype)||util.isValNaN(a,e.dtype)?util.getNaN("bool"):r||a})},t.prototype.logicalXor=function(t,e){return this.broadcastedBinaryOp(t,e,"bool",function(r,a){return util.isValNaN(r,t.dtype)||util.isValNaN(a,e.dtype)?util.getNaN("bool"):r^a})},t.prototype.where=function(t,e,r,a){for(var o=t.dataSync(),n=e.dataSync(),i=r.dataSync(),s=ops.zeros(e.shape,a),u=s.dataSync(),p=0,h=0===t.rank||t.rank>1||1===e.rank?1:e.shape[1],l=0;l<o.length;l++)for(var f=0;f<h;f++)1===o[l]?u[p++]=n[l]:u[p++]=i[l];return s},t.prototype.topKValues=function(t,e){return this.topK(t,e).values},t.prototype.topKIndices=function(t,e){return this.topK(t,e).indices},t.prototype.topK=function(t,e){for(var r=t.dataSync(),a=[],o=0;o<r.length;o++)a.push({value:r[o],index:o});a.sort(function(t,e){return e.value-t.value});var n=util.getTypedArrayFromDType(t.dtype,e),i=new Int32Array(e);for(o=0;o<e;o++)n[o]=a[o].value,i[o]=a[o].index;return{values:ops.tensor1d(n,t.dtype),indices:tensor_1.Tensor1D.new(i)}},t.prototype.min=function(t,e){axis_util.assertAxesAreInnerMostDims("min",e,t.rank);for(var r=axis_util.computeOutAndReduceShapes(t.shape,e),a=r[0],o=r[1],n=ops.zeros(a,t.dtype),i=util.sizeFromShape(o),s=n.dataSync(),u=t.dataSync(),p=0;p<s.length;++p){for(var h=p*i,l=u[0],f=0;f<i;++f){var c=u[h+f];if(isNaN(c)){l=Number.NaN;break}c<l&&(l=c)}s[p]=l}return n},t.prototype.minimum=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.min(t,e)})},t.prototype.max=function(t,e){axis_util.assertAxesAreInnerMostDims("max",e,t.rank);for(var r=axis_util.computeOutAndReduceShapes(t.shape,e),a=r[0],o=r[1],n=ops.zeros(a,t.dtype),i=util.sizeFromShape(o),s=n.dataSync(),u=t.dataSync(),p=0;p<s.length;++p){for(var h=p*i,l=u[h],f=0;f<i;++f){var c=u[h+f];if(isNaN(c)){l=Number.NaN;break}c>l&&(l=c)}s[p]=l}return n},t.prototype.maximum=function(t,e){return this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.max(t,e)})},t.prototype.ceil=function(t){for(var e=t.dataSync(),r=new Float32Array(e.length),a=0;a<e.length;++a)r[a]=Math.ceil(e[a]);return tensor_1.Tensor.make(t.shape,{values:r})},t.prototype.floor=function(t){for(var e=t.dataSync(),r=new Float32Array(e.length),a=0;a<e.length;++a)r[a]=Math.floor(e[a]);return tensor_1.Tensor.make(t.shape,{values:r})},t.prototype.exp=function(t){for(var e=t.dataSync(),r=new Float32Array(e.length),a=0;a<e.length;++a)r[a]=Math.exp(e[a]);return tensor_1.Tensor.make(t.shape,{values:r})},t.prototype.log=function(t){for(var e=t.dataSync(),r=new Float32Array(e.length),a=0;a<e.length;++a){var o=e[a];r[a]=Math.log(o)}return tensor_1.Tensor.make(t.shape,{values:r})},t.prototype.sqrt=function(t){for(var e=t.dataSync(),r=new Float32Array(e.length),a=0;a<e.length;++a){var o=e[a];r[a]=Math.sqrt(o)}return tensor_1.Tensor.make(t.shape,{values:r})},t.prototype.square=function(t){for(var e=t.dataSync(),r=new Float32Array(e.length),a=0;a<e.length;++a){var o=e[a];r[a]=o*o}return tensor_1.Tensor.make(t.shape,{values:r})},t.prototype.relu=function(t){for(var e=ops.zeros(t.shape,t.dtype),r=e.dataSync(),a=t.dataSync(),o=0;o<a.length;++o){var n=a[o];util.isValNaN(n,t.dtype)?r[o]=util.getNaN(e.dtype):r[o]=Math.max(0,a[o])}return e},t.prototype.elu=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a){var o=r[a];e[a]=o>=0?o:Math.exp(o)-1}return tensor_1.Tensor.make(t.shape,{values:e})},t.prototype.eluDer=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a){var o=r[a];e[a]=o>=0?1:Math.exp(o)}return tensor_1.Tensor.make(t.shape,{values:e})},t.prototype.selu=function(t){for(var e=selu_util.SELU_SCALEALPHA,r=selu_util.SELU_SCALE,a=new Float32Array(t.size),o=t.dataSync(),n=0;n<o.length;++n){var i=o[n];a[n]=i>=0?r*i:e*(Math.exp(i)-1)}return tensor_1.Tensor.make(t.shape,{values:a})},t.prototype.leakyRelu=function(t,e){for(var r=new Float32Array(t.size),a=t.dataSync(),o=0;o<a.length;o++){var n=a[o];r[o]=n>=0?n:e*n}return tensor_1.Tensor.make(t.shape,{values:r})},t.prototype.prelu=function(t,e){for(var r=new Float32Array(t.size),a=t.dataSync(),o=e.dataSync(),n=0;n<a.length;n++){var i=a[n];r[n]=i>=0?i:o[n]*i}return tensor_1.Tensor.make(t.shape,{values:r})},t.prototype.preluDer=function(t,e){for(var r=new Float32Array(t.size),a=t.dataSync(),o=e.dataSync(),n=0;n<a.length;n++){var i=a[n];r[n]=i>0?1:i<0?o[n]:i}return tensor_1.Tensor.make(t.shape,{values:r})},t.prototype.clip=function(t,e,r){for(var a=new Float32Array(t.size),o=t.dataSync(),n=0;n<o.length;++n)a[n]=Math.min(r,Math.max(e,o[n]));return tensor_1.Tensor.make(t.shape,{values:a})},t.prototype.abs=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.abs(r[a]);return tensor_1.Tensor.make(t.shape,{values:e})},t.prototype.int=function(t){for(var e=new Int32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=r[a];return tensor_1.Tensor.make(t.shape,{values:e},"int32")},t.prototype.sigmoid=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=1/(1+Math.exp(-r[a]));return tensor_1.Tensor.make(t.shape,{values:e})},t.prototype.sin=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.sin(r[a]);return tensor_1.Tensor.make(t.shape,{values:e})},t.prototype.cos=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.cos(r[a]);return tensor_1.Tensor.make(t.shape,{values:e})},t.prototype.tan=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.tan(r[a]);return tensor_1.Tensor.make(t.shape,{values:e})},t.prototype.asin=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.asin(r[a]);return tensor_1.Tensor.make(t.shape,{values:e})},t.prototype.acos=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.acos(r[a]);return tensor_1.Tensor.make(t.shape,{values:e})},t.prototype.atan=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.atan(r[a]);return tensor_1.Tensor.make(t.shape,{values:e})},t.prototype.sinh=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.sinh(r[a]);return tensor_1.Tensor.make(t.shape,{values:e})},t.prototype.cosh=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=Math.cosh(r[a]);return tensor_1.Tensor.make(t.shape,{values:e})},t.prototype.tanh=function(t){for(var e=new Float32Array(t.size),r=t.dataSync(),a=0;a<r.length;++a)e[a]=util.tanh(r[a]);return tensor_1.Tensor.make(t.shape,{values:e})},t.prototype.step=function(t,e){void 0===e&&(e=0);for(var r=new Float32Array(t.size),a=t.dataSync(),o=0;o<a.length;++o){var n=a[o];util.isValNaN(n,t.dtype)?r[o]=util.getNaN(t.dtype):r[o]=n>0?1:e}return tensor_1.Tensor.make(t.shape,{values:r})},t.prototype.conv2d=function(t,e,r){for(var a=r.filterHeight,o=r.filterWidth,n=r.padInfo.left,i=r.padInfo.top,s=ops.buffer(r.outShape,t.dtype),u=0;u<r.batchSize;++u)for(var p=0;p<r.outChannels;++p)for(var h=0;h<r.outHeight;++h)for(var l=h*r.strideHeight-n,f=Math.max(0,l),c=Math.min(r.inHeight,a+l),d=0;d<r.outWidth;++d){for(var y=d*r.strideWidth-i,v=Math.max(0,y),g=Math.min(r.inWidth,o+y),m=0,N=f;N<c;++N)for(var b=N-l,S=v;S<g;++S)for(var w=S-y,_=0;_<r.inChannels;++_){m+=t.get(u,N,S,_)*e.get(b,w,_,p)}s.set(m,u,h,d,p)}return s.toTensor()},t.prototype.conv2dDerInput=function(t,e,r){for(var a=r.filterHeight,o=r.filterWidth,n=a-1-r.padInfo.top,i=o-1-r.padInfo.left,s=r.strideHeight,u=r.strideWidth,p=ops.buffer(r.inShape,"float32"),h=0;h<r.batchSize;++h)for(var l=0;l<r.inChannels;++l)for(var f=0;f<r.inHeight;++f)for(var c=f-i,d=Math.max(0,Math.ceil(c/s)),y=Math.min(r.outHeight,(a+c)/s),v=0;v<r.inWidth;++v){for(var g=v-n,m=Math.max(0,Math.ceil(g/u)),N=Math.min(r.outWidth,(o+g)/u),b=0,S=d;S<y;++S)for(var w=S*s-c,_=m;_<N;++_)for(var M=_*u-g,x=0;x<r.outChannels;++x){b+=t.get(h,S,_,x)*e.get(a-1-w,o-1-M,l,x)}p.set(b,h,f,v,l)}return p.toTensor()},t.prototype.conv2dDerFilter=function(t,e,r){for(var a=r.strideHeight,o=r.strideWidth,n=r.filterHeight,i=r.filterWidth,s=ops.buffer(r.filterShape,"float32"),u=r.padInfo.left,p=r.padInfo.top,h=0;h<n;++h)for(var l=Math.max(0,Math.ceil((p-h)/a)),f=Math.min(r.outHeight,(r.inHeight+p-h)/a),c=0;c<i;++c)for(var d=Math.max(0,Math.ceil((u-c)/o)),y=Math.min(r.outWidth,(r.inWidth+u-c)/o),v=0;v<r.inChannels;++v)for(var g=0;g<r.outChannels;++g){for(var m=0,N=0;N<r.batchSize;++N)for(var b=l;b<f;++b)for(var S=h+b*a-p,w=d;w<y;++w){var _=c+w*o-u;m+=t.get(N,S,_,v)*e.get(N,b,w,g)}s.set(m,h,c,v,g)}return s.toTensor()},t.prototype.depthwiseConv2D=function(t,e,r){for(var a=r.filterHeight,o=r.filterWidth,n=r.padInfo.left,i=r.padInfo.top,s=r.outChannels/r.inChannels,u=ops.buffer(r.outShape,t.dtype),p=0;p<r.batchSize;++p)for(var h=0;h<r.inChannels;++h)for(var l=0;l<r.outHeight;++l)for(var f=l*r.strideHeight-n,c=Math.max(0,f),d=Math.min(r.inHeight,a+f),y=0;y<r.outWidth;++y)for(var v=y*r.strideWidth-i,g=Math.max(0,v),m=Math.min(r.inWidth,o+v),N=0;N<s;++N){for(var b=0,S=c;S<d;++S)for(var w=S-f,_=g;_<m;++_){var M=_-v;b+=t.get(p,S,_,h)*e.get(w,M,h,N)}u.set(b,p,l,y,h*s+N)}return u.toTensor()},t.prototype.tile=function(t,e){for(var r=new Array(t.rank),a=0;a<r.length;a++)r[a]=t.shape[a]*e[a];var o=ops.buffer(r,t.dtype),n=t.dataSync();for(a=0;a<o.values.length;++a){for(var i=o.indexToLoc(a),s=new Array(t.rank),u=0;u<s.length;u++)s[u]=i[u]%t.shape[u];var p=t.locToIndex(s);o.values[a]=n[p]}return o.toTensor()},t.prototype.pad1D=function(t,e,r){for(var a=e[0],o=e[1],n=t.dataSync(),i=ops.zeros([a+n.length+o],t.dtype),s=i.dataSync(),u=0,p=0;p<s.length;p++)p>=a&&p<a+n.length?s[p]=n[u++]:s[p]=r;return i},t.prototype.pad2D=function(t,e,r){for(var a=e[0][0],o=e[0][1],n=e[1][0],i=e[1][1],s=[a+t.shape[0]+o,n+t.shape[1]+i],u=ops.zeros(s,t.dtype),p=u.dataSync(),h=t.dataSync(),l=0,f=0;f<s[0];f++){var c=-1,d=-1;f>=a&&f<s[0]-o&&(d=(c=f*s[1]+n)+t.shape[1]-1);for(var y=0;y<s[1];y++){var v=f*s[1]+y;p[v]=v>=c&&v<=d?h[l++]:r}}return u},t.prototype.transpose=function(t,e){for(var r=new Array(t.rank),a=0;a<r.length;a++)r[a]=t.shape[e[a]];var o=new Float32Array(t.size),n=t.dataSync(),i=tensor_1.Tensor.make(r,{values:o});for(a=0;a<t.size;++a){for(var s=t.indexToLoc(a),u=new Array(s.length),p=0;p<u.length;p++)u[p]=s[e[p]];o[i.locToIndex(u)]=n[a]}return i},t.prototype.gather=function(t,e,r){var a=t.shape.slice(),o=e.dataSync();a[r]=o.length;for(var n=ops.zeros(a,t.dtype),i=t.dataSync(),s=n.dataSync(),u=0;u<n.size;++u){var p=n.indexToLoc(u),h=p.slice();h[r]=o[p[r]];var l=t.locToIndex(h);s[u]=i[l]}return n},t.prototype.pool=function(t,e,r){for(var a=e.strideHeight,o=e.strideWidth,n=e.filterHeight,i=e.filterWidth,s=ops.buffer(e.outShape,"float32"),u=e.padInfo.top,p=e.padInfo.left,h=0;h<e.batchSize;++h)for(var l=0;l<e.inChannels;++l)for(var f=0;f<e.outHeight;++f)for(var c=f*a-u,d=Math.max(0,c),y=Math.min(e.inHeight,n+c),v=0;v<e.outWidth;++v){for(var g=v*o-p,m=Math.max(0,g),N=Math.min(e.inWidth,i+g),b="max"===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,S=0,w=d;w<y;++w){for(var _=m;_<N;++_){var M=t.get(h,w,_,l);if(isNaN(M)){b=NaN,S=NaN;break}"max"===r&&M>b||"min"===r&&M<b?b=M:"avg"===r&&(S+=M/(n*i))}if(isNaN(b))break}s.set("avg"===r?S:b,h,f,v,l)}return s.toTensor()},t.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},t.prototype.maxPoolPositions=function(t,e){for(var r=ops.buffer(e.outShape,"int32"),a=e.strideHeight,o=e.strideWidth,n=e.filterHeight,i=e.filterWidth,s=e.padInfo.top,u=e.padInfo.left,p=0;p<e.batchSize;++p)for(var h=0;h<e.inChannels;++h)for(var l=0;l<e.outHeight;++l)for(var f=l*a-s,c=Math.max(0,f),d=Math.min(e.inHeight,n+f),y=0;y<e.outWidth;++y){for(var v=y*o-u,g=Math.max(0,v),m=Math.min(e.inWidth,i+v),N=Number.NEGATIVE_INFINITY,b=-1,S=c;S<d;++S)for(var w=S-f,_=g;_<m;++_){var M=_-v,x=t.get(p,S,_,h);x>N&&(N=x,b=w*i+M)}r.set(b,p,l,y,h)}return r.toTensor()},t.prototype.maxPoolBackprop=function(t,e,r){for(var a=this.maxPoolPositions(e,r),o=r.strideHeight,n=r.strideWidth,i=r.filterHeight,s=r.filterWidth,u=s-1-r.padInfo.left,p=i-1-r.padInfo.top,h=ops.buffer(e.shape,"float32"),l=0;l<r.batchSize;++l)for(var f=0;f<r.inChannels;++f)for(var c=0;c<r.inHeight;++c)for(var d=0;d<r.inWidth;++d){for(var y=c-p,v=d-u,g=0,m=0;m<i;++m){var N=(y+m)/o;if(!(N<0||N>=r.outHeight||Math.floor(N)!==N))for(var b=0;b<s;++b){var S=(v+b)/n;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S)){var w=i*s-1-a.get(l,N,S,f)===m*s+b?1:0;if(0!==w)g+=t.get(l,N,S,f)*w}}}h.set(g,l,c,d,f)}return h.toTensor()},t.prototype.avgPoolBackprop=function(t,e,r){for(var a=r.strideHeight,o=r.strideWidth,n=r.filterHeight,i=r.filterWidth,s=i-1-r.padInfo.left,u=n-1-r.padInfo.top,p=ops.buffer(e.shape,"float32"),h=1/(n*i),l=0;l<r.batchSize;++l)for(var f=0;f<r.inChannels;++f)for(var c=0;c<r.inHeight;++c)for(var d=0;d<r.inWidth;++d){for(var y=c-u,v=d-s,g=0,m=0;m<n;++m){var N=(y+m)/a;if(!(N<0||N>=r.outHeight||Math.floor(N)!==N))for(var b=0;b<i;++b){var S=(v+b)/o;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S))g+=t.get(l,N,S,f)}}p.set(g*h,l,c,d,f)}return p.toTensor()},t.prototype.minPool=function(t,e){return this.pool(t,e,"min")},t.prototype.avgPool=function(t,e){return this.pool(t,e,"avg").toFloat()},t.prototype.resizeBilinear=function(t,e,r,a){for(var o=t.shape,n=o[0],i=o[1],s=o[2],u=o[3],p=ops.buffer([n,e,r,u],t.dtype),h=a?[i-1,s-1]:[i,s],l=a?[e-1,r-1]:[e,r],f=0;f<n;f++)for(var c=0;c<e;c++)for(var d=0;d<r;d++)for(var y=0;y<u;y++){var v=h[0]*c/l[0],g=h[1]*d/l[1],m=Math.floor(v),N=Math.min(i-1,Math.ceil(v)),b=Math.floor(g),S=Math.min(s-1,Math.ceil(g)),w=t.get(f,m,b,y),_=t.get(f,N,b,y),M=g-b,x=w+(t.get(f,m,S,y)-w)*M,T=x+(_+(t.get(f,N,S,y)-_)*M-x)*(v-m);p.set(T,f,c,d,y)}return p.toTensor()},t.prototype.batchNormalization4D=function(t,e,r,a,o,n){for(var i=t.dataSync(),s=e.dataSync(),u=r.dataSync(),p=o?o.dataSync():new Float32Array([1]),h=n?n.dataSync():new Float32Array([0]),l=new Float32Array(i.length),f=0;f<i.length;f++)l[f]=h[f%h.length]+(i[f]-s[f%s.length])*p[f%p.length]/Math.sqrt(u[f%u.length]+a);return ops_1.tensor4d(l,t.shape)},t.prototype.localResponseNormalization4D=function(t,e,r,a,o,n){for(var i=ops.buffer(t.shape,"float32"),s=e,u=i.shape[1]-1,p=i.shape[2]-1,h=i.shape[3]-1,l=function(e,r,a,o){for(var n=0,i=Math.max(0,o-s);i<=Math.min(o+s,h);i++){var u=t.get(e,r,a,i);n+=u*u}return n},f=function(e,r,a,o){for(var n=0,i=Math.max(0,r-s);i<=Math.min(r+s,u);i++)for(var h=Math.max(0,a-s);h<=Math.min(a+s,p);h++)n+=Math.pow(t.get(e,i,h,o),2);return n},c=0;c<i.shape[0];c++)for(var d=0;d<=i.shape[1];d++)for(var y=0;y<i.shape[2];y++)for(var v=0;v<i.shape[3];v++){var g="withinChannel"===n?f(c,d,y,v):l(c,d,y,v),m=t.get(c,d,y,v)*Math.pow(r+a*g,-o);i.set(m,c,d,y,v)}return i.toTensor()},t.prototype.multinomial=function(t,e,r){for(var a=t.shape[0],o=t.shape[1],n=ops.zeros([a,e],"int32"),i=n.dataSync(),s=t.dataSync(),u=0;u<a;++u){var p=u*o,h=new Float32Array(o-1);h[0]=s[p];for(var l=1;l<h.length;++l)h[l]=h[l-1]+s[p+l];for(var f=seedrandom.alea(r.toString()),c=u*e,d=0;d<e;++d){var y=f();i[c+d]=h.length;for(var v=0;v<h.length;v++)if(y<h[v]){i[c+d]=v;break}}}return n},t.prototype.oneHot=function(t,e,r,a){var o=new Float32Array(t.size*e);o.fill(a);for(var n=0;n<t.size;++n)o[n*e+t.get(n)]=r;return ops.tensor2d(o,[t.size,e])},t.prototype.broadcastedBinaryOp=function(t,e,r,a){for(var o=broadcast_util.assertAndGetBroadcastShape(t.shape,e.shape),n=ops.buffer(o,r),i=t.dataSync(),s=e.dataSync(),u=broadcast_util.getBroadcastDims(t.shape,o),p=broadcast_util.getBroadcastDims(e.shape,o),h=function(r){var o=n.indexToLoc(r),h=o.slice(-t.rank);u.forEach(function(t){return h[t]=0});var l=t.locToIndex(h),f=o.slice(-e.rank);p.forEach(function(t){return f[t]=0});var c=e.locToIndex(f);n.values[r]=a(i[l],s[c])},l=0;l<n.values.length;++l)h(l);return n.toTensor()},t.prototype.dispose=function(){},t}();exports.MathBackendCPU=MathBackendCPU,environment_1.ENV.registerBackend("cpu",function(){return new MathBackendCPU});var NDArrayMathCPU=function(t){function e(e){void 0===e&&(e=!1);return console.warn("new NDArrayMathCPU() is deprecated. Please use dl.setBackend('cpu')."),t.call(this,"cpu",e)||this}return __extends(e,t),e}(math_1.NDArrayMath);exports.NDArrayMathCPU=NDArrayMathCPU;

},{"../environment":66,"../math":137,"../ops/axis_util":139,"../ops/broadcast_util":142,"../ops/concat_util":145,"../ops/ops":155,"../ops/selu_util":161,"../tensor":178,"../types":182,"../util":183,"seedrandom":186}],101:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(a,o){function p(e){try{i(n.next(e))}catch(e){o(e)}}function u(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(p,u)}i((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,a,o,p={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;p;)try{if(r=1,n&&(a=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return p.label++,{value:o[1],done:!1};case 5:p.label++,n=o[1],o=[0];continue;case 7:o=p.ops.pop(),p.trys.pop();continue;default:if(!(a=(a=p.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){p=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){p.label=o[1];break}if(6===o[0]&&p.label<a[1]){p.label=a[1],a=o;break}if(a&&p.label<a[2]){p.label=a[2],p.ops.push(o);break}a[2]&&p.ops.pop(),p.trys.pop();continue}o=t.call(e,p)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),math_1=require("../math"),axis_util=require("../ops/axis_util"),reduce_util=require("../ops/reduce_util"),tensor_1=require("../tensor"),types=require("../types"),util=require("../util"),argminmax_gpu_1=require("./webgl/argminmax_gpu"),avg_pool_backprop_gpu_1=require("./webgl/avg_pool_backprop_gpu"),batchnorm_gpu_1=require("./webgl/batchnorm_gpu"),binaryop_gpu=require("./webgl/binaryop_gpu"),binaryop_gpu_1=require("./webgl/binaryop_gpu"),clip_gpu_1=require("./webgl/clip_gpu"),concat_gpu_1=require("./webgl/concat_gpu"),conv_backprop_gpu_1=require("./webgl/conv_backprop_gpu"),conv_gpu_1=require("./webgl/conv_gpu"),conv_gpu_depthwise_1=require("./webgl/conv_gpu_depthwise"),from_pixels_gpu_1=require("./webgl/from_pixels_gpu"),gather_gpu_1=require("./webgl/gather_gpu"),gpgpu_context_1=require("./webgl/gpgpu_context"),gpgpu_math=require("./webgl/gpgpu_math"),logical_gpu_1=require("./webgl/logical_gpu"),lrn_gpu_1=require("./webgl/lrn_gpu"),max_pool_backprop_gpu_1=require("./webgl/max_pool_backprop_gpu"),mulmat_gpu_1=require("./webgl/mulmat_gpu"),multinomial_gpu_1=require("./webgl/multinomial_gpu"),onehot_gpu_1=require("./webgl/onehot_gpu"),pad_gpu_1=require("./webgl/pad_gpu"),pool_gpu_1=require("./webgl/pool_gpu"),reduce_gpu_1=require("./webgl/reduce_gpu"),resize_bilinear_gpu_1=require("./webgl/resize_bilinear_gpu"),reverse_gpu_1=require("./webgl/reverse_gpu"),slice_gpu_1=require("./webgl/slice_gpu"),tex_util_1=require("./webgl/tex_util"),texture_manager_1=require("./webgl/texture_manager"),tile_gpu_1=require("./webgl/tile_gpu"),transpose_gpu_1=require("./webgl/transpose_gpu"),unary_op=require("./webgl/unaryop_gpu"),unaryop_gpu_1=require("./webgl/unaryop_gpu"),webgl_util=require("./webgl/webgl_util"),MathBackendWebGL=function(){function e(e,t){if(void 0===t&&(t=!0),this.gpgpu=e,this.delayedStorage=t,this.texData=new WeakMap,this.uploadWaitMs=0,this.downloadWaitMs=0,this.binaryCache={},this.disposed=!1,environment_1.ENV.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");null==e?(this.gpgpu=new gpgpu_context_1.GPGPUContext,this.gpgpuCreatedLocally=!0):this.gpgpuCreatedLocally=!1,"undefined"!=typeof document&&(this.canvas=document.createElement("canvas")),this.textureManager=new texture_manager_1.TextureManager(this.gpgpu)}return e.prototype.register=function(e,t,r){if(this.texData.has(e))throw new Error("Data buffer is already registered");this.texData.set(e,{shape:t,dtype:r,values:null,texture:null,texShape:null,texType:tex_util_1.TextureType.FLOAT})},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("MathBackendWebGL.writePixels(): pixels can not be null");var r=[e.height,e.width],n=[e.height,e.width,t];if(e instanceof HTMLVideoElement){if(null==this.canvas)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.canvas.width=e.width,this.canvas.height=e.height,this.canvas.getContext("2d").drawImage(e,0,0,e.width,e.height),e=this.canvas}var a=tensor_1.Tensor.make(r,{},"int32");this.texData.get(a.dataId).texType=tex_util_1.TextureType.UNSIGNED_BYTE,this.gpgpu.uploadPixelDataToTexture(this.getTexture(a.dataId),e);var o=new from_pixels_gpu_1.FromPixelsProgram(n),p=this.compileAndRun(o,[a]);return a.dispose(),p},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendWebGL.write(): values can not be null");this.throwIfNoData(e);var r=this.texData.get(e),n=r.texture,a=r.texShape,o=r.texType;null!=n&&(this.textureManager.releaseTexture(n,a,o),r.texture=null,r.texShape=null),r.values=t,this.delayedStorage||this.uploadToGPU(e)},e.prototype.readSync=function(e){this.throwIfNoData(e);var t=this.texData.get(e),r=t.texture,n=t.values,a=t.texShape;if(null!=n)return this.cacheOnCPU(e),n;var o,p=null!=this.activeTimers;p&&(o=performance.now());var u=this.gpgpu.downloadMatrixFromTexture(r,a[0],a[1]);return p&&(this.downloadWaitMs+=performance.now()-o),this.cacheOnCPU(e,u),t.values},e.prototype.read=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,a,o;return __generator(this,function(p){switch(p.label){case 0:return this.throwIfNoData(e),t=this.texData.get(e),r=t.texture,n=t.values,a=t.texShape,null!=n?(this.cacheOnCPU(e),[2,n]):environment_1.ENV.get("WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED")?[4,this.gpgpu.downloadMatrixFromTextureAsync(r,a[0],a[1])]:[3,2];case 1:return o=p.sent(),this.cacheOnCPU(e,o),[2,t.values];case 2:return 0===environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?[2,this.readSync(e)]:[4,this.gpgpu.runQuery(function(){})];case 3:return p.sent(),[2,this.readSync(e)]}})})},e.prototype.time=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,a,o,p;return __generator(this,function(u){switch(u.label){case 0:return t=this.activeTimers,r=[],n=!1,null==this.programTimersStack?(this.programTimersStack=r,n=!0):this.activeTimers.push(r),this.activeTimers=r,e(),a=util.flatten(this.activeTimers),this.activeTimers=t,n&&(this.programTimersStack=null),[4,Promise.all(a).then(function(e){var t=0;return e.forEach(function(e){return t+=e}),t})];case 1:return o=u.sent(),p={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:o,wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,p]}})})},e.prototype.memory=function(){return{unreliable:!1}},e.prototype.startTimer=function(){return environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},e.prototype.endTimer=function(e){return environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=performance.now(),e)},e.prototype.getQueryTime=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){return environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.pollQueryTime(e)]:[2,(t=e).endMs-t.startMs]})})},e.prototype.disposeData=function(e){if(this.texData.has(e)){var t=this.texData.get(e),r=t.texture,n=t.texShape,a=t.texType;null!=r&&this.textureManager.releaseTexture(r,n,a),this.texData.delete(e)}},e.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},e.prototype.getTextureData=function(e){return this.uploadToGPU(e),this.texData.get(e)},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.slice1D=function(e,t,r){var n=new slice_gpu_1.SliceProgram([r]),a=n.getCustomSetupFunc([t]);return this.compileAndRun(n,[e],null,a)},e.prototype.slice2D=function(e,t,r){var n=new slice_gpu_1.SliceProgram(r),a=n.getCustomSetupFunc(t);return this.compileAndRun(n,[e],null,a)},e.prototype.slice3D=function(e,t,r){var n=new slice_gpu_1.SliceProgram(r),a=n.getCustomSetupFunc(t);return this.compileAndRun(n,[e],null,a)},e.prototype.slice4D=function(e,t,r){var n=new slice_gpu_1.SliceProgram(r),a=n.getCustomSetupFunc(t);return this.compileAndRun(n,[e],null,a)},e.prototype.reverse4D=function(e,t){var r=new reverse_gpu_1.ReverseProgram(e.shape,t);return this.compileAndRun(r,[e])},e.prototype.concat=function(e,t){var r=new concat_gpu_1.ConcatProgram(e.shape,t.shape);return this.compileAndRun(r,[e,t])},e.prototype.neg=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.NEG);return this.compileAndRun(t,[e])},e.prototype.matMul=function(e,t,r,n){var a=new mulmat_gpu_1.MatMulProgram(e.shape,t.shape,r,n);return this.compileAndRun(a,[e,t])},e.prototype.multiply=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MUL,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,types.upcastType(e.dtype,t.dtype));return this.compileAndRun(r,[e,t],n)},e.prototype.batchNormalization4D=function(e,t,r,n,a,o){var p=[e,t,r],u=null;null!=o&&(u=o.shape,p.push(o));var i=null;null!=a&&(i=a.shape,p.push(a));var s=new batchnorm_gpu_1.BatchNormProgram(e.shape,t.shape,r.shape,u,i,n);return this.compileAndRun(s,p)},e.prototype.localResponseNormalization4D=function(e,t,r,n,a,o){var p=new lrn_gpu_1.LRNProgram(e.shape,t,r,n,a,o);return this.compileAndRun(p,[e])},e.prototype.tile=function(e,t){var r=new tile_gpu_1.TileProgram(e.shape,t);return this.compileAndRun(r,[e])},e.prototype.pad1D=function(e,t,r){var n=new pad_gpu_1.Pad1DProgram(e.shape,t,r);return this.compileAndRun(n,[e])},e.prototype.pad2D=function(e,t,r){var n=new pad_gpu_1.Pad2DProgram(e.shape,t,r);return this.compileAndRun(n,[e])},e.prototype.transpose=function(e,t){var r=new transpose_gpu_1.TransposeProgram(e.shape,t);return this.compileAndRun(r,[e])},e.prototype.gather=function(e,t,r){var n=new gather_gpu_1.GatherProgram(e.shape,t.size,r);return this.compileAndRun(n,[e,t])},e.prototype.reduce=function(e,t,r){var n=e.shape[0],a=e.shape[1],o={windowSize:reduce_util.computeOptimalWindowSize(a),inSize:a,batchSize:n},p=new reduce_gpu_1.ReduceProgram(o,t),u=p.outputShape,i=u[0],s=u[1],h=this.makeOutputArray([i,s],r);return this.compileAndRun(p,[e],h),1===h.shape[1]?h:this.reduce(h,t,r)},e.prototype.argReduce=function(e,t,r){void 0===r&&(r=null);var n=e.shape[0],a=e.shape[1];null!=r&&(n=r.shape[0],a=r.shape[1]);var o={windowSize:reduce_util.computeOptimalWindowSize(a),inSize:a,batchSize:n},p=new argminmax_gpu_1.ArgMinMaxProgram(o,t,null==r),u=p.outputShape,i=u[0],s=u[1],h=this.makeOutputArray([i,s],"int32"),l=[e];return null!=r&&l.push(r),this.compileAndRun(p,l,h),1===h.shape[1]?h:this.argReduce(e,t,h)},e.prototype.sum=function(e,t){axis_util.assertAxesAreInnerMostDims("sum",t,e.rank);var r=axis_util.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],o=util.sizeFromShape(a),p=e.as2D(-1,o),u=types.sumOutType(e.dtype);return this.reduce(p,"sum",u).reshape(n)},e.prototype.argMin=function(e,t){axis_util.assertAxesAreInnerMostDims("argMin",t,e.rank);var r=axis_util.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],o=util.sizeFromShape(a),p=e.as2D(-1,o);return this.argReduce(p,"min").reshape(n)},e.prototype.argMax=function(e,t){axis_util.assertAxesAreInnerMostDims("argMax",t,e.rank);var r=axis_util.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],o=util.sizeFromShape(a),p=e.as2D(-1,o);return this.argReduce(p,"max").reshape(n)},e.prototype.equal=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.EQUAL,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.notEqual=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.NOT_EQUAL,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.less=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LESS,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.lessEqual=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LESS_EQUAL,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.greater=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.GREATER,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.greaterEqual=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.GREATER_EQUAL,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.logicalNot=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.LOGICAL_NOT);return this.compileAndRun(t,[e])},e.prototype.logicalAnd=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LOGICAL_AND,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.logicalOr=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LOGICAL_OR,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.logicalXor=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LOGICAL_XOR,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],n)},e.prototype.where=function(e,t,r,n){var a=new logical_gpu_1.WhereProgram(e.rank,t.shape,t.rank),o=this.makeOutputArray(a.outputShape,n);return this.compileAndRun(a,[e,t,r],o)},e.prototype.topKValues=function(e,t){throw new Error("topKValues GPU not yet implemented!")},e.prototype.topKIndices=function(e,t){throw new Error("topKIndices GPU not yet implemented!")},e.prototype.min=function(e,t){axis_util.assertAxesAreInnerMostDims("min",t,e.rank);var r=axis_util.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],o=util.sizeFromShape(a),p=e.as2D(-1,o);return this.reduce(p,"min",p.dtype).reshape(n)},e.prototype.minimum=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MIN,e.shape,t.shape);return this.compileAndRun(r,[e,t])},e.prototype.max=function(e,t){axis_util.assertAxesAreInnerMostDims("max",t,e.rank);var r=axis_util.computeOutAndReduceShapes(e.shape,t),n=r[0],a=r[1],o=util.sizeFromShape(a),p=e.as2D(-1,o);return this.reduce(p,"max",p.dtype).reshape(n)},e.prototype.maximum=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MAX,e.shape,t.shape);return this.compileAndRun(r,[e,t])},e.prototype.divide=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.DIV,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e,t],n)},e.prototype.add=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.ADD,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,types.upcastType(e.dtype,t.dtype));return this.compileAndRun(r,[e,t],n)},e.prototype.subtract=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.SUB,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,types.upcastType(e.dtype,t.dtype));return this.compileAndRun(r,[e,t],n)},e.prototype.pow=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.POW,e.shape,t.shape),n=this.makeOutputArray(r.outputShape,types.upcastType(e.dtype,t.dtype));return this.compileAndRun(r,[e,t],n)},e.prototype.ceil=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.CEIL);return this.compileAndRun(t,[e])},e.prototype.floor=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.FLOOR);return this.compileAndRun(t,[e])},e.prototype.exp=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.EXP);return this.compileAndRun(t,[e])},e.prototype.log=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.LOG);return this.compileAndRun(t,[e])},e.prototype.sqrt=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.SQRT);return this.compileAndRun(t,[e])},e.prototype.square=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.SQUARE);return this.compileAndRun(t,[e])},e.prototype.relu=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.RELU);return this.compileAndRun(t,[e])},e.prototype.elu=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ELU);return this.compileAndRun(t,[e])},e.prototype.eluDer=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ELU_DER);return this.compileAndRun(t,[e])},e.prototype.selu=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.SELU);return this.compileAndRun(t,[e])},e.prototype.leakyRelu=function(e,t){var r=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.LEAKY_RELU(t));return this.compileAndRun(r,[e])},e.prototype.prelu=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.PRELU,e.shape,t.shape);return this.compileAndRun(r,[e,t])},e.prototype.preluDer=function(e,t){var r=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.PRELU_DER,e.shape,t.shape);return this.compileAndRun(r,[e,t])},e.prototype.int=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.TO_INT),r=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[e],r)},e.prototype.clip=function(e,t,r){var n=new clip_gpu_1.ClipProgram(e.shape,t,r);return this.compileAndRun(n,[e])},e.prototype.abs=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ABS);return this.compileAndRun(t,[e])},e.prototype.sigmoid=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.SIGMOID);return this.compileAndRun(t,[e])},e.prototype.sin=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.SIN);return this.compileAndRun(t,[e])},e.prototype.cos=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.COS);return this.compileAndRun(t,[e])},e.prototype.tan=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.TAN);return this.compileAndRun(t,[e])},e.prototype.asin=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ASIN);return this.compileAndRun(t,[e])},e.prototype.acos=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ACOS);return this.compileAndRun(t,[e])},e.prototype.atan=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.ATAN);return this.compileAndRun(t,[e])},e.prototype.sinh=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.SINH);return this.compileAndRun(t,[e])},e.prototype.cosh=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.COSH);return this.compileAndRun(t,[e])},e.prototype.tanh=function(e){var t=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.TANH);return this.compileAndRun(t,[e])},e.prototype.step=function(e,t){var r=new unaryop_gpu_1.UnaryOpProgram(e.shape,unary_op.STEP(t));return this.compileAndRun(r,[e])},e.prototype.conv2d=function(e,t,r){var n=new conv_gpu_1.Conv2DProgram(r);return this.compileAndRun(n,[e,t])},e.prototype.conv2dDerInput=function(e,t,r){var n=new conv_backprop_gpu_1.Conv2DDerInputProgram(r);return this.compileAndRun(n,[e,t])},e.prototype.conv2dDerFilter=function(e,t,r){var n=new conv_backprop_gpu_1.Conv2DDerFilterProgram(r);return this.compileAndRun(n,[e,t])},e.prototype.depthwiseConv2D=function(e,t,r){var n=new conv_gpu_depthwise_1.DepthwiseConv2DProgram(r);return this.compileAndRun(n,[e,t])},e.prototype.maxPool=function(e,t){var r=new pool_gpu_1.Pool2DProgram(t,"max",!1),n=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[e],n)},e.prototype.minPool=function(e,t){var r=new pool_gpu_1.Pool2DProgram(t,"min",!1),n=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[e],n)},e.prototype.avgPool=function(e,t){var r=new pool_gpu_1.Pool2DProgram(t,"avg",!1),n=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e],n)},e.prototype.maxPoolBackprop=function(e,t,r){var n=new pool_gpu_1.Pool2DProgram(r,"max",!0),a=this.compileAndRun(n,[t]),o=new max_pool_backprop_gpu_1.MaxPool2DBackpropProgram(r),p=this.makeOutputArray(o.outputShape,t.dtype),u=this.compileAndRun(o,[e,a],p);return a.dispose(),u},e.prototype.avgPoolBackprop=function(e,t,r){var n=new avg_pool_backprop_gpu_1.AvgPool2DBackpropProgram(r),a=this.makeOutputArray(n.outputShape,t.dtype);return this.compileAndRun(n,[e],a)},e.prototype.resizeBilinear=function(e,t,r,n){var a=new resize_bilinear_gpu_1.ResizeBilinearProgram(e.shape,t,r,n);return this.compileAndRun(a,[e])},e.prototype.multinomial=function(e,t,r){var n=e.shape[0],a=e.shape[1],o=new multinomial_gpu_1.MultinomialProgram(n,a,t),p=this.makeOutputArray(o.outputShape,"int32"),u=o.getCustomSetupFunc(r);return this.compileAndRun(o,[e],p,u)},e.prototype.oneHot=function(e,t,r,n){var a=new onehot_gpu_1.OneHotProgram(e.size,t,r,n);return this.compileAndRun(a,[e])},e.prototype.makeOutputArray=function(e,t){return tensor_1.Tensor.make(e,{},t)},e.prototype.compileAndRun=function(e,t,r,n){var a=this;null==r&&(r=this.makeOutputArray(e.outputShape,t[0].dtype));var o=t.map(function(e){return a.uploadToGPU(e.dataId),{tensor:e,texData:a.texData.get(e.dataId)}});this.uploadToGPU(r.dataId);var p,u={tensor:r,texData:this.texData.get(r.dataId)},i=gpgpu_math.makeShaderKey(e,o,u),s=this.getAndSaveBinary(i,function(){return gpgpu_math.compileProgram(a.gpgpu,e,o,u)}),h=null!=this.activeTimers;return h&&(p=this.startTimer()),gpgpu_math.runProgram(s,o,u,n),h&&(p=this.endTimer(p),this.activeTimers.push(this.getQueryTime(p))),r},e.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){if(!this.disposed){for(var e in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram);this.textureManager.dispose(),this.canvas.remove(),this.gpgpuCreatedLocally&&this.gpgpu.dispose(),this.disposed=!0}},e.prototype.throwIfNoData=function(e){if(!this.texData.has(e))throw new Error("WebGL backend: No data found for this tensor. Did you change your backend in the middle of the program? New backends can't use Tensors created with previous backends")},e.prototype.uploadToGPU=function(e){this.throwIfNoData(e);var t=this.texData.get(e),r=t.shape,n=t.values,a=t.texture,o=t.dtype,p=t.texType;if(null==a){var u,i=null!=this.activeTimers;i&&(u=performance.now());var s=webgl_util.getTextureShapeFromLogicalShape(this.gpgpu.gl,r);t.texShape=s;var h=this.textureManager.acquireTexture(s,p);t.texture=h,null!=n&&(this.gpgpu.uploadMatrixToTexture(h,s[0],s[1],typedArrayToFloat32(n,o)),t.values=null,i&&(this.uploadWaitMs+=performance.now()-u))}},e.prototype.cacheOnCPU=function(e,t){var r=this.delayedStorage,n=this.texData.get(e),a=n.texture,o=n.texShape,p=n.dtype,u=n.texType;r&&null!=a&&(this.textureManager.releaseTexture(a,o,u),n.texture=null,n.texShape=null),null!=t&&(n.values=float32ToTypedArray(t,p))},e}();exports.MathBackendWebGL=MathBackendWebGL,environment_1.ENV.registerBackend("webgl",function(){return new MathBackendWebGL});var NDArrayMathGPU=function(e){function t(t,r){void 0===r&&(r=!1);return console.warn("new NDArrayMathGPU() is deprecated. Please use dl.setBackend('webgl')."),e.call(this,new MathBackendWebGL(t),r)||this}return __extends(t,e),t.prototype.getGPGPUContext=function(){return this.engine.backend.getGPGPUContext()},t.prototype.getTextureManager=function(){return this.engine.backend.getTextureManager()},t}(math_1.NDArrayMath);function float32ToTypedArray(e,t){if("float32"===t)return e;if("int32"===t||"bool"===t){for(var r="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),n=0;n<r.length;++n){var a=e[n];a=isNaN(a)?util.getNaN(t):Math.round(a),r[n]=a}return r}throw new Error("Unknown dtype "+t)}function typedArrayToFloat32(e,t){if(e instanceof Float32Array)return e;for(var r=new Float32Array(e.length),n=0;n<r.length;n++){var a=e[n];r[n]=util.isValNaN(a,t)?NaN:a}return r}exports.NDArrayMathGPU=NDArrayMathGPU;

},{"../environment":66,"../math":137,"../ops/axis_util":139,"../ops/reduce_util":158,"../tensor":178,"../types":182,"../util":183,"./webgl/argminmax_gpu":104,"./webgl/avg_pool_backprop_gpu":105,"./webgl/batchnorm_gpu":106,"./webgl/binaryop_gpu":107,"./webgl/clip_gpu":108,"./webgl/concat_gpu":109,"./webgl/conv_backprop_gpu":110,"./webgl/conv_gpu":111,"./webgl/conv_gpu_depthwise":112,"./webgl/from_pixels_gpu":113,"./webgl/gather_gpu":114,"./webgl/gpgpu_context":115,"./webgl/gpgpu_math":116,"./webgl/logical_gpu":118,"./webgl/lrn_gpu":119,"./webgl/max_pool_backprop_gpu":120,"./webgl/mulmat_gpu":121,"./webgl/multinomial_gpu":122,"./webgl/onehot_gpu":123,"./webgl/pad_gpu":124,"./webgl/pool_gpu":125,"./webgl/reduce_gpu":126,"./webgl/resize_bilinear_gpu":127,"./webgl/reverse_gpu":128,"./webgl/slice_gpu":130,"./webgl/tex_util":131,"./webgl/texture_manager":132,"./webgl/tile_gpu":133,"./webgl/transpose_gpu":134,"./webgl/unaryop_gpu":135,"./webgl/webgl_util":136}],102:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ops=require("../ops/ops"),tensor_1=require("../tensor"),util=require("../util");function executeKernel(r,n,i){if("MatMul"===n){var t=i;return r.matMul(t.inputs.a,t.inputs.b,t.args.transposeA,t.args.transposeB)}if("Slice1D"===n){t=i;return r.slice1D(t.inputs.x,t.args.begin,t.args.size)}if("Slice2D"===n){t=i;return r.slice2D(t.inputs.x,t.args.begin,t.args.size)}if("Slice3D"===n){t=i;return r.slice3D(t.inputs.x,t.args.begin,t.args.size)}if("Slice4D"===n){t=i;return r.slice4D(t.inputs.x,t.args.begin,t.args.size)}if("Reverse4D"===n){t=i;return r.reverse4D(t.inputs.x,t.args.axis)}if("Concat"===n){t=i;return r.concat(t.inputs.a,t.inputs.b)}if("Neg"===n){t=i;return r.neg(t.inputs.x)}if("Add"===n){t=i;return r.add(t.inputs.a,t.inputs.b)}if("Sub"===n){t=i;return r.subtract(t.inputs.a,t.inputs.b)}if("Mul"===n){t=i;return r.multiply(t.inputs.a,t.inputs.b)}if("Div"===n){t=i;return r.divide(t.inputs.a,t.inputs.b)}if("Sum"===n){t=i;return r.sum(t.inputs.x,t.args.axes)}if("ArgMax"===n){t=i;return r.argMax(t.inputs.x,t.args.axes)}if("ArgMin"===n){t=i;return r.argMin(t.inputs.x,t.args.axes)}if("Equal"===n){t=i;return r.equal(t.inputs.a,t.inputs.b)}if("NotEqual"===n){t=i;return r.notEqual(t.inputs.a,t.inputs.b)}if("Less"===n){t=i;return r.less(t.inputs.a,t.inputs.b)}if("LessEqual"===n){t=i;return r.lessEqual(t.inputs.a,t.inputs.b)}if("Greater"===n){t=i;return r.greater(t.inputs.a,t.inputs.b)}if("GreaterEqual"===n){t=i;return r.greaterEqual(t.inputs.a,t.inputs.b)}if("LogicalNot"===n){t=i;return r.logicalNot(t.inputs.x)}if("LogicalAnd"===n){t=i;return r.logicalAnd(t.inputs.a,t.inputs.b)}if("LogicalOr"===n){t=i;return r.logicalOr(t.inputs.a,t.inputs.b)}if("LogicalXor"===n){t=i;return r.logicalXor(t.inputs.a,t.inputs.b)}if("Where"===n){t=i;return r.where(t.inputs.condition,t.inputs.a,t.inputs.b,t.args.dtype)}if("TopKValues"===n){t=i;return r.topKValues(t.inputs.x,t.args.k)}if("TopKIndices"===n){t=i;return r.topKIndices(t.inputs.x,t.args.k)}if("Min"===n){t=i;return r.min(t.inputs.x,t.args.axes)}if("Minimum"===n){t=i;return r.minimum(t.inputs.a,t.inputs.b)}if("Max"===n){t=i;return r.max(t.inputs.x,t.args.axes)}if("Maximum"===n){t=i;return r.maximum(t.inputs.a,t.inputs.b)}if("Ceil"===n){t=i;return r.ceil(t.inputs.x)}if("Floor"===n){t=i;return r.floor(t.inputs.x)}if("Pow"===n){t=i;return r.pow(t.inputs.base,t.inputs.exp)}if("Exp"===n){t=i;return r.exp(t.inputs.x)}if("Log"===n){t=i;return r.log(t.inputs.x)}if("Sqrt"===n){t=i;return r.sqrt(t.inputs.x)}if("Square"===n){t=i;return r.square(t.inputs.x)}if("Relu"===n){t=i;return r.relu(t.inputs.x)}if("Reshape"===n){var e=(t=i).inputs.x,s=t.args.newShape;return tensor_1.Tensor.make(s,{dataId:e.dataId},e.dtype)}if("Cast"===n){e=(t=i).inputs.x;var u=t.args.newDType;if(!util.hasEncodingLoss(e.dtype,u))return tensor_1.Tensor.make(e.shape,{dataId:e.dataId},u);if("int32"===u)return r.int(e);if("bool"===u)return r.notEqual(e,ops.scalar(0,e.dtype));throw new Error("Error in Cast: unknown dtype argument ("+u+")")}if("LeakyRelu"===n){t=i;return r.leakyRelu(t.inputs.x,t.args.alpha)}if("PReLU"===n){t=i;return r.prelu(t.inputs.x,t.inputs.alpha)}if("PReLUDer"===n){t=i;return r.preluDer(t.inputs.x,t.inputs.alpha)}if("Elu"===n){t=i;return r.elu(t.inputs.x)}if("EluDer"===n){t=i;return r.eluDer(t.inputs.x)}if("Selu"===n){t=i;return r.selu(t.inputs.x)}if("Abs"===n){t=i;return r.abs(t.inputs.x)}if("Sigmoid"===n){t=i;return r.sigmoid(t.inputs.x)}if("Step"===n){t=i;return r.step(t.inputs.x,t.args.alpha)}if("Sin"===n){t=i;return r.sin(t.inputs.x)}if("Cos"===n){t=i;return r.cos(t.inputs.x)}if("Tan"===n){t=i;return r.tan(t.inputs.x)}if("Asin"===n){t=i;return r.asin(t.inputs.x)}if("Acos"===n){t=i;return r.acos(t.inputs.x)}if("Atan"===n){t=i;return r.atan(t.inputs.x)}if("Sinh"===n){t=i;return r.sinh(t.inputs.x)}if("Cosh"===n){t=i;return r.cosh(t.inputs.x)}if("Tanh"===n){t=i;return r.tanh(t.inputs.x)}if("Clip"===n){t=i;return r.clip(t.inputs.x,t.args.min,t.args.max)}if("Tile"===n){t=i;return r.tile(t.inputs.x,t.args.reps)}if("Gather"===n){t=i;return r.gather(t.inputs.x,t.inputs.indices,t.args.axis)}if("Pad1D"===n){t=i;return r.pad1D(t.inputs.x,t.args.paddings,t.args.constantValue)}if("Pad2D"===n){t=i;return r.pad2D(t.inputs.x,t.args.paddings,t.args.constantValue)}if("Transpose"===n){t=i;return r.transpose(t.inputs.x,t.args.perm)}if("Conv2D"===n){t=i;return r.conv2d(t.inputs.x,t.inputs.filter,t.args.convInfo)}if("Conv2DDerInput"===n){t=i;return r.conv2dDerInput(t.inputs.dy,t.inputs.filter,t.args.convInfo)}if("Conv2DDerFilter"===n){t=i;return r.conv2dDerFilter(t.inputs.x,t.inputs.dy,t.args.convInfo)}if("DepthwiseConv2D"===n){t=i;return r.depthwiseConv2D(t.inputs.x,t.inputs.filter,t.args.convInfo)}if("MaxPool"===n){t=i;return r.maxPool(t.inputs.x,t.args.convInfo)}if("MaxPoolBackprop"===n){t=i;return r.maxPoolBackprop(t.inputs.dy,t.inputs.x,t.args.convInfo)}if("AvgPool"===n){t=i;return r.avgPool(t.inputs.x,t.args.convInfo)}if("AvgPoolBackprop"===n){t=i;return r.avgPoolBackprop(t.inputs.dy,t.inputs.x,t.args.convInfo)}if("MinPool"===n){t=i;return r.minPool(t.inputs.x,t.args.convInfo)}if("ResizeBilinear"===n){t=i;return r.resizeBilinear(t.inputs.x,t.args.newHeight,t.args.newWidth,t.args.alignCorners)}if("BatchNorm4D"===n){t=i;return r.batchNormalization4D(t.inputs.x,t.inputs.mean,t.inputs.variance,t.args.varianceEpsilon,t.inputs.scale,t.inputs.offset)}if("LRN4D"===n){t=i;return r.localResponseNormalization4D(t.inputs.x,t.args.radius,t.args.bias,t.args.alpha,t.args.beta,t.args.normRegion)}if("Multinomial"===n){t=i;return r.multinomial(t.inputs.probs,t.args.numSamples,t.args.seed)}if("OneHot"===n){t=i;return r.oneHot(t.inputs.indices,t.args.depth,t.args.onValue,t.args.offValue)}throw new Error("No backend method found for kernel "+n)}exports.executeKernel=executeKernel;

},{"../ops/ops":155,"../tensor":178,"../util":183}],103:[function(require,module,exports){
"use strict";var MatrixOrientation;Object.defineProperty(exports,"__esModule",{value:!0}),function(t){t[t.REGULAR=0]="REGULAR",t[t.TRANSPOSED=1]="TRANSPOSED"}(MatrixOrientation=exports.MatrixOrientation||(exports.MatrixOrientation={}));

},{}],104:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ArgMinMaxProgram=function(){return function(t,n,e){this.variableNames=["A"];var i=t.windowSize,a=t.batchSize,s=t.inSize,d=Math.ceil(s/i);e||this.variableNames.push("bestIndicesA"),this.outputShape=[a,d];var r="max"===n?">":"<",o=e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+i+";\n\n        int bestIndex = 0;\n        float bestValue = getA(batch, inOffset);\n\n        for (int i = 0; i < "+i+"; i++) {\n          int inIdx = "+o+";\n          float candidate = getA(batch, inIdx);\n          if (isNaN(candidate)) {\n            setOutput(candidate);\n            return;\n          }\n          if (candidate "+r+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "}}();exports.ArgMinMaxProgram=ArgMinMaxProgram;

},{}],105:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var AvgPool2DBackpropProgram=function(){return function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var t=n.filterHeight,o=n.filterWidth,d=n.strideHeight,r=n.strideWidth,e=t-1-n.padInfo.top,i=o-1-n.padInfo.left,a=1/(t*o);this.userCode="\n      const ivec2 pads = ivec2("+e+", "+i+");\n      const float avgMultiplier = float("+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+d+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+r+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.AvgPool2DBackpropProgram=AvgPool2DBackpropProgram;

},{}],106:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),BatchNormProgram=function(){return function(t,a,e,s,r,o){this.outputShape=[],this.supportsBroadcasting=!0,this.variableNames=["x","mean","variance"],broadcast_util.assertAndGetBroadcastShape(t,a),broadcast_util.assertAndGetBroadcastShape(t,e);var n="0.0";null!=s&&(broadcast_util.assertAndGetBroadcastShape(t,s),this.variableNames.push("offset"),n="getOffsetAtOutCoords()");var i="1.0";null!=r&&(broadcast_util.assertAndGetBroadcastShape(t,r),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+n+";\n        float scale = "+i+";\n        float inv = scale / sqrt(variance + float("+o+"));\n        setOutput((x - mean) * inv + offset);\n      }\n    "}}();exports.BatchNormProgram=BatchNormProgram;

},{"../../ops/broadcast_util":142}],107:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),CHECK_NAN_SNIPPET="\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n";exports.ADD="return a + b;",exports.SUB="return a - b;",exports.MUL="return a * b;",exports.DIV="return a / b;",exports.POW="\n  return (round(mod(b, 2.0)) == 0 || round(mod(b, 2.0)) == 2) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",exports.EQUAL=CHECK_NAN_SNIPPET+"\n  return float(a == b);\n",exports.NOT_EQUAL=CHECK_NAN_SNIPPET+"\n  return float(a != b);\n",exports.LESS=CHECK_NAN_SNIPPET+"\n  return float(a < b);\n",exports.LESS_EQUAL=CHECK_NAN_SNIPPET+"\n  return float(a <= b);\n",exports.GREATER=CHECK_NAN_SNIPPET+"\n  return float(a > b);\n",exports.GREATER_EQUAL=CHECK_NAN_SNIPPET+"\n  return float(a >= b);\n",exports.LOGICAL_AND=CHECK_NAN_SNIPPET+"\n  return float(a >= 1.0 && b >= 1.0);\n",exports.LOGICAL_OR=CHECK_NAN_SNIPPET+"\n  return float(a >= 1.0 || b >= 1.0);\n",exports.LOGICAL_XOR=CHECK_NAN_SNIPPET+"\n  return float(a >= 1.0 ^^ b >= 1.0);\n",exports.PRELU="\n  return (a >= 0.0) ? a : b * a;\n",exports.PRELU_DER="\n  return (a > 0.0) ? 1.0 : ((a < 0.0) ? b : a);\n",exports.MAX=CHECK_NAN_SNIPPET+"\n  return max(a, b);\n",exports.MIN=CHECK_NAN_SNIPPET+"\n  return min(a, b);\n";var BinaryOpProgram=function(){return function(r,t,n){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.outputShape=broadcast_util.assertAndGetBroadcastShape(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+r+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}}();exports.BinaryOpProgram=BinaryOpProgram;

},{"../../ops/broadcast_util":142}],108:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ClipProgram=function(){return function(t,e,r){this.variableNames=["A"],this.outputShape=t;var u=e.toFixed(20),a=r.toFixed(20);this.userCode="\n      void main() {\n        float value = getAAtOutCoords();\n        if (isNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, "+u+", "+a+"));\n      }\n    "}}();exports.ClipProgram=ClipProgram;

},{}],109:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var concat_util=require("../../ops/concat_util"),ConcatProgram=function(){return function(t,e){this.variableNames=["A","B"],this.outputShape=[],this.outputShape=concat_util.computeOutShape(t,e,1),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        float value = 0.0;\n        if (yC < "+t[1]+") {\n          value = getA(yR, yC);\n        } else {\n          yC -= "+t[1]+";\n          value = getB(yR, yC);\n        }\n\n        setOutput(value);\n      }\n    "}}();exports.ConcatProgram=ConcatProgram;

},{"../../ops/concat_util":145}],110:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Conv2DDerFilterProgram=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideHeight,o=n.strideWidth,e=n.padInfo.top,d=n.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+e+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+o+" - "+d+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.Conv2DDerFilterProgram=Conv2DDerFilterProgram;var Conv2DDerInputProgram=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,o=n.filterWidth,e=n.strideHeight,d=n.strideWidth,r=t-1-n.padInfo.top,i=o-1-n.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+r+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+e+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+d+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+o+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.Conv2DDerInputProgram=Conv2DDerInputProgram;

},{}],111:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Conv2DProgram=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.top,t=n.padInfo.left,o=n.strideHeight,d=n.strideWidth,r=n.filterHeight,i=n.filterWidth,a=4*Math.floor(n.inChannels/4),C=n.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+o+", "+d+");\n      const ivec2 pads = ivec2("+e+", "+t+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+r+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            int xC = xCCorner + wC;\n\n            if (xC < 0 || xC >= "+n.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+a+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===C)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+a+") *\n                getW(wR, wC, "+a+", d2);\n            } else if ("+(2===C)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+a+"),\n                getX(batch, xR, xC, "+a+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+a+", d2),\n                getW(wR, wC, "+a+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===C)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+a+"),\n                getX(batch, xR, xC, "+a+" + 1),\n                getX(batch, xR, xC, "+a+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+a+", d2),\n                getW(wR, wC, "+a+" + 1, d2),\n                getW(wR, wC, "+a+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.Conv2DProgram=Conv2DProgram;

},{}],112:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DepthwiseConv2DProgram=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var t=n.inHeight,e=n.inWidth,o=n.padInfo.top,i=n.padInfo.left,r=n.strideHeight,d=n.strideWidth,s=n.filterHeight,a=n.filterWidth,C=n.outChannels/n.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+d+");\n      const ivec2 pads = ivec2("+o+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+C+";\n        int q = d2 - d1 * "+C+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            int xC = xCCorner + wC;\n\n            if (xC < 0 || xC >= "+e+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.DepthwiseConv2DProgram=DepthwiseConv2DProgram;

},{}],113:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FromPixelsProgram=function(){return function(e){this.variableNames=["A"];var t=e[0],n=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+n+".0, "+t+".0);\n\n        vec4 values = texture2D(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "}}();exports.FromPixelsProgram=FromPixelsProgram;

},{}],114:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),GatherProgram=function(){return function(r,e,t){this.variableNames=["A","indices"];var s=r.slice();s[t]=e,this.outputShape=s,this.rank=s.length;var o=shader_compiler_1.getCoordsDataType(this.rank),n=getSourceCoords(r,t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+n+"));\n      }\n    "}}();function getSourceCoords(r,e){var t=r.length;if(t>4)throw Error("Gather for rank "+t+" is not yet supported");if(1===t)return"int(getIndices(resRC))";for(var s=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],n=0;n<r.length;n++)n===e?o.push("int(getIndices("+s[n]+"))"):o.push(""+s[n]);return o.join()}exports.GatherProgram=GatherProgram;

},{"./shader_compiler":129}],115:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(o,n){function u(t){try{a(i.next(t))}catch(t){n(t)}}function l(t){try{a(i.throw(t))}catch(t){n(t)}}function a(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(u,l)}a((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var r,i,o,n,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function l(n){return function(l){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,i=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){u.label=n[1];break}if(6===n[0]&&u.label<o[1]){u.label=o[1],o=n;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(n);break}o[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,l])}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),util=require("../../util"),gpgpu_util=require("./gpgpu_util"),tex_util=require("./tex_util"),webgl_util=require("./webgl_util"),GPGPUContext=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.gl=null!=t?t:gpgpu_util.createWebGLContext(),1===environment_1.ENV.get("WEBGL_VERSION")?(this.textureFloatExtension=webgl_util.getExtensionOrThrow(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float")):this.colorBufferFloatExtension=webgl_util.getExtensionOrThrow(this.gl,"EXT_color_buffer_float"),this.loseContextExtension=webgl_util.getExtensionOrThrow(this.gl,"WEBGL_lose_context"),environment_1.ENV.get("WEBGL_GET_BUFFER_SUB_DATA_ASYNC_EXTENSION_ENABLED")&&(this.getBufferSubDataAsyncExtension=this.gl.getExtension("WEBGL_get_buffer_sub_data_async")),this.vertexBuffer=gpgpu_util.createVertexBuffer(this.gl),this.indexBuffer=gpgpu_util.createIndexBuffer(this.gl),this.framebuffer=webgl_util.createFramebuffer(this.gl)}return t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;webgl_util.callAndCheck(e,function(){return e.finish()}),webgl_util.callAndCheck(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),webgl_util.callAndCheck(e,function(){return e.deleteFramebuffer(t.framebuffer)}),webgl_util.callAndCheck(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),webgl_util.callAndCheck(e,function(){return e.deleteBuffer(t.vertexBuffer)}),webgl_util.callAndCheck(e,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),webgl_util.callAndCheck(e,function(){return e.deleteBuffer(t.indexBuffer)}),this.loseContextExtension.loseContext(),this.disposed=!0}},t.prototype.enableAutomaticDebugValidation=function(t){this.autoDebugValidate=t,webgl_util.enableDebugWebGLErrorChecking(t)},t.prototype.createMatrixTexture=function(t,e){return this.throwIfDisposed(),gpgpu_util.createMatrixTexture(this.gl,t,e)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),gpgpu_util.uploadPixelDataToTexture(this.gl,t,e)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),gpgpu_util.createPackedMatrixTexture(this.gl,t,e)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(webgl_util.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer),this.outputTexture=null),webgl_util.callAndCheck(this.gl,function(){return e.gl.deleteTexture(t)})},t.prototype.uploadMatrixToTexture=function(t,e,r,i){this.throwIfDisposed();return gpgpu_util.uploadMatrixToTexture(this.gl,t,e,r,i,1)},t.prototype.uploadMatrixToPackedTexture=function(t,e,r,i){return this.throwIfDisposed(),gpgpu_util.uploadMatrixToPackedTexture(this.gl,t,e,r,i)},t.prototype.downloadMatrixFromTexture=function(t,e,r){var i=this;return this.downloadMatrixDriver(t,function(){return gpgpu_util.downloadMatrixFromOutputTexture(i.gl,e,r)})},t.prototype.downloadMatrixFromTextureAsync=function(t,e,r){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(o){if(null==this.getBufferSubDataAsyncExtension)throw new Error("Cannot download matrix from output texture asynchronously, WEBGL_get_buffer_sub_data_async is not enabled.");return[2,this.downloadMatrixDriverAsync(t,function(){return gpgpu_util.downloadMatrixFromOutputTextureAsync(i.gl,i.getBufferSubDataAsyncExtension,e,r)})]})})},t.prototype.downloadMatrixFromRGBAColorTexture=function(t,e,r,i){var o=this;return this.downloadMatrixDriver(t,function(){return gpgpu_util.downloadMatrixFromRGBAColorTexture(o.gl,e,r,i)})},t.prototype.downloadMatrixFromPackedTexture=function(t,e,r){var i=this;return this.downloadMatrixDriver(t,function(){return gpgpu_util.downloadMatrixFromPackedOutputTexture(i.gl,e,r)})},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,r=webgl_util.createFragmentShader(e,t),i=gpgpu_util.createVertexShader(e),o=webgl_util.createProgram(e);return webgl_util.callAndCheck(e,function(){return e.attachShader(o,i)}),webgl_util.callAndCheck(e,function(){return e.attachShader(o,r)}),webgl_util.linkProgram(e,o),this.autoDebugValidate&&webgl_util.validateProgram(e,o),o},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&webgl_util.callAndCheck(this.gl,function(){return e.gl.deleteProgram(t)})},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.autoDebugValidate&&webgl_util.validateProgram(this.gl,this.program),webgl_util.callAndCheck(this.gl,function(){return e.gl.useProgram(t)})},t.prototype.getUniformLocation=function(t,e,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?webgl_util.getProgramUniformLocationOrThrow(this.gl,t,e):webgl_util.getProgramUniformLocation(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var r=this;return this.throwIfDisposed(),webgl_util.callAndCheck(this.gl,function(){return r.gl.getAttribLocation(t,e)})},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),webgl_util.bindTextureToProgramUniformSampler(this.gl,this.program,t,e,r)},t.prototype.setOutputMatrixTexture=function(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,r){this.throwIfDisposed();var i=tex_util.getPackedMatrixTextureShapeWidthHeight(e,r),o=i[0],n=i[1];this.setOutputMatrixTextureDriver(t,o,n)},t.prototype.setOutputMatrixWriteRegion=function(t,e,r,i){this.setOutputMatrixWriteRegionDriver(r,t,i,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&webgl_util.validateProgram(this.gl,this.program),webgl_util.validateFramebuffer(this.gl)},t.prototype.executeProgram=function(t){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;gpgpu_util.bindVertexProgramAttributeStreams(e,this.program,this.vertexBuffer,t),this.autoDebugValidate&&this.debugValidate(),webgl_util.callAndCheck(e,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),webgl_util.callAndCheck(this.gl,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=webgl_util.getExtensionOrThrow(this.gl,2===environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.runQuery=function(t){var e=this.beginQuery();return t(),this.endQuery(),this.pollQueryTime(e)},t.prototype.beginQuery=function(){if(2===environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,r),r}r=(e=this.getQueryTimerExtensionWebGL1()).createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,r),r},t.prototype.endQuery=function(){if(2===environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2();t.endQuery(e.TIME_ELAPSED_EXT)}else{(e=this.getQueryTimerExtensionWebGL1()).endQueryEXT(e.TIME_ELAPSED_EXT)}},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE),n=this.gl.getParameter(i.GPU_DISJOINT_EXT);return o&&!n}o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,i.QUERY_RESULT_AVAILABLE_EXT),n=this.gl.getParameter(i.GPU_DISJOINT_EXT);return o&&!n},t.prototype.pollQueryTime=function(t){var e=this;return new Promise(function(r,i){var o=environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION");util.repeatedTry(function(){return e.isQueryAvailable(t,o)}).then(function(){return r(e.getQueryTime(t,o))}).catch(function(){console.warn("Disjoint query timer never available."),r(-1)})})},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(t,i.QUERY_RESULT_EXT)/1e6},t.prototype.downloadMatrixDriverSetup=function(t){this.throwIfDisposed(),webgl_util.bindColorTextureToFramebuffer(this.gl,t,this.framebuffer),this.autoDebugValidate&&webgl_util.validateFramebuffer(this.gl)},t.prototype.downloadMatrixDriverTeardown=function(){null!=this.outputTexture?(webgl_util.bindColorTextureToFramebuffer(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&webgl_util.validateFramebuffer(this.gl)):webgl_util.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.downloadMatrixDriverSetup(t);var r=e();return this.downloadMatrixDriverTeardown(),r},t.prototype.downloadMatrixDriverAsync=function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:return this.downloadMatrixDriverSetup(t),[4,e()];case 1:return r=i.sent(),this.downloadMatrixDriverTeardown(),[2,r]}})})},t.prototype.setOutputMatrixTextureDriver=function(t,e,r){this.throwIfDisposed();var i=this.gl;webgl_util.bindColorTextureToFramebuffer(i,t,this.framebuffer),this.autoDebugValidate&&webgl_util.validateFramebuffer(i),this.outputTexture=t,webgl_util.callAndCheck(i,function(){return i.viewport(0,0,e,r)}),webgl_util.callAndCheck(i,function(){return i.scissor(0,0,e,r)})},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,r,i){var o=this;this.throwIfDisposed(),webgl_util.callAndCheck(this.gl,function(){return o.gl.scissor(t,e,r,i)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();exports.GPGPUContext=GPGPUContext;

},{"../../environment":66,"../../util":183,"./gpgpu_util":117,"./tex_util":131,"./webgl_util":136}],116:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),util=require("../../util"),shader_compiler=require("./shader_compiler"),ATTRIBUTE_NAMES=["uv","clipSpacePos"],NAN_UNIFORM_NAME="NaN";function shouldUploadNaNUniform(){return!environment_1.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")}function compileProgram(e,a,r,t){for(var o=a.userCode,n=r.map(function(e,r){var t={logicalShape:e.tensor.shape,texShape:e.texData.texShape};return{name:a.variableNames[r],shapeInfo:t}}),i=n.map(function(e){return e.shapeInfo}),u={logicalShape:t.tensor.shape,texShape:t.texData.texShape},s=shader_compiler.makeShader(n,u,o,!0===a.supportsBroadcasting),p=e.createProgram(s),h={},m=0;m<a.variableNames.length;m++){var c=a.variableNames[m];h[c]=e.getUniformLocation(p,c)}var l={};if(ATTRIBUTE_NAMES.forEach(function(a){l[a]=e.getAttributeLocation(p,a)}),shouldUploadNaNUniform()){h[NAN_UNIFORM_NAME]=e.getUniformLocation(p,NAN_UNIFORM_NAME,!1)}return{program:a,source:s,webGLProgram:p,uniformLocations:h,attributeLocations:l,gpgpu:e,inShapeInfos:i,outShapeInfo:u}}function validateBinaryAndProgram(e,a){if(e.length!==a.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+a.length+" inputs");e.forEach(function(e,r){var t=e.logicalShape,o=e.texShape,n=a[r].tensor.shape,i=a[r].texData.texShape;if(!util.arraysEqual(t,n))throw Error("Binary was compiled with different shapes than the current args. Shapes "+t+" and "+n+" must match");if(!util.arraysEqual(o,i))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+i+" must match")})}function runProgram(e,a,r,t){validateBinaryAndProgram(e.inShapeInfos,a),validateBinaryAndProgram([e.outShapeInfo],[r]);var o=r.texData.texture,n=r.texData.texShape,i=e.gpgpu;i.setOutputMatrixTexture(o,n[0],n[1]),i.setProgram(e.webGLProgram),a.forEach(function(a,r){var t=a.texData.texture,o=e.program.variableNames[r],n=e.uniformLocations[o];i.setInputMatrixTexture(t,n,r)}),shouldUploadNaNUniform()&&i.gl.uniform1f(e.uniformLocations[NAN_UNIFORM_NAME],NaN),null!=t&&t(i,e.webGLProgram),i.executeProgram(e.attributeLocations)}function makeShaderKey(e,a,r){var t="";a.concat(r).forEach(function(e){t+=e.tensor.shape+"_"+e.texData.texShape});var o=e.userCode,n=(!0===e.supportsBroadcasting).toString(),i=e.constructor.name;return i+="_"+n+"_"+t+"_"+o}exports.compileProgram=compileProgram,exports.runProgram=runProgram,exports.makeShaderKey=makeShaderKey;

},{"../../environment":66,"../../util":183,"./shader_compiler":129}],117:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(a,u){function i(e){try{o(n.next(e))}catch(e){u(e)}}function l(e){try{o(n.throw(e))}catch(e){u(e)}}function o(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(i,l)}o((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,n,a,u,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function l(u){return function(l){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=n[2&u[0]?"return":u[0]?"throw":"next"])&&!(a=a.call(n,u[1])).done)return a;switch(n=0,a&&(u=[0,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!a||u[1]>a[0]&&u[1]<a[3])){i.label=u[1];break}if(6===u[0]&&i.label<a[1]){i.label=a[1],a=u;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(u);break}a[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(e){u=[6,e],n=0}finally{r=a=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),tex_util=require("./tex_util"),webgl_util=require("./webgl_util");function getWebGLContextAttributes(){return{alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0}}function createWebGLContext(e){var t,r=getWebGLContextAttributes();return t=null!=e?webgl_util.createWebGLRenderingContextFromCanvas(e,r):webgl_util.createWebGLRenderingContext(r),webgl_util.callAndCheck(t,function(){return t.disable(t.DEPTH_TEST)}),webgl_util.callAndCheck(t,function(){return t.disable(t.STENCIL_TEST)}),webgl_util.callAndCheck(t,function(){return t.disable(t.BLEND)}),webgl_util.callAndCheck(t,function(){return t.disable(t.DITHER)}),webgl_util.callAndCheck(t,function(){return t.disable(t.POLYGON_OFFSET_FILL)}),webgl_util.callAndCheck(t,function(){return t.disable(t.SAMPLE_COVERAGE)}),webgl_util.callAndCheck(t,function(){return t.enable(t.SCISSOR_TEST)}),webgl_util.callAndCheck(t,function(){return t.enable(t.CULL_FACE)}),webgl_util.callAndCheck(t,function(){return t.cullFace(t.BACK)}),t}function createVertexShader(e){return webgl_util.createVertexShader(e,"\n    precision highp float;\n    attribute vec3 clipSpacePos;\n    attribute vec2 uv;\n    varying vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function createVertexBuffer(e){var t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return webgl_util.createStaticVertexBuffer(e,t)}function createIndexBuffer(e){var t=new Uint16Array([0,1,2,2,1,3]);return webgl_util.createStaticIndexBuffer(e,t)}function getTextureInternalFormat(e,t){return environment_1.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")&&2===environment_1.ENV.get("WEBGL_VERSION")?4===t?e.RGBA32F:e.R32F:e.RGBA}function getTextureFormat(e,t){return environment_1.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")&&2===environment_1.ENV.get("WEBGL_VERSION")?4===t?e.RGBA:e.RED:e.RGBA}function getTextureType(e){return environment_1.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?e.FLOAT:e.UNSIGNED_BYTE}function createAndConfigureTexture(e,t,r,n){webgl_util.validateTextureSize(e,t,r);var a=webgl_util.createTexture(e),u=e.TEXTURE_2D,i=getTextureInternalFormat(e,n),l=getTextureFormat(e,n);return webgl_util.callAndCheck(e,function(){return e.bindTexture(u,a)}),webgl_util.callAndCheck(e,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),webgl_util.callAndCheck(e,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),webgl_util.callAndCheck(e,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),webgl_util.callAndCheck(e,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),webgl_util.callAndCheck(e,function(){return e.texImage2D(u,0,i,t,r,0,l,getTextureType(e),null)}),webgl_util.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,null)}),a}function createMatrixTexture(e,t,r){var n=tex_util.getUnpackedMatrixTextureShapeWidthHeight(t,r);return createAndConfigureTexture(e,n[0],n[1],1)}function createColorMatrixTexture(e,t,r){var n=tex_util.getColorMatrixTextureShapeWidthHeight(t,r);return createAndConfigureTexture(e,n[0],n[1],4)}function createPackedMatrixTexture(e,t,r){var n=tex_util.getPackedMatrixTextureShapeWidthHeight(t,r);return createAndConfigureTexture(e,n[0],n[1],4)}function bindVertexProgramAttributeStreams(e,t,r,n){webgl_util.callAndCheck(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),webgl_util.bindVertexBufferToProgramAttribute(e,t,"clipSpacePos",r,3,20,0,n),webgl_util.bindVertexBufferToProgramAttribute(e,t,"uv",r,2,20,12,n)}function uploadPixelDataToTexture(e,t,r){webgl_util.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,t)}),webgl_util.callAndCheck(e,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),webgl_util.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function uploadDataToTexture(e,t,r,n,a,u){var i=getTextureFormat(e,u);webgl_util.validateTextureSize(e,r,n),webgl_util.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,t)}),webgl_util.callAndCheck(e,function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,n,i,getTextureType(e),a)}),webgl_util.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function uploadMatrixToTexture(e,t,r,n,a,u){var i,l=tex_util.getUnpackedMatrixTextureShapeWidthHeight(r,n),o=l[0],c=l[1];if(environment_1.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")){var x=1===u?webgl_util.getChannelsPerTexture():u;1===x?i=a:(i=new Float32Array(tex_util.getUnpackedArraySizeFromMatrixSize(a.length,x)),tex_util.encodeMatrixToUnpackedArray(a,i,x))}else i=tex_util.encodeFloatArray(a);uploadDataToTexture(e,t,o,c,i,u)}function uploadMatrixToPackedTexture(e,t,r,n,a){var u=tex_util.getPackedMatrixTextureShapeWidthHeight(r,n),i=u[0],l=u[1],o=new Float32Array(tex_util.getPackedRGBAArraySizeFromMatrixShape(r,n));tex_util.encodeMatrixToPackedRGBA(a,r,n,o);uploadDataToTexture(e,t,i,l,o,4)}function getDownloadTargetArrayBuffer(e,t,r){return environment_1.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?new Float32Array(tex_util.getUnpackedArraySizeFromMatrixSize(e*t,r)):new Uint8Array(e*t*r)}function decodeDownloadTargetArrayBuffer(e,t,r,n){if(environment_1.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")){var a=new Float32Array(t*r);return tex_util.decodeMatrixFromUnpackedArray(e,a,n),a}return tex_util.decodeToFloatArray(e)}function downloadMatrixFromOutputTextureAsync(e,t,r,n){return __awaiter(this,void 0,void 0,function(){var a,u,i,l,o;return __generator(this,function(c){switch(c.label){case 0:return a=e,i=getDownloadTargetArrayBuffer(r,n,u=4),l=i instanceof Float32Array?4*i.length:i,o=e.createBuffer(),webgl_util.callAndCheck(e,function(){return e.bindBuffer(a.PIXEL_PACK_BUFFER,o)}),webgl_util.callAndCheck(e,function(){return e.bufferData(a.PIXEL_PACK_BUFFER,l,e.STATIC_DRAW)}),webgl_util.callAndCheck(e,function(){return a.readPixels(0,0,n,r,e.RGBA,getTextureType(e),0)}),[4,t.getBufferSubDataAsync(a.PIXEL_PACK_BUFFER,0,i)];case 1:return c.sent(),[2,decodeDownloadTargetArrayBuffer(i,r,n,u)]}})})}function downloadMatrixFromOutputTexture(e,t,r){var n=tex_util.getUnpackedMatrixTextureShapeWidthHeight(t,r),a=n[0],u=n[1],i=getDownloadTargetArrayBuffer(t,r,4);return webgl_util.callAndCheck(e,function(){return e.readPixels(0,0,a,u,e.RGBA,getTextureType(e),i)}),decodeDownloadTargetArrayBuffer(i,t,r,4)}function downloadMatrixFromRGBAColorTexture(e,t,r,n){var a=t*r*4,u=new Uint8Array(a);webgl_util.callAndCheck(e,function(){return e.readPixels(0,0,r,t,e.RGBA,e.UNSIGNED_BYTE,u)});for(var i=new Float32Array(a),l=0;l<u.length;l++)i[l]=u[l];var o=new Float32Array(t*r*n);return tex_util.decodeMatrixFromUnpackedColorRGBAArray(i,o,n),o}function downloadMatrixFromPackedOutputTexture(e,t,r){var n=tex_util.getPackedMatrixTextureShapeWidthHeight(t,r),a=n[0],u=n[1],i=new Float32Array(tex_util.getPackedRGBAArraySizeFromMatrixShape(t,r));webgl_util.callAndCheck(e,function(){return e.readPixels(0,0,a,u,e.RGBA,getTextureType(e),i)});var l=new Float32Array(t*r);return tex_util.decodeMatrixFromPackedRGBA(i,t,r,l)}exports.getWebGLContextAttributes=getWebGLContextAttributes,exports.createWebGLContext=createWebGLContext,exports.createVertexShader=createVertexShader,exports.createVertexBuffer=createVertexBuffer,exports.createIndexBuffer=createIndexBuffer,exports.createMatrixTexture=createMatrixTexture,exports.createColorMatrixTexture=createColorMatrixTexture,exports.createPackedMatrixTexture=createPackedMatrixTexture,exports.bindVertexProgramAttributeStreams=bindVertexProgramAttributeStreams,exports.uploadPixelDataToTexture=uploadPixelDataToTexture,exports.uploadMatrixToTexture=uploadMatrixToTexture,exports.uploadMatrixToPackedTexture=uploadMatrixToPackedTexture,exports.downloadMatrixFromOutputTextureAsync=downloadMatrixFromOutputTextureAsync,exports.downloadMatrixFromOutputTexture=downloadMatrixFromOutputTexture,exports.downloadMatrixFromRGBAColorTexture=downloadMatrixFromRGBAColorTexture,exports.downloadMatrixFromPackedOutputTexture=downloadMatrixFromPackedOutputTexture;

},{"../../environment":66,"./tex_util":131,"./webgl_util":136}],118:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),WhereProgram=function(){return function(e,r,t){var s,o;if(this.variableNames=["c","a","b"],this.outputShape=r,t>4)throw Error("Where for rank "+t+" is not yet supported");if(1===t)o="resRC",s="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[],i=[],u=0;u<r.length;u++)i.push(""+a[u]),u<e&&n.push(""+a[u]);s=n.join(),o=i.join()}var p=shader_compiler_1.getCoordsDataType(t);this.userCode="\n      void main() {\n        "+p+" resRC = getOutputCoords();\n        float cVal = getC("+s+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "}}();exports.WhereProgram=WhereProgram;

},{"./shader_compiler":129}],119:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var LRNProgram=function(){return function(n,t,o,i,r,d){this.variableNames=["x"],this.outputShape=[];var s,e=t,a=n[1]-1,u=n[2]-1,c=n[3]-1;this.outputShape=n;var l="float("+o+") + float("+i+") * sum";s=.5===r?"inversesqrt("+l+")":1===r?"1.0/("+l+")":"exp(log("+l+") * float(-"+r+"));",this.userCode="withinChannel"===d?"\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int b = coords[0];\n          int r = coords[1];\n          int c = coords[2];\n          int d = coords[3];\n          float x = getX(b, r, c, d);\n          float sum = 0.0;\n          for (int u = -"+e+"; u <= "+e+"; u++) {\n            for (int v = -"+e+"; v <= "+e+"; v++) {\n              int idx = r + u;\n              int idy = c + v;\n              if (idx >= 0 && idx <= "+a+" && idy >= 0 && idy <= "+u+") {\n                float z = getX(b, idx, idy, d);\n                sum += z * z;\n              }\n            }\n          }\n          float val = x * "+s+";\n          setOutput(val);\n        }\n      ":"\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int b = coords[0];\n          int r = coords[1];\n          int c = coords[2];\n          int d = coords[3];\n          float x = getX(b, r, c, d);\n          float sum = 0.0;\n          for (int j = -"+e+"; j <= "+e+"; j++) {\n            int idx = d + j;\n            if (idx >= 0 && idx <=  "+c+") {\n              float z = getX(b, r, c, idx);\n              sum += z * z;\n            }\n          }\n          float val = x * "+s+";\n          setOutput(val);\n        }\n      "}}();exports.LRNProgram=LRNProgram;

},{}],120:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MaxPool2DBackpropProgram=function(){return function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var t=n.filterHeight,o=n.filterWidth,e=n.strideHeight,d=n.strideWidth,r=t-1-n.padInfo.top,i=o-1-n.padInfo.left,a=t*o-1;this.userCode="\n      const ivec2 pads = ivec2("+r+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+e+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+d+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+a+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+o+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}();exports.MaxPool2DBackpropProgram=MaxPool2DBackpropProgram;

},{}],121:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MatMulProgram=function(){return function(t,n,e,r){void 0===e&&(e=!1),void 0===r&&(r=!1),this.variableNames=["matrixA","matrixB"];var i=e?t[1]:t[0],a=r?n[0]:n[1],o=e?t[0]:t[1];this.outputShape=[i,a];var M=function(t,n){return e?n+" + "+t+", aRow":"aRow, "+n+" + "+t},u=function(t,n){return r?"bCol, "+n+" + "+t:n+" + "+t+", bCol"},x=4*Math.floor(o/4),g=o%4;this.userCode=" float dotARowBCol(int aRow, int bCol) {\n      float result = 0.0;\n      for (int i = 0; i < "+x+"; i += 4) {\n        vec4 a = vec4(\n          getMatrixA("+M(0,"i")+"),\n          getMatrixA("+M(1,"i")+"),\n          getMatrixA("+M(2,"i")+"),\n          getMatrixA("+M(3,"i")+")\n        );\n        vec4 b = vec4(\n          getMatrixB("+u(0,"i")+"),\n          getMatrixB("+u(1,"i")+"),\n          getMatrixB("+u(2,"i")+"),\n          getMatrixB("+u(3,"i")+")\n        );\n\n        result += dot(a, b);\n      }\n\n      if ("+(1===g)+") {\n        result += getMatrixA("+M(0,x)+") *\n          getMatrixB("+u(0,x)+");\n      } else if ("+(2===g)+") {\n        vec2 a = vec2(\n          getMatrixA("+M(0,x)+"),\n          getMatrixA("+M(1,x)+")\n        );\n        vec2 b = vec2(\n          getMatrixB("+u(0,x)+"),\n          getMatrixB("+u(1,x)+")\n        );\n        result += dot(a, b);\n      } else if ("+(3===g)+") {\n        vec3 a = vec3(\n          getMatrixA("+M(0,x)+"),\n          getMatrixA("+M(1,x)+"),\n          getMatrixA("+M(2,x)+")\n        );\n        vec3 b = vec3(\n          getMatrixB("+u(0,x)+"),\n          getMatrixB("+u(1,x)+"),\n          getMatrixB("+u(2,x)+")\n        );\n        result += dot(a, b);\n      }\n\n      return result;\n    }\n\n    void main() {\n      ivec2 resRC = getOutputCoords();\n      setOutput(dotARowBCol(resRC.x, resRC.y));\n    }\n    "}}();exports.MatMulProgram=MatMulProgram;

},{}],122:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MultinomialProgram=function(){function n(n,t,e){this.variableNames=["probs"],this.outputShape=[n,e],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(n){var t=this;return function(e,o){null==t.seedLoc&&(t.seedLoc=e.getUniformLocation(o,"seed")),e.gl.uniform1f(t.seedLoc,n)}},n}();exports.MultinomialProgram=MultinomialProgram;

},{}],123:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var OneHotProgram=function(){return function(t,e,o,n){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+n+"), float("+o+"),\n                      float(index == coords.y)));\n      }\n    "}}();exports.OneHotProgram=OneHotProgram;

},{}],124:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Pad1DProgram=function(){return function(t,e,r){this.variableNames=["x"];var n=e[0],s=e[1];this.outputShape=[n+t[0]+s],this.rank=1,this.userCode="\n      void main() {\n        int resRC = getOutputCoords();\n        if (resRC < "+n+" || resRC >= "+n+" + "+t[0]+") {\n          setOutput(float("+r+"));\n        } else {\n          setOutput(getX(resRC - "+n+"));\n        }\n      }\n    "}}();exports.Pad1DProgram=Pad1DProgram;var Pad2DProgram=function(){return function(t,e,r){this.variableNames=["x"];var n=e[0][0],s=e[0][1],a=e[1][0],o=e[1][1];this.outputShape=[n+t[0]+s,a+t[1]+o],this.rank=2;var u="resRC.x - "+n+", resRC.y - "+a;this.userCode="\n      void main() {\n        ivec2 resRC = getOutputCoords();\n        int topShape = "+n+" + "+t[0]+";\n        int leftShape = "+a+" + "+t[1]+";\n        if (resRC.x < "+n+" || resRC.x >= topShape ||\n            resRC.y < "+a+" || resRC.y >= leftShape) {\n          setOutput(float("+r+"));\n        } else {\n          setOutput(getX("+u+"));\n        }\n      }\n    "}}();exports.Pad2DProgram=Pad2DProgram;

},{}],125:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Pool2DProgram=function(){return function(n,e,t){if(this.variableNames=["x"],"avg"===e&&t)throw new Error("Cannot compute positions for average pool.");var i=n.filterHeight,a=n.filterWidth,o=n.strideHeight,r=n.strideWidth,u=n.padInfo.top,l=n.padInfo.left;this.outputShape=n.outShape;var x="avg"===e,s="0.0";if(x||(s="min"===e?"1.0 / 0.0":"-1.0 / 0.0"),t){var c="min"===e?"<=":">=";this.userCode="\n        const ivec2 strides = ivec2("+o+", "+r+");\n        const ivec2 pads = ivec2("+u+", "+l+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+i+"; wR++) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+a+"; wC++) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              if (isNaN(value)) {\n                setOutput(value);\n                return;\n              }\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value "+c+" currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+a+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "}else{var C="min"===e?"min":"max",d=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(d="avgValue / "+i*a+".0");var v=4*Math.floor(a/4),R=a%4,f="\n      if (hasNaN(values)) {\n        setOutput(getNaN(values));\n        return;\n      }\n      if ("+x+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = "+C+"(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+r+");\n      const ivec2 pads = ivec2("+u+", "+l+");\n      const float initializationValue = "+s+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+s+");\n        float avgValue = 0.0;\n\n        for (int wR = 0; wR < "+i+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+v+"; wC += 4) {\n            int xC = xCCorner + wC;\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              getValue(batch, xR, xC + 2, d),\n              getValue(batch, xR, xC + 3, d)\n            );\n\n            "+f+"\n          }\n\n          int xC = xCCorner + "+v+";\n          if ("+(1===R)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n            "+f+"\n          } else if ("+(2===R)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+f+"\n          } else if ("+(3===R)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              getValue(batch, xR, xC + 2, d),\n              initializationValue\n            );\n\n            "+f+"\n          }\n        }\n        setOutput("+d+");\n      }\n    "}}}();exports.Pool2DProgram=Pool2DProgram;

},{}],126:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ReduceProgram=function(){return function(n,e){this.variableNames=["x"];var i=n.windowSize,a=n.batchSize,t=n.inSize,u=Math.ceil(t/i);this.outputShape=[a,u];var l="sum"===e,o="0.0";l||(o="min"===e?"1.0 / 0.0":"-1.0 / 0.0");var c="min"===e?"min":"max",s=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e&&(s="sumValue");var r=4*Math.floor(i/4),d=i%4,v="\n      if ("+l+") {\n        sumValue += dot(values, ones);\n      } else {\n        if (hasNaN(values)) {\n          setOutput(getNaN(values));\n          return;\n        }\n        minMaxValue = "+c+"(values, minMaxValue);\n      }\n    ",x="";t%i>0&&(x="\n        if (inIdx < 0 || inIdx >= "+t+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+o+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+x+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+i+";\n\n        vec4 minMaxValue = vec4("+o+");\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+r+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+v+"\n        }\n\n        int inIdx = inOffset + "+r+";\n        if ("+(1===d)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n          "+v+"\n        } else if ("+(2===d)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n          "+v+"\n        } else if ("+(3===d)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n          "+v+"\n        }\n        setOutput("+s+");\n      }\n    "}}();exports.ReduceProgram=ReduceProgram;

},{}],127:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ResizeBilinearProgram=function(){return function(e,o,t,n){this.variableNames=["A"],this.outputShape=[];var r=e[0],c=e[1],i=e[2],u=e[3];this.outputShape=[r,o,t,u];var a=n?[c-1,i-1]:[c,i],s=n?[o-1,t-1]:[o,t];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+c+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "}}();exports.ResizeBilinearProgram=ResizeBilinearProgram;

},{}],128:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ReverseProgram=function(){return function(e,r){this.variableNames=["x"],this.outputShape=e;var t=function(t){return-1!==r.indexOf(t)&&1!==e[t]?e[t]+" - coords["+t+"] - 1":"coords["+t+"]"},o=t(0),s=t(1),n=t(2),u=t(3);this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        float val = getX("+o+", "+s+", "+n+", "+u+");\n        setOutput(val);\n      }\n    "}}();exports.ReverseProgram=ReverseProgram;

},{}],129:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),util=require("../../util"),broadcast_util=require("../../ops/broadcast_util"),tex_util=require("./tex_util");function makeShader(e,n,t,r){var a=getSampleSnippet(),o=getSetOutputSnippet(),i=e.map(function(e){return"uniform sampler2D "+e.name+";"}).join("\n"),u=e.map(function(e){return getInputSamplingSnippet(e,n,r)}).join("\n"),l=n.texShape,c=getOutputSamplingSnippet(n.logicalShape,l);return[SHADER_PREFIX,a,o,i,c,u,t].join("\n")}function getSampleSnippet(){return environment_1.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?FLOAT_TEXTURE_SAMPLE_SNIPPET:UNSIGNED_BYTE_TEXTURE_SAMPLE_SNIPPET}function getSetOutputSnippet(){return environment_1.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")?FLOAT_TEXTURE_SETOUTPUT_SNIPPET:UNSIGNED_BYTE_TEXTURE_SETOUTPUT_SNIPPET}function getSamplerFromInInfo(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return getSamplerScalar(e);case 1:return getSampler1D(e);case 2:return getSampler2D(e);case 3:return getSampler3D(e);case 4:return getSampler4D(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function getInputSamplingSnippet(e,n,t){var r=getSamplerFlat(e);return r+=getSamplerFromInInfo(e),(t||util.arraysEqual(e.shapeInfo.logicalShape,n.logicalShape))&&(r+=getSamplerAtOutputCoords(e,n,t)),r}function getOutputSamplingSnippet(e,n){switch(e.length){case 0:return getOutputScalarCoords();case 1:return getOutput1DCoords(e,n);case 2:return getOutput2DCoords(e,n);case 3:return getOutput3DCoords(e,n);case 4:return getOutput4DCoords(e,n);default:throw new Error(e.length+"-D output sampling is not yet supported")}}exports.makeShader=makeShader;var SAMPLE_1D_SNIPPET="\nvec2 UVfrom1D(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",SAMPLE_2D_SNIPPET="\nvec2 UVfrom2D(int texNumR, int texNumC, int numC, int row, int col) {\n  int index = row * numC + col;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",SAMPLE_3D_SNIPPET="\nvec2 UVfrom3D(int texNumR, int texNumC, int stride0,\n    int stride1, int row, int col, int depth) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",SAMPLE_4D_SNIPPET="\nvec2 UVfrom4D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int row, int col, int depth,\n    int depth2) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",UNSIGNED_BYTE_TEXTURE_SAMPLE_SNIPPET="\n  uniform float NaN;\n\n  const vec4 floatDeltas = vec4(\n      1.0,\n      1.0 / 255.0,\n      1.0 / (255.0 * 255.0),\n      1.0 / (255.0 * 255.0 * 255.0)\n  );\n  const float minValue = "+tex_util.FLOAT_MIN+".0;\n  const float maxValue = "+tex_util.FLOAT_MAX+".0;\n  const float range = (maxValue - minValue) / 255.0;\n  const vec2 dotRange = vec2(1.0, range);\n\n  float sample(sampler2D texture, vec2 uv) {\n    vec4 sampleValue = texture2D(texture, uv);\n    if (all(equal(sampleValue, vec4("+tex_util.BYTE_NAN_VALUE+")))) {\n      return NaN;\n    }\n\n    vec4 encValue = floor(sampleValue * 255.0 + 0.5);\n    float decodedValue = dot(encValue, floatDeltas);\n    return dot(vec2(minValue, decodedValue), dotRange);\n  }\n",UNSIGNED_BYTE_TEXTURE_SETOUTPUT_SNIPPET="\n  const vec4 floatPowers = vec4(\n    1.0,\n    255.0,\n    255.0 * 255.0,\n    255.0 * 255.0 * 255.0\n  );\n  const vec2 recipRange = vec2(1.0/range);\n  const vec2 recipRange255 = vec2(1.0/(maxValue - minValue));\n\n  void setOutput(float decodedValue) {\n    if (isNaN(decodedValue)) {\n      gl_FragColor = vec4("+tex_util.BYTE_NAN_VALUE+");\n      return;\n    }\n\n    float a = dot(vec2(decodedValue, -minValue), recipRange);\n    float b = fract(a) * 255.0;\n    float c = fract(b) * 255.0;\n    float d = fract(c) * 255.0;\n    gl_FragColor = floor(vec4(a, b, c, d)) / 255.0;\n\n    // TODO(dsmilkov): Version above gets better accuracy but probably slower\n    // than the version below. Benchmark to determine if the accuracy is worth\n    // the cost.\n\n    // float normValue = dot(vec2(decodedValue, -minValue), recipRange255);\n    // vec4 f = normValue * floatPowers;\n    // gl_FragColor = floor(fract(f) * 255.0) / 255.0;\n  }\n",FLOAT_TEXTURE_SAMPLE_SNIPPET="\n  float sample(sampler2D texture, vec2 uv) {\n    return texture2D(texture, uv).r;\n  }\n",FLOAT_TEXTURE_SETOUTPUT_SNIPPET="\n  void setOutput(float val) {\n    gl_FragColor = vec4(val, 0, 0, 0);\n  }\n",SHADER_PREFIX="\n  precision highp float;\n  precision highp int;\n  varying vec2 resultUV;\n  const vec2 halfCR = vec2(0.5, 0.5);\n\n  bool isNaN(float val) {\n    float v1 = val * val;\n    float v2 = val * val;\n    return v1 == v2 ? false : true;\n  }\n\n  bool hasNaN(vec4 values) {\n    vec4 v1 = values * values;\n    vec4 v2 = values * values;\n    return any(notEqual(v1, v2));\n  }\n\n  float getNaN(vec4 values) {\n    return dot(vec4(1), values);\n  }\n\n  int round(float value) {\n    return int(floor(value + 0.5));\n  }\n\n  int imod(int x, int y) {\n    return x - y * (x / y);\n  }\n\n  const vec2 randomConst = vec2(\n    23.14069263277926, // e^pi (Gelfond's constant)\n     2.665144142690225 // 2^sqrt(2) (Gelfond–Schneider constant)\n  );\n\n  float random(float seed) {\n      return fract(cos(dot(resultUV * seed, randomConst)) * 12345.6789);\n  }\n\n  "+SAMPLE_1D_SNIPPET+"\n  "+SAMPLE_2D_SNIPPET+"\n  "+SAMPLE_3D_SNIPPET+"\n  "+SAMPLE_4D_SNIPPET+"\n";function getOutputScalarCoords(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function getOutput1DCoords(e,n){return 1===n[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return resTexRC.x * "+n[1]+" + resTexRC.y;\n    }\n  "}function getOutput3DCoords(e,n){var t=e[1]*e[2],r=e[2];return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = index / "+t+";\n      index -= r * "+t+";\n      int c = index / "+r+";\n      int d = index - c * "+r+";\n      return ivec3(r, c, d);\n    }\n  "}function getOutput4DCoords(e,n){var t=e[3],r=e[2]*t,a=e[1]*r;return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      int r = index / "+a+";\n      index -= r * "+a+";\n\n      int c = index / "+r+";\n      index -= c * "+r+";\n\n      int d = index / "+t+";\n      int d2 = index - d * "+t+";\n\n      return ivec4(r, c, d, d2);\n    }\n  "}function getOutput2DCoords(e,n){return util.arraysEqual(e,n)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+n[0]+", "+n[1]+"));\n        int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+n[0]+", "+n[1]+"));\n        int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}function getSamplerScalar(e){var n=e.name;return"\n    float "+("get"+n.charAt(0).toUpperCase()+n.slice(1))+"() {\n      return sample("+n+", halfCR);\n    }\n  "}function getSampler1D(e){var n=e.name,t="get"+n.charAt(0).toUpperCase()+n.slice(1);return"\n    float "+t+"(int index) {\n      return "+t+"Flat(index);\n    }\n  "}function getSampler2D(e){var n=e.shapeInfo.logicalShape,t=e.shapeInfo.texShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t[0],i=t[1];if(util.arraysEqual(n,t))return"\n    float "+a+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+o+".0);\n      return sample("+r+", uv);\n    }\n  ";var u=util.squeezeShape(n),l=u.newShape,c=u.keptDims,s=l;if(s.length<n.length){return"\n      "+getSamplerFromInInfo(squeezeInputInfo(e,s))+"\n      float "+a+"(int row, int col) {\n        return "+a+"("+getSqueezedParams(["row","col"],c)+");\n      }\n    "}return 1===i?"\n    float "+a+"(int row, int col) {\n      int index = row * "+n[1]+" + col;\n      vec2 uv = vec2(0.5, (float(index) + 0.5) / "+o+".0);\n      return sample("+r+", uv);\n    }\n  ":1===o?"\n    float "+a+"(int row, int col) {\n      int index = row * "+n[1]+" + col;\n      vec2 uv = vec2((float(index) + 0.5) / "+i+".0, 0.5);\n      return sample("+r+", uv);\n    }\n  ":"\n  float "+a+"(int row, int col) {\n    vec2 uv = UVfrom2D("+o+", "+i+", "+n[1]+", row, col);\n    return sample("+r+", uv);\n  }\n"}function getSampler3D(e){var n=e.shapeInfo.texShape,t=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[0],i=n[1],u=t[1]*t[2],l=t[2],c=util.squeezeShape(t),s=c.newShape,p=c.keptDims,v=s;if(v.length<t.length){return"\n        "+getSamplerFromInInfo(squeezeInputInfo(e,v))+"\n        float "+a+"(int row, int col, int depth) {\n          return "+a+"("+getSqueezedParams(["row","col","depth"],p)+");\n        }\n      "}return i===u?"\n        float "+a+"(int row, int col, int depth) {\n          int texR = row;\n          int texC = col * "+l+" + depth;\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+i+".0, "+o+".0);\n          return sample("+r+", uv);\n        }\n      ":i===l?"\n    float "+a+"(int row, int col, int depth) {\n      int texR = row * "+t[1]+" + col;\n      int texC = depth;\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+i+".0, "+o+".0);\n      return sample("+r+", uv);\n    }\n  ":"\n      float "+a+"(int row, int col, int depth) {\n        vec2 uv = UVfrom3D(\n            "+o+", "+i+", "+u+", "+l+", row, col, depth);\n        return sample("+r+", uv);\n      }\n  "}function getSampler4D(e){var n=e.shapeInfo.logicalShape,t=e.shapeInfo.texShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t[0],i=t[1],u=n[3],l=n[2]*u,c=n[1]*l,s=util.squeezeShape(n),p=s.newShape,v=s.keptDims;if(p.length<n.length){return"\n      "+getSamplerFromInInfo(squeezeInputInfo(e,p))+"\n      float "+a+"(int row, int col, int depth, int depth2) {\n        return "+a+"("+getSqueezedParams(["row","col","depth","depth2"],v)+");\n      }\n    "}return i===c?"\n      float "+a+"(int row, int col, int depth, int depth2) {\n        int texR = row;\n        int texC = col * "+l+" + depth * "+u+" + depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+i+".0, "+o+".0);\n        return sample("+r+", uv);\n      }\n    ":i===u?"\n      float "+a+"(int row, int col, int depth, int depth2) {\n        int texR = row * "+n[1]*n[2]+" + col * "+n[2]+" + depth;\n        int texC = depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+i+".0, "+o+".0);\n        return sample("+r+", uv);\n      }\n    ":"\n    float "+a+"(int row, int col, int depth, int depth2) {\n      vec2 uv = UVfrom4D("+o+", "+i+", "+c+", "+l+",\n          "+u+", row, col, depth, depth2);\n      return sample("+r+", uv);\n    }\n  "}function getSamplerFlat(e){var n=e.name,t=e.shapeInfo.texShape,r="get"+n.charAt(0).toUpperCase()+n.slice(1)+"Flat",a=t[0],o=t[1];return 1===o&&1===a?"\n      float "+r+"(int index) {\n        return sample("+n+", halfCR);\n      }\n    ":1===o?"\n      float "+r+"(int index) {\n        vec2 uv = vec2(0.5, (float(index) + 0.5) / "+a+".0);\n        return sample("+n+", uv);\n      }\n    ":1===a?"\n      float "+r+"(int index) {\n        vec2 uv = vec2((float(index) + 0.5) / "+o+".0, 0.5);\n        return sample("+n+", uv);\n      }\n    ":"\n    float "+r+"(int index) {\n      vec2 uv = UVfrom1D("+a+", "+o+", index);\n      return sample("+n+", uv);\n    }\n  "}function getBroadcastOutputCoordsSampler(e,n,t,r){var a=e.shapeInfo.logicalShape.length,o=n.logicalShape.length,i="int";2===o?i="ivec2":3===o?i="ivec3":4===o&&(i="ivec4");var u=broadcast_util.getBroadcastDims(e.shapeInfo.logicalShape,n.logicalShape),l=o-a;return"\n    float "+r+"() {\n      "+i+" coords = getOutputCoords();\n      "+(0===a?"":o<2&&u.length>=1?"coords = 0;":u.map(function(e){return"coords["+(e+l)+"] = 0;"}).join("\n"))+"\n      return get"+t+"("+(o<2&&a>0?"coords":e.shapeInfo.logicalShape.map(function(e,n){return"coords["+(n+l)+"]"}).join(", "))+");\n    }\n  "}function getSamplerAtOutputCoords(e,n,t){var r=e.shapeInfo.texShape,a=e.name,o=a.charAt(0).toUpperCase()+a.slice(1),i="get"+o+"AtOutCoords",u=broadcast_util.getBroadcastDims(e.shapeInfo.logicalShape,n.logicalShape),l=e.shapeInfo.logicalShape.length,c=n.logicalShape.length,s=t&&(c>l||u.length>0),p=broadcast_util.broadcastDimsAreOuter(u);if(s&&!p)return getBroadcastOutputCoordsSampler(e,n,o,i);var v=n.texShape;if(util.arraysEqual(r,v))return"\n      float "+i+"() {\n        return sample("+a+", resultUV);\n      }\n    ";var d=util.sizeFromShape(r),x="";return s&&p&&(x="\n        int mainPart = index / "+d+";\n        index -= mainPart * "+d+";\n      "),"\n    float "+i+"() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+v[0]+", "+v[1]+"));\n      int index = resTexRC.x * "+v[1]+" + resTexRC.y;\n      "+x+"\n      int texR = index / "+r[1]+";\n      int texC = index - texR * "+r[1]+";\n      vec2 uv = (vec2(texC, texR) + halfCR) /\n                 vec2("+r[1]+".0, "+r[0]+".0);\n\n      return sample("+a+", uv);\n    }\n  "}function getCoordsDataType(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";throw Error("GPU for rank "+e+" is not yet supported")}function squeezeInputInfo(e,n){var t=JSON.parse(JSON.stringify(e));return t.shapeInfo.logicalShape=n,t}function getSqueezedParams(e,n){return n.map(function(n){return e[n]}).join(", ")}exports.getCoordsDataType=getCoordsDataType;

},{"../../environment":66,"../../ops/broadcast_util":142,"../../util":183,"./tex_util":131}],130:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),SliceProgram=function(){function r(r){this.variableNames=["source"],this.outputShape=r,this.rank=r.length;var o=shader_compiler_1.getCoordsDataType(this.rank),t=getCoords(this.rank);this.userCode="\n      uniform "+o+" start;\n\n      void main() {\n        "+o+" sourceLoc = start + getOutputCoords();\n        setOutput(getSource("+t+"));\n      }\n    "}return r.prototype.getCustomSetupFunc=function(r){var o=this;if(r.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+r.length+")");return function(t,e){if(null!=o.startLoc||(o.startLoc=t.getUniformLocationNoThrow(e,"start"),null!=o.startLoc))if(1===o.rank)t.gl.uniform1i(o.startLoc,r[0]);else if(2===o.rank)t.gl.uniform2i(o.startLoc,r[0],r[1]);else if(3===o.rank)t.gl.uniform3i(o.startLoc,r[0],r[1],r[2]);else{if(4!==o.rank)throw Error("Slicing for rank "+o.rank+" is not yet supported");t.gl.uniform4i(o.startLoc,r[0],r[1],r[2],r[3])}}},r}();function getCoords(r){if(1===r)return"sourceLoc";if(2===r)return"sourceLoc.x, sourceLoc.y";if(3===r)return"sourceLoc.x, sourceLoc.y, sourceLoc.z";if(4===r)return"sourceLoc.x, sourceLoc.y, sourceLoc.z, sourceLoc.w";throw Error("Slicing for rank "+r+" is not yet supported")}exports.SliceProgram=SliceProgram;

},{"./shader_compiler":129}],131:[function(require,module,exports){
"use strict";var TextureType;function getUnpackedMatrixTextureShapeWidthHeight(e,r){return[r,e]}function getUnpackedArraySizeFromMatrixSize(e,r){return e*r}function getColorMatrixTextureShapeWidthHeight(e,r){return[4*r,e]}function getMatrixSizeFromUnpackedArraySize(e,r){if(e%r!=0)throw new Error("unpackedSize ("+e+") must be a multiple of "+r);return e/r}function encodeMatrixToUnpackedArray(e,r,t){var a=getUnpackedArraySizeFromMatrixSize(e.length,t);if(r.length<a)throw new Error("unpackedArray length ("+r.length+") must be >= "+a);for(var o=0,i=0;i<e.length;++i)r[o]=e[i],o+=t}Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e[e.FLOAT=0]="FLOAT",e[e.UNSIGNED_BYTE=1]="UNSIGNED_BYTE"}(TextureType=exports.TextureType||(exports.TextureType={})),exports.getUnpackedMatrixTextureShapeWidthHeight=getUnpackedMatrixTextureShapeWidthHeight,exports.getUnpackedArraySizeFromMatrixSize=getUnpackedArraySizeFromMatrixSize,exports.getColorMatrixTextureShapeWidthHeight=getColorMatrixTextureShapeWidthHeight,exports.getMatrixSizeFromUnpackedArraySize=getMatrixSizeFromUnpackedArraySize,exports.encodeMatrixToUnpackedArray=encodeMatrixToUnpackedArray,exports.FLOAT_MAX=2e4,exports.FLOAT_MIN=-exports.FLOAT_MAX;var FLOAT_RANGE=(exports.FLOAT_MAX-exports.FLOAT_MIN)/255,FLOAT_DELTAS=[1,1/255,1/65025,1/16581375],FLOAT_POWERS=[1,255,65025];function encodeFloatArray(e){for(var r=new Uint8Array(4*e.length),t=function(t){var a=e[t/4];if(isNaN(a))return r[t]=exports.BYTE_NAN_VALUE,r[t+1]=exports.BYTE_NAN_VALUE,r[t+2]=exports.BYTE_NAN_VALUE,r[t+3]=exports.BYTE_NAN_VALUE,"continue";var o=(a-exports.FLOAT_MIN)/FLOAT_RANGE,i=FLOAT_POWERS.map(function(e){return e*o}).map(function(e){return Math.floor(e%1*255)});r[t]=Math.floor(o),r[t+1]=i[0],r[t+2]=i[1],r[t+3]=i[2]},a=0;a<r.length;a+=4)t(a);return r}function decodeToFloatArray(e){for(var r=new Float32Array(e.length/4),t=function(t){if(e[t]===exports.BYTE_NAN_VALUE&&e[t+1]===exports.BYTE_NAN_VALUE&&e[t+2]===exports.BYTE_NAN_VALUE&&e[t+3]===exports.BYTE_NAN_VALUE)return r[t/4]=NaN,"continue";var a=0;FLOAT_DELTAS.forEach(function(r,o){a+=r*e[t+o]});var o=a*FLOAT_RANGE+exports.FLOAT_MIN;r[t/4]=o},a=0;a<e.length;a+=4)t(a);return r}function decodeMatrixFromUnpackedArray(e,r,t){var a=getMatrixSizeFromUnpackedArraySize(e.length,t);if(r.length<a)throw new Error("matrix length ("+r.length+") must be >= "+a);for(var o=0,i=0;i<e.length;i+=t)r[o++]=e[i]}function decodeMatrixFromUnpackedColorRGBAArray(e,r,t){var a=e.length*t/4;if(r.length<a)throw new Error("matrix length ("+r.length+") must be >= "+a);for(var o=0,i=0;i<e.length;i+=4)for(var n=0;n<t;n++)r[o++]=e[i+n]}function getPackedMatrixTextureShapeWidthHeight(e,r){return[Math.ceil(r/2),Math.ceil(e/2)]}function getPackedRGBAArraySizeFromMatrixShape(e,r){var t=getPackedMatrixTextureShapeWidthHeight(e,r);return t[0]*t[1]*4}function encodeMatrixToPackedRGBA(e,r,t,a){var o=getPackedRGBAArraySizeFromMatrixShape(r,t);if(a.length<o)throw new Error("packedRGBA length ("+a.length+") must be >= "+o);for(var i=getPackedMatrixTextureShapeWidthHeight(r,t),n=i[0],x=i[1],c=t%2==1,d=r%2==1,A=Math.floor(t/2),h=Math.floor(r/2),p=c?4:0,g=t,u=0,T=0;T<h;++T){for(var M=2*T*t,f=0;f<A;++f){var l=M+2*f;a[u]=e[l],a[u+1]=e[l+1],a[u+2]=e[l+g],a[u+3]=e[l+g+1],u+=4}u+=p}if(c){l=t-1,u=4*(n-1);var F=2*t;for(p=4*n,T=0;T<h;++T)a[u]=e[l],a[u+2]=e[l+t],l+=F,u+=p}if(d)for(l=(r-1)*t,u=(x-1)*n*4,f=0;f<A;++f)a[u++]=e[l++],a[u++]=e[l++],u+=2;return c&&d&&(a[a.length-4]=e[e.length-1]),a}function decodeMatrixFromPackedRGBA(e,r,t,a){var o=r*t;if(o<a.length)throw new Error("matrix length ("+a.length+") must be >= "+o);for(var i=t%2==1,n=r%2==1,x=Math.floor(t/2),c=Math.floor(r/2),d=getPackedMatrixTextureShapeWidthHeight(r,t),A=d[0],h=d[1],p=i?4:0,g=t+(i?1:0),u=0,T=0,M=t,f=0;f<c;++f){for(var l=0;l<x;++l)a[T++]=e[u++],a[T++]=e[u++],a[M++]=e[u++],a[M++]=e[u++];u+=p,T+=g,M+=g}if(i){u=4*(A-1);var F=t-1;for(p=4*A,g=2*t,f=0;f<c;++f)a[F]=e[u],a[F+t]=e[u+2],u+=p,F+=g}if(n)for(u=(h-1)*A*4,F=(r-1)*t,l=0;l<x;++l)a[F++]=e[u++],a[F++]=e[u++],u+=2;return i&&n&&(a[a.length-1]=e[e.length-4]),a}exports.BYTE_NAN_VALUE=0,exports.encodeFloatArray=encodeFloatArray,exports.decodeToFloatArray=decodeToFloatArray,exports.decodeMatrixFromUnpackedArray=decodeMatrixFromUnpackedArray,exports.decodeMatrixFromUnpackedColorRGBAArray=decodeMatrixFromUnpackedColorRGBAArray,exports.getPackedMatrixTextureShapeWidthHeight=getPackedMatrixTextureShapeWidthHeight,exports.getPackedRGBAArraySizeFromMatrixShape=getPackedRGBAArraySizeFromMatrixShape,exports.encodeMatrixToPackedRGBA=encodeMatrixToPackedRGBA,exports.decodeMatrixFromPackedRGBA=decodeMatrixFromPackedRGBA;

},{}],132:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tex_util_1=require("./tex_util"),TextureManager=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.allocatedTextures=[],this.usedTextureCount={}}return e.prototype.acquireTexture=function(e,t){void 0===t&&(t=tex_util_1.TextureType.FLOAT);var u=getKeyFromTextureShape(e,t);if(u in this.freeTextures||(this.freeTextures[u]=[]),u in this.usedTextureCount||(this.usedTextureCount[u]=0),this.usedTextureCount[u]++,this.freeTextures[u].length>0)return this.numFreeTextures--,this.numUsedTextures++,this.log(),this.freeTextures[u].shift();this.numUsedTextures++,this.log();var r=this.gpgpu.createMatrixTexture(e[0],e[1]);return this.allocatedTextures.push(r),r},e.prototype.releaseTexture=function(e,t,u){void 0===u&&(u=tex_util_1.TextureType.FLOAT);var r=getKeyFromTextureShape(t,u);r in this.freeTextures||(this.freeTextures[r]=[]),this.freeTextures[r].push(e),this.numFreeTextures++,this.numUsedTextures--,this.usedTextureCount[r]--,this.log()},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;null!=this.allocatedTextures&&(this.allocatedTextures.forEach(function(t){e.gpgpu.deleteMatrixTexture(t)}),this.freeTextures=null,this.allocatedTextures=null,this.usedTextureCount=null,this.numUsedTextures=0,this.numFreeTextures=0)},e}();function getKeyFromTextureShape(e,t){return e[0]+"_"+e[1]+"_"+t}exports.TextureManager=TextureManager;

},{"./tex_util":131}],133:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),TileProgram=function(){return function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),o=0;o<t.length;o++)t[o]=r[o]*e[o];this.outputShape=t,this.rank=t.length;var s=shader_compiler_1.getCoordsDataType(this.rank),i=getSourceCoords(r);this.userCode="\n      void main() {\n        "+s+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "}}();function getSourceCoords(r){var e=r.length;if(e>4)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+r[0]+")";for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],s=0;s<r.length;s++)o.push("imod("+t[s]+", "+r[s]+")");return o.join()}exports.TileProgram=TileProgram;

},{"./shader_compiler":129}],134:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),TransposeProgram=function(){return function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),o=0;o<t.length;o++)t[o]=r[e[o]];this.outputShape=t,this.rank=t.length;var s=shader_compiler_1.getCoordsDataType(this.rank),n=getSwitchedCoords(e);this.userCode="\n    void main() {\n      "+s+" resRC = getOutputCoords();\n      setOutput(getA("+n+"));\n    }\n    "}}();function getSwitchedCoords(r){var e=r.length;if(e>4)throw Error("Transpose for rank "+e+" is not yet supported");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],o=new Array(e),s=0;s<r.length;s++)o[r[s]]=t[s];return o.join()}exports.TransposeProgram=TransposeProgram;

},{"./shader_compiler":129}],135:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var selu_util=require("../../ops/selu_util"),UnaryOpProgram=function(){return function(n,r){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      float unaryOperation(float x) {\n        "+r+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}}();exports.UnaryOpProgram=UnaryOpProgram;var CHECK_NAN_SNIPPET="\n  if (isNaN(x)) return x;\n";function LEAKY_RELU(n){return"\n    return (x >= 0.0) ? x : "+n+" * x;\n  "}function STEP(n){return void 0===n&&(n=0),CHECK_NAN_SNIPPET+"\n    return x > 0.0 ? 1.0 : float("+n+");\n  "}exports.ABS="\n  return abs(x);\n",exports.RELU=CHECK_NAN_SNIPPET+"\n  return (x < 0.0) ? 0.0 : x;\n",exports.ELU="\n  return (x >= 0.0) ? x : (exp(x) - 1.0);\n",exports.ELU_DER="\n  return (x >= 0.0) ? 1.0 : exp(x);\n",exports.SELU="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+selu_util.SELU_SCALEALPHA+";\n  float scale = "+selu_util.SELU_SCALE+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",exports.LEAKY_RELU=LEAKY_RELU,exports.STEP=STEP,exports.NEG="\n  return -x;\n",exports.CEIL="\n  return ceil(x);\n",exports.FLOOR="\n  return floor(x);\n",exports.EXP="\n  return exp(x);\n",exports.LOG="\n  return log(x);\n",exports.SQRT=CHECK_NAN_SNIPPET+"\n  return sqrt(x);\n",exports.SIGMOID="\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",exports.SIN=CHECK_NAN_SNIPPET+"\n  return sin(x);\n",exports.COS=CHECK_NAN_SNIPPET+"\n  return cos(x);\n",exports.TAN="\n  return tan(x);\n",exports.ASIN=CHECK_NAN_SNIPPET+"\n  return asin(x);\n",exports.ACOS=CHECK_NAN_SNIPPET+"\n  return acos(x);\n",exports.ATAN=CHECK_NAN_SNIPPET+"\n  return atan(x);\n",exports.SINH="\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n",exports.COSH="\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n",exports.TANH="\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n",exports.SQUARE="\n  return x * x;\n",exports.LOGICAL_NOT=CHECK_NAN_SNIPPET+"\n  return float(!(x >= 1.0));\n",exports.TO_INT="\n  return float(int(x));\n";

},{"../../ops/selu_util":161}],136:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MAX_TEXTURE_SIZE=null,util=require("../../util"),environment_1=require("../../environment");function createWebGLRenderingContext(e){var r=document.createElement("canvas");return r.width=1,r.height=1,createWebGLRenderingContextFromCanvas(r,e)}function createWebGLRenderingContextFromCanvas(e,r){var t,n=environment_1.ENV.get("WEBGL_VERSION");if(2===n?t=e.getContext("webgl2",r):1===n&&(t=e.getContext("webgl",r)||e.getContext("experimental-webgl",r)),0===n||null==t)throw new Error("This browser does not support WebGL.");return t}function callAndCheck(e,r){var t=r();return checkWebGLError(e),t}exports.createWebGLRenderingContext=createWebGLRenderingContext,exports.createWebGLRenderingContextFromCanvas=createWebGLRenderingContextFromCanvas,exports.callAndCheck=callAndCheck;var webGLDebugErrorCheckingEnabled=!1;function enableDebugWebGLErrorChecking(e){webGLDebugErrorCheckingEnabled=e}function checkWebGLError(e){if(webGLDebugErrorCheckingEnabled){var r=e.getError();if(r!==e.NO_ERROR)throw new Error("WebGL Error: "+getWebGLErrorMessage(e,r))}}function getWebGLErrorMessage(e,r){switch(r){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+r}}function getExtensionOrThrow(e,r){return throwIfNull(e,function(){return e.getExtension(r)},'Extension "'+r+'" not supported on this browser.')}function createVertexShader(e,r){var t=throwIfNull(e,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(callAndCheck(e,function(){return e.shaderSource(t,r)}),callAndCheck(e,function(){return e.compileShader(t)}),!1===e.getShaderParameter(t,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function createFragmentShader(e,r){var t=throwIfNull(e,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(callAndCheck(e,function(){return e.shaderSource(t,r)}),callAndCheck(e,function(){return e.compileShader(t)}),!1===e.getShaderParameter(t,e.COMPILE_STATUS))throw logShaderSourceAndInfoLog(r,e.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}exports.enableDebugWebGLErrorChecking=enableDebugWebGLErrorChecking,exports.checkWebGLError=checkWebGLError,exports.getWebGLErrorMessage=getWebGLErrorMessage,exports.getExtensionOrThrow=getExtensionOrThrow,exports.createVertexShader=createVertexShader,exports.createFragmentShader=createFragmentShader;var lineNumberRegex=/ERROR: [0-9]+:([0-9]+):/g;function logShaderSourceAndInfoLog(e,r){var t=lineNumberRegex.exec(r);if(null==t)return console.log("Couldn't parse line number in error: "+r),void console.log(e);for(var n=+t[1],o=e.split("\n"),a=o.length.toString().length+2,u=o.map(function(e,r){return util.rightPad((r+1).toString(),a)+e}),i=0,c=0;c<u.length;c++)i=Math.max(u[c].length,i);var f=u.slice(0,n-1),l=u.slice(n-1,n),E=u.slice(n);console.log(f.join("\n")),console.log(r.split("\n")[0]),console.log("%c "+util.rightPad(l[0],i),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(E.join("\n"))}function createProgram(e){return throwIfNull(e,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function linkProgram(e,r){if(callAndCheck(e,function(){return e.linkProgram(r)}),!1===e.getProgramParameter(r,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(r)),new Error("Failed to link vertex and fragment shaders.")}function validateProgram(e,r){if(callAndCheck(e,function(){return e.validateProgram(r)}),!1===e.getProgramParameter(r,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(r)),new Error("Shader program validation failed.")}function createStaticVertexBuffer(e,r){var t=throwIfNull(e,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return callAndCheck(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,t)}),callAndCheck(e,function(){return e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW)}),t}function createStaticIndexBuffer(e,r){var t=throwIfNull(e,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return callAndCheck(e,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t)}),callAndCheck(e,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,r,e.STATIC_DRAW)}),t}function queryMaxTextureSize(e){return null!=MAX_TEXTURE_SIZE?MAX_TEXTURE_SIZE:MAX_TEXTURE_SIZE=callAndCheck(e,function(){return e.getParameter(e.MAX_TEXTURE_SIZE)})}function getChannelsPerTexture(){return environment_1.ENV.get("WEBGL_FLOAT_TEXTURE_ENABLED")&&2===environment_1.ENV.get("WEBGL_VERSION")?1:4}function createTexture(e){return throwIfNull(e,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function validateTextureSize(e,r,t){var n=queryMaxTextureSize(e);if(r<=0||t<=0){var o="["+r+"x"+t+"]";throw new Error("Requested texture size "+o+" is invalid.")}if(r>n||t>n){o="["+r+"x"+t+"]";throw new Error("Requested texture size "+o+" greater than WebGL maximum on this browser / GPU "+("["+n+"x"+n+"]")+".")}}function createFramebuffer(e){return throwIfNull(e,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function bindVertexBufferToProgramAttribute(e,r,t,n,o,a,u,i){var c=-1;-1!==(c=null!=i&&t in i?i[t]:e.getAttribLocation(r,t))&&(callAndCheck(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,n)}),callAndCheck(e,function(){return e.vertexAttribPointer(c,o,e.FLOAT,!1,a,u)}),callAndCheck(e,function(){return e.enableVertexAttribArray(c)}))}function bindTextureUnit(e,r,t){validateTextureUnit(e,t),callAndCheck(e,function(){return e.activeTexture(e.TEXTURE0+t)}),callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,r)})}function unbindTextureUnit(e,r){validateTextureUnit(e,r),callAndCheck(e,function(){return e.activeTexture(e.TEXTURE0+r)}),callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function getProgramUniformLocationOrThrow(e,r,t){return throwIfNull(e,function(){return e.getUniformLocation(r,t)},'uniform "'+t+'" not present in program.')}function getProgramUniformLocation(e,r,t){return e.getUniformLocation(r,t)}function bindTextureToProgramUniformSampler(e,r,t,n,o){callAndCheck(e,function(){return bindTextureUnit(e,t,o)}),callAndCheck(e,function(){return e.uniform1i(n,o)})}function bindCanvasToFramebuffer(e){callAndCheck(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),callAndCheck(e,function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)}),callAndCheck(e,function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)})}function bindColorTextureToFramebuffer(e,r,t){callAndCheck(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)}),callAndCheck(e,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0)})}function unbindColorTextureFromFramebuffer(e,r){callAndCheck(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),callAndCheck(e,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function validateFramebuffer(e){var r=e.checkFramebufferStatus(e.FRAMEBUFFER);if(r!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+getFramebufferErrorMessage(e,r))}function getFramebufferErrorMessage(e,r){switch(r){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+r}}function throwIfNull(e,r,t){var n=callAndCheck(e,function(){return r()});if(null==n)throw new Error(t);return n}function validateTextureUnit(e,r){var t=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=r+e.TEXTURE0;if(n<e.TEXTURE0||n>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function getTextureShapeFromLogicalShape(e,r){2!==r.length&&(r=util.squeezeShape(r).newShape);var t=queryMaxTextureSize(e),n=util.sizeFromShape(r);return r.length<=1&&n<=t?[n,1]:2===r.length&&r[0]<=t&&r[1]<=t?r:3===r.length&&r[0]<=t&&r[1]*r[2]<=t?[r[0],r[1]*r[2]]:4===r.length&&r[0]<=t&&r[1]*r[2]*r[3]<=t?[r[0],r[1]*r[2]*r[3]]:util.sizeToSquarishShape(n)}exports.createProgram=createProgram,exports.linkProgram=linkProgram,exports.validateProgram=validateProgram,exports.createStaticVertexBuffer=createStaticVertexBuffer,exports.createStaticIndexBuffer=createStaticIndexBuffer,exports.queryMaxTextureSize=queryMaxTextureSize,exports.getChannelsPerTexture=getChannelsPerTexture,exports.createTexture=createTexture,exports.validateTextureSize=validateTextureSize,exports.createFramebuffer=createFramebuffer,exports.bindVertexBufferToProgramAttribute=bindVertexBufferToProgramAttribute,exports.bindTextureUnit=bindTextureUnit,exports.unbindTextureUnit=unbindTextureUnit,exports.getProgramUniformLocationOrThrow=getProgramUniformLocationOrThrow,exports.getProgramUniformLocation=getProgramUniformLocation,exports.bindTextureToProgramUniformSampler=bindTextureToProgramUniformSampler,exports.bindCanvasToFramebuffer=bindCanvasToFramebuffer,exports.bindColorTextureToFramebuffer=bindColorTextureToFramebuffer,exports.unbindColorTextureFromFramebuffer=unbindColorTextureFromFramebuffer,exports.validateFramebuffer=validateFramebuffer,exports.getFramebufferErrorMessage=getFramebufferErrorMessage,exports.getTextureShapeFromLogicalShape=getTextureShapeFromLogicalShape;

},{"../../environment":66,"../../util":183}],137:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment"),array_ops=require("./ops/array_ops"),batchnorm=require("./ops/batchnorm"),binary_ops=require("./ops/binary_ops"),compare=require("./ops/compare"),conv=require("./ops/conv"),image_ops=require("./ops/image_ops"),logical=require("./ops/logical_ops"),lrn_ops=require("./ops/lrn"),lstm_ops=require("./ops/lstm"),matmul=require("./ops/matmul"),norm=require("./ops/norm"),ops=require("./ops/ops"),pool=require("./ops/pool"),reduction_ops=require("./ops/reduction_ops"),reverse=require("./ops/reverse"),slice=require("./ops/slice"),softmax_ops=require("./ops/softmax"),transpose=require("./ops/transpose"),unary_ops=require("./ops/unary_ops"),tracking_1=require("./tracking"),util=require("./util"),tidy=tracking_1.Tracking.tidy,keep=tracking_1.Tracking.keep,NDArrayMath=function(){function s(s,r){this.matMul=matmul.Ops.matMul,this.vectorTimesMatrix=matmul.Ops.vectorTimesMatrix,this.outerProduct=matmul.Ops.outerProduct,this.matrixTimesVector=matmul.Ops.matrixTimesVector,this.dotProduct=matmul.Ops.dotProduct,this.slice=slice.Ops.slice,this.slice1D=slice.Ops.slice1d,this.slice2D=slice.Ops.slice2d,this.slice3D=slice.Ops.slice3d,this.slice4D=slice.Ops.slice4d,this.reverse=reverse.Ops.reverse,this.reverse1D=reverse.Ops.reverse1d,this.reverse2D=reverse.Ops.reverse2d,this.reverse3D=reverse.Ops.reverse3d,this.reverse4D=reverse.Ops.reverse4d,this.batchNormalization=batchnorm.Ops.batchNormalization,this.batchNormalization2D=batchnorm.Ops.batchNormalization2d,this.batchNormalization3D=batchnorm.Ops.batchNormalization3d,this.batchNormalization4D=batchnorm.Ops.batchNormalization4d,this.avgPool=pool.Ops.avgPool,this.maxPool=pool.Ops.maxPool,this.minPool=pool.Ops.minPool,this.maxPoolBackprop=pool.Ops.maxPoolBackprop,this.conv2dTranspose=conv.Ops.conv2dTranspose,this.depthwiseConv2D=conv.Ops.depthwiseConv2d,this.conv2dDerFilter=conv.Ops.conv2dDerFilter,this.conv2dDerInput=conv.Ops.conv2dDerInput,this.argMax=reduction_ops.Ops.argMax,this.argMin=reduction_ops.Ops.argMin,this.logSumExp=reduction_ops.Ops.logSumExp,this.max=reduction_ops.Ops.max,this.mean=reduction_ops.Ops.mean,this.min=reduction_ops.Ops.min,this.moments=reduction_ops.Ops.moments,this.sum=reduction_ops.Ops.sum,this.add=binary_ops.Ops.add,this.addStrict=binary_ops.Ops.addStrict,this.div=binary_ops.Ops.div,this.divide=this.div,this.divStrict=binary_ops.Ops.divStrict,this.divideStrict=this.divStrict,this.maximum=binary_ops.Ops.maximum,this.maximumStrict=binary_ops.Ops.maximumStrict,this.minimum=binary_ops.Ops.minimum,this.minimumStrict=binary_ops.Ops.minimumStrict,this.mul=binary_ops.Ops.mul,this.multiply=this.mul,this.mulStrict=binary_ops.Ops.mulStrict,this.multiplyStrict=this.mulStrict,this.pow=binary_ops.Ops.pow,this.powStrict=binary_ops.Ops.powStrict,this.sub=binary_ops.Ops.sub,this.subtract=this.sub,this.subStrict=binary_ops.Ops.subStrict,this.logicalNot=logical.Ops.logicalNot,this.logicalAnd=logical.Ops.logicalAnd,this.logicalOr=logical.Ops.logicalOr,this.logicalXor=logical.Ops.logicalXor,this.where=logical.Ops.where,this.transpose=transpose.Ops.transpose,this.equal=compare.Ops.equal,this.equalStrict=compare.Ops.equalStrict,this.greater=compare.Ops.greater,this.greaterStrict=compare.Ops.greaterStrict,this.greaterEqual=compare.Ops.greaterEqual,this.greaterEqualStrict=compare.Ops.greaterEqualStrict,this.less=compare.Ops.less,this.lessStrict=compare.Ops.lessStrict,this.lessEqual=compare.Ops.lessEqual,this.lessEqualStrict=compare.Ops.lessEqualStrict,this.notEqual=compare.Ops.notEqual,this.notEqualStrict=compare.Ops.notEqualStrict,this.abs=unary_ops.Ops.abs,this.acos=unary_ops.Ops.acos,this.asin=unary_ops.Ops.asin,this.atan=unary_ops.Ops.atan,this.ceil=unary_ops.Ops.ceil,this.clip=unary_ops.Ops.clipByValue,this.cos=unary_ops.Ops.cos,this.cosh=unary_ops.Ops.cosh,this.elu=unary_ops.Ops.elu,this.exp=unary_ops.Ops.exp,this.floor=unary_ops.Ops.floor,this.leakyRelu=unary_ops.Ops.leakyRelu,this.log=unary_ops.Ops.log,this.neg=unary_ops.Ops.neg,this.prelu=unary_ops.Ops.prelu,this.relu=unary_ops.Ops.relu,this.selu=unary_ops.Ops.selu,this.sigmoid=unary_ops.Ops.sigmoid,this.sin=unary_ops.Ops.sin,this.sinh=unary_ops.Ops.sinh,this.sqrt=unary_ops.Ops.sqrt,this.square=unary_ops.Ops.square,this.step=unary_ops.Ops.step,this.tan=unary_ops.Ops.tan,this.tanh=unary_ops.Ops.tanh,this.norm=norm.Ops.norm,this.basicLSTMCell=lstm_ops.Ops.basicLSTMCell,this.multiRNNCell=lstm_ops.Ops.multiRNNCell,this.softmax=softmax_ops.Ops.softmax,this.softmaxCrossEntropy=softmax_ops.Ops.softmaxCrossEntropy,this.cast=array_ops.Ops.cast,this.clone=array_ops.Ops.clone,this.gather=array_ops.Ops.gather,this.reshape=array_ops.Ops.reshape,this.tile=array_ops.Ops.tile,this.oneHot=array_ops.Ops.oneHot,this.multinomial=array_ops.Ops.multinomial,this.pad1D=array_ops.Ops.pad1d,this.pad2D=array_ops.Ops.pad2d,this.resizeBilinear3D=image_ops.Ops.resizeBilinear,this.localResponseNormalization3D=lrn_ops.LRN.localResponseNormalization,this.localResponseNormalization4D=lrn_ops.LRN.localResponseNormalization,this.keep=tracking_1.Tracking.keep,environment_1.ENV.setMath(this,s,r),this.engine=environment_1.ENV.engine,this.dispose=environment_1.ENV.engine.dispose.bind(environment_1.ENV.engine),this.registeredVariables=environment_1.ENV.engine.registeredVariables,this.startScope=environment_1.ENV.engine.startScope.bind(environment_1.ENV.engine),this.endScope=environment_1.ENV.engine.endScope.bind(environment_1.ENV.engine)}return s.prototype.scope=function(s){var r=function(s){return keep(s)},t=function(s){return s};return tidy(function(){return s(r,t)})},s.prototype.track=function(s){return s},s.prototype.topK=function(s,r){var t,i;return util.assert(r<=s.size,"Error in topK: k value ("+r+") must be less than size of input tensor, got shape "+s.shape+"."),tidy("topK",function(){return t=environment_1.ENV.engine.executeKernel("TopKValues",{inputs:{x:s},args:{k:r}}),i=environment_1.ENV.engine.executeKernel("TopKIndices",{inputs:{x:s},args:{k:r}}),t}),{values:t,indices:i}},s.prototype.elementWiseMul=function(s,r){return s.mulStrict(r)},s.prototype.scalarDividedByArray=function(s,r){return util.assert(1===s.size,"Error in scalarDividedByArray: first argument must be rank 0, but got Tensor of rank "+s.rank+"."),s.div(r)},s.prototype.arrayDividedByScalar=function(s,r){return util.assert(1===r.size,"Error in arrayDividedByScalar: second argument must be rank 0, but got Tensor of rank "+r.rank+"."),s.div(r)},s.prototype.switchDim=function(s,r){return ops.transpose(s,r)},s.prototype.scalarPlusArray=function(s,r){return util.assert(1===s.size,"Error in scalarPlusArray: first argument must be rank 0, but got rank "+s.rank+"."),this.add(s,r)},s.prototype.scalarMinusArray=function(s,r){return util.assert(1===s.size,"Error in scalarMinusArray: first argument must be rank 0, but got rank "+s.rank+"."),this.subtract(s,r)},s.prototype.arrayMinusScalar=function(s,r){return util.assert(1===r.size,"Error in arrayMinusScalar: second argument must be rank 0, but got rank "+r.rank+"."),this.subtract(s,r)},s.prototype.scaledArrayAdd=function(s,r,t,i){var e=this;return util.assert(1===s.size,"Error in scaledArrayAdd: first argument must rank 0, but got  rank "+s.rank+"."),util.assert(1===t.size,"Error in scaledArrayAdd: third argument must be rank 0, but got Tensor of rank "+t.rank+"."),util.assertShapesMatch(r.shape,i.shape,"Error in scaledArrayAdd: "),tidy("scaledArrayAdd",function(){return e.add(e.multiply(s,r),e.multiply(t,i))})},s.prototype.scalarTimesArray=function(s,r){return util.assert(1===s.size,"Error in arrayDividedByScalar: first argument must be rank 0, but got rank "+s.rank+"."),this.multiply(s,r)},s.prototype.concat=function(s,r,t){return ops.concat([s,r],t)},s.prototype.concat1D=function(s,r){return ops.concat1d([s,r])},s.prototype.concat2D=function(s,r,t){return ops.concat2d([s,r],t)},s.prototype.concat3D=function(s,r,t){return ops.concat3d([s,r],t)},s.prototype.concat4D=function(s,r,t){return ops.concat4d([s,r],t)},s.prototype.conv1d=function(s,r,t,i,e,o){return null!=t&&util.assert(1===t.rank,"Error in conv1d: bias must be rank 1, but got rank "+t.rank+"."),ops.conv1d(s,r,i,e,o).add(t)},s.prototype.conv2d=function(s,r,t,i,e,o){return null!=t&&util.assert(1===t.rank,"Error in conv2d: bias must be rank 1, but got rank "+t.rank+"."),ops.conv2d(s,r,i,e,o).add(t)},s.prototype.argMaxEquals=function(s,r){return util.assertShapesMatch(s.shape,r.shape,"Error in argMaxEquals: "),s.argMax().equal(r.argMax())},s}();exports.NDArrayMath=NDArrayMath;

},{"./environment":66,"./ops/array_ops":138,"./ops/batchnorm":140,"./ops/binary_ops":141,"./ops/compare":143,"./ops/conv":146,"./ops/image_ops":148,"./ops/logical_ops":149,"./ops/lrn":150,"./ops/lstm":151,"./ops/matmul":152,"./ops/norm":153,"./ops/ops":155,"./ops/pool":156,"./ops/reduction_ops":159,"./ops/reverse":160,"./ops/slice":162,"./ops/softmax":164,"./ops/transpose":165,"./ops/unary_ops":166,"./tracking":180,"./util":183}],138:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,n,r,o){var t,a=arguments.length,i=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,n,r,o);else for(var s=e.length-1;s>=0;s--)(t=e[s])&&(i=(a<3?t(i):a>3?t(n,r,i):t(n,r))||i);return a>3&&i&&Object.defineProperty(n,r,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),tensor_1=require("../tensor"),util=require("../util"),concat_1=require("./concat"),operation_1=require("./operation"),rand_1=require("./rand"),Ops=function(){function e(){}return e.tensor=function(e,n,r){void 0===r&&(r="float32");var o=util.inferShape(e);return null!=n&&1!==o.length&&util.assertShapesMatch(n,o,"Error creating a new Tensor. Inferred shape ("+o+") does not match the provided shape ("+n+"). "),util.isTypedArray(e)||Array.isArray(e)||(e=[e]),n=n||o,tensor_1.Tensor.make(n,{values:toTypedArray(e,r)},r)},e.scalar=function(n,r){if(void 0===r&&(r="float32"),util.isTypedArray(n)||Array.isArray(n))throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean)");return e.tensor(n,[],r)},e.tensor1d=function(n,r){void 0===r&&(r="float32");var o=util.inferShape(n);if(1!==o.length)throw new Error("Error creating a new Tensor1D: values must be a flat/TypedArray");return e.tensor(n,o,r)},e.tensor2d=function(n,r,o){void 0===o&&(o="float32");var t=util.inferShape(n);if(2!==t.length&&1!==t.length)throw new Error("Error creating a new Tensor2D: values must be number[][] or flat/TypedArray");return r=r||t,e.tensor(n,r,o)},e.tensor3d=function(n,r,o){void 0===o&&(o="float32");var t=util.inferShape(n);if(3!==t.length&&1!==t.length)throw new Error("Error creating a new Tensor3D: values must be number[][][]or flat/TypedArray");return r=r||t,e.tensor(n,r,o)},e.tensor4d=function(n,r,o){void 0===o&&(o="float32");var t=util.inferShape(n);if(4!==t.length&&1!==t.length)throw new Error("Error creating a new Tensor4D: values must be number[][][][]or flat/TypedArray");return r=r||t,e.tensor(n,r,o)},e.ones=function(e,n){void 0===n&&(n="float32");var r=makeOnesTypedArray(util.sizeFromShape(e),n);return tensor_1.Tensor.make(e,{values:r},n)},e.zeros=function(e,n){void 0===n&&(n="float32");var r=makeZerosTypedArray(util.sizeFromShape(e),n);return tensor_1.Tensor.make(e,{values:r},n)},e.fill=function(e,n,r){void 0===r&&(r="float32");var o=util.getTypedArrayFromDType(r,util.sizeFromShape(e));return o.fill(n),tensor_1.Tensor.make(e,{values:o},r)},e.onesLike=function(n){return e.ones(n.shape,n.dtype)},e.zerosLike=function(n){return e.zeros(n.shape,n.dtype)},e.clone=function(e){return tensor_1.Tensor.make(e.shape,{dataId:e.dataId},e.dtype)},e.randomNormal=function(e,n,r,o,t){if(void 0===n&&(n=0),void 0===r&&(r=1),null!=o&&"bool"===o)throw new Error("Unsupported data type "+o);var a=new rand_1.MPRandGauss(n,r,o,!1,t);return tensor_1.Tensor.rand(e,function(){return a.nextValue()},o)},e.truncatedNormal=function(e,n,r,o,t){if(void 0===n&&(n=0),void 0===r&&(r=1),null!=o&&"bool"===o)throw new Error("Unsupported data type "+o);var a=new rand_1.MPRandGauss(n,r,o,!0,t);return tensor_1.Tensor.rand(e,function(){return a.nextValue()},o)},e.randomUniform=function(e,n,r,o){return void 0===n&&(n=0),void 0===r&&(r=1),void 0===o&&(o="float32"),tensor_1.Tensor.rand(e,function(){return util.randUniform(n,r)},o)},e.rand=function(e,n,r){var o=util.sizeFromShape(e),t=null;if(null==r||"float32"===r)t=new Float32Array(o);else if("int32"===r)t=new Int32Array(o);else{if("bool"!==r)throw new Error("Unknown data type "+r);t=new Uint8Array(o)}for(var a=0;a<o;a++)t[a]=n();return tensor_1.Tensor.make(e,{values:t},r)},e.multinomial=function(e,n,r){var o=e.size;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(e.rank>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+e.rank);r=r||Math.random();var t=e.rank;1===e.rank&&(e=e.as2D(1,-1));var a=environment_1.ENV.engine.executeKernel("Multinomial",{inputs:{probs:e},args:{numSamples:n,seed:r}});return 1===t?a.as1D():a},e.oneHot=function(e,n,r,o){if(void 0===r&&(r=1),void 0===o&&(o=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);return environment_1.ENV.engine.executeKernel("OneHot",{inputs:{indices:e},args:{depth:n,onValue:r,offValue:o}})},e.fromPixels=function(e,n){if(void 0===n&&(n=3),n>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return environment_1.ENV.engine.fromPixels(e,n)},e.reshape=function(e,n){n=util.inferFromImplicitShape(n,e.size),util.assert(e.size===util.sizeFromShape(n),"new shape and old shape must have the same number of elements.");return environment_1.ENV.engine.executeKernel("Reshape",{inputs:{x:e},args:{newShape:n}},function(n,r){return{x:function(){return n.reshape(e.shape)}}})},e.squeeze=function(n,r){return e.reshape(n,util.squeezeShape(n.shape,r).newShape)},e.cast=function(e,n){return environment_1.ENV.engine.executeKernel("Cast",{inputs:{x:e},args:{newDType:n}},function(e,n){return{x:function(){return e.reshape(e.shape)}}})},e.tile=function(e,n){return util.assert(e.rank===n.length,"Error in transpose: rank of input "+e.rank+" must match length of reps "+n+"."),environment_1.ENV.engine.executeKernel("Tile",{inputs:{x:e},args:{reps:n}})},e.gather=function(e,n,r){return void 0===r&&(r=0),environment_1.ENV.engine.executeKernel("Gather",{inputs:{x:e,indices:n},args:{axis:r}})},e.pad1d=function(e,n,r){return void 0===r&&(r=0),util.assert(2===n.length,"Invalid number of paddings. Must be length of 2."),environment_1.ENV.engine.executeKernel("Pad1D",{inputs:{x:e},args:{paddings:n,constantValue:r}})},e.pad2d=function(e,n,r){return void 0===r&&(r=0),util.assert(2===n.length&&2===n[0].length&&2===n[1].length,"Invalid number of paddings. Must be length of 2 each."),environment_1.ENV.engine.executeKernel("Pad2D",{inputs:{x:e},args:{paddings:n,constantValue:r}})},e.pad=function(n,r,o){if(void 0===o&&(o=0),0===n.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");if(1===n.rank)return e.pad1d(n,r[0],o);if(2===n.rank)return e.pad2d(n,r,o);throw new Error("pad of rank-"+n.rank+" tensor is not yet supported")},e.stack=function(e,n){void 0===n&&(n=0),util.assert(e.length>=2,"Pass at least two tensors to dl.stack");var r=e[0].rank,o=e[0].shape,t=e[0].dtype;util.assert(n<=r,"Axis must be <= rank of the tensor"),e.forEach(function(e){util.assertShapesMatch(o,e.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(e){util.assert(t===e.dtype,"All tensors passed to stack must have matching dtypes")});var a=e.map(function(e){return e.expandDims(n)});return concat_1.Concat.concat(a,n)},e.expandDims=function(n,r){void 0===r&&(r=0),util.assert(r<=n.rank,"Axis must be <= rank of the tensor");var o=n.shape.slice();return o.splice(r,0,1),e.reshape(n,o)},e.linspace=function(e,n,r){if(0===r)throw new Error("Cannot request zero samples");var o=(n-e)/(r-1),t=makeZerosTypedArray(r,"float32");t[0]=e;for(var a=1;a<t.length;a++)t[a]=t[a-1]+o;return tensor_1.Tensor1D.new(t,"float32")},e.range=function(n,r,o,t){if(void 0===o&&(o=1),void 0===t&&(t="float32"),0===o)throw new Error("Cannot have a step of zero");if(n===r||n<r&&o<0||r<n&&o>1)return e.zeros([0],t);var a=makeZerosTypedArray(Math.abs(Math.ceil((r-n)/o)),t);r<n&&1===o&&(o=-1),a[0]=n;for(var i=1;i<a.length;i++)a[i]=a[i-1]+o;return e.tensor1d(a,t)},e.buffer=function(e,n,r){return void 0===n&&(n="float32"),new tensor_1.TensorBuffer(e,n,r)},e.print=function(e,n){void 0===n&&(n=!1);var r=new(function(){return function(){}}());r.shape=e.shape,r.values=Array.from(e.dataSync()),r.toString=function(){var r=["values: ["+this.values.join(", ")+"]","shape: ["+e.shape.join(", ")+"]","rank: "+e.rank];n&&(r.push("dtype: '"+this.dtype+"'"),r.push("size: "+this.size));for(var o=0;o<r.length;o++)r[o]="  "+r[o];return"TensorInfo {\n"+r.join(",\n")+"\n}"},n&&(r.dtype=e.dtype,r.size=e.size),console.log(r)},__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"})],e,"tensor",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"})],e,"scalar",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"})],e,"tensor1d",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"})],e,"tensor2d",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"})],e,"tensor3d",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"})],e,"tensor4d",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"}),operation_1.operation],e,"ones",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"}),operation_1.operation],e,"zeros",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"}),operation_1.operation],e,"fill",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"}),operation_1.operation],e,"onesLike",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"}),operation_1.operation],e,"zerosLike",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"}),operation_1.operation],e,"clone",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"}),operation_1.operation],e,"randomNormal",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"}),operation_1.operation],e,"truncatedNormal",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"}),operation_1.operation],e,"randomUniform",null),__decorate([operation_1.operation],e,"rand",null),__decorate([operation_1.operation],e,"multinomial",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"}),operation_1.operation],e,"oneHot",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"}),operation_1.operation],e,"fromPixels",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Transformations"}),operation_1.operation],e,"reshape",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Transformations"})],e,"squeeze",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Transformations"}),operation_1.operation],e,"cast",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Slicing and Joining"}),operation_1.operation],e,"tile",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Slicing and Joining"}),operation_1.operation],e,"gather",null),__decorate([operation_1.operation],e,"pad1d",null),__decorate([operation_1.operation],e,"pad2d",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Transformations"}),operation_1.operation],e,"pad",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Slicing and Joining"}),operation_1.operation],e,"stack",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Transformations"}),operation_1.operation],e,"expandDims",null),__decorate([operation_1.operation,doc_1.doc({heading:"Tensors",subheading:"Creation"})],e,"linspace",null),__decorate([operation_1.operation,doc_1.doc({heading:"Tensors",subheading:"Creation"})],e,"range",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"})],e,"buffer",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"})],e,"print",null),e}();function makeZerosTypedArray(e,n){if(null==n||"float32"===n)return new Float32Array(e);if("int32"===n)return new Int32Array(e);if("bool"===n)return new Uint8Array(e);throw new Error("Unknown data type $ {dtype}")}function makeOnesTypedArray(e,n){for(var r=makeZerosTypedArray(e,n),o=0;o<r.length;o++)r[o]=1;return r}function toTypedArray(e,n){return noConversionNeeded(e,n)?e:(Array.isArray(e)&&(e=util.flatten(e)),util.copyTypedArray(e,n))}function noConversionNeeded(e,n){return e instanceof Float32Array&&"float32"===n||e instanceof Int32Array&&"int32"===n||e instanceof Uint8Array&&"bool"===n}exports.Ops=Ops;

},{"../doc":64,"../environment":66,"../tensor":178,"../util":183,"./concat":144,"./operation":154,"./rand":157}],139:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function axesAreInnerMostDims(e,n){for(var t=0;t<e.length;++t)if(e[e.length-t-1]!==n-1-t)return!1;return!0}function combineLocations(e,n,t){for(var r=e.length+n.length,s=[],o=0,u=0,i=0;i<r;i++)-1===t.indexOf(i)?s.push(e[o++]):s.push(n[u++]);return s}function computeOutAndReduceShapes(e,n){for(var t=[],r=e.length,s=0;s<r;s++)-1===n.indexOf(s)&&t.push(e[s]);return[t,n.map(function(n){return e[n]})]}function expandShapeToKeepDim(e,n){return combineLocations(e,n.map(function(e){return 1}),n)}function parseAxisParam(e,n){var t=n.length;return e=null==e?n.map(function(e,n){return n}):[].concat(e),util.assert(e.every(function(e){return e>=-t&&e<t}),"All values in axis param must be in range [-"+t+", "+t+") but got axis "+e),util.assert(e.every(function(e){return util.isInt(e)}),"All values in axis param must be integers but got axis "+e),e.map(function(e){return e<0?t+e:e})}function assertAxesAreInnerMostDims(e,n,t){util.assert(axesAreInnerMostDims(n,t),e+" supports only inner-most axes for now. Got axes "+n+" and rank-"+t+" input.")}function getAxesPermutation(e,n){if(axesAreInnerMostDims(e,n))return null;for(var t=[],r=0;r<n;++r)-1===e.indexOf(r)&&t.push(r);return e.forEach(function(e){return t.push(e)}),t}function getUndoAxesPermutation(e){return e.map(function(e,n){return[n,e]}).sort(function(e,n){return e[1]-n[1]}).map(function(e){return e[0]})}function getInnerMostAxes(e,n){for(var t=[],r=n-e;r<n;++r)t.push(r);return t}exports.axesAreInnerMostDims=axesAreInnerMostDims,exports.combineLocations=combineLocations,exports.computeOutAndReduceShapes=computeOutAndReduceShapes,exports.expandShapeToKeepDim=expandShapeToKeepDim,exports.parseAxisParam=parseAxisParam,exports.assertAxesAreInnerMostDims=assertAxesAreInnerMostDims,exports.getAxesPermutation=getAxesPermutation,exports.getUndoAxesPermutation=getUndoAxesPermutation,exports.getInnerMostAxes=getInnerMostAxes;

},{"../util":183}],140:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(r,a,n,t){var o,e=arguments.length,i=e<3?a:null===t?t=Object.getOwnPropertyDescriptor(a,n):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(r,a,n,t);else for(var s=r.length-1;s>=0;s--)(o=r[s])&&(i=(e<3?o(i):e>3?o(a,n,i):o(a,n))||i);return e>3&&i&&Object.defineProperty(a,n,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),operation_1=require("./operation"),Ops=function(){function r(){}return r.batchNormalization2d=function(a,n,t,o,e,i){return void 0===o&&(o=.001),util.assert(2===a.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+a.rank+"."),util.assert(2===n.rank||1===n.rank,"Error in batchNormalization2D: mean must be rank 2 or rank 1 but got rank "+n.rank+"."),util.assert(2===t.rank||1===t.rank,"Error in batchNormalization2D: variance must be rank 2 or rank 1 but got rank "+t.rank+"."),null!=e&&util.assert(2===e.rank||1===e.rank,"Error in batchNormalization2D: scale must be rank 2 or rank 1 but got rank "+e.rank+"."),null!=i&&util.assert(2===i.rank||1===i.rank,"Error in batchNormalization2D: offset must be rank 2 or rank 1 but got rank "+i.rank+"."),r.batchNormalization(a,n,t,o,e,i)},r.batchNormalization3d=function(a,n,t,o,e,i){return void 0===o&&(o=.001),util.assert(3===a.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+a.rank+"."),util.assert(3===n.rank||1===n.rank,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but got rank "+n.rank+"."),util.assert(3===t.rank||1===t.rank,"Error in batchNormalization3D: variance must be rank 3 or rank 1 but got rank "+t.rank+"."),null!=e&&util.assert(3===e.rank||1===e.rank,"Error in batchNormalization3D: scale must be rank 3 or rank 1 but got rank "+e.rank+"."),null!=i&&util.assert(3===i.rank||1===i.rank,"Error in batchNormalization3D: offset must be rank 3 or rank 1 but got rank "+i.rank+"."),r.batchNormalization(a,n,t,o,e,i)},r.batchNormalization4d=function(a,n,t,o,e,i){return void 0===o&&(o=.001),util.assert(4===a.rank,"Error in batchNormalization4D: x must be rank 4 but got rank "+a.rank+"."),util.assert(4===n.rank||1===n.rank,"Error in batchNormalization4D: mean must be rank 4 or rank 1 but got rank "+n.rank+"."),util.assert(4===t.rank||1===t.rank,"Error in batchNormalization4D: variance must be rank 4 or rank 1 but got rank "+t.rank+"."),null!=e&&util.assert(4===e.rank||1===e.rank,"Error in batchNormalization4D: scale must be rank 4 or rank 1 but got rank "+e.rank+"."),null!=i&&util.assert(4===i.rank||1===i.rank,"Error in batchNormalization4D: offset must be rank 4 or rank 1 but got rank "+i.rank+"."),r.batchNormalization(a,n,t,o,e,i)},r.batchNormalization=function(r,a,n,t,o,e){var i;return void 0===t&&(t=.001),i=0===r.rank||1===r.rank?r.as4D(1,1,1,r.size):2===r.rank?r.as4D(1,1,r.shape[0],r.shape[1]):3===r.rank?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r,environment_1.ENV.engine.executeKernel("BatchNorm4D",{inputs:{x:i,mean:batchnormReshape4D(a),variance:batchnormReshape4D(n),scale:batchnormReshape4D(o),offset:batchnormReshape4D(e)},args:{varianceEpsilon:t}}).reshape(r.shape)},__decorate([operation_1.operation],r,"batchNormalization2d",null),__decorate([operation_1.operation],r,"batchNormalization3d",null),__decorate([operation_1.operation],r,"batchNormalization4d",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Normalization"})],r,"batchNormalization",null),r}();function batchnormReshape4D(r){return null==r?null:0===r.rank?r.as1D():1===r.rank?r:2===r.rank?r.as4D(1,1,r.shape[0],r.shape[1]):3===r.rank?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}exports.Ops=Ops;

},{"../doc":64,"../environment":66,"../util":183,"./operation":154}],141:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,t,r,a){var n,i=arguments.length,o=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,a);else for(var u=e.length-1;u>=0;u--)(n=e[u])&&(o=(i<3?n(o):i>3?n(t,r,o):n(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),broadcast_util=require("./broadcast_util"),operation_1=require("./operation"),ops_1=require("./ops"),Ops=function(){function e(){}return e.add=function(e,t){util.assertTypesMatch(e,t);var r=broadcast_util.assertAndGetBroadcastShape(e.shape,t.shape);return environment_1.ENV.engine.executeKernel("Add",{inputs:{a:e,b:t}},function(a,n){return{a:function(){var t=a,n=broadcast_util.getReductionAxes(e.shape,r);return n.length>0&&(t=t.sum(n)),t.reshape(e.shape)},b:function(){var e=a,n=broadcast_util.getReductionAxes(t.shape,r);return n.length>0&&(e=e.sum(n)),e.reshape(t.shape)}}})},e.addStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in addStrict: "),e.add(t)},e.sub=function(e,t){util.assertTypesMatch(e,t);var r=broadcast_util.assertAndGetBroadcastShape(e.shape,t.shape);return environment_1.ENV.engine.executeKernel("Sub",{inputs:{a:e,b:t}},function(a,n){return{a:function(){var t=a,n=broadcast_util.getReductionAxes(e.shape,r);return n.length>0&&(t=t.sum(n)),t.reshape(e.shape)},b:function(){var e=a,n=broadcast_util.getReductionAxes(t.shape,r);return n.length>0&&(e=e.sum(n)),e.neg().reshape(t.shape)}}})},e.subStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in subStrict: "),e.sub(t)},e.pow=function(e,t){util.assert("int32"===t.dtype,"only supports int32 data type for the exponent parameter."),broadcast_util.assertAndGetBroadcastShape(e.shape,t.shape);return environment_1.ENV.engine.executeKernel("Pow",{inputs:{base:e,exp:t}},function(r,a){if(!util.arraysEqual(e.shape,t.shape)&&!util.isScalarShape(t.shape))throw new Error("Gradient of pow not yet supported for broadcasted shapes.");return{base:function(){var a=t.toFloat().mul(e.pow(t.sub(ops_1.scalar(1,"int32"))).toFloat());return r.mul(a)},exp:function(){throw new Error("Backprop through exponent not implemented yet.")}}})},e.powStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in powStrict: "),e.pow(t)},e.mul=function(e,t){util.assertTypesMatch(e,t);var r=broadcast_util.assertAndGetBroadcastShape(e.shape,t.shape);return environment_1.ENV.engine.executeKernel("Mul",{inputs:{a:e,b:t}},function(a,n){return{a:function(){var n=a.mul(t.toFloat()),i=broadcast_util.getReductionAxes(e.shape,r);return i.length>0?n.sum(i).reshape(e.shape):n},b:function(){var n=a.mul(e.toFloat()),i=broadcast_util.getReductionAxes(t.shape,r);return i.length>0?n.sum(i).reshape(t.shape):n}}})},e.mulStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in multiplyStrict: "),e.mul(t)},e.div=function(e,t){var r=broadcast_util.assertAndGetBroadcastShape(e.shape,t.shape);return environment_1.ENV.engine.executeKernel("Div",{inputs:{a:e,b:t}},function(a,n){return{a:function(){var n=a.div(t.toFloat()),i=broadcast_util.getReductionAxes(e.shape,r);return i.length>0?n.sum(i).reshape(e.shape):n},b:function(){var n=a.mul(e.toFloat()),i=broadcast_util.getReductionAxes(t.shape,r);i.length>0&&(n=n.sum(i).reshape(t.shape));var o=t.square();return n.div(o.toFloat()).neg()}}})},e.divStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in divideStrict: "),e.div(t)},e.minimum=function(e,t){util.assertTypesMatch(e,t),broadcast_util.assertAndGetBroadcastShape(e.shape,t.shape);return environment_1.ENV.engine.executeKernel("Minimum",{inputs:{a:e,b:t}},function(r,a){return{a:function(){return r.mul(e.lessEqual(t).toFloat())},b:function(){return r.mul(e.greater(t).toFloat())}}})},e.minimumStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in minimumStrict: "),e.minimum(t)},e.maximum=function(e,t){util.assertTypesMatch(e,t),broadcast_util.assertAndGetBroadcastShape(e.shape,t.shape);return environment_1.ENV.engine.executeKernel("Maximum",{inputs:{a:e,b:t}},function(r,a){return{a:function(){return r.mul(e.greaterEqual(t).toFloat())},b:function(){return r.mul(e.less(t).toFloat())}}})},e.maximumStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in minimumStrict: "),e.maximum(t)},__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"add",null),__decorate([operation_1.operation],e,"addStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"sub",null),__decorate([operation_1.operation],e,"subStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"pow",null),__decorate([operation_1.operation],e,"powStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"mul",null),__decorate([operation_1.operation],e,"mulStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"div",null),__decorate([operation_1.operation],e,"divStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"minimum",null),__decorate([operation_1.operation],e,"minimumStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"maximum",null),__decorate([operation_1.operation],e,"maximumStrict",null),e}();exports.Ops=Ops;

},{"../doc":64,"../environment":66,"../util":183,"./broadcast_util":142,"./operation":154,"./ops":155}],142:[function(require,module,exports){
"use strict";function getBroadcastDims(t,e){for(var r=t.length,a=[],s=0;s<r;s++){var n=r-1-s,o=t[n]||1;(e[e.length-1-s]||1)>1&&1===o&&a.unshift(n)}return a}function getReductionAxes(t,e){for(var r=[],a=0;a<e.length;a++){var s=t[t.length-a-1],n=e.length-a-1,o=e[n];(null==s||1===s&&o>1)&&r.unshift(n)}return r}function broadcastDimsAreOuter(t){for(var e=0;e<t.length;e++)if(t[e]!==e)return!1;return!0}function assertAndGetBroadcastShape(t,e){for(var r=[],a="Operands could not be broadcast together with shapes "+t+" and "+e+".",s=Math.max(t.length,e.length),n=0;n<s;n++){var o=t[t.length-n-1]||1,u=e[e.length-n-1]||1;if(o>1&&u>1&&o!==u)throw Error(a);r.unshift(Math.max(o,u))}return r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getBroadcastDims=getBroadcastDims,exports.getReductionAxes=getReductionAxes,exports.broadcastDimsAreOuter=broadcastDimsAreOuter,exports.assertAndGetBroadcastShape=assertAndGetBroadcastShape;

},{}],143:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,t,a,r){var n,o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,a):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,a,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(o<3?n(i):o>3?n(t,a,i):n(t,a))||i);return o>3&&i&&Object.defineProperty(t,a,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),broadcast_util=require("./broadcast_util"),operation_1=require("./operation"),Ops=function(){function e(){}return e.notEqual=function(e,t){return util.assertTypesMatch(e,t),broadcast_util.assertAndGetBroadcastShape(e.shape,t.shape),environment_1.ENV.engine.executeKernel("NotEqual",{inputs:{a:e,b:t}})},e.notEqualStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in notEqualStrict: "),e.notEqual(t)},e.less=function(e,t){return util.assertTypesMatch(e,t),broadcast_util.assertAndGetBroadcastShape(e.shape,t.shape),environment_1.ENV.engine.executeKernel("Less",{inputs:{a:e,b:t}})},e.lessStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in lessStrict: "),e.less(t)},e.equal=function(e,t){return util.assertTypesMatch(e,t),broadcast_util.assertAndGetBroadcastShape(e.shape,t.shape),environment_1.ENV.engine.executeKernel("Equal",{inputs:{a:e,b:t}})},e.equalStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in equalStrict: "),e.equal(t)},e.lessEqual=function(e,t){return util.assertTypesMatch(e,t),broadcast_util.assertAndGetBroadcastShape(e.shape,t.shape),environment_1.ENV.engine.executeKernel("LessEqual",{inputs:{a:e,b:t}})},e.lessEqualStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in lessEqualStrict: "),e.lessEqual(t)},e.greater=function(e,t){return util.assertTypesMatch(e,t),broadcast_util.assertAndGetBroadcastShape(e.shape,t.shape),environment_1.ENV.engine.executeKernel("Greater",{inputs:{a:e,b:t}})},e.greaterStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in greaterStrict: "),e.greater(t)},e.greaterEqual=function(e,t){return util.assertTypesMatch(e,t),broadcast_util.assertAndGetBroadcastShape(e.shape,t.shape),environment_1.ENV.engine.executeKernel("GreaterEqual",{inputs:{a:e,b:t}})},e.greaterEqualStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in greaterEqualStrict: "),e.greaterEqual(t)},__decorate([doc_1.doc({heading:"Operations",subheading:"Logical"}),operation_1.operation],e,"notEqual",null),__decorate([operation_1.operation],e,"notEqualStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Logical"}),operation_1.operation],e,"less",null),__decorate([operation_1.operation],e,"lessStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Logical"}),operation_1.operation],e,"equal",null),__decorate([operation_1.operation],e,"equalStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Logical"}),operation_1.operation],e,"lessEqual",null),__decorate([operation_1.operation],e,"lessEqualStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Logical"}),operation_1.operation],e,"greater",null),__decorate([operation_1.operation],e,"greaterStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Logical"}),operation_1.operation],e,"greaterEqual",null),__decorate([operation_1.operation],e,"greaterEqualStrict",null),e}();exports.Ops=Ops;

},{"../doc":64,"../environment":66,"../util":183,"./broadcast_util":142,"./operation":154}],144:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,t,n,c){var o,r=arguments.length,a=r<3?t:null===c?c=Object.getOwnPropertyDescriptor(t,n):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,c);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),concat_util=require("./concat_util"),operation_1=require("./operation"),Concat=function(){function e(){}return e.concat1d=function(t){return e.concat(t,0)},e.concat2d=function(t,n){return e.concat(t,n)},e.concat3d=function(t,n){return e.concat(t,n)},e.concat4d=function(t,n){return e.concat(t,n)},e.concat=function(e,t){void 0===t&&(t=0),util.assert(e.length>=2,"Pass at least two tensors to concat");for(var n=e[0],c=1;c<e.length;++c)n=concat2Tensors(n,e[c],t);return n},__decorate([doc_1.doc({heading:"Tensors",subheading:"Slicing and Joining"}),operation_1.operation],e,"concat",null),e}();function concat2Tensors(e,t,n){concat_util.assertParams(e.shape,t.shape,n);var c=concat_util.computeOutShape(e.shape,t.shape,n),o=e.as2D(-1,util.sizeFromShape(e.shape.slice(n))),r=t.as2D(-1,util.sizeFromShape(t.shape.slice(n))),a=concat_util.computeGradientSliceShapes(o.shape,r.shape),i=a.aBegin,u=a.aSize,s=a.bBegin,l=a.bSize;return environment_1.ENV.engine.executeKernel("Concat",{inputs:{a:o,b:r}},function(e){return{a:function(){return e.slice(i,u)},b:function(){return e.slice(s,l)}}}).reshape(c)}exports.Concat=Concat;

},{"../doc":64,"../environment":66,"../util":183,"./concat_util":145,"./operation":154}],145:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function assertParams(e,t,a){var r=e.length,n=t.length;util.assert(e.length===t.length,"Error in concat"+r+"D: rank of x1 ("+r+") and x2 ("+n+") must be the same."),util.assert(a>=0&&a<r,"Error in concat"+r+"D: axis must be between 0 and "+(r-1)+".");for(var s=0;s<r;s++)util.assert(s===a||e[s]===t[s],"Error in concat"+r+"D: Shape ("+e+") does not match ("+t+") along the non-concatenated axis "+s+".")}function computeOutShape1D(e,t){util.assert(1===e.length&&1===t.length,"x1 and x2 should be 1d array.");var a=e.slice();return a[0]+=t[0],a}function computeOutShape(e,t,a){util.assert(e.length===t.length,"x1 and x2 should have the same rank.");var r=e.slice();return r[a]+=t[a],r}function computeGradientSliceShapes(e,t){return{aBegin:[0,0],aSize:e,bBegin:[0,e[1]],bSize:t}}exports.assertParams=assertParams,exports.computeOutShape1D=computeOutShape1D,exports.computeOutShape=computeOutShape,exports.computeGradientSliceShapes=computeGradientSliceShapes;

},{"../util":183}],146:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,n,t,r){var a,o=arguments.length,s=o<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,n,t,r);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o<3?a(s):o>3?a(n,t,s):a(n,t))||s);return o>3&&s&&Object.defineProperty(n,t,s),s};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),conv_util=require("./conv_util"),operation_1=require("./operation"),Ops=function(){function e(){}return e.conv1d=function(n,t,r,a,o){var s=n,i=!1;2===n.rank&&(i=!0,s=n.as3D(1,n.shape[0],n.shape[1])),util.assert(3===s.rank,"Error in conv1d: input must be rank 3, but got rank "+s.rank+"."),util.assert(3===t.rank,"Error in conv1d: filter must be rank 3, but got rank "+t.rank+"."),null!=o&&util.assert(util.isInt(a),"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."),util.assert(s.shape[2]===t.shape[1],"Error in conv1d: depth of input ("+s.shape[2]+") must match  input depth for filter "+t.shape[1]+".");var u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),p=s.as4D(s.shape[0],1,s.shape[1],s.shape[2]),h=[1,r],d=e.conv2d(p,u,h,a,o);return i?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])},e.conv2d=function(n,t,r,a,o){var s=n,i=!1;3===n.rank&&(i=!0,s=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),util.assert(4===s.rank,"Error in conv2d: input must be rank 4, but got rank "+s.rank+"."),util.assert(4===t.rank,"Error in conv2d: filter must be rank 4, but got rank "+t.rank+"."),null!=o&&util.assert(util.isInt(a),"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."),util.assert(s.shape[3]===t.shape[2],"Error in conv2d: depth of input ("+s.shape[3]+") must match  input depth for filter "+t.shape[2]+".");var u=conv_util.computeConv2DInfo(s.shape,t.shape,r,a,o),p=environment_1.ENV.engine.executeKernel("Conv2D",{inputs:{x:s,filter:t},args:{convInfo:u}},function(n,o){return{x:function(){return e.conv2dDerInput(s.shape,n,t,r,a)},filter:function(){return e.conv2dDerFilter(s,n,t.shape,r,a)}}});return i?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p},e.conv2dDerInput=function(e,n,t,r,a,o){util.assert(e.length===n.rank,"Length of inShape ("+e.length+") and rank of dy ("+n.rank+") must match");var s=e,i=n,u=!1;3===n.rank&&(u=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),s=[1,e[0],e[1],e[2]]);var p=s[3],h=i.shape[3];util.assert(4===s.length,"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."),util.assert(4===i.rank,"Error in conv2dDerInput: dy must be rank 4, but got rank "+i.rank),util.assert(4===t.rank,"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank),util.assert(p===t.shape[2],"Error in conv2dDerInput: depth of input ("+p+") must match input depth for filter "+t.shape[2]+"."),util.assert(h===t.shape[3],"Error in conv2dDerInput: depth of output ("+h+") mustmatch output depth for filter "+t.shape[3]+"."),null!=o&&util.assert(util.isInt(a),"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+".");var d=conv_util.computeConv2DInfo(s,t.shape,r,a,o),l=environment_1.ENV.engine.executeKernel("Conv2DDerInput",{inputs:{dy:i,filter:t},args:{convInfo:d}});return u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l},e.conv2dDerFilter=function(e,n,t,r,a,o){var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=n;3===i.rank&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),util.assert(4===s.rank,"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."),util.assert(4===i.rank,"Error in conv2dDerFilter: dy must be rank 4, but got shape "+i.shape+"."),util.assert(4===t.length,"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."),util.assert(s.shape[3]===t[2],"Error in conv2dDerFilter: depth of input "+s.shape[3]+") must match input depth in filter ("+t[2]+"."),util.assert(i.shape[3]===t[3],"Error in conv2dDerFilter: depth of dy ("+i.shape[3]+") must match output depth for filter ("+t[3]+")."),null!=o&&util.assert(util.isInt(a),"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+".");var u=conv_util.computeConv2DInfo(s.shape,t,r,a,o);return environment_1.ENV.engine.executeKernel("Conv2DDerFilter",{inputs:{x:s,dy:i},args:{convInfo:u}})},e.conv2dTranspose=function(n,t,r,a,o,s){return e.conv2dDerInput(r,n,t,a,o,s)},e.depthwiseConv2d=function(e,n,t,r,a,o){void 0===a&&(a=[1,1]);var s=e,i=!1;3===e.rank&&(i=!0,s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),util.assert(4===s.rank,"Error in depthwiseConv2D: input must be rank 4, but got rank "+s.rank+"."),util.assert(4===n.rank,"Error in depthwiseConv2D: filter must be rank 4, but got rank "+n.rank+"."),util.assert(s.shape[3]===n.shape[2],"Error in depthwiseConv2D: number of input channels ("+s.shape[3]+") must match the inChannels dimension in filter "+n.shape[2]+".");var u=parseTupleParam(a=a||[1,1]),p=u[0],h=u[1];util.assert(1===p&&1===h,"Error in depthwiseConv2D: rates greater than 1 are not yet supported. Got rates '"+a+"'"),null!=o&&util.assert(util.isInt(r),"Error in depthwiseConv2D: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+".");var d=conv_util.computeConv2DInfo(s.shape,n.shape,t,r,o,!0),l=environment_1.ENV.engine.executeKernel("DepthwiseConv2D",{inputs:{x:s,filter:n},args:{convInfo:d}});return i?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l},__decorate([doc_1.doc({heading:"Operations",subheading:"Convolution"}),operation_1.operation],e,"conv1d",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Convolution"}),operation_1.operation],e,"conv2d",null),__decorate([operation_1.operation],e,"conv2dDerInput",null),__decorate([operation_1.operation],e,"conv2dDerFilter",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Convolution"}),operation_1.operation],e,"conv2dTranspose",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Convolution"}),operation_1.operation],e,"depthwiseConv2d",null),e}();function parseTupleParam(e){return"number"==typeof e?[e,e]:e}exports.Ops=Ops;

},{"../doc":64,"../environment":66,"../util":183,"./conv_util":147,"./operation":154}],147:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function computePool2DInfo(t,e,o,n,r,a){void 0===a&&(a="channelsLast");var u,i=parseTupleParam(e),p=i[0],h=i[1];if("channelsLast"===a)u=[p,h,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);u=[p,h,t[1],t[1]]}return computeConv2DInfo(t,u,o,n,r,!1,a)}function computeConv2DInfo(t,e,o,n,r,a,u){void 0===a&&(a=!1),void 0===u&&(u="channelsLast");var i=[-1,-1,-1,-1],p=i[0],h=i[1],l=i[2],s=i[3];if("channelsLast"===u)p=t[0],h=t[1],l=t[2],s=t[3];else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat "+u);p=t[0],s=t[1],h=t[2],l=t[3]}var c,d=e[0],f=e[1],m=e[3],D=parseTupleParam(o),g=D[0],v=D[1],I=getPadAndOutInfo(n,h,l,g,v,d,f,r),w=I.padInfo,P=I.outHeight,M=I.outWidth,C=a?m*s:m;return"channelsFirst"===u?c=[p,C,P,M]:"channelsLast"===u&&(c=[p,P,M,C]),{batchSize:p,dataFormat:u,inHeight:h,inWidth:l,inChannels:s,outHeight:P,outWidth:M,outChannels:C,padInfo:w,strideHeight:g,strideWidth:v,filterHeight:d,filterWidth:f,inShape:t,outShape:c,filterShape:e}}function computeOutputShape3D(t,e,o,n,r,a){null==r&&(r=computeDefaultPad(t,e,n));var u=t[0],i=t[1],p=conditionalRound((u-e+2*r)/n+1,a);util.assert(util.isInt(p),"The output # of rows ("+p+") must be an integer. Change the stride and/or zero pad parameters");var h=conditionalRound((i-e+2*r)/n+1,a);return util.assert(util.isInt(h),"The output # of columns ("+h+") must be an integer. Change the stride and/or zero pad parameters"),[p,h,o]}function computeDefaultPad(t,e,o){return Math.floor((t[0]*(o-1)-o+e)/2)}function computeWeightsShape4D(t,e,o,n){return[o,n,t,e]}function computeDilatedRC(t,e){return[(t[0]-1)*e+1,(t[1]-1)*e+1]}function parseTupleParam(t){return"number"==typeof t?[t,t]:t}function getPadAndOutInfo(t,e,o,n,r,a,u,i){var p,h,l;if("number"==typeof t){p={top:t,bottom:t,left:t,right:t};var s=computeOutputShape3D([e,o,1],a,1,n,t,i);h=s[0],l=s[1]}else if("same"===t){var c=((h=Math.ceil(e/n))-1)*n+a-e,d=((l=Math.ceil(o/r))-1)*r+u-o,f=Math.floor(c/2),m=c-f,D=Math.floor(d/2);p={top:f,bottom:m,left:D,right:d-D}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);p={top:0,bottom:0,left:0,right:0},h=Math.ceil((e-a+1)/n),l=Math.ceil((o-u+1)/r)}return{padInfo:p,outHeight:h,outWidth:l}}function conditionalRound(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}exports.computePool2DInfo=computePool2DInfo,exports.computeConv2DInfo=computeConv2DInfo,exports.computeOutputShape3D=computeOutputShape3D,exports.computeDefaultPad=computeDefaultPad,exports.computeWeightsShape4D=computeWeightsShape4D,exports.computeDilatedRC=computeDilatedRC;

},{"../util":183}],148:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,r,n,t){var i,a=arguments.length,o=a<3?r:null===t?t=Object.getOwnPropertyDescriptor(r,n):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,r,n,t);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(r,n,o):i(r,n))||o);return a>3&&o&&Object.defineProperty(r,n,o),o};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),operation_1=require("./operation"),Ops=function(){function e(){}return e.resizeBilinear=function(e,r,n){void 0===n&&(n=!1),util.assert(3===e.rank||4===e.rank,"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+e.rank+"."),util.assert(2===r.length,"Error in resizeBilinear: new shape must 2D, but got shape "+r+".");var t=e,i=!1;3===e.rank&&(i=!0,t=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=r[0],o=r[1],s=environment_1.ENV.engine.executeKernel("ResizeBilinear",{inputs:{x:t},args:{newHeight:a,newWidth:o,alignCorners:n}});return i?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s},__decorate([doc_1.doc({heading:"Operations",subheading:"Images",namespace:"image"}),operation_1.operation],e,"resizeBilinear",null),e}();exports.Ops=Ops;

},{"../doc":64,"../environment":66,"../util":183,"./operation":154}],149:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,o,t,r){var a,n=arguments.length,i=n<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,o,t,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(n<3?a(i):n>3?a(o,t,i):a(o,t))||i);return n>3&&i&&Object.defineProperty(o,t,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),types=require("../types"),util=require("../util"),broadcast_util=require("./broadcast_util"),operation_1=require("./operation"),Ops=function(){function e(){}return e.logicalNot=function(e){return util.assert("bool"===e.dtype,"Error Array must be of type bool."),environment_1.ENV.engine.executeKernel("LogicalNot",{inputs:{x:e}})},e.logicalAnd=function(e,o){return util.assert("bool"===e.dtype&&"bool"===o.dtype,"Error Array must be of type bool."),broadcast_util.assertAndGetBroadcastShape(e.shape,o.shape),environment_1.ENV.engine.executeKernel("LogicalAnd",{inputs:{a:e,b:o}})},e.logicalOr=function(e,o){return util.assert("bool"===e.dtype&&"bool"===o.dtype,"Error Array must be of type bool."),broadcast_util.assertAndGetBroadcastShape(e.shape,o.shape),environment_1.ENV.engine.executeKernel("LogicalOr",{inputs:{a:e,b:o}})},e.logicalXor=function(e,o){return util.assert("bool"===e.dtype&&"bool"===o.dtype,"Error Array must be of type bool."),broadcast_util.assertAndGetBroadcastShape(e.shape,o.shape),environment_1.ENV.engine.executeKernel("LogicalXor",{inputs:{a:e,b:o}})},e.where=function(e,o,t){util.assert("bool"===e.dtype||"bool"===o.dtype||"bool"===t.dtype,"Error Array must be of type bool."),util.assertShapesMatch(o.shape,t.shape,"Error in where: "),1===e.rank?util.assert(e.shape[0]===o.shape[0],"The first dimension of `a` must match the size of `condition`."):util.assertShapesMatch(e.shape,t.shape,"Error in where: ");var r=types.upcastType(o.dtype,t.dtype);return environment_1.ENV.engine.executeKernel("Where",{inputs:{condition:e,a:o,b:t},args:{dtype:r}})},__decorate([doc_1.doc({heading:"Operations",subheading:"Logical"}),operation_1.operation],e,"logicalNot",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Logical"}),operation_1.operation],e,"logicalAnd",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Logical"}),operation_1.operation],e,"logicalOr",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Logical"}),operation_1.operation],e,"logicalXor",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Logical"}),operation_1.operation],e,"where",null),e}();exports.Ops=Ops;

},{"../doc":64,"../environment":66,"../types":182,"../util":183,"./broadcast_util":142,"./operation":154}],150:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,r,o,n){var t,a=arguments.length,i=a<3?r:null===n?n=Object.getOwnPropertyDescriptor(r,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,o,n);else for(var s=e.length-1;s>=0;s--)(t=e[s])&&(i=(a<3?t(i):a>3?t(r,o,i):t(r,o))||i);return a>3&&i&&Object.defineProperty(r,o,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),operation_1=require("./operation"),LRN=function(){function e(){}return e.localResponseNormalization=function(e,r,o,n,t,a){void 0===r&&(r=5),void 0===o&&(o=1),void 0===n&&(n=1),void 0===t&&(t=.5),void 0===a&&(a="acrossChannels"),util.assert(4===e.rank||3===e.rank,"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+e.rank+"."),util.assert(util.isInt(r),"Error in localResponseNormalization3D: radius must be an integer\n                     but got radius "+r+".");var i=e,s=!1;3===e.rank&&(s=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var l=environment_1.ENV.engine.executeKernel("LRN4D",{inputs:{x:i},args:{radius:r,bias:o,alpha:n,beta:t,normRegion:a}});return s?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l},__decorate([doc_1.doc({heading:"Operations",subheading:"Normalization"}),operation_1.operation],e,"localResponseNormalization",null),e}();exports.LRN=LRN;

},{"../doc":64,"../environment":66,"../util":183,"./operation":154}],151:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,c=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(c=(n<3?i(c):n>3?i(t,r,c):i(t,r))||c);return n>3&&c&&Object.defineProperty(t,r,c),c};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),operation_1=require("./operation"),Ops=function(){function e(){}return e.multiRNNCell=function(e,t,r,o){for(var i=t,n=[],c=0;c<e.length;c++){var a=e[c](i,r[c],o[c]);n.push(a[0]),n.push(a[1]),i=a[1]}var l=[],s=[];for(c=0;c<n.length;c+=2)l.push(n[c]),s.push(n[c+1]);return[l,s]},e.basicLSTMCell=function(e,t,r,o,i,n){var c=o.concat(n,1).matMul(t).add(r),a=c.shape[0],l=c.shape[1]/4,s=[a,l],u=c.slice([0,0],s),d=c.slice([0,l],s),p=c.slice([0,2*l],s),h=c.slice([0,3*l],s),f=u.sigmoid().mulStrict(d.tanh()).addStrict(i.mulStrict(e.add(p).sigmoid())),_=f.tanh().mulStrict(h.sigmoid());return[f,_]},__decorate([doc_1.doc({heading:"Operations",subheading:"RNN"}),operation_1.operation],e,"multiRNNCell",null),__decorate([doc_1.doc({heading:"Operations",subheading:"RNN"}),operation_1.operation],e,"basicLSTMCell",null),e}();exports.Ops=Ops;

},{"../doc":64,"./operation":154}],152:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(t,r,e,n){var a,o=arguments.length,i=o<3?r:null===n?n=Object.getOwnPropertyDescriptor(r,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,r,e,n);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(i=(o<3?a(i):o>3?a(r,e,i):a(r,e))||i);return o>3&&i&&Object.defineProperty(r,e,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),matmul_1=require("../kernels/types/matmul"),util=require("../util"),operation_1=require("./operation"),Ops=function(){function t(){}return t.matMul=function(t,r,e,n){void 0===e&&(e=!1),void 0===n&&(n=!1),a=[enumToBool(e),enumToBool(n)],n=a[1];var a,o=(e=a[0])?t.shape[0]:t.shape[1],i=n?r.shape[1]:r.shape[0];return util.assert(2===t.rank&&2===r.rank,"Error in matMul: inputs must be rank 2, got ranks "+t.rank+" and "+r.rank+"."),util.assert(o===i,"Error in matMul: inner shapes ("+o+") and ("+i+") of Tensors with shapes "+t.shape+" and "+r.shape+" and transposeA="+e+" and transposeB="+n+" must match."),environment_1.ENV.engine.executeKernel("MatMul",{inputs:{a:t,b:r},args:{transposeA:e,transposeB:n}},function(a,o){if(e||n)throw new Error("Backprop for transposed MatMul not yet implemented.");return{a:function(){return a.matMul(r.toFloat(),!1,!0)},b:function(){return t.toFloat().matMul(a,!0,!1)}}})},t.vectorTimesMatrix=function(t,r){return util.assert(1===t.rank,"Error in vectorTimesMatrix: first input must be rank 1, but got rank "+t.rank+"."),util.assert(2===r.rank,"Error in vectorTimesMatrix: second input must be rank 2, but got rank "+r.rank+"."),util.assert(t.size===r.shape[0],"Error in vectorTimesMatrix: size of vector ("+t.size+") must match first dimension of matrix ("+r.shape[0]+")"),t.as2D(1,-1).matMul(r).as1D()},t.matrixTimesVector=function(t,r){return util.assert(1===r.rank,"Error in matrixTimesVector: second input must rank 1, but got rank "+r.rank+"."),util.assert(2===t.rank,"Error in matrixTimesVector: first input must be a rank 2, but got rank "+t.rank+"."),util.assert(r.size===t.shape[1],"Error in matrixTimesVector: size of first rank 1 input "+r.size+" must match inner dimension of second rank 2 input, but got shape "+t.shape+"."),t.matMul(r.as2D(-1,1)).as1D()},t.dotProduct=function(t,r){return util.assert(1===t.rank&&1===r.rank,"Error in dotProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."),util.assert(t.size===r.size,"Error in dotProduct: size of inputs ("+t.size+") and ("+r.size+") must match."),t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar()},t.outerProduct=function(t,r){return util.assert(1===t.rank&&1===r.rank,"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."),t.as2D(-1,1).matMul(r.as2D(1,-1))},__decorate([doc_1.doc({heading:"Operations",subheading:"Matrices"}),operation_1.operation],t,"matMul",null),__decorate([operation_1.operation],t,"vectorTimesMatrix",null),__decorate([operation_1.operation],t,"matrixTimesVector",null),__decorate([operation_1.operation],t,"dotProduct",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Matrices"}),operation_1.operation],t,"outerProduct",null),t}();function enumToBool(t){return t!==matmul_1.MatrixOrientation.REGULAR&&(t===matmul_1.MatrixOrientation.TRANSPOSED||t)}exports.Ops=Ops;

},{"../doc":64,"../environment":66,"../kernels/types/matmul":103,"../util":183,"./operation":154}],153:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(r,e,n,i){var o,t=arguments.length,a=t<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(r,e,n,i);else for(var s=r.length-1;s>=0;s--)(o=r[s])&&(a=(t<3?o(a):t>3?o(e,n,a):o(e,n))||a);return t>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),axis_util=require("./axis_util"),operation_1=require("./operation"),ops=require("./ops"),Ops=function(){function r(){}return r.norm=function(r,e,n,i){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===i&&(i=!1);var o=normImpl(r,e,n),t=o.shape;if(i){var a=axis_util.parseAxisParam(n,r.shape);t=axis_util.expandShapeToKeepDim(o.shape,a)}return o.reshape(t)},__decorate([doc_1.doc({heading:"Operations",subheading:"Matrices"}),operation_1.operation],r,"norm",null),r}();function normImpl(r,e,n){if(void 0===n&&(n=null),0===r.rank)return r.abs();if(1!==r.rank&&null===n)return normImpl(r.reshape([-1]),e,n);if(1===r.rank||"number"==typeof n||n instanceof Array&&1===n.length){if(1===e)return r.abs().sum(n);if(e===1/0)return r.abs().max(n);if(e===-1/0)return r.abs().min(n);if("euclidean"===e||2===e)return r.abs().pow(ops.scalar(2,"int32")).sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}if(n instanceof Array&&2===n.length){if(1===e)return r.abs().sum(n[0]).max(n[1]-1);if(e===1/0)return r.abs().sum(n[1]).max(n[0]);if(e===-1/0)return r.abs().sum(n[1]).min(n[0]);if("fro"===e||"euclidean"===e)return r.square().sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+n)}exports.Ops=Ops;

},{"../doc":64,"./axis_util":139,"./operation":154,"./ops":155}],154:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../globals");function operation(e,r,o){var t=o.value;return o.value=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return globals_1.tidy(r,function(){return t.apply(void 0,e)})},o}exports.operation=operation;

},{"../globals":67}],155:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var array_ops=require("./array_ops"),batchnorm_ops=require("./batchnorm"),binary_ops=require("./binary_ops"),compare_ops=require("./compare"),concat_ops=require("./concat"),conv_ops=require("./conv"),image_ops=require("./image_ops"),logical_ops=require("./logical_ops"),lrn_ops=require("./lrn"),lstm_ops=require("./lstm"),matmul_ops=require("./matmul"),norm_ops=require("./norm"),pool_ops=require("./pool"),reduction_ops=require("./reduction_ops"),reverse_ops=require("./reverse"),slice_ops=require("./slice"),softmax_ops=require("./softmax"),transpose_ops=require("./transpose"),unary_ops=require("./unary_ops");exports.batchNormalization=batchnorm_ops.Ops.batchNormalization,exports.batchNormalization2d=batchnorm_ops.Ops.batchNormalization2d,exports.batchNormalization3d=batchnorm_ops.Ops.batchNormalization3d,exports.batchNormalization4d=batchnorm_ops.Ops.batchNormalization4d,exports.concat=concat_ops.Concat.concat,exports.concat1d=concat_ops.Concat.concat1d,exports.concat2d=concat_ops.Concat.concat2d,exports.concat3d=concat_ops.Concat.concat3d,exports.concat4d=concat_ops.Concat.concat4d,exports.conv1d=conv_ops.Ops.conv1d,exports.conv2d=conv_ops.Ops.conv2d,exports.conv2dTranspose=conv_ops.Ops.conv2dTranspose,exports.depthwiseConv2d=conv_ops.Ops.depthwiseConv2d,exports.matMul=matmul_ops.Ops.matMul,exports.matrixTimesVector=matmul_ops.Ops.matrixTimesVector,exports.outerProduct=matmul_ops.Ops.outerProduct,exports.vectorTimesMatrix=matmul_ops.Ops.vectorTimesMatrix,exports.avgPool=pool_ops.Ops.avgPool,exports.maxPool=pool_ops.Ops.maxPool,exports.minPool=pool_ops.Ops.minPool,exports.transpose=transpose_ops.Ops.transpose,exports.reverse=reverse_ops.Ops.reverse,exports.reverse1d=reverse_ops.Ops.reverse1d,exports.reverse2d=reverse_ops.Ops.reverse2d,exports.reverse3d=reverse_ops.Ops.reverse3d,exports.reverse4d=reverse_ops.Ops.reverse4d,exports.slice=slice_ops.Ops.slice,exports.slice1d=slice_ops.Ops.slice1d,exports.slice2d=slice_ops.Ops.slice2d,exports.slice3d=slice_ops.Ops.slice3d,exports.slice4d=slice_ops.Ops.slice4d,exports.argMax=reduction_ops.Ops.argMax,exports.argMin=reduction_ops.Ops.argMin,exports.logSumExp=reduction_ops.Ops.logSumExp,exports.max=reduction_ops.Ops.max,exports.mean=reduction_ops.Ops.mean,exports.min=reduction_ops.Ops.min,exports.moments=reduction_ops.Ops.moments,exports.sum=reduction_ops.Ops.sum,exports.equal=compare_ops.Ops.equal,exports.equalStrict=compare_ops.Ops.equalStrict,exports.greater=compare_ops.Ops.greater,exports.greaterStrict=compare_ops.Ops.greaterStrict,exports.greaterEqual=compare_ops.Ops.greaterEqual,exports.greaterEqualStrict=compare_ops.Ops.greaterEqualStrict,exports.less=compare_ops.Ops.less,exports.lessStrict=compare_ops.Ops.lessStrict,exports.lessEqual=compare_ops.Ops.lessEqual,exports.lessEqualStrict=compare_ops.Ops.lessEqualStrict,exports.notEqual=compare_ops.Ops.notEqual,exports.notEqualStrict=compare_ops.Ops.notEqualStrict,exports.logicalNot=logical_ops.Ops.logicalNot,exports.logicalAnd=logical_ops.Ops.logicalAnd,exports.logicalOr=logical_ops.Ops.logicalOr,exports.logicalXor=logical_ops.Ops.logicalXor,exports.where=logical_ops.Ops.where,exports.abs=unary_ops.Ops.abs,exports.acos=unary_ops.Ops.acos,exports.asin=unary_ops.Ops.asin,exports.atan=unary_ops.Ops.atan,exports.ceil=unary_ops.Ops.ceil,exports.clipByValue=unary_ops.Ops.clipByValue,exports.cos=unary_ops.Ops.cos,exports.cosh=unary_ops.Ops.cosh,exports.elu=unary_ops.Ops.elu,exports.exp=unary_ops.Ops.exp,exports.floor=unary_ops.Ops.floor,exports.leakyRelu=unary_ops.Ops.leakyRelu,exports.log=unary_ops.Ops.log,exports.neg=unary_ops.Ops.neg,exports.prelu=unary_ops.Ops.prelu,exports.relu=unary_ops.Ops.relu,exports.selu=unary_ops.Ops.selu,exports.sigmoid=unary_ops.Ops.sigmoid,exports.sin=unary_ops.Ops.sin,exports.sinh=unary_ops.Ops.sinh,exports.sqrt=unary_ops.Ops.sqrt,exports.square=unary_ops.Ops.square,exports.step=unary_ops.Ops.step,exports.tan=unary_ops.Ops.tan,exports.tanh=unary_ops.Ops.tanh,exports.add=binary_ops.Ops.add,exports.addStrict=binary_ops.Ops.addStrict,exports.div=binary_ops.Ops.div,exports.divStrict=binary_ops.Ops.divStrict,exports.maximum=binary_ops.Ops.maximum,exports.maximumStrict=binary_ops.Ops.maximumStrict,exports.minimum=binary_ops.Ops.minimum,exports.minimumStrict=binary_ops.Ops.minimumStrict,exports.mul=binary_ops.Ops.mul,exports.mulStrict=binary_ops.Ops.mulStrict,exports.pow=binary_ops.Ops.pow,exports.powStrict=binary_ops.Ops.powStrict,exports.sub=binary_ops.Ops.sub,exports.subStrict=binary_ops.Ops.subStrict,exports.norm=norm_ops.Ops.norm,exports.cast=array_ops.Ops.cast,exports.clone=array_ops.Ops.clone,exports.fromPixels=array_ops.Ops.fromPixels,exports.ones=array_ops.Ops.ones,exports.onesLike=array_ops.Ops.onesLike,exports.zeros=array_ops.Ops.zeros,exports.zerosLike=array_ops.Ops.zerosLike,exports.rand=array_ops.Ops.rand,exports.randomNormal=array_ops.Ops.randomNormal,exports.truncatedNormal=array_ops.Ops.truncatedNormal,exports.randomUniform=array_ops.Ops.randomUniform,exports.reshape=array_ops.Ops.reshape,exports.squeeze=array_ops.Ops.squeeze,exports.tile=array_ops.Ops.tile,exports.gather=array_ops.Ops.gather,exports.oneHot=array_ops.Ops.oneHot,exports.linspace=array_ops.Ops.linspace,exports.range=array_ops.Ops.range,exports.buffer=array_ops.Ops.buffer,exports.fill=array_ops.Ops.fill,exports.tensor=array_ops.Ops.tensor,exports.scalar=array_ops.Ops.scalar,exports.tensor1d=array_ops.Ops.tensor1d,exports.tensor2d=array_ops.Ops.tensor2d,exports.tensor3d=array_ops.Ops.tensor3d,exports.tensor4d=array_ops.Ops.tensor4d,exports.print=array_ops.Ops.print,exports.expandDims=array_ops.Ops.expandDims,exports.stack=array_ops.Ops.stack,exports.pad=array_ops.Ops.pad,exports.pad1d=array_ops.Ops.pad1d,exports.pad2d=array_ops.Ops.pad2d,exports.basicLSTMCell=lstm_ops.Ops.basicLSTMCell,exports.multiRNNCell=lstm_ops.Ops.multiRNNCell,exports.softmax=softmax_ops.Ops.softmax,exports.localResponseNormalization=lrn_ops.LRN.localResponseNormalization;var tensor_1=require("../tensor"),types_1=require("../types");tensor_1.Tensor,types_1.Rank,tensor_1.Tensor3D,tensor_1.Tensor4D,exports.losses={softmaxCrossEntropy:softmax_ops.Ops.softmaxCrossEntropy},exports.image={resizeBilinear:image_ops.Ops.resizeBilinear};

},{"../tensor":178,"../types":182,"./array_ops":138,"./batchnorm":140,"./binary_ops":141,"./compare":143,"./concat":144,"./conv":146,"./image_ops":148,"./logical_ops":149,"./lrn":150,"./lstm":151,"./matmul":152,"./norm":153,"./pool":156,"./reduction_ops":159,"./reverse":160,"./slice":162,"./softmax":164,"./transpose":165,"./unary_ops":166}],156:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(n,e,o,a){var r,t=arguments.length,i=t<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,o):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(n,e,o,a);else for(var s=n.length-1;s>=0;s--)(r=n[s])&&(i=(t<3?r(i):t>3?r(e,o,i):r(e,o))||i);return t>3&&i&&Object.defineProperty(e,o,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),conv_util=require("./conv_util"),operation_1=require("./operation"),Ops=function(){function n(){}return n.maxPool=function(e,o,a,r,t){var i=e,s=!1;3===e.rank&&(s=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),util.assert(4===i.rank,"Error in maxPool: input must be rank 4 but got rank "+i.rank+"."),null!=t&&util.assert(util.isInt(r),"Error in maxPool: pad must be an integer when using, dimRoundingMode "+t+" but got pad "+r+".");var u=conv_util.computePool2DInfo(i.shape,o,a,r,t),p=environment_1.ENV.engine.executeKernel("MaxPool",{inputs:{x:i},args:{convInfo:u}},function(e,t){return{x:function(){return n.maxPoolBackprop(e,i,o,a,r)}}});return s?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p},n.maxPoolBackprop=function(n,e,o,a,r,t){util.assert(e.rank===n.rank,"Rank of input ("+e.rank+") does not match rank of dy ("+n.rank+")");var i=e,s=n,u=!1;3===e.rank&&(u=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),util.assert(4===s.rank,"Error in maxPoolBackprop: dy must be rank 4 but got rank "+s.rank+"."),util.assert(4===i.rank,"Error in maxPoolBackprop: input must be rank 4 but got rank "+i.rank+"."),null!=t&&util.assert(util.isInt(r),"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+t+" but got pad "+r+".");var p=conv_util.computePool2DInfo(i.shape,o,a,r,t),l=environment_1.ENV.engine.executeKernel("MaxPoolBackprop",{inputs:{dy:s,x:i},args:{convInfo:p}});return u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l},n.minPool=function(n,e,o,a,r){var t=n,i=!1;3===n.rank&&(i=!0,t=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),util.assert(4===t.rank,"Error in minPool: x must be rank 4 but got rank "+t.rank+"."),null!=r&&util.assert(util.isInt(a),"Error in minPool: pad must be an integer when using, dimRoundingMode "+r+" but got pad "+a+".");var s=conv_util.computePool2DInfo(t.shape,e,o,a,r),u=environment_1.ENV.engine.executeKernel("MinPool",{inputs:{x:t},args:{convInfo:s}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u},n.avgPool=function(e,o,a,r,t){var i=e,s=!1;3===e.rank&&(s=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),util.assert(4===i.rank,"Error in avgPool: x must be rank 4 but got rank "+i.rank+"."),null!=t&&util.assert(util.isInt(r),"Error in avgPool: pad must be an integer when using, dimRoundingMode "+t+" but got pad "+r+".");var u=conv_util.computePool2DInfo(i.shape,o,a,r),p=environment_1.ENV.engine.executeKernel("AvgPool",{inputs:{x:i},args:{convInfo:u}},function(e,t){return{x:function(){return n.avgPoolBackprop(e,i,o,a,r)}}});return s?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p},n.avgPoolBackprop=function(n,e,o,a,r){util.assert(e.rank===n.rank,"Rank of input ("+e.rank+") does not match rank of dy ("+n.rank+")");var t=e,i=n,s=!1;3===e.rank&&(s=!0,t=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),util.assert(4===i.rank,"Error in avgPoolBackprop: dy must be rank 4 but got rank "+i.rank+"."),util.assert(4===t.rank,"Error in avgPoolBackprop: input must be rank 4 but got rank "+t.rank+".");var u=conv_util.computePool2DInfo(t.shape,o,a,r),p=environment_1.ENV.engine.executeKernel("AvgPoolBackprop",{inputs:{dy:i,x:t},args:{convInfo:u}});return s?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p},__decorate([doc_1.doc({heading:"Operations",subheading:"Convolution"}),operation_1.operation],n,"maxPool",null),__decorate([operation_1.operation],n,"maxPoolBackprop",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Convolution"}),operation_1.operation],n,"minPool",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Convolution"}),operation_1.operation],n,"avgPool",null),__decorate([operation_1.operation],n,"avgPoolBackprop",null),n}();exports.Ops=Ops;

},{"../doc":64,"../environment":66,"../util":183,"./conv_util":147,"./operation":154}],157:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var seedrandom=require("seedrandom"),MPRandGauss=function(){function t(t,e,s,a,i){this.mean=t,this.stdDev=e,this.dtype=s,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var r=i||Math.random();this.random=seedrandom.alea(r.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,s,a=!1;!a;){var i=void 0,r=void 0,n=void 0;do{n=(i=2*this.random()-1)*i+(r=2*this.random()-1)*r}while(n>=1||0===n);var d=Math.sqrt(-2*Math.log(n)/n);e=this.mean+this.stdDev*i*d,s=this.mean+this.stdDev*r*d,this.truncated&&!this.isValidTruncated(e)||(a=!0)}return this.truncated&&!this.isValidTruncated(s)||(this.nextVal=this.convertValue(s)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}();exports.MPRandGauss=MPRandGauss;

},{"seedrandom":186}],158:[function(require,module,exports){
"use strict";function computeOptimalWindowSize(e){return e<=exports.PARALLELIZE_THRESHOLD?e:nearestDivisor(e,Math.floor(Math.sqrt(e)))}function nearestDivisor(e,t){for(var r=t;r<e;++r)if(e%r==0)return r;return e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.PARALLELIZE_THRESHOLD=30,exports.computeOptimalWindowSize=computeOptimalWindowSize;

},{}],159:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,a,n,r){var i,t=arguments.length,o=t<3?a:null===r?r=Object.getOwnPropertyDescriptor(a,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,a,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(t<3?i(o):t>3?i(a,n,o):i(a,n))||o);return t>3&&o&&Object.defineProperty(a,n,o),o};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),globals_1=require("../globals"),tensor_1=require("../tensor"),util=require("../util"),axis_util=require("./axis_util"),operation_1=require("./operation"),ops=require("./ops"),Ops=function(){function e(){}return e.logSumExp=function(e,a,n){void 0===a&&(a=null),void 0===n&&(n=!1);var r=axis_util.parseAxisParam(a,e.shape),i=e.max(r,!0),t=e.sub(i).exp().sum(r).log(),o=i.reshape(t.shape).add(t);if(n){var s=axis_util.expandShapeToKeepDim(o.shape,r);return o.reshape(s)}return o},e.sum=function(e,a,n){void 0===a&&(a=null),void 0===n&&(n=!1);var r=axis_util.parseAxisParam(a,e.shape);return globals_1.customGrad(function(e){var a=axis_util.getAxesPermutation(r,e.rank),i=r,t=e;null!=a&&(t=e.transpose(a),i=axis_util.getInnerMostAxes(i.length,e.rank));var o=environment_1.ENV.engine.executeKernel("Sum",{inputs:{x:t},args:{axes:i}});if(n){var s=axis_util.expandShapeToKeepDim(o.shape,r);o=o.reshape(s)}return{value:o,gradFunc:function(a){var n=e.shape.slice();return r.forEach(function(e){n[e]=1}),a.reshape(n).mul(tensor_1.Tensor.ones(e.shape,"float32"))}}})(e)},e.mean=function(e,a,n){void 0===a&&(a=null),void 0===n&&(n=!1);var r=axis_util.parseAxisParam(a,e.shape),i=axis_util.computeOutAndReduceShapes(e.shape,r)[1],t=util.sizeFromShape(i);return globals_1.customGrad(function(e){var i=ops.scalar(t);return{value:e.div(i).sum(a,n),gradFunc:function(a){var n=e.shape.slice();return r.forEach(function(e){n[e]=1}),a.reshape(n).mul(tensor_1.Tensor.ones(e.shape,"float32")).div(i)}}})(e)},e.min=function(e,a,n){void 0===a&&(a=null),void 0===n&&(n=!1);var r=axis_util.parseAxisParam(a,e.shape),i=r,t=axis_util.getAxesPermutation(i,e.rank);null!=t&&(e=e.transpose(t),i=axis_util.getInnerMostAxes(i.length,e.rank));var o=environment_1.ENV.engine.executeKernel("Min",{inputs:{x:e},args:{axes:i}});if(n){var s=axis_util.expandShapeToKeepDim(o.shape,r);return o.reshape(s)}return o},e.max=function(e,a,n){void 0===a&&(a=null),void 0===n&&(n=!1);var r=axis_util.parseAxisParam(a,e.shape),i=r,t=axis_util.getAxesPermutation(i,e.rank);null!=t&&(e=e.transpose(t),i=axis_util.getInnerMostAxes(i.length,e.rank));var o=environment_1.ENV.engine.executeKernel("Max",{inputs:{x:e},args:{axes:i}});if(n){var s=axis_util.expandShapeToKeepDim(o.shape,r);return o.reshape(s)}return o},e.argMin=function(e,a){void 0===a&&(a=null);var n=axis_util.parseAxisParam(a,e.shape),r=axis_util.getAxesPermutation(n,e.rank);return null!=r&&(e=e.transpose(r),n=axis_util.getInnerMostAxes(n.length,e.rank)),environment_1.ENV.engine.executeKernel("ArgMin",{inputs:{x:e},args:{axes:n}})},e.argMax=function(e,a){void 0===a&&(a=null);var n=axis_util.parseAxisParam(a,e.shape),r=axis_util.getAxesPermutation(n,e.rank);return null!=r&&(e=e.transpose(r),n=axis_util.getInnerMostAxes(n.length,e.rank)),environment_1.ENV.engine.executeKernel("ArgMax",{inputs:{x:e},args:{axes:n}})},e.moments=function(e,a,n){void 0===a&&(a=null),void 0===n&&(n=!1);var r=axis_util.parseAxisParam(a,e.shape),i=e.mean(r,n),t=i.shape;n||(t=axis_util.expandShapeToKeepDim(i.shape,r));var o=e.toFloat().sub(i.reshape(t)).square();return{mean:i,variance:o.mean(r,n)}},__decorate([doc_1.doc({heading:"Operations",subheading:"Reduction"}),operation_1.operation],e,"logSumExp",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Reduction"}),operation_1.operation],e,"sum",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Reduction"}),operation_1.operation],e,"mean",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Reduction"}),operation_1.operation],e,"min",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Reduction"}),operation_1.operation],e,"max",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Reduction"}),operation_1.operation],e,"argMin",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Reduction"}),operation_1.operation],e,"argMax",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Normalization"}),operation_1.operation],e,"moments",null),e}();exports.Ops=Ops;

},{"../doc":64,"../environment":66,"../globals":67,"../tensor":178,"../util":183,"./axis_util":139,"./operation":154,"./ops":155}],160:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,r,n,t){var s,a=arguments.length,i=a<3?r:null===t?t=Object.getOwnPropertyDescriptor(r,n):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,n,t);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(i=(a<3?s(i):a>3?s(r,n,i):s(r,n))||i);return a>3&&i&&Object.defineProperty(r,n,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),axis_util=require("./axis_util"),operation_1=require("./operation"),Ops=function(){function e(){}return e.reverse1d=function(r){return util.assert(1===r.rank,"Error in reverse1D: x must be rank 1 but got\n             rank "+r.rank+"."),e.reverse(r,0)},e.reverse2d=function(r,n){return util.assert(2===r.rank,"Error in reverse2D: x must be rank 2 but got\n             rank "+r.rank+"."),e.reverse(r,n)},e.reverse3d=function(r,n){return util.assert(3===r.rank,"Error in reverse3D: x must be rank 3 but got\n             rank "+r.rank+"."),e.reverse(r,n)},e.reverse4d=function(r,n){return util.assert(4===r.rank,"Error in reverse4D: x must be rank 4 but got\n             rank "+r.rank+"."),e.reverse(r,n)},e.reverse=function(e,r){var n,t=axis_util.parseAxisParam(r,e.shape).map(function(r){return r+4-e.rank});if(0===e.rank)return e.clone();if(1===e.rank)n=e.as4D(1,1,1,e.shape[0]);else if(2===e.rank)n=e.as4D(1,1,e.shape[0],e.shape[1]);else if(3===e.rank)n=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]);else{if(4!==e.rank)throw new Error("Reverse for rank "+e.rank+" is not yet implemented");n=e}return environment_1.ENV.engine.executeKernel("Reverse4D",{inputs:{x:n},args:{axis:t}}).reshapeAs(e)},__decorate([doc_1.doc({heading:"Tensors",subheading:"Slicing and Joining"}),operation_1.operation],e,"reverse",null),e}();exports.Ops=Ops;

},{"../doc":64,"../environment":66,"../util":183,"./axis_util":139,"./operation":154}],161:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SELU_SCALEALPHA=1.7580993408473768,exports.SELU_SCALE=1.0507009873554805;

},{}],162:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,n,i,r){var t,o=arguments.length,l=o<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,n,i,r);else for(var c=e.length-1;c>=0;c--)(t=e[c])&&(l=(o<3?t(l):o>3?t(n,i,l):t(n,i))||l);return o>3&&l&&Object.defineProperty(n,i,l),l};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),operation_1=require("./operation"),slice_util=require("./slice_util"),Ops=function(){function e(){}return e.slice1d=function(e,n,i){return slice_util.assertParamsValid(e,[n],[i]),environment_1.ENV.engine.executeKernel("Slice1D",{inputs:{x:e},args:{begin:n,size:i}})},e.slice2d=function(e,n,i){return slice_util.assertParamsValid(e,n,i),environment_1.ENV.engine.executeKernel("Slice2D",{inputs:{x:e},args:{begin:n,size:i}})},e.slice3d=function(e,n,i){return slice_util.assertParamsValid(e,n,i),environment_1.ENV.engine.executeKernel("Slice3D",{inputs:{x:e},args:{begin:n,size:i}})},e.slice4d=function(e,n,i){return slice_util.assertParamsValid(e,n,i),environment_1.ENV.engine.executeKernel("Slice4D",{inputs:{x:e},args:{begin:n,size:i}})},e.slice=function(n,i,r){if(0===n.rank)throw new Error("Slicing scalar is not possible");if(1===n.rank)return e.slice1d(n,i[0],r[0]);if(2===n.rank)return e.slice2d(n,i,r);if(3===n.rank)return e.slice3d(n,i,r);if(4===n.rank)return e.slice4d(n,i,r);throw new Error("Slicing for rank "+n.rank+" not implemented yet")},__decorate([operation_1.operation],e,"slice1d",null),__decorate([operation_1.operation],e,"slice2d",null),__decorate([operation_1.operation],e,"slice3d",null),__decorate([operation_1.operation],e,"slice4d",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Slicing and Joining"}),operation_1.operation],e,"slice",null),e}();exports.Ops=Ops;

},{"../doc":64,"../environment":66,"./operation":154,"./slice_util":163}],163:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function assertParamsValid(r,a,e){util.assert(r.rank===a.length,"Error in slice"+r.rank+"D: Length of begin "+a+" must match the rank of the array ("+r.rank+")."),util.assert(r.rank===e.length,"Error in slice"+r.rank+"D: Length of size "+e+" must match the rank of the array ("+r.rank+").");for(var t=0;t<r.rank;++t)util.assert(a[t]+e[t]<=r.shape[t],"Error in slice"+r.rank+"D: begin["+t+"] + size["+t+"] ("+(a[t]+e[t])+") would overflow input.shape["+t+"] ("+r.shape[t]+")")}exports.assertParamsValid=assertParamsValid;

},{"../util":183}],164:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,o,r,t){var a,n=arguments.length,s=n<3?o:null===t?t=Object.getOwnPropertyDescriptor(o,r):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,o,r,t);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(s=(n<3?a(s):n>3?a(o,r,s):a(o,r))||s);return n>3&&s&&Object.defineProperty(o,r,s),s};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),globals_1=require("../globals"),util=require("../util"),axis_util=require("./axis_util"),operation_1=require("./operation"),ops=require("./ops"),Ops=function(){function e(){}return e.softmax=function(e,o){if(void 0===o&&(o=-1),-1===o&&(o=e.rank-1),o!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+o);return globals_1.customGrad(function(e){var r=e.logSumExp([o],!0),t=e.toFloat().sub(r).exp();return{value:t,gradFunc:function(e){var r=e.mul(t);return r.sub(r.sum([o],!0).mul(t))}}})(e)},e.softmaxCrossEntropy=function(e,o,r){if(void 0===r&&(r=-1),util.assertShapesMatch(e.shape,o.shape,"Error in softmaxCrossEntropy: "),-1===r&&(r=o.rank-1),r!==o.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+o.rank+" and dim was "+r);return globals_1.customGrad(function(e,o){var t=o.softmax(r);return{value:ops.scalar(1e-5).add(t).log().mul(e).neg().sum([r]),gradFunc:function(o){var a=axis_util.expandShapeToKeepDim(o.shape,[r]);return[o.reshape(a).mul(e.toFloat().sub(t)),o.reshape(a).mul(t.sub(e.toFloat()))]}}})(e,o)},__decorate([doc_1.doc({heading:"Operations",subheading:"Normalization"}),operation_1.operation],e,"softmax",null),__decorate([doc_1.doc({heading:"Training",subheading:"Losses",namespace:"losses"}),operation_1.operation],e,"softmaxCrossEntropy",null),e}();exports.Ops=Ops;

},{"../doc":64,"../globals":67,"../util":183,"./axis_util":139,"./operation":154,"./ops":155}],165:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,r,t,n){var o,i=arguments.length,u=i<3?r:null===n?n=Object.getOwnPropertyDescriptor(r,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,r,t,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(u=(i<3?o(u):i>3?o(r,t,u):o(r,t))||u);return i>3&&u&&Object.defineProperty(r,t,u),u};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),axis_util=require("./axis_util"),operation_1=require("./operation"),Ops=function(){function e(){}return e.transpose=function(e,r){null==r&&(r=e.shape.map(function(e,r){return r}).reverse());return util.assert(e.rank===r.length,"Error in transpose: rank of input "+e.rank+" must match length of perm "+r+"."),environment_1.ENV.engine.executeKernel("Transpose",{inputs:{x:e},args:{perm:r}},function(e){var t=axis_util.getUndoAxesPermutation(r);return{x:function(){return e.transpose(t)}}})},__decorate([doc_1.doc({heading:"Operations",subheading:"Matrices"}),operation_1.operation],e,"transpose",null),e}();exports.Ops=Ops;

},{"../doc":64,"../environment":66,"../util":183,"./axis_util":139,"./operation":154}],166:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,n,t,r){var o,i=arguments.length,u=i<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,n,t,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(u=(i<3?o(u):i>3?o(n,t,u):o(n,t))||u);return i>3&&u&&Object.defineProperty(n,t,u),u};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),operation_1=require("./operation"),ops=require("./ops"),ops_1=require("./ops"),selu_util=require("./selu_util"),Ops=function(){function e(){}return e.neg=function(e){return environment_1.ENV.engine.executeKernel("Neg",{inputs:{x:e}},function(e,n){return{x:function(){return e.neg()}}})},e.ceil=function(e){return environment_1.ENV.engine.executeKernel("Ceil",{inputs:{x:e}},function(e,n){return{x:function(){return ops.zeros(n.shape)}}})},e.floor=function(e){return environment_1.ENV.engine.executeKernel("Floor",{inputs:{x:e}},function(e,n){return{x:function(){return ops.zeros(n.shape)}}})},e.exp=function(e){return environment_1.ENV.engine.executeKernel("Exp",{inputs:{x:e}},function(e,n){return{x:function(){return e.mul(n)}}})},e.log=function(e){return environment_1.ENV.engine.executeKernel("Log",{inputs:{x:e}},function(n,t){return{x:function(){return n.div(e.toFloat())}}})},e.sqrt=function(e){return environment_1.ENV.engine.executeKernel("Sqrt",{inputs:{x:e}},function(n,t){return{x:function(){return n.div(e.toFloat().sqrt().mul(ops.scalar(2)))}}})},e.square=function(e){return environment_1.ENV.engine.executeKernel("Square",{inputs:{x:e}},function(n,t){return{x:function(){return n.mul(e.toFloat().mul(ops.scalar(2)))}}})},e.abs=function(e){return environment_1.ENV.engine.executeKernel("Abs",{inputs:{x:e}},function(n,t){return{x:function(){return n.mul(e.toFloat().step(-1))}}})},e.clipByValue=function(e,n,t){return util.assert(n<=t,"Error in clip: min ("+n+") must beless than or equal to max ("+t+")."),environment_1.ENV.engine.executeKernel("Clip",{inputs:{x:e},args:{min:n,max:t}},function(r,o){return{x:function(){return r.where(e.greater(ops.scalar(n)).logicalAnd(e.less(ops.scalar(t))),ops_1.zerosLike(r))}}})},e.relu=function(e){return environment_1.ENV.engine.executeKernel("Relu",{inputs:{x:e}},function(n,t){var r=e.step();return{x:function(){return n.mul(r.toFloat())}}})},e.elu=function(e){return environment_1.ENV.engine.executeKernel("Elu",{inputs:{x:e}},function(n){return{x:function(){return n.mul(eluDer(e))},alpha:function(){throw new Error("Derivative of prelu with respect to alpha is not implemented yet")}}})},e.selu=function(e){return environment_1.ENV.engine.executeKernel("Selu",{inputs:{x:e}},function(n,t){return{x:function(){var t=e.greater(ops.scalar(0)),r=ops.scalar(selu_util.SELU_SCALEALPHA),o=ops.scalar(selu_util.SELU_SCALE),i=n.mul(o),u=n.mul(r).mul(e.toFloat().exp());return ops.where(t,i,u)}}})},e.leakyRelu=function(e,n){void 0===n&&(n=.2);return environment_1.ENV.engine.executeKernel("LeakyRelu",{inputs:{x:e},args:{alpha:n}},function(t,r){return{x:function(){return t.mul(e.step(n))}}})},e.prelu=function(e,n){return environment_1.ENV.engine.executeKernel("PReLU",{inputs:{x:e,alpha:n}},function(t){return{x:function(){return t.mul(preluDer(e,n))},alpha:function(){throw new Error("Derivative of prelu with respect to alpha is not implemented yet")}}})},e.sigmoid=function(e){return environment_1.ENV.engine.executeKernel("Sigmoid",{inputs:{x:e}},function(e,n){return{x:function(){return e.mul(n.mul(ops.scalar(1).sub(n)))}}})},e.sin=function(e){return environment_1.ENV.engine.executeKernel("Sin",{inputs:{x:e}},function(n,t){return{x:function(){return e.toFloat().cos().mul(n)}}})},e.cos=function(e){return environment_1.ENV.engine.executeKernel("Cos",{inputs:{x:e}},function(n,t){return{x:function(){return e.toFloat().sin().neg().mul(n)}}})},e.tan=function(e){return environment_1.ENV.engine.executeKernel("Tan",{inputs:{x:e}},function(n,t){return{x:function(){return n.div(e.cos().square())}}})},e.asin=function(n){return environment_1.ENV.engine.executeKernel("Asin",{inputs:{x:n}},function(t,r){return{x:function(){return t.div(e.sqrt(ops.scalar(1).sub(n.toFloat().square())))}}})},e.acos=function(n){return environment_1.ENV.engine.executeKernel("Acos",{inputs:{x:n}},function(t,r){return{x:function(){return t.div(e.sqrt(ops.scalar(1).sub(n.toFloat().square()))).neg()}}})},e.atan=function(e){return environment_1.ENV.engine.executeKernel("Atan",{inputs:{x:e}},function(n,t){return{x:function(){return n.div(ops.scalar(1).add(e.toFloat().square()))}}})},e.sinh=function(e){return environment_1.ENV.engine.executeKernel("Sinh",{inputs:{x:e}},function(n,t){return{x:function(){return e.toFloat().cosh().mul(n)}}})},e.cosh=function(e){return environment_1.ENV.engine.executeKernel("Cosh",{inputs:{x:e}},function(n,t){return{x:function(){return e.toFloat().sinh().mul(n)}}})},e.tanh=function(e){return environment_1.ENV.engine.executeKernel("Tanh",{inputs:{x:e}},function(e,n){return{x:function(){return ops.scalar(1).sub(n.square()).mul(e)}}})},e.step=function(e,n){return void 0===n&&(n=0),environment_1.ENV.engine.executeKernel("Step",{inputs:{x:e},args:{alpha:n}},function(e,n){return{x:function(){return ops.zeros(n.shape)}}})},__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"neg",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"ceil",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"floor",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"exp",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"log",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"sqrt",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"square",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"abs",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"clipByValue",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"relu",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"elu",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"selu",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"leakyRelu",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"prelu",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"sigmoid",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"sin",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"cos",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"tan",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"asin",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"acos",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"atan",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"sinh",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"cosh",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"tanh",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Basic math"}),operation_1.operation],e,"step",null),e}();function preluDer(e,n){return environment_1.ENV.engine.executeKernel("PReLUDer",{inputs:{x:e,alpha:n}})}function eluDer(e){return environment_1.ENV.engine.executeKernel("EluDer",{inputs:{x:e}})}exports.Ops=Ops;

},{"../doc":64,"../environment":66,"../util":183,"./operation":154,"./ops":155,"./selu_util":161}],167:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,a){e.__proto__=a}||function(e,a){for(var t in a)a.hasOwnProperty(t)&&(e[t]=a[t])};return function(a,t){function r(){this.constructor=a}e(a,t),a.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),tensor_array_map_1=require("../graph/tensor_array_map"),ops_1=require("../ops/ops"),tensor_1=require("../tensor"),tensor_2=require("../tensor"),optimizer_1=require("./optimizer"),AdadeltaOptimizer=function(e){function a(a,t,r,s){void 0===s&&(s=1e-8);var o=e.call(this,a,r)||this;return o.accumulatedGrads={},o.accumulatedUpdates={},o.accumulatedSquaredGradientsGraph=new tensor_array_map_1.TensorArrayMap,o.accumulatedUpdatesGraph=new tensor_array_map_1.TensorArrayMap,o.c=globals_1.keep(ops_1.scalar(-a)),o.epsilon=globals_1.keep(ops_1.scalar(s)),o.rho=globals_1.keep(ops_1.scalar(t)),o.oneMinusRho=globals_1.keep(ops_1.scalar(1-t)),o}return __extends(a,e),a.prototype.applyGradients=function(e){var a=this,t=function(t){var s=environment_1.ENV.engine.registeredVariables[t];if(null==r.accumulatedGrads[t]){globals_1.tidy(function(){a.accumulatedGrads[t]=tensor_2.variable(ops_1.zerosLike(s),!1)})}if(null==r.accumulatedUpdates[t]){globals_1.tidy(function(){a.accumulatedUpdates[t]=tensor_2.variable(ops_1.zerosLike(s),!1)})}var o=e[t],u=r.accumulatedGrads[t],i=r.accumulatedUpdates[t];globals_1.tidy(function(){var e=a.rho.mul(u).add(a.oneMinusRho.mul(o.square())),r=i.add(a.epsilon).sqrt().div(u.add(a.epsilon).sqrt()).mul(o),n=a.rho.mul(i).add(a.oneMinusRho.mul(r.square()));a.accumulatedGrads[t].assign(e),a.accumulatedUpdates[t].assign(n);var d=a.c.mul(r).add(s);s.assign(d)})},r=this;for(var s in e)t(s)},a.prototype.beforeBatch=function(a,t,r,s,o){var u=this;e.prototype.beforeBatch.call(this,a,t,r,s,o),0===this.accumulatedSquaredGradientsGraph.size()&&this.variableNodes.forEach(function(e){u.accumulatedSquaredGradientsGraph.set(e.output,tensor_1.Tensor.zeros(e.output.shape)),u.accumulatedUpdatesGraph.set(e.output,tensor_1.Tensor.zeros(e.output.shape))})},a.prototype.afterBatch=function(e,a,t,r,s){var o=this;null==this.one&&(this.one=globals_1.keep(ops_1.scalar(1))),globals_1.tidy(function(){o.variableNodes.forEach(function(a){var t=r.get(a.output),s=o.variableGradients.get(a.output),u=o.accumulatedSquaredGradientsGraph.get(a.output),i=o.accumulatedUpdatesGraph.get(a.output),n=e.multiply(s,s),d=e.scaledArrayAdd(o.rho,u,e.subtract(o.one,o.rho),n),p=e.multiply(e.divide(e.sqrt(e.add(i,o.epsilon)),e.sqrt(e.add(u,o.epsilon))),s),l=e.scaledArrayAdd(o.cGraph,p,o.one,t),c=e.multiply(p,p),h=e.scaledArrayAdd(o.rho,i,e.subtract(o.one,o.rho),c);o.accumulatedSquaredGradientsGraph.set(a.output,globals_1.keep(d)),o.accumulatedUpdatesGraph.set(a.output,globals_1.keep(h)),r.set(a.output,globals_1.keep(l)),a.data=l,t.dispose(),u.dispose(),i.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new tensor_array_map_1.TensorArrayMap},a.prototype.dispose=function(){var a=this;e.prototype.dispose.call(this),this.c.dispose(),this.epsilon.dispose(),this.rho.dispose(),this.oneMinusRho.dispose(),null!=this.one&&this.one.dispose(),null!=this.accumulatedSquaredGradientsGraph&&this.accumulatedSquaredGradientsGraph.dispose(),null!=this.accumulatedUpdatesGraph&&this.accumulatedUpdatesGraph.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(e){return a.accumulatedUpdates[e].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(e){return a.accumulatedGrads[e].dispose()}))},a}(optimizer_1.Optimizer);exports.AdadeltaOptimizer=AdadeltaOptimizer;

},{"../environment":66,"../globals":67,"../graph/tensor_array_map":98,"../ops/ops":155,"../tensor":178,"./optimizer":172}],168:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),tensor_array_map_1=require("../graph/tensor_array_map"),ops_1=require("../ops/ops"),tensor_1=require("../tensor"),tensor_2=require("../tensor"),optimizer_1=require("./optimizer"),AdagradOptimizer=function(e){function t(t,a,r){void 0===r&&(r=.1);var s=e.call(this,t,a)||this;return s.learningRate=t,s.initialAccumulatorValue=r,s.accumulatedGrads={},s.accumulatedSquaredGradients=new tensor_array_map_1.TensorArrayMap,s.c=globals_1.keep(ops_1.scalar(-t)),s.epsilon=globals_1.keep(ops_1.scalar(1e-8)),s}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this,a=function(a){var s=environment_1.ENV.engine.registeredVariables[a];if(null==r.accumulatedGrads[a]){globals_1.tidy(function(){t.accumulatedGrads[a]=tensor_2.variable(ops_1.fill(s.shape,t.initialAccumulatorValue),!1)})}var i=e[a],o=r.accumulatedGrads[a];globals_1.tidy(function(){var e=o.add(i.square());t.accumulatedGrads[a].assign(e);var r=t.c.mul(i.div(e.add(t.epsilon).sqrt())).add(s);s.assign(r)})},r=this;for(var s in e)a(s)},t.prototype.beforeBatch=function(t,a,r,s,i){var o=this;e.prototype.beforeBatch.call(this,t,a,r,s,i),0===this.accumulatedSquaredGradients.size()&&this.variableNodes.forEach(function(e){o.accumulatedSquaredGradients.set(e.output,tensor_1.Tensor.zeros(e.output.shape))})},t.prototype.afterBatch=function(e,t,a,r,s){var i=this;null==this.one&&(this.one=globals_1.keep(ops_1.scalar(1))),globals_1.tidy(function(){i.variableNodes.forEach(function(t){var a=r.get(t.output),s=i.variableGradients.get(t.output),o=i.accumulatedSquaredGradients.get(t.output),n=e.multiply(s,s),u=e.add(o,n),d=e.scaledArrayAdd(i.cGraph,e.divide(s,e.add(e.sqrt(u),i.epsilon)),i.one,a);i.accumulatedSquaredGradients.set(t.output,globals_1.keep(u)),r.set(t.output,globals_1.keep(d)),t.data=d,a.dispose(),o.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new tensor_array_map_1.TensorArrayMap},t.prototype.dispose=function(){var t=this;e.prototype.dispose.call(this),this.epsilon.dispose(),this.c.dispose(),null!=this.one&&this.one.dispose(),null!=this.accumulatedSquaredGradients&&this.accumulatedSquaredGradients.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(e){return t.accumulatedGrads[e].dispose()})},t}(optimizer_1.Optimizer);exports.AdagradOptimizer=AdagradOptimizer;

},{"../environment":66,"../globals":67,"../graph/tensor_array_map":98,"../ops/ops":155,"../tensor":178,"./optimizer":172}],169:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),tensor_array_map_1=require("../graph/tensor_array_map"),ops_1=require("../ops/ops"),tensor_1=require("../tensor"),tensor_2=require("../tensor"),optimizer_1=require("./optimizer"),AdamOptimizer=function(e){function t(t,a,s,o,r){void 0===o&&(o=1e-8);var n=e.call(this,t,r)||this;return n.learningRate=t,n.accumulatedFirstMoment={},n.accumulatedSecondMoment={},n.firstMomentGraph=new tensor_array_map_1.TensorArrayMap,n.secondMomentGraph=new tensor_array_map_1.TensorArrayMap,n.c=globals_1.keep(ops_1.scalar(-t)),n.eps=globals_1.keep(ops_1.scalar(o)),n.beta1=globals_1.keep(ops_1.scalar(a)),n.beta2=globals_1.keep(ops_1.scalar(s)),globals_1.tidy(function(){n.accBeta1=tensor_2.variable(ops_1.scalar(a)),n.accBeta2=tensor_2.variable(ops_1.scalar(s))}),n.oneMinusBeta1=globals_1.keep(ops_1.scalar(1-a)),n.oneMinusBeta2=globals_1.keep(ops_1.scalar(1-s)),n.one=globals_1.keep(ops_1.scalar(1)),n}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this;globals_1.tidy(function(){var a=t.one.sub(t.accBeta1),s=t.one.sub(t.accBeta2);for(var o in e){var r=environment_1.ENV.engine.registeredVariables[o];if(null==t.accumulatedFirstMoment[o]){var n=!1;t.accumulatedFirstMoment[o]=tensor_2.variable(ops_1.zerosLike(r),n)}if(null==t.accumulatedSecondMoment[o]){n=!1;t.accumulatedSecondMoment[o]=tensor_2.variable(ops_1.zerosLike(r),n)}var i=e[o],c=t.accumulatedFirstMoment[o],p=t.accumulatedSecondMoment[o],u=t.beta1.mul(c).add(t.oneMinusBeta1.mul(i)),l=t.beta2.mul(p).add(t.oneMinusBeta2.mul(i.square())),d=u.div(a),m=l.div(s);t.accumulatedFirstMoment[o].assign(u),t.accumulatedSecondMoment[o].assign(l);var _=t.c.mul(d.div(t.eps.add(m.sqrt()))).add(r);r.assign(_)}t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})},t.prototype.beforeBatch=function(t,a,s,o,r){var n=this;e.prototype.beforeBatch.call(this,t,a,s,o,r),0===this.firstMomentGraph.size()&&this.variableNodes.forEach(function(e){n.firstMomentGraph.set(e.output,tensor_1.Tensor.zeros(e.output.shape))}),0===this.secondMomentGraph.size()&&this.variableNodes.forEach(function(e){n.secondMomentGraph.set(e.output,tensor_1.Tensor.zeros(e.output.shape))})},t.prototype.afterBatch=function(e,t,a,s,o){var r=this;globals_1.tidy(function(){var t=r.one.sub(r.accBeta1),a=r.one.sub(r.accBeta2);r.variableNodes.forEach(function(o){var n=s.get(o.output),i=r.variableGradients.get(o.output),c=r.firstMomentGraph.get(o.output),p=r.secondMomentGraph.get(o.output),u=e.scaledArrayAdd(r.beta1,c,r.oneMinusBeta1,i),l=e.scaledArrayAdd(r.beta2,p,r.oneMinusBeta2,i.square()),d=u.div(t),m=l.div(a),_=e.scaledArrayAdd(r.cGraph,d.div(r.eps.add(m.sqrt())),r.one,n);s.set(o.output,globals_1.keep(_)),o.data=_,r.firstMomentGraph.set(o.output,globals_1.keep(u)),r.secondMomentGraph.set(o.output,globals_1.keep(l)),n.dispose(),i.dispose(),c.dispose(),p.dispose()}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.variableGradients.dispose(),this.variableGradients=new tensor_array_map_1.TensorArrayMap},t.prototype.dispose=function(){var t=this;e.prototype.dispose.call(this),this.c.dispose(),this.eps.dispose(),this.beta1.dispose(),this.beta2.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.firstMomentGraph&&this.firstMomentGraph.dispose(),null!=this.secondMomentGraph&&this.secondMomentGraph.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return t.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach(function(e){return t.accumulatedSecondMoment[e].dispose()})},t}(optimizer_1.Optimizer);exports.AdamOptimizer=AdamOptimizer;

},{"../environment":66,"../globals":67,"../graph/tensor_array_map":98,"../ops/ops":155,"../tensor":178,"./optimizer":172}],170:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),tensor_array_map_1=require("../graph/tensor_array_map"),ops_1=require("../ops/ops"),tensor_1=require("../tensor"),tensor_2=require("../tensor"),optimizer_1=require("./optimizer"),AdamaxOptimizer=function(e){function t(t,a,s,r,o,i){void 0===r&&(r=1e-8),void 0===o&&(o=0);var n=e.call(this,t,i)||this;return n.learningRate=t,n.accumulatedFirstMoment={},n.accumulatedWeightedInfNorm={},n.firstMomentGraph=new tensor_array_map_1.TensorArrayMap,n.weightedInfNormGraph=new tensor_array_map_1.TensorArrayMap,n.c=globals_1.keep(ops_1.scalar(-t)),n.eps=globals_1.keep(ops_1.scalar(r)),n.beta1=globals_1.keep(ops_1.scalar(a)),n.beta2=globals_1.keep(ops_1.scalar(s)),n.decay=globals_1.keep(ops_1.scalar(o)),globals_1.tidy(function(){n.iteration=tensor_2.variable(ops_1.scalar(0)),n.accBeta1=tensor_2.variable(ops_1.scalar(a))}),n.oneMinusBeta1=globals_1.keep(ops_1.scalar(1-a)),n.one=globals_1.keep(ops_1.scalar(1)),n}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this;globals_1.tidy(function(){var a=t.one.sub(t.accBeta1),s=t.c.div(t.one.add(t.decay.mul(t.iteration)));for(var r in e){var o=environment_1.ENV.engine.registeredVariables[r];if(null==t.accumulatedFirstMoment[r]){var i=!1;t.accumulatedFirstMoment[r]=tensor_2.variable(ops_1.zerosLike(o),i)}if(null==t.accumulatedWeightedInfNorm[r]){i=!1;t.accumulatedWeightedInfNorm[r]=tensor_2.variable(ops_1.zerosLike(o),i)}var n=e[r],p=t.accumulatedFirstMoment[r],u=t.accumulatedWeightedInfNorm[r],c=t.beta1.mul(p).add(t.oneMinusBeta1.mul(n)),d=t.beta2.mul(u),l=n.abs(),m=d.maximum(l);t.accumulatedFirstMoment[r].assign(c),t.accumulatedWeightedInfNorm[r].assign(m);var h=s.div(a).mul(c.div(t.eps.add(m))).add(o);o.assign(h)}t.iteration.assign(t.iteration.add(t.one)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})},t.prototype.beforeBatch=function(t,a,s,r,o){var i=this;e.prototype.beforeBatch.call(this,t,a,s,r,o),0===this.firstMomentGraph.size()&&this.variableNodes.forEach(function(e){i.firstMomentGraph.set(e.output,tensor_1.Tensor.zeros(e.output.shape))}),0===this.weightedInfNormGraph.size()&&this.variableNodes.forEach(function(e){i.weightedInfNormGraph.set(e.output,tensor_1.Tensor.zeros(e.output.shape))})},t.prototype.afterBatch=function(e,t,a,s,r){var o=this;globals_1.tidy(function(){var t=o.cGraph.div(o.one.add(o.decay.mul(o.iteration)));o.variableNodes.forEach(function(a){var r=s.get(a.output),i=o.variableGradients.get(a.output),n=o.firstMomentGraph.get(a.output),p=o.weightedInfNormGraph.get(a.output),u=e.scaledArrayAdd(o.beta1,n,o.oneMinusBeta1,i),c=o.beta2.mul(p),d=i.abs(),l=c.maximum(d),m=e.scaledArrayAdd(o.one,r,t.div(o.one.sub(o.accBeta1)),u.div(o.eps.add(l)));s.set(a.output,globals_1.keep(m)),a.data=m,o.firstMomentGraph.set(a.output,globals_1.keep(u)),o.weightedInfNormGraph.set(a.output,globals_1.keep(l)),r.dispose(),i.dispose(),n.dispose(),p.dispose()}),o.iteration.assign(o.iteration.add(o.one)),o.accBeta1.assign(o.accBeta1.mul(o.beta1))}),this.variableGradients.dispose(),this.variableGradients=new tensor_array_map_1.TensorArrayMap},t.prototype.dispose=function(){var t=this;e.prototype.dispose.call(this),this.c.dispose(),this.eps.dispose(),this.accBeta1.dispose(),this.beta1.dispose(),this.beta2.dispose(),this.oneMinusBeta1.dispose(),this.decay.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.firstMomentGraph&&this.firstMomentGraph.dispose(),null!=this.weightedInfNormGraph&&this.weightedInfNormGraph.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return t.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(e){return t.accumulatedWeightedInfNorm[e].dispose()})},t}(optimizer_1.Optimizer);exports.AdamaxOptimizer=AdamaxOptimizer;

},{"../environment":66,"../globals":67,"../graph/tensor_array_map":98,"../ops/ops":155,"../tensor":178,"./optimizer":172}],171:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),tensor_array_map_1=require("../graph/tensor_array_map"),ops_1=require("../ops/ops"),tensor_1=require("../tensor"),tensor_2=require("../tensor"),sgd_optimizer_1=require("./sgd_optimizer"),MomentumOptimizer=function(e){function t(t,r,o){var i=e.call(this,t,o)||this;return i.learningRate=t,i.momentum=r,i.m=ops_1.scalar(i.momentum),i.accumulations={},i}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this,r=function(r){var i=environment_1.ENV.engine.registeredVariables[r];if(null==o.accumulations[r]){globals_1.tidy(function(){t.accumulations[r]=tensor_2.variable(ops_1.zerosLike(i),!1)})}var a=o.accumulations[r],s=e[r];globals_1.tidy(function(){var e=t.m.mul(a).add(s);t.accumulations[r].assign(e);var o=t.c.mul(e).add(i);i.assign(o)})},o=this;for(var i in e)r(i)},t.prototype.beforeBatch=function(t,r,o,i,a){var s=this;null==this.variableVelocitiesGraph&&(this.variableVelocitiesGraph=new tensor_array_map_1.TensorArrayMap),e.prototype.beforeBatch.call(this,t,r,o,i,a),0===this.variableVelocitiesGraph.size()&&this.variableNodes.forEach(function(e){s.variableVelocitiesGraph.set(e.output,tensor_1.Tensor.zeros(e.output.shape))})},t.prototype.afterBatch=function(e,t,r,o,i){var a=this;null==this.one&&(this.one=globals_1.keep(ops_1.scalar(1))),globals_1.tidy(function(){a.variableNodes.forEach(function(t){var r=o.get(t.output),i=a.variableGradients.get(t.output),s=a.variableVelocitiesGraph.get(t.output),n=e.scaledArrayAdd(a.m,s,a.one,i),p=e.scaledArrayAdd(a.cGraph,n,a.one,r);a.variableVelocitiesGraph.set(t.output,globals_1.keep(n)),o.set(t.output,globals_1.keep(p)),t.data=p,r.dispose(),s.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new tensor_array_map_1.TensorArrayMap},t.prototype.dispose=function(){if(e.prototype.dispose.call(this),this.m.dispose(),null!=this.one&&this.one.dispose(),null!=this.variableVelocitiesGraph&&this.variableVelocitiesGraph.dispose(),null!=this.accumulations)for(var t in this.accumulations)this.accumulations[t].dispose()},t.prototype.setMomentum=function(e){this.momentum=e},t}(sgd_optimizer_1.SGDOptimizer);exports.MomentumOptimizer=MomentumOptimizer;

},{"../environment":66,"../globals":67,"../graph/tensor_array_map":98,"../ops/ops":155,"../tensor":178,"./sgd_optimizer":175}],172:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,t,i,r){var a,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var n=e.length-1;n>=0;n--)(a=e[n])&&(o=(s<3?a(o):s>3?a(t,i,o):a(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),globals_1=require("../globals"),session_util=require("../graph/session_util"),tensor_array_map_1=require("../graph/tensor_array_map"),ops=require("../ops/ops"),tensor_1=require("../tensor"),Optimizer=function(){function e(e,t){this.learningRate=e,this.variableGradients=new tensor_array_map_1.TensorArrayMap,null!=t&&(this.specifiedVariableNodes=t)}return e.prototype.minimize=function(e,t,i){void 0===t&&(t=!1);var r=this.computeGradients(e,i),a=r.value,s=r.grads;return this.applyGradients(s),Object.keys(s).forEach(function(e){return s[e].dispose()}),t?a:(a.dispose(),null)},e.prototype.computeGradients=function(e,t){return globals_1.variableGrads(e,t)},e.prototype.beforeBatch=function(e,t,i,r,a){var s=this;this.variableNodes=null==this.specifiedVariableNodes?session_util.getVariableNodesFromEvaluationSet(i.nodes):this.specifiedVariableNodes,t!==this.prevBatchSize&&(null!=this.cGraph&&this.cGraph.dispose(),this.prevBatchSize=t,this.cGraph=e.keep(ops.scalar(-this.learningRate/t))),this.variableNodes.forEach(function(t){return s.variableGradients.set(t.output,e.keep(tensor_1.Tensor.zeros(t.output.shape)))})},e.prototype.afterExample=function(e,t,i,r){var a=this;globals_1.tidy(function(){a.variableNodes.forEach(function(t){var i=r.get(t.output),s=a.variableGradients.get(t.output);a.variableGradients.set(t.output,globals_1.keep(e.add(i,s))),s.dispose()})})},e.prototype.dispose=function(){null!=this.cGraph&&this.cGraph.dispose(),null!=this.variableNodes&&this.variableNodes.forEach(function(e){e.data.dispose()}),null!=this.specifiedVariableNodes&&this.specifiedVariableNodes.forEach(function(e){e.data.dispose()})},__decorate([doc_1.doc({heading:"Training",subheading:"Optimizers"})],e.prototype,"minimize",null),e=__decorate([doc_1.doc({heading:"Training",subheading:"Classes",namespace:"train"})],e)}();exports.Optimizer=Optimizer;

},{"../doc":64,"../globals":67,"../graph/session_util":97,"../graph/tensor_array_map":98,"../ops/ops":155,"../tensor":178}],173:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,i,r,a){var t,o=arguments.length,d=o<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(e,i,r,a);else for(var n=e.length-1;n>=0;n--)(t=e[n])&&(d=(o<3?t(d):o>3?t(i,r,d):t(i,r))||d);return o>3&&d&&Object.defineProperty(i,r,d),d};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),adadelta_optimizer_1=require("./adadelta_optimizer"),adagrad_optimizer_1=require("./adagrad_optimizer"),adam_optimizer_1=require("./adam_optimizer"),adamax_optimizer_1=require("./adamax_optimizer"),momentum_optimizer_1=require("./momentum_optimizer"),rmsprop_optimizer_1=require("./rmsprop_optimizer"),sgd_optimizer_1=require("./sgd_optimizer"),OptimizerConstructors=function(){function e(){}return e.sgd=function(e){return new sgd_optimizer_1.SGDOptimizer(e)},e.momentum=function(e,i){return new momentum_optimizer_1.MomentumOptimizer(e,i)},e.rmsprop=function(e,i,r,a){return void 0===i&&(i=.9),void 0===r&&(r=0),void 0===a&&(a=1e-8),new rmsprop_optimizer_1.RMSPropOptimizer(e,i,r,void 0,a)},e.adam=function(e,i,r,a){return void 0===e&&(e=.001),void 0===i&&(i=.9),void 0===r&&(r=.999),void 0===a&&(a=1e-8),new adam_optimizer_1.AdamOptimizer(e,i,r,a,void 0)},e.adadelta=function(e,i,r){return void 0===e&&(e=.001),void 0===i&&(i=.95),void 0===r&&(r=1e-8),new adadelta_optimizer_1.AdadeltaOptimizer(e,i,void 0,r)},e.adamax=function(e,i,r,a,t){return void 0===e&&(e=.002),void 0===i&&(i=.9),void 0===r&&(r=.999),void 0===a&&(a=1e-8),void 0===t&&(t=0),new adamax_optimizer_1.AdamaxOptimizer(e,i,r,a,t,void 0)},e.adagrad=function(e,i){return void 0===i&&(i=.1),new adagrad_optimizer_1.AdagradOptimizer(e,void 0,i)},__decorate([doc_1.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],e,"sgd",null),__decorate([doc_1.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],e,"momentum",null),__decorate([doc_1.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],e,"rmsprop",null),__decorate([doc_1.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],e,"adam",null),__decorate([doc_1.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],e,"adadelta",null),__decorate([doc_1.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],e,"adamax",null),__decorate([doc_1.doc({heading:"Training",subheading:"Optimizers",namespace:"train"})],e,"adagrad",null),e}();exports.OptimizerConstructors=OptimizerConstructors;

},{"../doc":64,"./adadelta_optimizer":167,"./adagrad_optimizer":168,"./adam_optimizer":169,"./adamax_optimizer":170,"./momentum_optimizer":171,"./rmsprop_optimizer":174,"./sgd_optimizer":175}],174:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,a){e.__proto__=a}||function(e,a){for(var t in a)a.hasOwnProperty(t)&&(e[t]=a[t])};return function(a,t){function s(){this.constructor=a}e(a,t),a.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),session_util=require("../graph/session_util"),tensor_array_map_1=require("../graph/tensor_array_map"),ops_1=require("../ops/ops"),tensor_1=require("../tensor"),tensor_2=require("../tensor"),optimizer_1=require("./optimizer"),RMSPropOptimizer=function(e){function a(a,t,s,r,o){void 0===t&&(t=.9),void 0===s&&(s=0),void 0===o&&(o=1e-8);var u=e.call(this,a,r)||this;return u.learningRate=a,u.accumulatedMeanSquares={},u.accumulatedMoments={},u.accumulatedMeanSquaredGraph=new tensor_array_map_1.TensorArrayMap,u.accumulatedMomentGraph=new tensor_array_map_1.TensorArrayMap,u.c=globals_1.keep(ops_1.scalar(a)),u.epsilon=globals_1.keep(ops_1.scalar(o)),u.decay=globals_1.keep(ops_1.scalar(t)),u.momentum=globals_1.keep(ops_1.scalar(s)),u.oneMinusDecay=globals_1.keep(ops_1.scalar(1-t)),u}return __extends(a,e),a.prototype.applyGradients=function(e){var a=this,t=function(t){var r=environment_1.ENV.engine.registeredVariables[t];if(null==s.accumulatedMeanSquares[t]){globals_1.tidy(function(){a.accumulatedMeanSquares[t]=tensor_2.variable(ops_1.zerosLike(r),!1)})}if(null==s.accumulatedMoments[t]){globals_1.tidy(function(){a.accumulatedMoments[t]=tensor_2.variable(ops_1.zerosLike(r),!1)})}var o=s.accumulatedMeanSquares[t],u=s.accumulatedMoments[t],i=e[t];globals_1.tidy(function(){var e=a.decay.mul(o).add(a.oneMinusDecay.mul(i.square())),s=a.momentum.mul(u).add(a.c.mul(i).div(e.add(a.epsilon).sqrt()));a.accumulatedMeanSquares[t].assign(e),a.accumulatedMoments[t].assign(s);var n=r.sub(s);r.assign(n)})},s=this;for(var r in e)t(r)},a.prototype.beforeBatch=function(e,a,t,s,r){var o=this;this.variableNodes=null==this.specifiedVariableNodes?session_util.getVariableNodesFromEvaluationSet(t.nodes):this.specifiedVariableNodes,a!==this.prevBatchSize&&(null!=this.cGraph&&this.cGraph.dispose(),this.prevBatchSize=a,this.cGraph=e.keep(ops_1.scalar(this.learningRate/a))),this.variableNodes.forEach(function(a){return o.variableGradients.set(a.output,e.keep(tensor_1.Tensor.zeros(a.output.shape)))}),0===this.accumulatedMeanSquaredGraph.size()&&this.variableNodes.forEach(function(e){o.accumulatedMeanSquaredGraph.set(e.output,tensor_1.Tensor.zeros(e.output.shape)),o.accumulatedMomentGraph.set(e.output,tensor_1.Tensor.zeros(e.output.shape))})},a.prototype.afterBatch=function(e,a,t,s,r){var o=this;globals_1.tidy(function(){o.variableNodes.forEach(function(a){var t=s.get(a.output),r=o.variableGradients.get(a.output),u=o.accumulatedMeanSquaredGraph.get(a.output),i=o.accumulatedMomentGraph.get(a.output),n=e.scaledArrayAdd(o.decay,u,o.oneMinusDecay,r.square()),c=e.scaledArrayAdd(o.momentum,i,o.cGraph,r.div(n.add(o.epsilon).sqrt())),p=t.sub(c);o.accumulatedMeanSquaredGraph.set(a.output,globals_1.keep(n)),o.accumulatedMomentGraph.set(a.output,globals_1.keep(c)),s.set(a.output,globals_1.keep(p)),a.data=p,t.dispose(),u.dispose(),i.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new tensor_array_map_1.TensorArrayMap},a.prototype.dispose=function(){var a=this;e.prototype.dispose.call(this),this.c.dispose(),this.epsilon.dispose(),this.decay.dispose(),this.momentum.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquaredGraph&&this.accumulatedMeanSquaredGraph.dispose(),null!=this.accumulatedMomentGraph&&this.accumulatedMomentGraph.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(e){return a.accumulatedMeanSquares[e].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(e){return a.accumulatedMoments[e].dispose()})},a}(optimizer_1.Optimizer);exports.RMSPropOptimizer=RMSPropOptimizer;

},{"../environment":66,"../globals":67,"../graph/session_util":97,"../graph/tensor_array_map":98,"../ops/ops":155,"../tensor":178,"./optimizer":172}],175:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),tensor_array_map_1=require("../graph/tensor_array_map"),ops_1=require("../ops/ops"),optimizer_1=require("./optimizer"),SGDOptimizer=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.learningRate=t,i.setLearningRate(t),i}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this;Object.keys(e).forEach(function(r){var i=e[r],o=environment_1.ENV.engine.registeredVariables[r];globals_1.tidy(function(){var e=t.c.mul(i).add(o);o.assign(e)})})},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=environment_1.ENV.math.keep(ops_1.scalar(-e))},t.prototype.dispose=function(){this.c.dispose(),null!=this.one&&this.one.dispose(),e.prototype.dispose.call(this)},t.prototype.afterBatch=function(e,t,r,i,o){var n=this;null==this.one&&(this.one=globals_1.keep(ops_1.scalar(1))),globals_1.tidy(function(){n.variableNodes.forEach(function(t){var r=i.get(t.output),o=n.variableGradients.get(t.output),s=e.scaledArrayAdd(n.cGraph,o,n.one,r);i.set(t.output,globals_1.keep(s)),t.data=s,r.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new tensor_array_map_1.TensorArrayMap},t}(optimizer_1.Optimizer);exports.SGDOptimizer=SGDOptimizer;

},{"../environment":66,"../globals":67,"../graph/tensor_array_map":98,"../ops/ops":155,"./optimizer":172}],176:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("./util"),Profiler=function(){function e(e,r){this.backendTimer=e,this.logger=r,null==r&&(this.logger=new Logger)}return e.prototype.profileKernel=function(e,r){var t,o=this,i=this.backendTimer.time(function(){t=r()}),n=t.dataSync();return util.checkForNaN(n,t.dtype,e),i.then(function(r){o.logger.logKernelProfile(e,t,n,r.kernelMs)}),t},e}();exports.Profiler=Profiler;var Logger=function(){function e(){}return e.prototype.logKernelProfile=function(e,r,t,o){var i=util.rightPad(o+"ms",9),n=util.rightPad(e,25),l=r.rank,c=r.size,g=util.rightPad(r.shape.toString(),14);console.log("%c"+n+"\t%c"+i+"\t%c"+l+"D "+g+"\t%c"+c,"font-weight:bold","color:red","color:blue","color: orange")},e}();exports.Logger=Logger;

},{"./util":183}],177:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("./util"),tensor_1=require("./tensor");function getFilteredNodesXToY(t,r,e){for(var n={},o={},i=0;i<r.length;i++)n[r[i].id]=!0;for(i=0;i<t.length;i++){var u=(k=t[i]).inputAndArgs.inputs;for(var s in u){for(var a=u[s],p=!1,d=0;d<r.length;d++)if(n[a.id]){if(k.output instanceof tensor_1.Tensor)n[k.output.id]=!0;else for(var f=0,l=Object.keys(k.output);f<l.length;f++){var c=l[f];n[k.output[c].id]=!0}p=!0,o[k.id]=!0;break}if(p)break}}var g={};g[e.id]=!0;var v={};for(i=t.length-1;i>=0;i--){u=(k=t[i]).inputAndArgs.inputs;var h=[];if(k.output instanceof tensor_1.Tensor)h.push(k.output);else for(var b=0,A=Object.keys(k.output);b<A.length;b++){c=A[b];h.push(k.output[c])}for(d=0;d<h.length;d++)if(g[h[d].id]){for(var s in u)g[u[s].id]=!0,v[k.id]=!0;break}}var T=[];for(i=0;i<t.length;i++){var k;if(o[(k=t[i]).id]&&v[k.id]){var m={};for(var s in k.inputAndArgs.inputs){var F=k.inputAndArgs.inputs[s];n[F.id]&&(m[s]=F)}var _=void 0;if(k.output instanceof tensor_1.Tensor)_=k.output;else for(var x in _={},k.output){g[k.output[x].id]&&(_[x]=k.output[x])}var y=Object.assign({},k);y.inputAndArgs={inputs:m},y.output=_,T.push(y)}}return T}function backpropagateGradients(t,r){for(var e=r.length-1;e>=0;e--){var n=r[e],o=void 0;if(n.output instanceof tensor_1.Tensor)o=t[n.output.id];else{o={};for(var i=0,u=Object.keys(n.output);i<u.length;i++){var s=u[i];o[s]=t[n.output[s].id]}}if(null==n.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+n.name+".");var a=n.gradient(o,n.output);for(var p in n.inputAndArgs.inputs){if(!(p in a))throw new Error("Cannot backprop through input "+p+". Available gradients found: "+Object.keys(a)+".");var d=a[p](),f=n.inputAndArgs.inputs[p];if(!util.arraysEqual(d.shape,f.shape))throw new Error("Error in gradient for op "+n.name+". The gradient of input '"+p+"' has shape '"+d.shape+"', which does not match the shape of the input '"+f.shape+"'");if(null==t[f.id])t[f.id]=d;else{var l=t[f.id];t[f.id]=l.add(d),l.dispose()}}}}function extractTensorsFromScopeResult(t){if(null==t)return[];if(t instanceof tensor_1.Tensor)return[t];var r=[],e=t;for(var n in e){var o=util.flatten(e[n]).filter(function(t){return t instanceof tensor_1.Tensor});r.push.apply(r,o)}return r}function stripUndefinedInputsFromInputConfig(t){return Object.keys(t.inputs).forEach(function(r){null==t.inputs[r]&&delete t.inputs[r]}),t}exports.getFilteredNodesXToY=getFilteredNodesXToY,exports.backpropagateGradients=backpropagateGradients,exports.extractTensorsFromScopeResult=extractTensorsFromScopeResult,exports.stripUndefinedInputsFromInputConfig=stripUndefinedInputsFromInputConfig;

},{"./tensor":178,"./util":183}],178:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])};return function(o,e){function s(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}(),__decorate=this&&this.__decorate||function(t,o,e,s){var r,n=arguments.length,i=n<3?o:null===s?s=Object.getOwnPropertyDescriptor(o,e):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,o,e,s);else for(var p=t.length-1;p>=0;p--)(r=t[p])&&(i=(n<3?r(i):n>3?r(o,e,i):r(o,e))||i);return n>3&&i&&Object.defineProperty(o,e,i),i},__awaiter=this&&this.__awaiter||function(t,o,e,s){return new(e||(e=Promise))(function(r,n){function i(t){try{h(s.next(t))}catch(t){n(t)}}function p(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){t.done?r(t.value):new e(function(o){o(t.value)}).then(i,p)}h((s=s.apply(t,o||[])).next())})},__generator=this&&this.__generator||function(t,o){var e,s,r,n,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:p(0),throw:p(1),return:p(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function p(n){return function(p){return function(n){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,s&&(r=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[0,r.value]),n[0]){case 0:case 1:r=n;break;case 4:return i.label++,{value:n[1],done:!1};case 5:i.label++,s=n[1],n=[0];continue;case 7:n=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){i=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){i.label=n[1];break}if(6===n[0]&&i.label<r[1]){i.label=r[1],r=n;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(n);break}r[2]&&i.ops.pop(),i.trys.pop();continue}n=o.call(t,i)}catch(t){n=[6,t],s=0}finally{e=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,p])}}};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("./doc"),environment_1=require("./environment"),ops=require("./ops/ops"),util=require("./util"),TensorBuffer=function(){function t(t,o,e){if(this.shape=t,this.dtype=o,this.values=e,null!=e){var s=e.length,r=util.sizeFromShape(t);util.assert(s===r,"Length of values '"+s+"' does not match the size inferred by the shape '"+r+"'")}this.values=e||util.getTypedArrayFromDType(o,util.sizeFromShape(t)),this.strides=computeStrides(t)}return t.prototype.set=function(t){for(var o=[],e=1;e<arguments.length;e++)o[e-1]=arguments[e];0===o.length&&(o=[0]),util.assert(o.length===this.rank,"The number of provided coordinates ("+o.length+") must match the rank ("+this.rank+")");var s=this.locToIndex(o);this.values[s]=t},t.prototype.get=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];0===t.length&&(t=[0]);for(var e=t[t.length-1],s=0;s<t.length-1;++s)e+=this.strides[s]*t[s];return this.values[e]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var o=t[t.length-1],e=0;e<t.length-1;++e)o+=this.strides[e]*t[e];return o},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var o=new Array(this.shape.length),e=0;e<o.length-1;++e)o[e]=Math.floor(t/this.strides[e]),t-=o[e]*this.strides[e];return o[o.length-1]=t,o},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return Tensor.make(this.shape,{values:this.values},this.dtype)},__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"})],t.prototype,"set",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"})],t.prototype,"get",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"})],t.prototype,"toTensor",null),t=__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t)}();exports.TensorBuffer=TensorBuffer;var Tensor=function(){function t(t,e,s,r){this.isDisposed=!1,this.size=util.sizeFromShape(t),null!=s&&util.assert(this.size===s.length,"Constructing tensor of shape ("+this.size+") should match the length of values ("+s.length+")"),this.shape=t,this.dtype=e||"float32",this.strides=computeStrides(t),this.dataId=null!=r?r:{},this.id=o.nextId++,this.rankType=this.rank<5?this.rank.toString():"higher",environment_1.ENV.engine.registerTensor(this),null!=s&&environment_1.ENV.engine.write(this.dataId,s)}return o=t,t.ones=function(t,o){return ops.ones(t,o)},t.zeros=function(t,o){return ops.zeros(t,o)},t.onesLike=function(t){return ops.onesLike(t)},t.zerosLike=function(t){return ops.zerosLike(t)},t.like=function(t){return ops.clone(t)},t.make=function(t,e,s){return new o(t,s,e.values,e.dataId)},t.fromPixels=function(t,o){return void 0===o&&(o=3),ops.fromPixels(t,o)},t.rand=function(t,o,e){return ops.rand(t,o,e)},t.randNormal=function(t,o,e,s,r){return void 0===o&&(o=0),void 0===e&&(e=1),ops.randomNormal(t,o,e,s,r)},t.randTruncatedNormal=function(t,o,e,s,r){return void 0===o&&(o=0),void 0===e&&(e=1),ops.truncatedNormal(t,o,e,s,r)},t.randUniform=function(t,o,e,s){return ops.randomUniform(t,o,e,s)},t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),util.assert(1===this.size,"The array must have only 1 element."),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,o){return this.throwIfDisposed(),this.reshape([t,o])},t.prototype.as3D=function(t,o,e){return this.throwIfDisposed(),this.reshape([t,o,e])},t.prototype.as4D=function(t,o,e,s){return this.throwIfDisposed(),this.reshape([t,o,e,s])},t.prototype.asType=function(t){return this.throwIfDisposed(),ops.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.get=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this.throwIfDisposed(),0===t.length&&(t=[0]);for(var e=t[t.length-1],s=0;s<t.length-1;++s)e+=this.strides[s]*t[s];return this.dataSync()[e]},t.prototype.val=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return 0===t.length&&(t=[0]),this.throwIfDisposed(),[4,this.data()];case 1:return o.sent(),[2,this.get.apply(this,t)]}})})},t.prototype.locToIndex=function(t){if(this.throwIfDisposed(),0===this.rank)return 0;if(1===this.rank)return t[0];for(var o=t[t.length-1],e=0;e<t.length-1;++e)o+=this.strides[e]*t[e];return o},t.prototype.indexToLoc=function(t){if(this.throwIfDisposed(),0===this.rank)return[];if(1===this.rank)return[t];for(var o=new Array(this.shape.length),e=0;e<o.length-1;++e)o[e]=Math.floor(t/this.strides[e]),t-=o[e]*this.strides[e];return o[o.length-1]=t,o},t.prototype.getValues=function(){return this.dataSync()},t.prototype.getValuesAsync=function(){return this.data()},t.prototype.buffer=function(){return ops.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.data=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.throwIfDisposed(),[2,environment_1.ENV.engine.read(this.dataId)]})})},t.prototype.dataSync=function(){return this.throwIfDisposed(),environment_1.ENV.engine.readSync(this.dataId)},t.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,environment_1.ENV.engine.disposeTensor(this))},t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),ops.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),ops.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),ops.expandDims(this,t)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),ops.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),ops.clone(this)},t.prototype.tile=function(t){return this.throwIfDisposed(),ops.tile(this,t)},t.prototype.gather=function(t,o){return void 0===o&&(o=0),this.throwIfDisposed(),ops.gather(this,t)},t.prototype.matMul=function(t,o,e){return void 0===o&&(o=!1),void 0===e&&(e=!1),this.throwIfDisposed(),ops.matMul(this,t,o,e)},t.prototype.norm=function(t,o,e){return void 0===t&&(t="euclidean"),void 0===o&&(o=null),void 0===e&&(e=!1),this.throwIfDisposed(),ops.norm(this,t,o,e)},t.prototype.slice=function(t,o){return this.throwIfDisposed(),ops.slice(this,t,o)},t.prototype.reverse=function(t){return this.throwIfDisposed(),ops.reverse(this,t)},t.prototype.concat=function(t,o){return void 0===o&&(o=0),this.throwIfDisposed(),ops.concat([this,t],o)},t.prototype.stack=function(t,o){return void 0===o&&(o=0),ops.stack([this,t],o)},t.prototype.pad=function(t,o){return void 0===o&&(o=0),ops.pad(this,t,o)},t.prototype.batchNormalization=function(t,o,e,s,r){return void 0===e&&(e=.001),this.throwIfDisposed(),ops.batchNormalization(this,t,o,e,s,r)},t.prototype.logSumExp=function(t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),this.throwIfDisposed(),ops.logSumExp(this,t,o)},t.prototype.sum=function(t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),this.throwIfDisposed(),ops.sum(this,t,o)},t.prototype.mean=function(t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),this.throwIfDisposed(),ops.mean(this,t,o)},t.prototype.min=function(t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),this.throwIfDisposed(),ops.min(this,t,o)},t.prototype.max=function(t,o){return void 0===t&&(t=null),void 0===o&&(o=!1),this.throwIfDisposed(),ops.max(this,t,o)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),ops.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),ops.argMax(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),ops.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),ops.addStrict(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),ops.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),ops.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),ops.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),ops.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),ops.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),ops.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),ops.div(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),ops.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),ops.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),ops.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),ops.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),ops.maximumStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),ops.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),ops.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),ops.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),ops.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),ops.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),ops.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),ops.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),ops.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),ops.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),ops.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),ops.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),ops.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),ops.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),ops.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),ops.logicalOr(this,t)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),ops.logicalXor(this,t)},t.prototype.where=function(t,o){return this.throwIfDisposed(),ops.where(t,this,o)},t.prototype.neg=function(){return this.throwIfDisposed(),ops.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),ops.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),ops.floor(this)},t.prototype.exp=function(){return this.throwIfDisposed(),ops.exp(this)},t.prototype.log=function(){return this.throwIfDisposed(),ops.log(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),ops.sqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),ops.square(this)},t.prototype.abs=function(){return this.throwIfDisposed(),ops.abs(this)},t.prototype.clipByValue=function(t,o){return this.throwIfDisposed(),ops.clipByValue(this,t,o)},t.prototype.relu=function(){return this.throwIfDisposed(),ops.relu(this)},t.prototype.elu=function(){return this.throwIfDisposed(),ops.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),ops.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),ops.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),ops.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),ops.sigmoid(this)},t.prototype.sin=function(){return this.throwIfDisposed(),ops.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),ops.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),ops.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),ops.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),ops.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),ops.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),ops.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),ops.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),ops.tanh(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),ops.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),ops.softmax(this,t)},t.prototype.resizeBilinear=function(t,o){return void 0===o&&(o=!1),this.throwIfDisposed(),ops.image.resizeBilinear(this,t,o)},t.prototype.conv1d=function(t,o,e,s){return this.throwIfDisposed(),ops.conv1d(this,t,o,e,s)},t.prototype.conv2d=function(t,o,e,s){return this.throwIfDisposed(),ops.conv2d(this,t,o,e,s)},t.prototype.conv2dTranspose=function(t,o,e,s,r){return this.throwIfDisposed(),ops.conv2dTranspose(this,t,o,e,s,r)},t.prototype.depthwiseConv2D=function(t,o,e,s,r){return void 0===s&&(s=[1,1]),this.throwIfDisposed(),ops.depthwiseConv2d(this,t,o,e,s,r)},t.prototype.avgPool=function(t,o,e,s){return this.throwIfDisposed(),ops.avgPool(this,t,o,e,s)},t.prototype.maxPool=function(t,o,e,s){return this.throwIfDisposed(),ops.maxPool(this,t,o,e,s)},t.prototype.minPool=function(t,o,e,s){return this.throwIfDisposed(),ops.minPool(this,t,o,e,s)},t.prototype.localResponseNormalization=function(t,o,e,s,r){return void 0===t&&(t=5),void 0===o&&(o=1),void 0===e&&(e=1),void 0===s&&(s=.5),void 0===r&&(r="acrossChannels"),ops.localResponseNormalization(this,t,o,e,s,r)},t.prototype.variable=function(t,o,e){return void 0===t&&(t=!0),this.throwIfDisposed(),Variable.variable(this,t,o,e)},t.nextId=0,__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"flatten",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"asScalar",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"as1D",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"as2D",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"as3D",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"as4D",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"asType",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"buffer",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"data",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"dataSync",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"dispose",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"toFloat",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"toInt",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"toBool",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"print",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"reshape",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"reshapeAs",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"expandDims",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"squeeze",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t.prototype,"clone",null),t=o=__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],t);var o}();exports.Tensor=Tensor,exports.NDArray=Tensor;var Scalar=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.new=function(t,o){return ops.scalar(t,o)},o}(Tensor);exports.Scalar=Scalar;var Tensor1D=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.new=function(t,o){return ops.tensor1d(t,o)},o}(Tensor);exports.Tensor1D=Tensor1D,exports.Array1D=Tensor1D;var Tensor2D=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.new=function(t,o,e){return ops.tensor2d(o,t,e)},o}(Tensor);exports.Tensor2D=Tensor2D,exports.Array2D=Tensor2D;var Tensor3D=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.new=function(t,o,e){return ops.tensor3d(o,t,e)},o}(Tensor);exports.Tensor3D=Tensor3D,exports.Array3D=Tensor3D;var Tensor4D=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.new=function(t,o,e){return ops.tensor4d(o,t,e)},o}(Tensor);exports.Tensor4D=Tensor4D,exports.Array4D=Tensor4D;var Variable=function(t){function o(o,s,r){void 0===s&&(s=!0);var n=t.call(this,o.shape,o.dtype,null,o.dataId)||this;return n.trainable=s,n.name=r,null==n.name&&(n.name=e.nextVarId.toString(),e.nextVarId++),environment_1.ENV.engine.registerVariable(n),n}return __extends(o,t),e=o,o.variable=function(t,o,s,r){return void 0===o&&(o=!0),null!=r&&r!==t.dtype&&(t=t.asType(r)),new e(t,o,s)},o.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!util.arraysEqual(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");environment_1.ENV.engine.disposeTensor(this),this.dataId=t.dataId,environment_1.ENV.engine.registerTensor(this)},o.nextVarId=0,__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],o.prototype,"assign",null),__decorate([doc_1.doc({heading:"Tensors",subheading:"Creation"})],o,"variable",null),o=e=__decorate([doc_1.doc({heading:"Tensors",subheading:"Classes"})],o);var e}(Tensor);exports.Variable=Variable;var variable=Variable.variable;function computeStrides(t){var o=t.length;if(o<2)return[];var e=new Array(o-1);e[o-2]=t[o-1];for(var s=o-3;s>=0;--s)e[s]=e[s+1]*t[s+1];return e}exports.variable=variable;

},{"./doc":64,"./environment":66,"./ops/ops":155,"./util":183}],179:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment"),backend_cpu_1=require("./kernels/backend_cpu"),backend_webgl_1=require("./kernels/backend_webgl"),tensor_1=require("./tensor"),util=require("./util"),WEBGL_FLOAT_ENVS=[{BACKEND:"webgl",WEBGL_FLOAT_TEXTURE_ENABLED:!0,WEBGL_VERSION:1},{BACKEND:"webgl",WEBGL_FLOAT_TEXTURE_ENABLED:!0,WEBGL_VERSION:2}];function expectArraysClose(e,r,n){if(void 0===n&&(n=exports.TEST_EPSILON),e instanceof tensor_1.Tensor||r instanceof tensor_1.Tensor){if(e instanceof tensor_1.Tensor&&r instanceof tensor_1.Tensor){if(e.dtype!==r.dtype)throw new Error("Arrays are of different type actual: "+e.dtype+" vs expected: "+r.dtype+".");if(!util.arraysEqual(e.shape,r.shape))throw new Error("Arrays are of different shape actual: "+e.shape+" vs expected: "+r.shape+".")}}else{var t=e.constructor.name,s=r.constructor.name;if(t!==s)throw new Error("Arrays are of different type actual: "+t+" vs expected: "+s)}var a,o;if(a=e instanceof tensor_1.Tensor?e.dataSync():e,o=r instanceof tensor_1.Tensor?r.dataSync():r,a.length!==o.length)throw new Error("Arrays have different lengths actual: "+a.length+" vs expected: "+o.length+".\nActual:   "+a+".\nExpected: "+o+".");for(var c=0;c<o.length;++c){var i=a[c],E=o[c];if(!areClose(i,Number(E),n))throw new Error("Arrays differ: actual["+c+"] = "+i+", expected["+c+"] = "+E+".\nActual:   "+a+".\nExpected: "+o+".")}}function expectArraysEqual(e,r){return expectArraysClose(e,r,0)}function expectNumbersClose(e,r,n){if(void 0===n&&(n=exports.TEST_EPSILON),!areClose(e,r,n))throw new Error("Numbers differ: actual === "+e+", expected === "+r)}function areClose(e,r,n){return!(!isNaN(e)||!isNaN(r))||!(isNaN(e)||isNaN(r)||Math.abs(e-r)>n)}function expectValuesInRange(e,r,n){var t;t=e instanceof tensor_1.Tensor?e.dataSync():e;for(var s=0;s<t.length;s++)if(t[s]<r||t[s]>n)throw new Error("Value out of range:"+t[s]+" low: "+r+", high: "+n)}function describeWithFlags(e,r,n){r.forEach(function(r){executeTests(e+" "+JSON.stringify(r),n,r)})}function executeTests(e,r,n){describe(e,function(){beforeEach(function(){environment_1.ENV.setFeatures(n||{}),environment_1.ENV.addCustomBackend("webgl",function(){return new backend_webgl_1.MathBackendWebGL}),environment_1.ENV.addCustomBackend("cpu",function(){return new backend_cpu_1.MathBackendCPU}),n&&null!=n.BACKEND&&environment_1.Environment.setBackend(n.BACKEND),environment_1.ENV.engine.startScope()}),afterEach(function(){environment_1.ENV.engine.endScope(null),environment_1.ENV.reset()}),r()})}function assertIsNan(e,r){if(!util.isValNaN(e,r))throw new Error("Value "+e+" does not represent NaN for dtype "+r)}exports.WEBGL_ENVS=WEBGL_FLOAT_ENVS.concat([{BACKEND:"webgl",WEBGL_FLOAT_TEXTURE_ENABLED:!1,WEBGL_VERSION:1}]),exports.CPU_ENVS=[{BACKEND:"cpu"}],exports.ALL_FLOAT_ENVS=WEBGL_FLOAT_ENVS.concat(exports.CPU_ENVS),exports.ALL_ENVS=exports.WEBGL_ENVS.concat(exports.CPU_ENVS),exports.TEST_EPSILON=.01,exports.expectArraysClose=expectArraysClose,exports.expectArraysEqual=expectArraysEqual,exports.expectNumbersClose=expectNumbersClose,exports.expectValuesInRange=expectValuesInRange,exports.describeWithFlags=describeWithFlags,exports.assertIsNan=assertIsNan;

},{"./environment":66,"./kernels/backend_cpu":100,"./kernels/backend_webgl":101,"./tensor":178,"./util":183}],180:[function(require,module,exports){
"use strict";var __decorate=this&&this.__decorate||function(e,n,t,r){var o,i=arguments.length,c=i<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,n,t,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(c=(i<3?o(c):i>3?o(n,t,c):o(n,t))||c);return i>3&&c&&Object.defineProperty(n,t,c),c};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("./doc"),environment_1=require("./environment"),Tracking=function(){function e(){}return e.tidy=function(e,n,t){if(void 0===t&&(t=!1),null==n){if("function"!=typeof e)throw new Error("Please provide a function to dl.tidy()");n=e,e=""}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to dl.tidy() must be a string");if("function"!=typeof n)throw new Error("When calling with two arguments, the 2nd argument to dl.tidy() must be a function")}environment_1.ENV.engine.startScope(t);var r=n();return r instanceof Promise?(r.then(function(e){return environment_1.ENV.engine.endScope(e,t)}),r):(environment_1.ENV.engine.endScope(r,t),r)},e.keep=function(e){return environment_1.ENV.engine.keep(e)},e.time=function(e){return environment_1.ENV.engine.time(e)},__decorate([doc_1.doc({heading:"Performance",subheading:"Memory"})],e,"tidy",null),__decorate([doc_1.doc({heading:"Performance",subheading:"Memory"})],e,"keep",null),__decorate([doc_1.doc({heading:"Performance",subheading:"Timing"})],e,"time",null),e}();exports.Tracking=Tracking;

},{"./doc":64,"./environment":66}],181:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var adadelta_optimizer_1=require("./optimizers/adadelta_optimizer"),adagrad_optimizer_1=require("./optimizers/adagrad_optimizer"),adam_optimizer_1=require("./optimizers/adam_optimizer"),adamax_optimizer_1=require("./optimizers/adamax_optimizer"),momentum_optimizer_1=require("./optimizers/momentum_optimizer"),optimizer_constructors_1=require("./optimizers/optimizer_constructors"),rmsprop_optimizer_1=require("./optimizers/rmsprop_optimizer"),sgd_optimizer_1=require("./optimizers/sgd_optimizer");momentum_optimizer_1.MomentumOptimizer,sgd_optimizer_1.SGDOptimizer,adadelta_optimizer_1.AdadeltaOptimizer,adagrad_optimizer_1.AdagradOptimizer,rmsprop_optimizer_1.RMSPropOptimizer,adamax_optimizer_1.AdamaxOptimizer,adam_optimizer_1.AdamOptimizer,exports.train={sgd:optimizer_constructors_1.OptimizerConstructors.sgd,momentum:optimizer_constructors_1.OptimizerConstructors.momentum,adadelta:optimizer_constructors_1.OptimizerConstructors.adadelta,adagrad:optimizer_constructors_1.OptimizerConstructors.adagrad,rmsprop:optimizer_constructors_1.OptimizerConstructors.rmsprop,adamax:optimizer_constructors_1.OptimizerConstructors.adamax,adam:optimizer_constructors_1.OptimizerConstructors.adam};

},{"./optimizers/adadelta_optimizer":167,"./optimizers/adagrad_optimizer":168,"./optimizers/adam_optimizer":169,"./optimizers/adamax_optimizer":170,"./optimizers/momentum_optimizer":171,"./optimizers/optimizer_constructors":173,"./optimizers/rmsprop_optimizer":174,"./optimizers/sgd_optimizer":175}],182:[function(require,module,exports){
"use strict";var DType,Rank,UpcastInt32AndMap,UpcastBoolAndMap,UpcastFloat32AndMap;Object.defineProperty(exports,"__esModule",{value:!0}),function(t){t.float32="float32",t.int32="int32",t.bool="bool"}(DType=exports.DType||(exports.DType={})),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4"}(Rank=exports.Rank||(exports.Rank={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32"}(UpcastInt32AndMap||(UpcastInt32AndMap={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool"}(UpcastBoolAndMap||(UpcastBoolAndMap={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32"}(UpcastFloat32AndMap||(UpcastFloat32AndMap={}));var upcastTypeMap={float32:UpcastFloat32AndMap,int32:UpcastInt32AndMap,bool:UpcastBoolAndMap};function upcastType(t,a){return upcastTypeMap[t][a]}function sumOutType(t){return upcastType(t,"int32")}exports.upcastType=upcastType,exports.sumOutType=sumOutType;

},{}],183:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("./tensor");function shuffle(r){for(var e=r.length,t=0,n=0;e>0;)n=Math.random()*e|0,t=r[--e],r[e]=r[n],r[n]=t}function clamp(r,e,t){return Math.max(r,Math.min(e,t))}function randUniform(r,e){return Math.random()*(e-r)+r}function distSquared(r,e){for(var t=0,n=0;n<r.length;n++){var a=Number(r[n])-Number(e[n]);t+=a*a}return t}function assert(r,e){if(!r)throw new Error(e)}function assertShapesMatch(r,e,t){void 0===t&&(t=""),assert(arraysEqual(r,e),t+"Shapes "+r+" and "+e+" must match")}function assertTypesMatch(r,e){assert(r.dtype===e.dtype,"The dtypes of the first ("+r.dtype+") and second ("+e.dtype+") input must match")}function flatten(r,e){if(void 0===e&&(e=[]),Array.isArray(r))for(var t=0;t<r.length;++t)flatten(r[t],e);else e.push(r);return e}function inferShape(r){if(isTypedArray(r))return[r.length];if(!Array.isArray(r))return[];for(var e=[];r instanceof Array;)e.push(r.length),r=r[0];return e}function sizeFromShape(r){if(0===r.length)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function isScalarShape(r){return 0===r.length}function arraysEqual(r,e){if(r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function isInt(r){return r%1==0}function tanh(r){if(null!=Math.tanh)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function sizeToSquarishShape(r){for(var e=Math.floor(Math.sqrt(r));e>1;--e)if(r%e==0)return[e,r/e];return[1,r]}function createShuffledIndices(r){for(var e=new Uint32Array(r),t=0;t<r;++t)e[t]=t;return shuffle(e),e}function rightPad(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function repeatedTry(r,e,t){return void 0===e&&(e=function(r){return 0}),new Promise(function(n,a){var o=0,s=function(){if(r())n();else{var i=e(++o);null!=t&&o>=t?a():setTimeout(s,i)}};setTimeout(s,0)})}function getQueryParams(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(r){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return decodeParam(e,t[0],t[1]),t.join("=")}),e}function decodeParam(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function inferFromImplicitShape(r,e){for(var t=1,n=-1,a=0;a<r.length;++a)if(r[a]>0)t*=r[a];else if(-1===r[a]){if(-1!==n)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+a);n=a}else if(r[a]<=0)throw Error("Shapes can not be <= 0. Found "+r[a]+" at dim "+a);if(-1===n){if(e>0&&e!==t)throw Error("Size ("+e+") must match the product of shape "+r);return r}if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=r.slice();return o[n]=e/t,o}function getNaN(r){if("float32"===r)return exports.NAN_FLOAT32;if("int32"===r)return exports.NAN_INT32;if("bool"===r)return exports.NAN_BOOL;throw new Error("Unknown dtype "+r)}function isValNaN(r,e){if(isNaN(r))return!0;if("float32"===e)return!1;if("int32"===e)return r===exports.NAN_INT32;if("bool"===e)return r===exports.NAN_BOOL;throw new Error("Unknown dtype "+e)}function squeezeShape(r,e){for(var t=[],n=[],a=0,o=0;o<r.length;++o){if(void 0!==e){if(e[a]===o&&r[o]>1)throw new Error("axis "+o+" is not 1");(void 0===e[a]||e[a]>o)&&1===r[o]&&(t.push(r[o]),n.push(o)),e[a]<=o&&a++}r[o]>1&&(t.push(r[o]),n.push(o))}return{newShape:t,keptDims:n}}function getTypedArrayFromDType(r,e){var t=null;if(null==r||"float32"===r)t=new Float32Array(e);else if("int32"===r)t=new Int32Array(e);else{if("bool"!==r)throw new Error("Unknown data type "+r);t=new Uint8Array(e)}return t}function isTensorInList(r,e){for(var t=0;t<e.length;t++)if(e[t].id===r.id)return!0;return!1}function checkForNaN(r,e,t){for(var n=0;n<r.length;n++)if(isValNaN(r[n],e))throw Error("The result of the '"+t+"' has NaNs.")}function flattenNameArrayMap(r,e){var t=[];if(r instanceof tensor_1.Tensor)t.push(r);else for(var n=r,a=0;a<e.length;a++)t.push(n[e[a]]);return t}function unflattenToNameArrayMap(r,e){if(r.length!==e.length)throw new Error("Cannot unflatten Tensor[], keys and arrays are not of same length.");for(var t={},n=0;n<r.length;n++)t[r[n]]=e[n];return t}function hasEncodingLoss(r,e){return"float32"!==e&&(("int32"!==e||"float32"===r)&&("bool"!==e||"bool"!==r))}function copyTypedArray(r,e){if(null==e||"float32"===e)return new Float32Array(r);if("int32"===e){for(var t=new Int32Array(r.length),n=0;n<t.length;++n){isValNaN(o=r[n],"int32")?t[n]=getNaN("int32"):t[n]=o}return t}if("bool"===e){var a=new Uint8Array(r.length);for(n=0;n<a.length;++n){var o;isValNaN(o=r[n],"bool")?a[n]=getNaN("bool"):0!==Math.round(o)&&(a[n]=1)}return a}throw new Error("Unknown data type "+e)}function isTypedArray(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function bytesPerElement(r){if("float32"===r||"int32"===r)return 4;if("bool"===r)return 1;throw new Error("Unknown dtype "+r)}function isFunction(r){return!!(r&&r.constructor&&r.call&&r.apply)}exports.shuffle=shuffle,exports.clamp=clamp,exports.randUniform=randUniform,exports.distSquared=distSquared,exports.assert=assert,exports.assertShapesMatch=assertShapesMatch,exports.assertTypesMatch=assertTypesMatch,exports.flatten=flatten,exports.inferShape=inferShape,exports.sizeFromShape=sizeFromShape,exports.isScalarShape=isScalarShape,exports.arraysEqual=arraysEqual,exports.isInt=isInt,exports.tanh=tanh,exports.sizeToSquarishShape=sizeToSquarishShape,exports.createShuffledIndices=createShuffledIndices,exports.rightPad=rightPad,exports.repeatedTry=repeatedTry,exports.getQueryParams=getQueryParams,exports.inferFromImplicitShape=inferFromImplicitShape,exports.NAN_INT32=1<<31,exports.NAN_BOOL=255,exports.NAN_FLOAT32=NaN,exports.getNaN=getNaN,exports.isValNaN=isValNaN,exports.squeezeShape=squeezeShape,exports.getTypedArrayFromDType=getTypedArrayFromDType,exports.isTensorInList=isTensorInList,exports.checkForNaN=checkForNaN,exports.flattenNameArrayMap=flattenNameArrayMap,exports.unflattenToNameArrayMap=unflattenToNameArrayMap,exports.hasEncodingLoss=hasEncodingLoss,exports.copyTypedArray=copyTypedArray,exports.isTypedArray=isTypedArray,exports.bytesPerElement=bytesPerElement,exports.isFunction=isFunction;

},{"./tensor":178}],184:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var version="0.5.0";exports.version=version;

},{}],185:[function(require,module,exports){
var objectCreate=Object.create||objectCreatePolyfill,objectKeys=Object.keys||objectKeysPolyfill,bind=Function.prototype.bind||functionBindPolyfill;function EventEmitter(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=objectCreate(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0;var hasDefineProperty,defaultMaxListeners=10;try{var o={};Object.defineProperty&&Object.defineProperty(o,"x",{value:0}),hasDefineProperty=0===o.x}catch(e){hasDefineProperty=!1}function $getMaxListeners(e){return void 0===e._maxListeners?EventEmitter.defaultMaxListeners:e._maxListeners}function emitNone(e,t,n){if(t)e.call(n);else for(var r=e.length,i=arrayClone(e,r),s=0;s<r;++s)i[s].call(n)}function emitOne(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,s=arrayClone(e,i),o=0;o<i;++o)s[o].call(n,r)}function emitTwo(e,t,n,r,i){if(t)e.call(n,r,i);else for(var s=e.length,o=arrayClone(e,s),a=0;a<s;++a)o[a].call(n,r,i)}function emitThree(e,t,n,r,i,s){if(t)e.call(n,r,i,s);else for(var o=e.length,a=arrayClone(e,o),l=0;l<o;++l)a[l].call(n,r,i,s)}function emitMany(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,s=arrayClone(e,i),o=0;o<i;++o)s[o].apply(n,r)}function _addListener(e,t,n,r){var i,s,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]):(s=e._events=objectCreate(null),e._eventsCount=0),o){if("function"==typeof o?o=s[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(i=$getMaxListeners(e))&&i>0&&o.length>i){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",a.name,a.message)}}else o=s[t]=n,++e._eventsCount;return e}function onceWrapper(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function _onceWrap(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=bind.call(onceWrapper,r);return i.listener=n,r.wrapFn=i,i}function _listeners(e,t,n){var r=e._events;if(!r)return[];var i=r[t];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?unwrapListeners(i):arrayClone(i,i.length):[]}function listenerCount(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function spliceOne(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}function arrayClone(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function unwrapListeners(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function objectCreatePolyfill(e){var t=function(){};return t.prototype=e,new t}function objectKeysPolyfill(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n}function functionBindPolyfill(e){var t=this;return function(){return t.apply(e,arguments)}}hasDefineProperty?Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=e}}):EventEmitter.defaultMaxListeners=defaultMaxListeners,EventEmitter.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(e){var t,n,r,i,s,o,a="error"===e;if(o=this._events)a=a&&null==o.error;else if(!a)return!1;if(a){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var l=new Error('Unhandled "error" event. ('+t+")");throw l.context=t,l}if(!(n=o[e]))return!1;var u="function"==typeof n;switch(r=arguments.length){case 1:emitNone(n,u,this);break;case 2:emitOne(n,u,this,arguments[1]);break;case 3:emitTwo(n,u,this,arguments[1],arguments[2]);break;case 4:emitThree(n,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),s=1;s<r;s++)i[s-1]=arguments[s];emitMany(n,u,this,i)}return!0},EventEmitter.prototype.addListener=function(e,t){return _addListener(this,e,t,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(e,t){return _addListener(this,e,t,!0)},EventEmitter.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,_onceWrap(this,e,t)),this},EventEmitter.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,_onceWrap(this,e,t)),this},EventEmitter.prototype.removeListener=function(e,t){var n,r,i,s,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=objectCreate(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():spliceOne(n,i),1===n.length&&(r[e]=n[0]),r.removeListener&&this.emit("removeListener",e,o||t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n,r;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=objectCreate(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=objectCreate(null):delete n[e]),this;if(0===arguments.length){var i,s=objectKeys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=objectCreate(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},EventEmitter.prototype.listeners=function(e){return _listeners(this,e,!0)},EventEmitter.prototype.rawListeners=function(e){return _listeners(this,e,!1)},EventEmitter.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):listenerCount.call(e,t)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};

},{}],186:[function(require,module,exports){
var alea=require("./lib/alea"),xor128=require("./lib/xor128"),xorwow=require("./lib/xorwow"),xorshift7=require("./lib/xorshift7"),xor4096=require("./lib/xor4096"),tychei=require("./lib/tychei"),sr=require("./seedrandom");sr.alea=alea,sr.xor128=xor128,sr.xorwow=xorwow,sr.xorshift7=xorshift7,sr.xor4096=xor4096,sr.tychei=tychei,module.exports=sr;

},{"./lib/alea":187,"./lib/tychei":188,"./lib/xor128":189,"./lib/xor4096":190,"./lib/xorshift7":191,"./lib/xorwow":192,"./seedrandom":193}],187:[function(require,module,exports){
!function(n,t,e){function s(n){var t,e=this,s=(t=4022871197,function(n){n=n.toString();for(var e=0;e<n.length;e++){var s=.02519603282416938*(t+=n.charCodeAt(e));s-=t=s>>>0,t=(s*=t)>>>0,t+=4294967296*(s-=t)}return 2.3283064365386963e-10*(t>>>0)});e.next=function(){var n=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=n-(e.c=0|n)},e.c=1,e.s0=s(" "),e.s1=s(" "),e.s2=s(" "),e.s0-=s(n),e.s0<0&&(e.s0+=1),e.s1-=s(n),e.s1<0&&(e.s1+=1),e.s2-=s(n),e.s2<0&&(e.s2+=1),s=null}function r(n,t){return t.c=n.c,t.s0=n.s0,t.s1=n.s1,t.s2=n.s2,t}function o(n,t){var e=new s(n),o=t&&t.state,u=e.next;return u.int32=function(){return 4294967296*e.next()|0},u.double=function(){return u()+1.1102230246251565e-16*(2097152*u()|0)},u.quick=u,o&&("object"==typeof o&&r(o,e),u.state=function(){return r(e,{})}),u}t&&t.exports?t.exports=o:e&&e.amd?e(function(){return o}):this.alea=o}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],188:[function(require,module,exports){
!function(t,n,e){function o(t){var n=this,e="";n.next=function(){var t=n.b,e=n.c,o=n.d,r=n.a;return t=t<<25^t>>>7^e,e=e-o|0,o=o<<24^o>>>8^r,r=r-t|0,n.b=t=t<<20^t>>>12^e,n.c=e=e-o|0,n.d=o<<16^e>>>16^r,n.a=r-t|0},n.a=0,n.b=0,n.c=-1640531527,n.d=1367130551,t===Math.floor(t)?(n.a=t/4294967296|0,n.b=0|t):e+=t;for(var o=0;o<e.length+20;o++)n.b^=0|e.charCodeAt(o),n.next()}function r(t,n){return n.a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n}function u(t,n){var e=new o(t),u=n&&n.state,c=function(){return(e.next()>>>0)/4294967296};return c.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},c.int32=e.next,c.quick=c,u&&("object"==typeof u&&r(u,e),c.state=function(){return r(e,{})}),c}n&&n.exports?n.exports=u:e&&e.amd?e(function(){return u}):this.tychei=u}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],189:[function(require,module,exports){
!function(t,n,e){function o(t){var n=this,e="";n.x=0,n.y=0,n.z=0,n.w=0,n.next=function(){var t=n.x^n.x<<11;return n.x=n.y,n.y=n.z,n.z=n.w,n.w^=n.w>>>19^t^t>>>8},t===(0|t)?n.x=t:e+=t;for(var o=0;o<e.length+64;o++)n.x^=0|e.charCodeAt(o),n.next()}function r(t,n){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n}function u(t,n){var e=new o(t),u=n&&n.state,i=function(){return(e.next()>>>0)/4294967296};return i.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=e.next,i.quick=i,u&&("object"==typeof u&&r(u,e),i.state=function(){return r(e,{})}),i}n&&n.exports?n.exports=u:e&&e.amd?e(function(){return u}):this.xor128=u}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],190:[function(require,module,exports){
!function(n,t,e){function r(n){var t=this;t.next=function(){var n,e,r=t.w,i=t.X,o=t.i;return t.w=r=r+1640531527|0,e=i[o+34&127],n=i[o=o+1&127],e^=e<<13,n^=n<<17,e^=e>>>15,n^=n>>>12,e=i[o]=e^n,t.i=o,e+(r^r>>>16)|0},function(n,t){var e,r,i,o,u,f=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),i=0,o=-32;o<c;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(u=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(u=u+1640531527|0,i=0==(e=f[127&o]^=r+u)?i+1:0);for(i>=128&&(f[127&(t&&t.length||0)]=-1),i=127,o=512;o>0;--o)r=f[i+34&127],e=f[i=i+1&127],r^=r<<13,e^=e<<17,r^=r>>>15,e^=e>>>12,f[i]=r^e;n.w=u,n.X=f,n.i=i}(t,n)}function i(n,t){return t.i=n.i,t.w=n.w,t.X=n.X.slice(),t}function o(n,t){null==n&&(n=+new Date);var e=new r(n),o=t&&t.state,u=function(){return(e.next()>>>0)/4294967296};return u.double=function(){do{var n=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===n);return n},u.int32=e.next,u.quick=u,o&&(o.X&&i(o,e),u.state=function(){return i(e,{})}),u}t&&t.exports?t.exports=o:e&&e.amd?e(function(){return o}):this.xor4096=o}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],191:[function(require,module,exports){
!function(n,t,e){function r(n){var t=this;t.next=function(){var n,e,r=t.x,i=t.i;return n=r[i],e=(n^=n>>>7)^n<<24,e^=(n=r[i+1&7])^n>>>10,e^=(n=r[i+3&7])^n>>>3,e^=(n=r[i+4&7])^n<<7,n=r[i+7&7],e^=(n^=n<<13)^n<<9,r[i]=e,t.i=i+1&7,e},function(n,t){var e,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,e=0;e<t.length;++e)r[7&e]=r[7&e]<<15^t.charCodeAt(e)+r[e+1&7]<<13;for(;r.length<8;)r.push(0);for(e=0;e<8&&0===r[e];++e);for(8==e?r[7]=-1:r[e],n.x=r,n.i=0,e=256;e>0;--e)n.next()}(t,n)}function i(n,t){return t.x=n.x.slice(),t.i=n.i,t}function o(n,t){null==n&&(n=+new Date);var e=new r(n),o=t&&t.state,u=function(){return(e.next()>>>0)/4294967296};return u.double=function(){do{var n=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===n);return n},u.int32=e.next,u.quick=u,o&&(o.x&&i(o,e),u.state=function(){return i(e,{})}),u}t&&t.exports?t.exports=o:e&&e.amd?e(function(){return o}):this.xorshift7=o}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],192:[function(require,module,exports){
!function(t,n,e){function o(t){var n=this,e="";n.next=function(){var t=n.x^n.x>>>2;return n.x=n.y,n.y=n.z,n.z=n.w,n.w=n.v,(n.d=n.d+362437|0)+(n.v=n.v^n.v<<4^t^t<<1)|0},n.x=0,n.y=0,n.z=0,n.w=0,n.v=0,t===(0|t)?n.x=t:e+=t;for(var o=0;o<e.length+64;o++)n.x^=0|e.charCodeAt(o),o==e.length&&(n.d=n.x<<10^n.x>>>4),n.next()}function r(t,n){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n.v=t.v,n.d=t.d,n}function u(t,n){var e=new o(t),u=n&&n.state,x=function(){return(e.next()>>>0)/4294967296};return x.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},x.int32=e.next,x.quick=x,u&&("object"==typeof u&&r(u,e),x.state=function(){return r(e,{})}),x}n&&n.exports?n.exports=u:e&&e.amd?e(function(){return u}):this.xorwow=u}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],193:[function(require,module,exports){
!function(n,r){var t,e=(0,eval)("this"),o=256,i=6,u="random",a=r.pow(o,i),f=r.pow(2,52),c=2*f,l=o-1;function s(l,s,h){var v=[],m=g(function n(r,t){var e,o=[],i=typeof r;if(t&&"object"==i)for(e in r)try{o.push(n(r[e],t-1))}catch(n){}return o.length?o:"string"==i?r:r+"\0"}((s=1==s?{entropy:!0}:s||{}).entropy?[l,y(n)]:null==l?function(){try{var r;return t&&(r=t.randomBytes)?r=r(o):(r=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(r)),y(r)}catch(r){var i=e.navigator,u=i&&i.plugins;return[+new Date,e,u,e.screen,y(n)]}}():l,3),v),j=new p(v),S=function(){for(var n=j.g(i),r=a,t=0;n<f;)n=(n+t)*o,r*=o,t=j.g(1);for(;n>=c;)n/=2,r/=2,t>>>=1;return(n+t)/r};return S.int32=function(){return 0|j.g(4)},S.quick=function(){return j.g(4)/4294967296},S.double=S,g(y(j.S),n),(s.pass||h||function(n,t,e,o){return o&&(o.S&&d(o,j),n.state=function(){return d(j,{})}),e?(r[u]=n,t):n})(S,m,"global"in s?s.global:this==r,s.state)}function p(n){var r,t=n.length,e=this,i=0,u=e.i=e.j=0,a=e.S=[];for(t||(n=[t++]);i<o;)a[i]=i++;for(i=0;i<o;i++)a[i]=a[u=l&u+n[i%t]+(r=a[i])],a[u]=r;(e.g=function(n){for(var r,t=0,i=e.i,u=e.j,a=e.S;n--;)r=a[i=l&i+1],t=t*o+a[l&(a[i]=a[u=l&u+r])+(a[u]=r)];return e.i=i,e.j=u,t})(o)}function d(n,r){return r.i=n.i,r.j=n.j,r.S=n.S.slice(),r}function g(n,r){for(var t,e=n+"",o=0;o<e.length;)r[l&o]=l&(t^=19*r[l&o])+e.charCodeAt(o++);return y(r)}function y(n){return String.fromCharCode.apply(0,n)}if(r["seed"+u]=s,g(r.random(),n),"object"==typeof module&&module.exports){module.exports=s;try{t=require("crypto")}catch(n){}}else"function"==typeof define&&define.amd&&define(function(){return s})}([],Math);

},{"crypto":27}],194:[function(require,module,exports){
(function (global){
!function(r){var e="object"==typeof exports&&exports,t="object"==typeof module&&module&&module.exports==e&&module,n="object"==typeof global&&global;n.global!==n&&n.window!==n||(r=n);var o,i,f,u=String.fromCharCode;function a(r){for(var e,t,n=[],o=0,i=r.length;o<i;)(e=r.charCodeAt(o++))>=55296&&e<=56319&&o<i?56320==(64512&(t=r.charCodeAt(o++)))?n.push(((1023&e)<<10)+(1023&t)+65536):(n.push(e),o--):n.push(e);return n}function d(r){if(r>=55296&&r<=57343)throw Error("Lone surrogate U+"+r.toString(16).toUpperCase()+" is not a scalar value")}function l(r,e){return u(r>>e&63|128)}function c(r){if(0==(4294967168&r))return u(r);var e="";return 0==(4294965248&r)?e=u(r>>6&31|192):0==(4294901760&r)?(d(r),e=u(r>>12&15|224),e+=l(r,6)):0==(4292870144&r)&&(e=u(r>>18&7|240),e+=l(r,12),e+=l(r,6)),e+=u(63&r|128)}function h(){if(f>=i)throw Error("Invalid byte index");var r=255&o[f];if(f++,128==(192&r))return 63&r;throw Error("Invalid continuation byte")}function v(){var r,e;if(f>i)throw Error("Invalid byte index");if(f==i)return!1;if(r=255&o[f],f++,0==(128&r))return r;if(192==(224&r)){if((e=(31&r)<<6|h())>=128)return e;throw Error("Invalid continuation byte")}if(224==(240&r)){if((e=(15&r)<<12|h()<<6|h())>=2048)return d(e),e;throw Error("Invalid continuation byte")}if(240==(248&r)&&(e=(7&r)<<18|h()<<12|h()<<6|h())>=65536&&e<=1114111)return e;throw Error("Invalid UTF-8 detected")}var s={version:"2.1.2",encode:function(r){for(var e=a(r),t=e.length,n=-1,o="";++n<t;)o+=c(e[n]);return o},decode:function(r){o=a(r),i=o.length,f=0;for(var e,t=[];!1!==(e=v());)t.push(e);return function(r){for(var e,t=r.length,n=-1,o="";++n<t;)(e=r[n])>65535&&(o+=u((e-=65536)>>>10&1023|55296),e=56320|1023&e),o+=u(e);return o}(t)}};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return s});else if(e&&!e.nodeType)if(t)t.exports=s;else{var p={}.hasOwnProperty;for(var b in s)p.call(s,b)&&(e[b]=s[b])}else r.utf8=s}(this);

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],195:[function(require,module,exports){
"use strict";Object.assign(module.exports,require("d3-array"),require("d3-scale"),require("d3-selection"),require("d3-shape"),require("d3-path"),require("d3-fetch"),require("d3-format"),require("d3-interpolate"),require("d3-collection"),require("d3-axis"),require("d3-time"),require("d3-time-format"));

},{"d3-array":28,"d3-axis":29,"d3-collection":30,"d3-fetch":33,"d3-format":34,"d3-interpolate":35,"d3-path":36,"d3-scale":37,"d3-selection":38,"d3-shape":39,"d3-time":41,"d3-time-format":40}],196:[function(require,module,exports){
module.exports={
  "GRU": [
    [0.16498248, 0.38312256, 0.55599123, 0.65791966, 0.67800948, 0.67251485, 0.65952480, 0.66509259, 0.65180205, 0.63019522, 0.59842905, 0.54884832, 0.50026017, 0.41515715, 0.28442754, 0.15930599, 0.06661732, 0.03841229, 0.03648069, 0, 0, 0],
    [0.22612278, 0.48656589, 0.64280205, 0.75038839, 0.78136693, 0.77645744, 0.76103043, 0.75609476, 0.73492189, 0.70673868, 0.66853530, 0.61148481, 0.55026538, 0.45579164, 0.32385909, 0.17074132, 0.07179867, 0.04737516, 0.03648069, 0, 0, 0],
    [0.26498095, 0.53542919, 0.68649669, 0.79215218, 0.81991231, 0.81032927, 0.79120300, 0.78005455, 0.75480772, 0.72199980, 0.68088782, 0.62016249, 0.55661359, 0.46039362, 0.32606085, 0.17074132, 0.07179867, 0.04737516, 0.03648069, 0, 0, 0]
  ],
  "LSTM": [
    [0.16676726, 0.37626697, 0.53884136, 0.64082453, 0.66960745, 0.66965024, 0.65944336, 0.66919065, 0.66066294, 0.64079170, 0.61261217, 0.56499345, 0.51584086, 0.42573967, 0.29968077, 0.16692790, 0.06696100, 0.03939009, 0.03655914, 0, 0, 0],
    [0.22837818, 0.47465125, 0.62246483, 0.73361585, 0.77401489, 0.77479948, 0.76191445, 0.75831105, 0.73990962, 0.71110583, 0.67451670, 0.61702313, 0.55588449, 0.45923250, 0.32521947, 0.17006270, 0.07137601, 0.04701398, 0.03655914, 0, 0, 0],
    [0.26740458, 0.52154859, 0.66520832, 0.77777588, 0.81441127, 0.80911520, 0.79160345, 0.78165789, 0.75716982, 0.72429096, 0.68277390, 0.62261021, 0.55765036, 0.45991602, 0.32561852, 0.17006270, 0.07137601, 0.04701398, 0.03655914, 0, 0, 0]
  ],
  "Nested LSTM": [
    [0.13668242, 0.32615537, 0.49198948, 0.59108968, 0.62159890, 0.62604301, 0.61940921, 0.63512016, 0.63063676, 0.61681965, 0.58698948, 0.54310746, 0.49671943, 0.40992755, 0.28565713, 0.15995261, 0.06681514, 0.03811944, 0.03663793, 0, 0, 0],
    [0.18943648, 0.42058772, 0.56994442, 0.68497327, 0.73673513, 0.74500432, 0.73825817, 0.74067486, 0.72730366, 0.70272199, 0.66873726, 0.61258587, 0.55228077, 0.45653025, 0.32326465, 0.17022117, 0.07201188, 0.04701398, 0.03663793, 0, 0, 0],
    [0.22421564, 0.46745211, 0.61142488, 0.73238285, 0.78517667, 0.78923174, 0.77793896, 0.77255975, 0.75223608, 0.72056462, 0.68063911, 0.62088136, 0.55806082, 0.46005483, 0.32626525, 0.17061611, 0.07201188, 0.04701398, 0.03663793, 0, 0, 0]
  ]
}

},{}],197:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),d3=require("../d3.js"),AutoComplete=function(){function e(r){(0,_classCallCheck2.default)(this,e),this._loader=d3.json(r+"data/autocomplete.json"),this._charMap=null,this._charMapInverse=null,this._wordMap=null,this._wordMapInverse=null}return(0,_createClass2.default)(e,[{key:"getCharMap",value:function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var r;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._charMap){e.next=5;break}return e.next=3,this._loader;case 3:r=e.sent,this._charMap=r.char_map;case 5:return e.abrupt("return",this._charMap);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getCharMapInverse",value:function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var r,t;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._charMapInverse){e.next=6;break}return e.next=3,this.getCharMap();case 3:for(r=e.sent,this._charMapInverse=new Map,t=0;t<r.length;t++)this._charMapInverse.set(r[t],t);case 6:return e.abrupt("return",this._charMapInverse);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getWordMap",value:function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var r;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wordMap){e.next=5;break}return e.next=3,this._loader;case 3:r=e.sent,this._wordMap=r.word_map;case 5:return e.abrupt("return",this._wordMap);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getWordMapInverse",value:function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var r,t;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wordMapInverse){e.next=6;break}return e.next=3,this.getWordMap();case 3:for(r=e.sent,this._wordMapInverse=new Map,t=0;t<r.length;t++)this._wordMapInverse.set(r[t],t);case 6:return e.abrupt("return",this._wordMapInverse);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"encodeSource",value:function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r){var t,a,n,u,s,o,i,c,l,p,h,f;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCharMapInverse();case 2:for(t=e.sent,a=[],n=[],u=!0,s=!1,o=void 0,e.prev=8,i=r[Symbol.iterator]();!(u=(c=i.next()).done);u=!0){for(l=c.value,p=l.split(""),h=new Int32Array(p.length),f=0;f<p.length;f++)h[f]=t.get(p[f]);a.push(h),n.push(p.length)}e.next=16;break;case 12:e.prev=12,e.t0=e.catch(8),s=!0,o=e.t0;case 16:e.prev=16,e.prev=17,u||null==i.return||i.return();case 19:if(e.prev=19,!s){e.next=22;break}throw o;case 22:return e.finish(19);case 23:return e.finish(16);case 24:return e.abrupt("return",{length:n,source:a});case 25:case"end":return e.stop()}},e,this,[[8,12,16,24],[17,,19,23]])}));return function(){return e.apply(this,arguments)}}()}]),e}();module.exports=AutoComplete;

},{"../d3.js":195,"@babel/runtime/helpers/asyncToGenerator":7,"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/regenerator":26}],198:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),AutoComplete=require("./dataset/autocomplete.js"),PureGRU=require("./models/pure_gru.js"),AutoCompleteDemo=require("./visual/autocomplete_demo.js"),VisualRNN=require("./visual/visual_rnn.js"),HeroConnectivity=require("./visual/hero_connectivity.js"),Connectivity=require("./visual/connectivity.js"),TrainingGraph=require("./visual/training_graph.js"),RecurrentUnitsSelect=require("./visual/recurrent_units_select.js"),Walkthrough=require("./visual/walkthrough.js"),AccuracyGraph=require("./visual/accuracy_graph.js"),dl=require("deeplearn"),dataDirectory="";function setupHeroDiagram(){return _setupHeroDiagram.apply(this,arguments)}function _setupHeroDiagram(){return(_setupHeroDiagram=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var t,r,n,a,o,u,c,i;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=function(e){clearTimeout(u),a(e).catch(function(e){throw e})},c=function(e,t,r){a(e).catch(function(e){throw e}),u=setTimeout(c,200,e>=r?t:e+1,t,r)},o=function(){return(o=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(a){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.setSelected(a),r.setSelected(a),n.setSelected(a),e.next=5,t.draw();case 5:return e.next=7,r.draw();case 7:return e.next=9,n.draw();case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)},a=function(){return o.apply(this,arguments)},(t=new HeroConnectivity({container:document.querySelector("#ar-hero-diagram-lstm"),dataDirectory:dataDirectory,filename:"connectivity_lstm.json",name:"LSTM"})).on("mouseover",i),(r=new HeroConnectivity({container:document.querySelector("#ar-hero-diagram-nlstm"),dataDirectory:dataDirectory,filename:"connectivity_nlstm.json",name:"Nested LSTM"})).on("mouseover",i),(n=new HeroConnectivity({container:document.querySelector("#ar-hero-diagram-gru"),dataDirectory:dataDirectory,filename:"connectivity_gru.json",name:"GRU"})).on("mouseover",i),window.heroReset=function(){clearTimeout(u),c(12,12,35)},window.heroSetIndex=function(e){i(e)},window.heroReset();case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function setupRecurrentUnitsSelect(){return _setupRecurrentUnitsSelect.apply(this,arguments)}function _setupRecurrentUnitsSelect(){return(_setupRecurrentUnitsSelect=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var t;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(t=new RecurrentUnitsSelect({container:document.querySelector("#ar-recurrent-units")})).on("select",function(e){t.setSelect(e),t.draw()}),t.setSelect("lstm"),t.draw();case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function setupAutocompleteDemo(){return _setupAutocompleteDemo.apply(this,arguments)}function _setupAutocompleteDemo(){return(_setupAutocompleteDemo=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t){var r,n,a,o,u,c,i,s,l,p;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s=function(){return(s=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(a),e.next=3,u(t);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)},i=function(){return s.apply(this,arguments)},c=function(){return(c=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t,n.setText(t),e.next=4,n.draw();case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)},u=function(){return c.apply(this,arguments)},r=new AutoComplete(dataDirectory),n=new AutoCompleteDemo(dataDirectory,t,r),a=null,o="",function(){function e(){return t.apply(this,arguments)}var t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function t(r,n){return _regenerator.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u(r.slice(0,n));case 2:n<r.length&&(a=setTimeout(e,500,r,n+1));case 3:case"end":return t.stop()}},t)}));return e}()("parts of north af",0),l=/^((?!chrome|android|crios|fxios).)*safari/i.test(navigator.userAgent),p=document.querySelector("#ar-demo-input-notice"),l?(dl.setBackend("cpu"),n.disableInput(),p.innerHTML="Safari doesn't support custom text."):(n.on("input",i),p.innerHTML="You can also type in your own text."),window.addEventListener("resize",function(){n.setText(o),n.draw().catch(function(e){throw e})}),window.arDemoShort=function(){i("parts of north ").catch(function(e){throw e})},window.arDemoReset=function(){i("parts of north af").catch(function(e){throw e})};case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}function setupMemorizationProblemRNN(){return _setupMemorizationProblemRNN.apply(this,arguments)}function _setupMemorizationProblemRNN(){return(_setupMemorizationProblemRNN=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var t;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(t=new VisualRNN({container:document.querySelector("#ar-memorization-problem-rnn"),colorize:function(e,t){for(var r,n=[],a=0;4>a;a++){r=[];for(var o=0;o<t;o++)0==a?o===e?r.push(1):r.push(0):o<=e?r.push(Math.pow(.8,a+(e-o))):r.push(0);n.push(r)}return n}})).draw(),t.on("mouseenter",function(e){t.setColorizeColumn(e),t.draw()}),window.addEventListener("resize",function(){t.draw()});case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function setupConnectivity(){return _setupConnectivity.apply(this,arguments)}function _setupConnectivity(){return(_setupConnectivity=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var t,r,n,a,o;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(){return(o=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(a){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.setSelected(a),r.setSelected(a),n.setSelected(a),e.next=5,t.draw();case 5:return e.next=7,r.draw();case 7:return e.next=9,n.draw();case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)},a=function(){return o.apply(this,arguments)},(t=new Connectivity({container:document.querySelector("#ar-connectivity-lstm"),dataDirectory:dataDirectory,filename:"connectivity_lstm.json",name:"LSTM"})).on("mouseover",a),(r=new Connectivity({container:document.querySelector("#ar-connectivity-nlstm"),dataDirectory:dataDirectory,filename:"connectivity_nlstm.json",name:"Nested LSTM"})).on("mouseover",a),(n=new Connectivity({container:document.querySelector("#ar-connectivity-gru"),dataDirectory:dataDirectory,filename:"connectivity_gru.json",name:"GRU"})).on("mouseover",a),e.next=10,a(106);case 10:window.connectivitySetIndex=function(e){document.querySelector("#ar-connectivity-gru").scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),a(null===e?106:e).catch(function(e){throw e})};case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function setupWalkthrough(){return _setupWalkthrough.apply(this,arguments)}function _setupWalkthrough(){return(_setupWalkthrough=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var t;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(t=new Walkthrough({container:document.querySelector("#ar-walkthrough")})).select(1),t.draw(),t.on("click",function(e,r){t.select(e),t.draw(),window.connectivitySetIndex(parseInt(r.dataset.connectivityIndex,10))});case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function setupAccuracyGraph(){return _setupAccuracyGraph.apply(this,arguments)}function _setupAccuracyGraph(){return(_setupAccuracyGraph=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var t;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(t=new AccuracyGraph({container:document.querySelector("#ar-accuracy-graph"),height:360})).draw(),window.addEventListener("resize",function(){t.draw()});case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function setupAutocompleteTrainingGraph(){return _setupAutocompleteTrainingGraph.apply(this,arguments)}function _setupAutocompleteTrainingGraph(){return(_setupAutocompleteTrainingGraph=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var t;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return 6e5,36e5,t=new TrainingGraph({container:document.querySelector("#ar-autocomplete-training"),dataDirectory:dataDirectory,name:"autocomplete",filename:"autocomplete-training.csv",ylim:[.5,10.5],xlimTime:[-6e5,258e5],xlimEpochs:[-200,15200],height:360}),e.next=5,t.draw();case 5:window.addEventListener("resize",function(){t.draw().catch(function(e){throw e})}),window.setAutocompleteTrainingGraphXAxis=function(e){t.setXAxis(e),t.draw().catch(function(e){throw e})};case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}document.addEventListener("DOMContentLoaded",(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var t,r;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{t=document.querySelectorAll("math-latex"),Array.from(t).forEach(function(e){window.katex.render(e.getAttribute("latex"),e,{displayMode:e.hasAttribute("display-mode")})})}catch(e){console.error(e)}return r=new PureGRU(dataDirectory),e.next=4,Promise.all([setupHeroDiagram(),setupMemorizationProblemRNN(),setupRecurrentUnitsSelect(),setupAutocompleteDemo(r),setupConnectivity(),setupWalkthrough(),setupAccuracyGraph(),setupAutocompleteTrainingGraph()]);case 4:r.load().catch(function(e){throw e});case 5:case"end":return e.stop()}},e)})));

},{"./dataset/autocomplete.js":197,"./models/pure_gru.js":200,"./visual/accuracy_graph.js":208,"./visual/autocomplete_demo.js":209,"./visual/connectivity.js":210,"./visual/hero_connectivity.js":211,"./visual/recurrent_units_select.js":212,"./visual/training_graph.js":213,"./visual/visual_rnn.js":214,"./visual/walkthrough.js":215,"@babel/runtime/helpers/asyncToGenerator":7,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/regenerator":26,"deeplearn":99}],199:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_awaitAsyncGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/awaitAsyncGenerator")),_wrapAsyncGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/wrapAsyncGenerator")),dl=require("deeplearn"),VariableScope=require("../operator/variable_scope.js"),LoaderCache=function(){function e(r){(0,_classCallCheck2.default)(this,e),this._loader=new dl.CheckpointLoader(r),this._cache=new Map}return(0,_createClass2.default)(e,[{key:"initialize",value:function(){return this._loader.getCheckpointManifest()}},{key:"get",value:function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._cache.has(r)){e.next=4;break}return e.next=3,this._cache.get(r);case 3:return e.abrupt("return",e.sent);case 4:return this._cache.set(r,this._loader.getVariable(r)),e.next=7,this._cache.get(r);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),AbstactModel=function(){function e(r,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"unnamed";(0,_classCallCheck2.default)(this,e),this._params=r,this._loader=new LoaderCache(t+"save/".concat(a)),this._variables=new VariableScope(this._loader,"model"),this.ready=!1}return(0,_createClass2.default)(e,[{key:"load",value:function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var r,t;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._loader.initialize();case 2:return e.next=4,this._model_fn({source:dl.tensor([0],[1],"int32"),length:dl.tensor(1,[],"int32")},this._variables,this._params);case 4:r=e.sent,t=(0,_slicedToArray2.default)(r,2),t[0],t[1],this.ready=!0;case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var r=this;return(0,_wrapAsyncGenerator2.default)(_regenerator.default.mark(function t(){var a,n,i,s,l,u,o,c,d,_,h;return _regenerator.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,_awaitAsyncGenerator2.default)(r._loader.initialize());case 2:a=0;case 3:if(!(a<e.source.length)){t.next=24;break}return n=dl.tensor(e.length[a],[],"int32"),i=dl.tensor(e.source[a],[e.source[a].length],"int32"),t.next=8,(0,_awaitAsyncGenerator2.default)(r._model_fn({source:i,length:n},r._variables,r._params));case 8:return s=t.sent,l=(0,_slicedToArray2.default)(s,2),u=l[0],o=l[1],r.ready=!0,t.next=15,(0,_awaitAsyncGenerator2.default)(Promise.all([u.data(),o.data()]));case 15:return c=t.sent,d=(0,_slicedToArray2.default)(c,2),_=d[0],h=d[1],t.next=21,{logits:_,probability:h};case 21:a++,t.next=3;break;case 24:case"end":return t.stop()}},t)}))()}}]),e}();module.exports=AbstactModel;

},{"../operator/variable_scope.js":207,"@babel/runtime/helpers/asyncToGenerator":7,"@babel/runtime/helpers/awaitAsyncGenerator":8,"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/helpers/slicedToArray":20,"@babel/runtime/helpers/wrapAsyncGenerator":23,"@babel/runtime/regenerator":26,"deeplearn":99}],200:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),dl=require("deeplearn"),AbstactModel=require("./abstact_model.js"),embeddingMatrix=require("../operator/embedding_matrix.js"),BasicGRUCell=require("../operator/basic_gru_cell.js"),MultiRNNCell=require("../operator/multi_rnn_cell.js"),dynamicRnn=require("../operator/dynamic_rnn.js"),denseLayer=require("../operator/dense_layer.js"),PureGRU=function(e){function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"autocomplete_gru";return(0,_classCallCheck2.default)(this,r),(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(r).call(this,{embedding_size:600,layers:2},e,t))}return(0,_inherits2.default)(r,e),(0,_createClass2.default)(r,[{key:"_model_fn",value:function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,t,n){var a,l,u,i,s,o,c,d,_,p;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.source,r.length,e.t0=embeddingMatrix,e.next=5,t.get("embedding-source");case 5:for(e.t1=e.sent,l=(0,e.t0)(e.t1),u=dl.gather(l,a),i=[],s=0;s<n.layers;s++)i.push(new BasicGRUCell(n.embedding_size,t.scope("rnn/multi_rnn_cell/cell_".concat(s,"/gru_cell"))));return o=new MultiRNNCell(i),e.next=13,dynamicRnn(o,u,a.shape[0]);case 13:return c=e.sent,d=(0,_slicedToArray2.default)(c,2),_=d[0],d[1],u=_[_.length-1],e.next=20,denseLayer(u,t.scope("dense"));case 20:return u=e.sent,dl.argMax(u,1),p=dl.softmax(u),e.abrupt("return",[u,p]);case 24:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),r}(AbstactModel);module.exports=PureGRU;

},{"../operator/basic_gru_cell.js":201,"../operator/dense_layer.js":202,"../operator/dynamic_rnn.js":203,"../operator/embedding_matrix.js":204,"../operator/multi_rnn_cell.js":205,"./abstact_model.js":199,"@babel/runtime/helpers/asyncToGenerator":7,"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/getPrototypeOf":11,"@babel/runtime/helpers/inherits":12,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/helpers/possibleConstructorReturn":18,"@babel/runtime/helpers/slicedToArray":20,"@babel/runtime/regenerator":26,"deeplearn":99}],201:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),dl=require("deeplearn"),split=require("./split.js"),BasicGRUCell=function(){function e(r,t){(0,_classCallCheck2.default)(this,e),this._numUnits=r,this._activation=dl.tanh.bind(dl),this._variables=t}return(0,_createClass2.default)(e,[{key:"zeroState",value:function(){return[dl.zeros([1,this._numUnits])]}},{key:"call",value:function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,t){var a,l,i,n,s,u,c,d,o,_,p,b,f,h,m,q;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,_slicedToArray2.default)(t,1),l=a[0],e.next=3,this._variables.get("gates/kernel");case 3:return i=e.sent,e.next=6,this._variables.get("gates/bias");case 6:return n=e.sent,e.next=9,this._variables.get("candidate/kernel");case 9:return s=e.sent,e.next=12,this._variables.get("candidate/bias");case 12:return u=e.sent,c=dl.matMul(dl.concat([r,l],1),i),c=dl.add(c,n),d=dl.sigmoid(c),o=split(d,2,1),_=(0,_slicedToArray2.default)(o,2),p=_[0],b=_[1],f=dl.mulStrict(p,l),h=dl.matMul(dl.concat([r,f],1),s),h=dl.add(h,u),m=this._activation(h),q=dl.add(dl.mulStrict(b,l),dl.mulStrict(dl.sub(dl.ones([1]),b),m)),e.abrupt("return",[q,[q]]);case 23:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();module.exports=BasicGRUCell;

},{"./split.js":206,"@babel/runtime/helpers/asyncToGenerator":7,"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/helpers/slicedToArray":20,"@babel/runtime/regenerator":26,"deeplearn":99}],202:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),dl=require("deeplearn");function denseLayer(){return _denseLayer.apply(this,arguments)}function _denseLayer(){return(_denseLayer=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,t){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=dl,e.t1=dl,e.t2=r,e.next=5,t.get("kernel");case 5:return e.t3=e.sent,e.t4=e.t1.matMul.call(e.t1,e.t2,e.t3),e.next=9,t.get("bias");case 9:return e.t5=e.sent,e.abrupt("return",e.t0.add.call(e.t0,e.t4,e.t5));case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}module.exports=denseLayer;

},{"@babel/runtime/helpers/asyncToGenerator":7,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/regenerator":26,"deeplearn":99}],203:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),dl=require("deeplearn");function dynamicRnn(){return _dynamicRnn.apply(this,arguments)}function _dynamicRnn(){return(_dynamicRnn=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,n,t){var a,u,i,l,o,s,c,p,d;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=[],u=[],i=r.zeroState(),l=0;case 4:if(!(l<t)){e.next=18;break}return o=dl.gather(n,dl.tensor([l],[1],"int32")),e.next=8,r.call(o,i);case 8:s=e.sent,c=(0,_slicedToArray2.default)(s,2),p=c[0],d=c[1],a.push(p),u.push(d),i=d;case 15:l++,e.next=4;break;case 18:return e.abrupt("return",[a,u]);case 19:case"end":return e.stop()}},e)}))).apply(this,arguments)}module.exports=dynamicRnn;

},{"@babel/runtime/helpers/asyncToGenerator":7,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/helpers/slicedToArray":20,"@babel/runtime/regenerator":26,"deeplearn":99}],204:[function(require,module,exports){
"use strict";var dl=require("deeplearn");function embeddingMatrix(e){return dl.concat([dl.zeros([1,e.shape[1]],"float32"),e],0)}module.exports=embeddingMatrix;

},{"deeplearn":99}],205:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),MultiRNNCell=function(){function e(r){(0,_classCallCheck2.default)(this,e),this._layers=r}return(0,_createClass2.default)(e,[{key:"zeroState",value:function(){var e=[],r=!0,t=!1,a=void 0;try{for(var l,u,n=this._layers[Symbol.iterator]();!(r=(l=n.next()).done);r=!0)u=l.value,e.push(u.zeroState())}catch(e){t=!0,a=e}finally{try{r||null==n.return||n.return()}finally{if(t)throw a}}return e}},{key:"call",value:function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,t){var a,l,u,n,i,s,o,c;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=[],l=r,u=0;case 3:if(!(u<this._layers.length)){e.next=16;break}return n=this._layers[u],e.next=7,n.call(l,t[u]);case 7:i=e.sent,s=(0,_slicedToArray2.default)(i,2),o=s[0],c=s[1],a.push(c),l=o;case 13:u++,e.next=3;break;case 16:return e.abrupt("return",[l,a]);case 17:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();module.exports=MultiRNNCell;

},{"@babel/runtime/helpers/asyncToGenerator":7,"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/helpers/slicedToArray":20,"@babel/runtime/regenerator":26}],206:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));function split(e,r,a){if(0!=e.shape[a]%r)throw new Error("number of splits ".concat(r," does not ")+"divide shape ".concat(e.shape," on axis ").concat(a));var t=(0,_toConsumableArray2.default)(e.shape);t[a]=e.shape[a]/r;for(var o=[],s=0;s<e.shape.length;s++)o[s]=0;for(var i=[],u=0;u<r;u++)i.push(e.slice(o,t)),o[a]+=t[a];return i}module.exports=split;

},{"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/helpers/toConsumableArray":21}],207:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),VariableScope=function(){function e(t,r){(0,_classCallCheck2.default)(this,e),this._loader=t,this._path=r}return(0,_createClass2.default)(e,[{key:"get",value:function(e){return this._loader.get("".concat(this._path,"/").concat(e))}},{key:"scope",value:function(t){return new e(this._loader,this._path+"/"+t)}}]),e}();module.exports=VariableScope;

},{"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/interopRequireDefault":13}],208:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),d3=require("../d3.js"),margin={top:10,right:10,bottom:0,left:10},xAxisHeight=40,yAxisWidth=45,xLabelHeight=15,yLabelWidth=15,legendItemRectSize=24,legendItemTextMargin=4,lineSetup={GRU:"#F8766D",LSTM:"#00BA38","Nested LSTM":"#619CFF"},topSuggestionSetup={1:"8 0",2:"8 8",3:"2 2"},AccuracyGraph=function(){function t(e){var i=this,a=e.container,s=e.height;(0,_classCallCheck2.default)(this,t),this._container=d3.select(a),this._height=s,this._innerHeight=s-margin.top-margin.bottom-xAxisHeight-xLabelHeight,this._data=null,this._svg=this._container.append("svg").attr("height",this._height).classed("ar-line-graph",!0),this._legend=this._container.append("div").classed("legend",!0).style("margin-left","".concat(margin.left+yAxisWidth,"px")).style("margin-right","".concat(margin.right,"px")),this._graph=this._svg.append("g").attr("transform","translate("+(margin.left+yAxisWidth+yLabelWidth)+","+margin.top+")"),this._background=this._graph.append("rect").attr("class","background").attr("height",this._innerHeight),this._xScale=d3.scaleLinear().domain([-1,21]),this._yScale=d3.scaleLinear().domain([1,0]).range([0,this._innerHeight]),this._xGrid=d3.axisBottom(this._xScale).ticks(10).tickSize(-this._height),this._xGridElement=this._graph.append("g").attr("class","grid").attr("transform","translate(0,"+this._innerHeight+")"),this._yGrid=d3.axisLeft(this._yScale).ticks(8),this._yGridElement=this._graph.append("g").attr("class","grid"),this._xAxis=d3.axisBottom(this._xScale).ticks(5),this._xAxisElement=this._graph.append("g").attr("class","axis").attr("transform","translate(0,"+this._innerHeight+")"),this._yAxis=d3.axisLeft(this._yScale).ticks(4).tickFormat(d3.format(".0%")),this._yAxisElement=this._graph.append("g").attr("class","axis"),this._yAxisTitle=this._graph.append("g").attr("class","axis-title"),this._xLabel=this._svg.append("text").attr("text-anchor","middle").attr("y",s-margin.bottom-xLabelHeight).text("characters from word"),this._svg.append("path").attr("d","M".concat(margin.left+yLabelWidth/2,",").concat(margin.top+this._innerHeight," V").concat(margin.top)).attr("id","ar-accuracy-graph-ylabel-vline"),this._yLabel=this._svg.append("text").append("textPath").attr("startOffset","50%").attr("href","#ar-accuracy-graph-ylabel-vline").attr("text-anchor","middle").text("accuracy"),this._yLabel.node().setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#ar-training-graph-".concat(name,"-ylabel")),this._lines=this._graph.append("g").classed("lines-container",!0),this._lines.selectAll("g.lines-type").data(["GRU","LSTM","Nested LSTM"],function(t){return t}).enter().append("g").classed("lines-type",!0).style("stroke",function(t){return lineSetup[t]}).each(function(){d3.select(this).selectAll("g.line").data([1,2,3]).enter().append("path").classed("line",!0).style("stroke-dasharray",function(t){return topSuggestionSetup[t]})}),this._lineDrawer=d3.line().curve(d3.curveLinear).x(function(t,e){return i._xScale(e)}).y(function(t){return i._yScale(t)}),this._data=require("../data/word-length-results.json"),this._drawLegend()}return(0,_createClass2.default)(t,[{key:"draw",value:function(){var t=this._container.node().clientWidth,e=t-(margin.left+margin.right+yAxisWidth+yLabelWidth);this._svg.attr("width",t),this._background.attr("width",e),this._xScale.range([0,e]),this._yGrid.tickSize(-e);var i=this._yScale.ticks(5);this._xScale.ticks(5);this._yGridElement.call(this._yGrid),this._yGridElement.selectAll(".tick").classed("minor",function(t){return!i.includes(t)}),this._xGridElement.call(this._xGrid),this._xGridElement.selectAll(".tick").classed("minor",function(t){return!i.includes(t)}),this._xAxisElement.call(this._xAxis),this._yAxisElement.call(this._yAxis);var a=this._lineDrawer,s=this._data;this._lines.selectAll("g.lines-type").each(function(t){d3.select(this).selectAll("path.line").data(s[t]).attr("d",function(t){return a(t)})});this._xLabel.attr("x",e/2+margin.left+yLabelWidth+yAxisWidth)}},{key:"_drawLegend",value:function(){var t=this._legend.selectAll("svg.legend-item").data([{type:"GRU",top:1},{type:"GRU",top:2},{type:"GRU",top:3},{type:"LSTM",top:1},{type:"LSTM",top:2},{type:"LSTM",top:3},{type:"Nested LSTM",top:1},{type:"Nested LSTM",top:2},{type:"Nested LSTM",top:3}]).enter().append("svg").attr("height",legendItemRectSize).classed("legend-item",!0);t.append("rect").classed("legend-background",!0).attr("width",legendItemRectSize).attr("height",legendItemRectSize),t.append("path").classed("legend-color",!0).style("stroke",function(t){var e=t.type;t.top;return lineSetup[e]}).style("stroke-dasharray",function(t){t.type;var e=t.top;return topSuggestionSetup[e]}).attr("d","M0,12 L24,12"),t.append("text").classed("legend-text",!0).attr("x",legendItemRectSize+legendItemTextMargin).attr("y",legendItemRectSize/2).text(function(t){var e=t.type,i=t.top;return"".concat(e," - top ").concat(i)})}}]),t}();module.exports=AccuracyGraph;

},{"../d3.js":195,"../data/word-length-results.json":196,"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/interopRequireDefault":13}],209:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_asyncIterator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncIterator")),d3=require("../d3.js"),events=require("events");function smoothFlowPathNarrow(t){var e=t.topX,r=t.bottomX,n=t.topWidth,a=t.bottomWidth,i=d3.path();return i.moveTo(e,0),i.quadraticCurveTo(e,15,r,30),i.lineTo(r+a,30),i.quadraticCurveTo(e+n,15,e+n,0),i.closePath(),i}function smoothFlowPathSameWidth(t){var e=t.x,r=t.borderWidth,n=t.midWidth,a=d3.path();return a.moveTo(e,0),a.quadraticCurveTo(e+r/2-n/2,15,e,30),a.lineTo(e+r,30),a.quadraticCurveTo(e+r/2+n/2,15,e+r,0),a.closePath(),a}var AutoCompleteDemo=function(t){function e(t,r,n){var a;(0,_classCallCheck2.default)(this,e),(a=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(e).call(this)))._model=r,a._text=" ",a._probabilityCacheGood=!1,a._probabilityCache=null,a._probabilityPrecomputed=d3.json(t+"data/demo-precompute.json").then(function(t){return new Map(t)}),a._dataset=n,a._inputContainer=d3.select("#ar-demo-input-content"),a._inputBackground=a._inputContainer.append("div").classed("background",!0),a._inputUnderline=a._inputContainer.append("div").classed("underline",!0),a._inputUnderline.append("span").classed("underline-letter",!0).text(" "),a._inputField=a._inputContainer.append("input").property("value",a._text).on("input",function(){return a.emit("input",a._inputField.property("value").trimLeft())}),a._rnnContainer=d3.select("#ar-demo-rnn-content"),a._rnnSvg=a._rnnContainer.append("svg").attr("height",75).attr("width","100%"),a._rnnSvgCells=a._rnnSvg.append("g").classed("cells",!0).attr("transform","translate(0, 15)"),a._rnnFlowInSvg=a._rnnSvg.append("g").classed("flow-in",!0),a._rnnFlowOutSvg=a._rnnSvg.append("g").attr("transform","translate(0, 45)").classed("flow-out",!0),a._rnnFlowOutPath=a._rnnFlowOutSvg.append("path"),a._rnnFlowArrow=a._rnnSvg.append("path").attr("transform","translate(0, 30)").attr("marker-start","url(#ar-demo-marker-circle)").attr("marker-mid","url(#ar-demo-marker-circle)").attr("marker-end","url(#ar-demo-marker-arrow)").classed("flow-arrow",!0);var i=a._rnnSvg.append("defs");return i.append("marker").attr("id","ar-demo-marker-circle").attr("markerWidth",3).attr("markerHeight",3).attr("refX",1.5).attr("refY",1.5).append("circle").attr("r",1.5).attr("cx",1.5).attr("cy",1.5).attr("fill","rgb(70, 130, 180)"),i.append("marker").attr("id","ar-demo-marker-arrow").attr("markerWidth",3).attr("markerHeight",3).attr("refX",2).attr("refY",1.5).append("path").attr("d","M0,0 L0,3 L3,1.5 Z").attr("fill","rgb(70, 130, 180)"),a._loader=a._rnnContainer.append("div").attr("id","ar-demo-loader").style("display","none"),a._loader.append("span").text("custom input, loading ..."),a._outputContainer=d3.select("#ar-demo-output-content"),a._outputCanvas=a._outputContainer.append("canvas").attr("height",30),a._outputFlowOutSvg=a._outputContainer.append("svg").attr("height",30).attr("width","100%"),a._outputFlowOutSvg.selectAll("path").data([0,0,0]).enter().append("path"),a._finalContainer=d3.select("#ar-demo-final-content"),a._finalSuggestions=a._finalContainer.append("div").classed("suggestions",!0),a}return(0,_inherits2.default)(e,t),(0,_createClass2.default)(e,[{key:"disableInput",value:function(){this._inputField.attr("disabled","disabled")}},{key:"_getMaxLength",value:function(){var t=this._inputUnderline.select("span.underline-letter").node(),e=window.getComputedStyle(t),r=parseFloat(e.width)+parseFloat(e.marginRight),n=this._inputField.node().getBoundingClientRect().width;return Math.floor(n/r)}},{key:"setText",value:function(t){var e=this._text,r=t.toLowerCase().replace(/[^a-z ]/g,"");this._text=(" "+r).slice(0,this._getMaxLength()),this._text!==e&&(this._probabilityCacheGood=!1)}},{key:"_showLoader",value:function(){this._loader.style("display","flex")}},{key:"_hideLoader",value:function(){this._loader.style("display","none")}},{key:"getProperbility",value:function(){var t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function t(e){var r,n,a,i,o,l,u,s,d,p;return _regenerator.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._probabilityPrecomputed;case 2:if(r=t.sent,!this._probabilityCacheGood){t.next=5;break}return t.abrupt("return",this._probabilityCache);case 5:if(!r.has(e)){t.next=9;break}return this._probabilityCacheGood=!0,this._probabilityCache=r.get(e),t.abrupt("return",this._probabilityCache);case 9:return(n=!this._model.ready)&&this._showLoader(),t.next=13,this._dataset.encodeSource([e]);case 13:a=t.sent,i=!0,o=!1,t.prev=16,u=(0,_asyncIterator2.default)(this._model.predict(a));case 18:return t.next=20,u.next();case 20:return s=t.sent,i=s.done,t.next=24,s.value;case 24:if(d=t.sent,i){t.next=32;break}return p=d,this._probabilityCache=p.probability,t.abrupt("break",32);case 29:i=!0,t.next=18;break;case 32:t.next=38;break;case 34:t.prev=34,t.t0=t.catch(16),o=!0,l=t.t0;case 38:if(t.prev=38,t.prev=39,i||null==u.return){t.next=43;break}return t.next=43,u.return();case 43:if(t.prev=43,!o){t.next=46;break}throw l;case 46:return t.finish(43);case 47:return t.finish(38);case 48:return this._probabilityCacheGood=!0,n&&this._hideLoader(),t.abrupt("return",this._probabilityCache);case 51:case"end":return t.stop()}},t,this,[[16,34,38,48],[39,,43,47]])}));return function(){return t.apply(this,arguments)}}()},{key:"draw",value:function(){var t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function t(){var e,r,n,a,i;return _regenerator.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this._inputField.property("value",this._text),t.next=3,this.getProperbility(this._text);case 3:return e=t.sent,r=Array.from(e).map(function(t,e){return{probability:t,index:e}}).sort(function(t,e){return e.probability-t.probability}),t.next=7,this._dataset.getWordMap();case 7:n=t.sent,a=r.slice(0,3).sort(function(t,e){return t.index-e.index}).map(function(t){var e=t.probability,r=t.index;return{probability:e,index:r,word:n[r]}}),this._drawInputUnderline(),i=this._getCellSizing(),this._drawRnn(i),this._drawOutput(i,e,a),this._drawFinal(e,a);case 14:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"_getCellSizing",value:function(){var t=this._inputContainer.node().getBoundingClientRect();return this._inputUnderline.selectAll("span.underline-letter").nodes().map(function(e){var r=e.getBoundingClientRect();return{left:r.left-t.left,width:r.width}})}},{key:"_drawInputUnderline",value:function(){var t=this,e=this._getMaxLength(),r=(this._text+" ".repeat(e-this._text.length)).split(""),n=this._inputUnderline.selectAll("span.underline-letter").data(r).classed("empty",function(e,r){return r>=t._text.length}).text(function(t){return t});n.enter().append("span").classed("underline-letter",!0).classed("empty",function(e,r){return r>=t._text.length}).text(function(t){return t}),n.exit().remove()}},{key:"_drawRnn",value:function(t){var e=t[this._text.length-1],r=this._outputContainer.node().clientWidth,n=this._rnnSvgCells.selectAll("rect").data(t).attr("x",function(t){return t.left}).attr("width",function(t){return t.width});n.enter().append("rect").attr("x",function(t){return t.left}).attr("width",function(t){return t.width}).attr("height",30),n.exit().remove();var a=this._rnnFlowInSvg.selectAll("rect").data(t.slice(0,this._text.length)).attr("x",function(t){return t.left}).attr("width",function(t){return t.width});a.enter().append("rect").attr("x",function(t){return t.left}).attr("width",function(t){return t.width}).attr("height",45),a.exit().remove(),this._rnnFlowOutPath.attr("d",smoothFlowPathNarrow({topX:e.left,topWidth:e.width,bottomX:0,bottomWidth:r}));var i=d3.path();i.moveTo(t[0].left+t[0].width/2,0);var o=!0,l=!1,u=void 0;try{for(var s,d,p=t.slice(1,this._text.length)[Symbol.iterator]();!(o=(s=p.next()).done);o=!0)d=s.value,i.lineTo(d.left+d.width/2,0)}catch(t){l=!0,u=t}finally{try{o||null==p.return||p.return()}finally{if(l)throw u}}this._rnnFlowArrow.attr("d",i)}},{key:"_drawOutput",value:function(t,e,r){t[this._text.length-1];var n=this._outputContainer.node().clientWidth,a=(n-20)/3,i=Math.floor(e.length/(n/4));this._outputFlowOutSvg.selectAll("path").data(r).attr("d",function(t,e){return smoothFlowPathNarrow({topX:4*Math.floor(t.index/i),topWidth:4,bottomX:(a+10)*e,bottomWidth:a})});this._outputCanvas.attr("width",n);for(var o=this._outputCanvas.node().getContext("2d"),l=Math.max.apply(Math,(0,_toConsumableArray2.default)(e)),u=0;u<n;u++){var s=Math.max.apply(Math,(0,_toConsumableArray2.default)(e.slice(u*i,(u+1)*i))),d=d3.interpolateViridis(s/l/3+1/3);o.beginPath(),o.fillStyle=d,o.fillRect(4*u,0,4,30),o.stroke()}}},{key:"_drawFinal",value:function(t,e){var r=this._outputContainer.node().clientWidth,n=(Math.floor(t.length/(r/4)),this._finalSuggestions.selectAll("div.suggestion").data(e).each(function(t){d3.select(this).select("span.word").text(t.word),d3.select(this).select("span.probability").text("(".concat((100*t.probability).toFixed(2),"%)"))}));n.enter().append("div").classed("suggestion",!0).each(function(t){d3.select(this).append("span").classed("word",!0).text(t.word),d3.select(this).append("span").classed("probability",!0).text("(".concat((100*t.probability).toFixed(2),"%)"))}),n.exit().remove()}}]),e}(events.EventEmitter);module.exports=AutoCompleteDemo;

},{"../d3.js":195,"@babel/runtime/helpers/asyncIterator":6,"@babel/runtime/helpers/asyncToGenerator":7,"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/getPrototypeOf":11,"@babel/runtime/helpers/inherits":12,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/helpers/possibleConstructorReturn":18,"@babel/runtime/helpers/toConsumableArray":21,"@babel/runtime/regenerator":26,"events":185}],210:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),d3=require("../d3.js"),events=require("events"),Connectivity=function(e){function t(e){var r,a=e.container,i=e.dataDirectory,n=e.filename,s=e.name;return(0,_classCallCheck2.default)(this,t),(r=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(t).call(this)))._name=s,r._data=d3.json(i+"data/"+n),r._isInitialized=!1,r._selectedCharIndex=0,r._container=d3.select(a),r._textArea=r._container.append("div").classed("textarea",!0),r._predictArea=r._container.append("div").classed("predictarea",!0),r._predictArea.selectAll(".prediction").data([{word:"",probability:0},{word:"",probability:0},{word:"",probability:0}]).enter().append("div").classed("prediction",!0).each(function(){d3.select(this).append("span").classed("word",!0),d3.select(this).append("span").classed("probability",!0)}),r._nameArea=r._container.append("div").classed("namearea",!0),r._nameArea.append("span").text(s),r}return(0,_inherits2.default)(t,e),(0,_createClass2.default)(t,[{key:"_initializeTextDraw",value:function(e){var t=this;this._isInitialized||(this._isInitialized=!0,this._textArea.selectAll("span").data(e).enter().append("span").text(function(e){return e.char}).on("mouseover",function(e,r){return t.emit("mouseover",r)}))}},{key:"setSelected",value:function(e){this._selectedCharIndex=e}},{key:"draw",value:function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var t,r,a,i,n,s,l,o,u,c,d,p=this;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._data;case 2:for(t=e.sent,this._initializeTextDraw(t),r=t[this._selectedCharIndex],a=r.connectivity,i=[],n=Math.max.apply(Math,(0,_toConsumableArray2.default)(a)),s=!0,l=!1,o=void 0,e.prev=11,u=a[Symbol.iterator]();!(s=(c=u.next()).done);s=!0)d=c.value,i.push(d/n);e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),l=!0,o=e.t0;case 19:e.prev=19,e.prev=20,s||null==u.return||u.return();case 22:if(e.prev=22,!l){e.next=25;break}throw o;case 25:return e.finish(22);case 26:return e.finish(19);case 27:this._predictArea.selectAll(".prediction").data(r.predict.slice(0,3).map(function(e,t){return{word:e,probability:r.probability[t]}})).each(function(e){d3.select(this).select("span.word").text(e.word),d3.select(this).select("span.probability").text("(".concat((100*e.probability).toFixed(2),"%)"))}),this._textArea.selectAll("span").data(i).style("background-color",interpolateViridisSubset).classed("selected",function(e,t){return p._selectedCharIndex===t});case 29:case"end":return e.stop()}},e,this,[[11,15,19,27],[20,,22,26]])}));return function(){return e.apply(this,arguments)}}()}]),t}(events.EventEmitter);function interpolateViridisSubset(e){return d3.interpolateViridis(.29+e*(2/3-.29))}module.exports=Connectivity;

},{"../d3.js":195,"@babel/runtime/helpers/asyncToGenerator":7,"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/getPrototypeOf":11,"@babel/runtime/helpers/inherits":12,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/helpers/possibleConstructorReturn":18,"@babel/runtime/helpers/toConsumableArray":21,"@babel/runtime/regenerator":26,"events":185}],211:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),d3=require("../d3.js"),events=require("events"),HeroConnectivity=function(e){function t(e){var r,a=e.container,i=e.dataDirectory,n=e.filename,s=e.name;return(0,_classCallCheck2.default)(this,t),(r=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(t).call(this)))._name=s,r._textLimit=70,r._data=d3.json(i+"data/"+n),r._isInitialized=!1,r._selectedCharIndex=0,r._container=d3.select(a),r._textArea=r._container.append("div").classed("textarea",!0),r._nameArea=r._container.append("div").classed("namearea",!0),r._nameArea.append("span").text(s),r}return(0,_inherits2.default)(t,e),(0,_createClass2.default)(t,[{key:"_initializeTextDraw",value:function(e){var t=this;this._isInitialized||(this._isInitialized=!0,this._textArea.selectAll("span").data(e).enter().append("span").text(function(e){return e.char}).on("mouseover",function(e,r){return t.emit("mouseover",r)}))}},{key:"setSelected",value:function(e){this._selectedCharIndex=e}},{key:"draw",value:function(){var e=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var t,r,a,i,n,s,u,l,o,c,p,d=this;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._data;case 2:for(t=e.sent,this._initializeTextDraw(t.slice(0,this._textLimit)),r=t[this._selectedCharIndex],a=r.connectivity.slice(0,this._textLimit),i=[],n=Math.max.apply(Math,(0,_toConsumableArray2.default)(a)),s=!0,u=!1,l=void 0,e.prev=11,o=a[Symbol.iterator]();!(s=(c=o.next()).done);s=!0)p=c.value,i.push(p/n);e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),u=!0,l=e.t0;case 19:e.prev=19,e.prev=20,s||null==o.return||o.return();case 22:if(e.prev=22,!u){e.next=25;break}throw l;case 25:return e.finish(22);case 26:return e.finish(19);case 27:this._textArea.selectAll("span").data(i).style("background-color",interpolateViridisSubset).classed("selected",function(e,t){return d._selectedCharIndex===t});case 28:case"end":return e.stop()}},e,this,[[11,15,19,27],[20,,22,26]])}));return function(){return e.apply(this,arguments)}}()}]),t}(events.EventEmitter);function interpolateViridisSubset(e){return d3.interpolateViridis(.29+e*(2/3-.29))}module.exports=HeroConnectivity;

},{"../d3.js":195,"@babel/runtime/helpers/asyncToGenerator":7,"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/getPrototypeOf":11,"@babel/runtime/helpers/inherits":12,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/helpers/possibleConstructorReturn":18,"@babel/runtime/helpers/toConsumableArray":21,"@babel/runtime/regenerator":26,"events":185}],212:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),events=require("events"),d3=require("../d3.js"),RecurrentUnitsSelect=function(e){function t(e){var r,i=e.container;return(0,_classCallCheck2.default)(this,t),(r=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(t).call(this)))._container=d3.select(i),r._menu=r._container.insert("ul",":first-child"),r._menu.selectAll("li").data([{text:"Nested LSTM",id:"nlstm"},{text:"LSTM",id:"lstm"},{text:"GRU",id:"gru"}],function(e){return e.id}).enter().append("li").text(function(e){return e.text}).on("click",function(e){return r.emit("select",e.id)}),r._selectedId="nlstm",r}return(0,_inherits2.default)(t,e),(0,_createClass2.default)(t,[{key:"setSelect",value:function(e){this._selectedId=e}},{key:"draw",value:function(){var e=this;this._menu.selectAll("li").classed("selected",function(t){return t.id===e._selectedId});this._container.attr("data-show",this._selectedId)}}]),t}(events.EventEmitter);module.exports=RecurrentUnitsSelect;

},{"../d3.js":195,"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/getPrototypeOf":11,"@babel/runtime/helpers/inherits":12,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/helpers/possibleConstructorReturn":18,"events":185}],213:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),d3=require("../d3.js"),margin={top:0,right:10,bottom:10,left:60},facetWidth=30,legendHeight=40,xAxisHeight=20,xLabelHeight=20,SubGraph=function(){function t(e){var a=this,i=e.container,r=e.topName,s=e.name,n=e.lineSetup,h=e.outerHeight,l=e.drawXAxis,c=e.xlimTime,o=e.xlimEpochs,d=e.ylim;(0,_classCallCheck2.default)(this,t),this.height=h-margin.top-margin.bottom,this.xlimTime=c,this.xlimEpochs=o,this.lineSetup=n,this.container=i,this.graph=this.container.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),this.facet=this.container.append("g").classed("facet",!0),this.facet.append("rect").classed("facet-background",!0).attr("width",facetWidth).attr("height",this.height);this.facet.append("path").attr("d","M10,0 V".concat(this.height)).attr("id","ar-training-graph-".concat(r,"-").concat(s,"-facet-text"));this.facet.append("text").append("textPath").attr("startOffset","50%").attr("href","#ar-training-graph-".concat(r,"-").concat(s,"-facet-text")).attr("text-anchor","middle").text(s).node().setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#ar-training-graph-".concat(r,"-").concat(s,"-facet-text")),this.background=this.graph.append("rect").attr("class","background").attr("height",this.height),this.yScale=d3.scaleLinear().domain(d).range([this.height,0]),this.xGridElement=this.graph.append("g").attr("class","grid").attr("transform","translate(0,"+this.height+")"),this.yGrid=d3.axisLeft(this.yScale).ticks(8),this.yGridElement=this.graph.append("g").attr("class","grid"),this.xAxisElement=this.graph.append("g").attr("class","axis").classed("hide-axis",!l).attr("transform","translate(0,"+this.height+")"),this.yAxis=d3.axisLeft(this.yScale).ticks(4),this.yAxisElement=this.graph.append("g").attr("class","axis"),this.lineDrawers=[],this.lineElements=[];for(var m,p=this,g=0;g<n.length;g++){m=d3.line().x(function(t){return p.xScale(t[a.dataColumn])}).y(function(t){return a.yScale(t.lossSmooth)}),this.lineDrawers.push(m);var u=this.graph.append("path").attr("class","line").attr("stroke",n[g].color);this.lineElements.push(u)}}return(0,_createClass2.default)(t,[{key:"setData",value:function(t){for(var e,a=0;a<this.lineSetup.length;a++)e=t[this.lineSetup[a].name],this.lineElements[a].data([e])}},{key:"setXAxis",value:function(t){this.xAxisName=t,"time"===t?(this.dataColumn="sec",this.xScale=d3.scaleTime().domain(this.xlimTime),this.xGrid=d3.axisBottom(this.xScale).ticks(d3.timeMinute.every(30)).tickSize(-this.height),this.xAxis=d3.axisBottom(this.xScale).ticks(d3.timeMinute.every(60)).tickFormat(function(t){var e=Math.floor(t.getTime()/36e5);return"0".concat(e,":00:00")})):"mini-batches"==t&&(this.dataColumn="step",this.xScale=d3.scaleLinear().domain(this.xlimEpochs),this.xGrid=d3.axisBottom(this.xScale).ticks(17).tickSize(-this.height),this.xAxis=d3.axisBottom(this.xScale).ticks(9))}},{key:"xTicksMajors",value:function(){if("time"===this.xAxisName){var t=this.xScale.ticks(d3.timeMinute.every(60)).map(function(t){return t.getTime()});return function(e){return!t.includes(e.getTime())}}if("mini-batches"===this.xAxisName){var e=this.xScale.ticks(4);return function(t){return!e.includes(t)}}}},{key:"draw",value:function(t){var e=t.outerWidth,a=(t.outerHeight,e-facetWidth-margin.left-margin.right);this.background.attr("width",a),this.facet.attr("transform","translate(".concat(margin.left+a,", ").concat(margin.top,")")),this.xScale.range([0,a]),this.yGrid.tickSize(-a);var i=this.yScale.ticks(4);this.yGridElement.call(this.yGrid),this.yGridElement.selectAll(".tick").classed("minor",function(t){return!i.includes(t)}),this.xGridElement.call(this.xGrid),this.xGridElement.selectAll(".tick").classed("minor",this.xTicksMajors()),this.xAxisElement.call(this.xAxis),this.yAxisElement.call(this.yAxis);for(var r=0;r<this.lineSetup.length;r++)this.lineElements[r].attr("d",this.lineDrawers[r])}}]),t}(),TrainingGraph=function(){function t(e){var a=e.container,i=e.dataDirectory,r=e.name,s=e.filename,n=e.height,h=e.xlimTime,l=e.xlimEpochs,c=e.ylim;(0,_classCallCheck2.default)(this,t),this._data=d3.csv(i+"data/"+s,function(t){return{dataset:t.dataset,loss:parseFloat(t.loss),lossSmooth:parseFloat(t["loss smooth"]),model:t.model,sec:new Date(1e3*parseFloat(t.sec)),time:new Date(1e3*parseFloat(t["wall time"])),step:parseInt(t.step)}}),this._dataLoaded=!1;var o=[{name:"GRU",color:"#F8766D"},{name:"LSTM",color:"#00BA38"},{name:"Nested LSTM",color:"#619CFF"}],d=(n-legendHeight-xLabelHeight-xAxisHeight)/2;this._container=d3.select(a).attr("height",n).attr("xmlns:xlink","http://www.w3.org/1999/xlink"),this._train=new SubGraph({container:this._container.append("g"),topName:r,name:"training",lineSetup:o,outerHeight:d,drawXAxis:!1,xlimTime:h,xlimEpochs:l,ylim:c}),this._valid=new SubGraph({container:this._container.append("g").attr("transform","translate(0, ".concat(d,")")),topName:r,name:"validation",lineSetup:o,outerHeight:d,drawXAxis:!0,xlimTime:h,xlimEpochs:l,ylim:c}),this._labels=this._container.append("g").attr("transform","translate(0, ".concat(margin.top,")"));var m=n-legendHeight,p=m-margin.bottom-margin.top-xAxisHeight;this._labels.append("path").attr("d","M".concat(margin.left/2,",").concat(p," V0")).attr("id","ar-training-graph-".concat(r,"-ylabel"));this._yLabel=this._labels.append("text").append("textPath").attr("startOffset","50%").attr("href","#ar-training-graph-".concat(r,"-ylabel")).attr("text-anchor","middle").text("cross entropy loss"),this._yLabel.node().setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#ar-training-graph-".concat(r,"-ylabel")),this._xLabel=this._labels.append("text").attr("text-anchor","middle").attr("y",m-12),this._legend=this._container.append("g").classed("legned",!0).attr("transform","translate(".concat(margin.left,", ").concat(m,")")),this._legendOfsset=this._legend.append("g");for(var g=0,u=0;u<o.length;u++){var x=o[u],f=x.name,_=x.color;this._legendOfsset.append("rect").attr("width",25).attr("height",25).attr("x",g),this._legendOfsset.append("line").attr("x1",g+2).attr("x2",g+25-2).attr("y1",12.5).attr("y2",12.5).attr("stroke",_),g+=30+this._legendOfsset.append("text").attr("x",g+30).attr("y",19).text(f).node().getComputedTextLength()+20}this._legendWidth=g-20,this._xAxisName="",this.setXAxis("time")}return(0,_createClass2.default)(t,[{key:"setXAxis",value:function(t){this._xAxisName=t,this._train.setXAxis(t),this._valid.setXAxis(t)}},{key:"getGraphWidth",value:function(){return this._container.node().getBoundingClientRect().width}},{key:"draw",value:function(){var t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function t(){var e,a,i,r;return _regenerator.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this._dataLoaded){t.next=8;break}return t.next=3,this._data;case 3:e=t.sent,a=d3.nest().key(function(t){return t.dataset}).key(function(t){return t.model}).object(e),this._train.setData(a.train),this._valid.setData(a.valid),this._dataLoaded=!0;case 8:i=this.getGraphWidth(),r=i-margin.left-margin.right-facetWidth,this._train.draw({outerWidth:i}),this._valid.draw({outerWidth:i}),this._xLabel.attr("x",r/2+margin.left).text(this._xAxisName),this._legendOfsset.attr("transform","translate(".concat((r-this._legendWidth)/2,", 0)"));case 14:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),t}();module.exports=TrainingGraph;

},{"../d3.js":195,"@babel/runtime/helpers/asyncToGenerator":7,"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/regenerator":26}],214:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),d3=require("../d3.js"),events=require("events"),blockWidth=12,blockSpace=14;function arange(t){for(var r=[],e=0;e<t;e++)r.push(e);return r}var VisualRNN=function(t){function r(t){var e,a=t.container,i=t.colorize;(0,_classCallCheck2.default)(this,r),(e=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(r).call(this)))._colorize=i,e._colorizeColumn=1/0,e._colorScale=d3.interpolateRgb("#f3f3f3","#9BC0DB"),e._container=d3.select(a).classed("ar-visual-rnn",!0),e._descriptions=e._container.append("div").classed("descriptions",!0),e._descriptions.selectAll("figcaption").data(["Softmax Layer","Recurrent Layer","Recurrent Layer","Input Layer"]).enter().append("figcaption").text(function(t){return t}),e._svg=e._container.append("svg");var o=e._svg.append("defs");return o.append("marker").attr("id",e._arrowId("right-inactive")).attr("markerWidth",3).attr("markerHeight",3).attr("refX",2).attr("refY",1.5).append("path").attr("d","M0,0 L0,3 L3,1.5 Z").attr("fill","#BBBBBB"),o.append("marker").attr("id",e._arrowId("right-active")).attr("markerWidth",3).attr("markerHeight",3).attr("refX",2).attr("refY",1.5).append("path").attr("d","M0,0 L0,3 L3,1.5 Z").attr("fill","#9BC0DB"),o.append("marker").attr("id",e._arrowId("up-inactive")).attr("markerWidth",3).attr("markerHeight",3).attr("refX",1.5).attr("refY",2).append("path").attr("d","M0,3 L3,3 L1.5,0 Z").attr("fill","#BBBBBB"),o.append("marker").attr("id",e._arrowId("up-active")).attr("markerWidth",3).attr("markerHeight",3).attr("refX",1.5).attr("refY",2).append("path").attr("d","M0,3 L3,3 L1.5,0 Z").attr("fill","#9BC0DB"),e._softmax=e._svg.append("g").attr("transform","translate(0, 0)"),e._recurrentTop=e._svg.append("g").attr("transform","translate(0, 60)"),e._recurrentBottom=e._svg.append("g").attr("transform","translate(0, 120)"),e._input=e._svg.append("g").attr("transform","translate(0, 180)"),e}return(0,_inherits2.default)(r,t),(0,_createClass2.default)(r,[{key:"_arrowId",value:function(t){return this._container.attr("id")+"-visual-rnn-arrow-"+t}},{key:"setColorizeColumn",value:function(t){this._colorizeColumn=t}},{key:"draw",value:function(){var t=this._svg.node().getBoundingClientRect().width,r=1+Math.floor((t-blockWidth)/(blockWidth+blockSpace)),e=this._colorize(Math.min(this._colorizeColumn,r-1),r);this._softmax.call(this._drawBoxes({blockWidth:blockWidth,blockSpace:blockSpace,blocks:r,colors:e[0]})),this._recurrentTop.call(this._drawBoxes({blockWidth:blockWidth,blockSpace:blockSpace,blocks:r,colors:e[1]})).call(this._drawUpArrow({blockWidth:blockWidth,blockSpace:blockSpace,blocks:r})).call(this._drawRightArrow({blockWidth:blockWidth,blockSpace:blockSpace,blocks:r})),this._recurrentBottom.call(this._drawBoxes({blockWidth:blockWidth,blockSpace:blockSpace,blocks:r,colors:e[2]})).call(this._drawUpArrow({blockWidth:blockWidth,blockSpace:blockSpace,blocks:r})).call(this._drawRightArrow({blockWidth:blockWidth,blockSpace:blockSpace,blocks:r})),this._input.call(this._drawBoxes({blockWidth:blockWidth,blockSpace:blockSpace,blocks:r,colors:e[3]})).call(this._drawUpArrow({blockWidth:blockWidth,blockSpace:blockSpace,blocks:r}))}},{key:"_drawBoxes",value:function(t){var r=t.blockWidth,e=t.blockSpace,a=t.blocks,i=t.colors,o=this.emit.bind(this,"mouseenter"),c=this._colorScale.bind(this);return function(t){var n=t.selectAll("rect.unit").data(arange(a)).attr("fill",function(t){return c(i[t])});n.enter().append("rect").classed("unit",!0).attr("width",r).attr("height",30).attr("rx",3).attr("x",function(t){return t*(r+e)}).attr("y",15).on("mouseenter",o).attr("fill",function(t){return c(i[t])}),n.exit().remove()}}},{key:"_drawUpArrow",value:function(t){var r=t.blockWidth,e=t.blockSpace,a=t.blocks,i="url(#".concat(this._arrowId("up-active"),")"),o="url(#".concat(this._arrowId("up-inactive"),")"),c=this._colorizeColumn;return function(t){var n=t.selectAll("path.arrow-up").data(arange(a)).attr("marker-end",function(t){return t<=c?i:o}).classed("active",function(t){return t<=c}).classed("inactive",function(t){return t>c});n.enter().append("path").classed("arrow-up",!0).attr("d",function(t){return"M ".concat(t*(r+e)+r/2," 15 v -15")}).attr("marker-end",function(t){return t<=c?i:o}).classed("active",function(t){return t<=c}).classed("inactive",function(t){return t>c}),n.exit().remove()}}},{key:"_drawRightArrow",value:function(t){var r=t.blockWidth,e=t.blockSpace,a=t.blocks,i="url(#".concat(this._arrowId("right-active"),")"),o="url(#".concat(this._arrowId("right-inactive"),")"),c=this._colorizeColumn;return function(t){var n=t.selectAll("path.arrow-right").data(arange(a-1)).attr("marker-end",function(t){return t<c?i:o}).classed("active",function(t){return t<c}).classed("inactive",function(t){return t>=c});n.enter().append("path").classed("arrow-right",!0).attr("d",function(t){return"M ".concat(t*(r+e)+r," 30 h 10")}).attr("marker-end",function(t){return t<c?i:o}).classed("active",function(t){return t<c}).classed("inactive",function(t){return t>=c}),n.exit().remove()}}}]),r}(events.EventEmitter);module.exports=VisualRNN;

},{"../d3.js":195,"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/getPrototypeOf":11,"@babel/runtime/helpers/inherits":12,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/helpers/possibleConstructorReturn":18,"events":185}],215:[function(require,module,exports){
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),events=require("events"),d3=require("../d3.js"),Walkthrough=function(e){function t(e){var r,i=e.container;(0,_classCallCheck2.default)(this,t),r=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(t).call(this));var s=(0,_assertThisInitialized2.default)(r);r._container=d3.select(i),r._steps=r._container.selectAll(".ar-walkthrough-step"),r._pages=r._container.selectAll(".ar-walkthrough-page").on("click",function(e){s.emit("click",e,this)});var l=r._steps.nodes().map(function(e,t){return t+1});return r._pages.data(l),r._steps.data(l),r._selectedItem=1,r}return(0,_inherits2.default)(t,e),(0,_createClass2.default)(t,[{key:"select",value:function(e){this._selectedItem=e}},{key:"draw",value:function(){var e=this;this._steps.classed("ar-walkthrough-selected",function(t){return t===e._selectedItem})}}]),t}(events.EventEmitter);module.exports=Walkthrough;

},{"../d3.js":195,"@babel/runtime/helpers/assertThisInitialized":5,"@babel/runtime/helpers/classCallCheck":9,"@babel/runtime/helpers/createClass":10,"@babel/runtime/helpers/getPrototypeOf":11,"@babel/runtime/helpers/inherits":12,"@babel/runtime/helpers/interopRequireDefault":13,"@babel/runtime/helpers/possibleConstructorReturn":18,"events":185}]},{},[198]);
